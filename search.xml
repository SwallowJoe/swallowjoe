<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Vulkanå…¥é—¨(1)-ç¯å¢ƒé…ç½®</title>
    <url>/2022/02/26/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡ä¸»è¦æ˜¯ä»‹ç»å¦‚ä½•åœ¨ ubuntu æœºå™¨ä¸Šå®‰è£…å¹¶ç¼–è¯‘Vulkanç¨‹åºã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li><a href="https://vulkan.lunarg.com/doc/sdk/1.2.170.0/linux/getting_started.html">https://vulkan.lunarg.com/doc/sdk/1.2.170.0/linux/getting_started.html</a></li>
<li><a href="https://github.com/google/glog">https://github.com/google/glog</a></li>
<li>[pkg-configçš„ç”¨æ³•]<a href="https://www.cnblogs.com/chris-cp/p/3580002.html">https://www.cnblogs.com/chris-cp/p/3580002.html</a></li>
<li>[è§£å†³&#x2F;usr&#x2F;local&#x2F;lib&#x2F;libglog.so.0: error adding symbols: DSO missing from command line]<a href="https://blog.csdn.net/u010987458/article/details/72235408">https://blog.csdn.net/u010987458/article/details/72235408</a></li>
<li><a href="https://www.glfw.org/docs/3.3/build_guide.html#build_link_cmake_package">https://www.glfw.org/docs/3.3/build_guide.html#build_link_cmake_package</a></li>
<li>[GLFW]<a href="https://www.glfw.org/">https://www.glfw.org/</a></li>
<li>[GLM]<a href="https://github.com/g-truc/glm">https://github.com/g-truc/glm</a></li>
</ol>
<h1 id="ä¸€-å‡†å¤‡ç¯å¢ƒ"><a href="#ä¸€-å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="ä¸€. å‡†å¤‡ç¯å¢ƒ"></a>ä¸€. å‡†å¤‡ç¯å¢ƒ</h1><h2 id="1-1-å¼€å‘ç¯å¢ƒ"><a href="#1-1-å¼€å‘ç¯å¢ƒ" class="headerlink" title="1.1 å¼€å‘ç¯å¢ƒ"></a>1.1 å¼€å‘ç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get dist-upgrade</span><br><span class="line">sudo apt-get install libglm-dev cmake libxcb-dri3-0 libxcb-present0 libpciaccess0 libpng-dev libxcb-keysyms1-dev libxcb-dri3-dev libx11-dev  libmirclient-dev libwayland-dev libxrandr-dev libxcb-ewmh-dev</span><br><span class="line"></span><br><span class="line">sudo apt-get install git libpython2.7</span><br></pre></td></tr></table></figure>

<h2 id="1-2-ä¸‹è½½-SDK"><a href="#1-2-ä¸‹è½½-SDK" class="headerlink" title="1.2 ä¸‹è½½ SDK"></a>1.2 ä¸‹è½½ SDK</h2><p>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://vulkan.lunarg.com/">https://vulkan.lunarg.com/</a> ä¸‹è½½SDKåŒ…ï¼švulkan-sdk.tar.gz</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd ~/Program</span><br><span class="line">mkdir vulkan</span><br><span class="line">cd vulkan</span><br><span class="line">tar zxf $HOME/Downloads/vulkan-sdk.tar.gz</span><br></pre></td></tr></table></figure>
<p>è§£å‹åçš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ–‡ä»¶å¤¹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>x86_64&#x2F;bin</td>
<td>Vulkanå·¥å…·å’Œå‘½ä»¤</td>
</tr>
<tr>
<td>x86_64&#x2F;include&#x2F;vulkan</td>
<td>ç¼–è¯‘é“¾æ¥å¤´æ–‡ä»¶</td>
</tr>
<tr>
<td>x86_64&#x2F;lib</td>
<td>VulkanåŠ è½½ç¨‹åºåº“å’Œlayerè¿è¡Œæ—¶åº“</td>
</tr>
<tr>
<td>x86_64&#x2F;etc&#x2F;explicit_layer.d</td>
<td>.json ç”¨äºVulkanéªŒè¯å±‚çš„æ¸…å•æ–‡ä»¶</td>
</tr>
<tr>
<td>config</td>
<td>æ ·æœ¬å±‚è®¾ç½®æ–‡ä»¶ï¼Œç³»ç»Ÿé…ç½®è¯´æ˜</td>
</tr>
<tr>
<td>doc</td>
<td>Khronos SPIRVï¼ŒVulkanï¼ŒLoaderå’ŒWSIè§„èŒƒ</td>
</tr>
<tr>
<td>examples</td>
<td>Vulkanç¨‹åºç¤ºä¾‹</td>
</tr>
<tr>
<td>samples</td>
<td>Vulkançš„ç¤ºä¾‹ä»£ç </td>
</tr>
<tr>
<td>source</td>
<td>glslangå’Œæ‰€é€‰Vulkanç»„ä»¶çš„æºå’Œè°ƒè¯•åº“</td>
</tr>
</tbody></table>
<h2 id="1-3-å®‰è£…SDK"><a href="#1-3-å®‰è£…SDK" class="headerlink" title="1.3 å®‰è£…SDK"></a>1.3 å®‰è£…SDK</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source ~/Program/vulkan/1.2.170.0/setup-env.sh</span><br><span class="line"></span><br><span class="line">export VULKAN_SDK=~/vulkan/1.2.170.0/x86_64</span><br><span class="line">export PATH=$VULKAN_SDK/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=$VULKAN_SDK/lib:$LD_LIBRARY_PATH</span><br><span class="line">export VK_LAYER_PATH=$VULKAN_SDK/etc/explicit_layer.d</span><br></pre></td></tr></table></figure>

<p>å¤§åŠŸå‘Šæˆï¼Œæ£€æŸ¥ä¸€ä¸‹ï¼šè¾“å…¥vulkaninfo<br><a href="mailto:&#117;&#98;&#117;&#x6e;&#116;&#117;&#64;&#49;&#56;&#x2e;&#48;&#x34;&#x4c;">&#117;&#98;&#117;&#x6e;&#116;&#117;&#64;&#49;&#56;&#x2e;&#48;&#x34;&#x4c;</a> ~  vulkaninfo<br>Cannot create Vulkan instance.<br>&#x2F;home&#x2F;lunarg&#x2F;sdk-build&#x2F;Vulkan-Tools&#x2F;vulkaninfo&#x2F;vulkaninfo.c:921: failed with VK_ERROR_INCOMPATIBLE_DRIVER</p>
<p>wtf, å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿç­‰ç­‰ï¼Œè²Œä¼¼æˆ‘ä»¬æ²¡æœ‰æ£€æŸ¥æ˜¯å¦å®‰è£…äº†é©±åŠ¨ã€‚ã€‚ã€‚</p>
<h2 id="1-4-å®‰è£…é©±åŠ¨"><a href="#1-4-å®‰è£…é©±åŠ¨" class="headerlink" title="1.4 å®‰è£…é©±åŠ¨"></a>1.4 å®‰è£…é©±åŠ¨</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:oibaf/graphics-drivers</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line">apt install libvulkan1 mesa-vulkan-drivers vulkan-utils</span><br><span class="line"></span><br><span class="line">// æˆ–è€…è¯•è¯•ï¼š</span><br><span class="line">sudo add-apt-repository ppa:graphics-drivers/ppa</span><br><span class="line">sudo apt upgrade</span><br><span class="line">sudo apt install nvidia-graphics-drivers-396 nvidia-settings vulkan vulkan-utils</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ä¸€ä¸‹ï¼šè¾“å…¥vulkaninfo</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_1.png" alt="å›¾ç‰‡"></p>
<p>æˆ–è€…ï¼švulkaninfo â€“html , åœ¨å½“å‰ç›®å½•ç”Ÿæˆ vulkaninfo.html æ–‡ä»¶ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šä¿¡æ¯</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_2.png" alt="å›¾ç‰‡"></p>
<h2 id="1-5-è¿è¡Œç¤ºä¾‹ç¨‹åº"><a href="#1-5-è¿è¡Œç¤ºä¾‹ç¨‹åº" class="headerlink" title="1.5. è¿è¡Œç¤ºä¾‹ç¨‹åº"></a>1.5. è¿è¡Œç¤ºä¾‹ç¨‹åº</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd Program/vulkan/1.1.160.0/examples</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<p>makeæˆåŠŸåä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆï¼š</p>
<p><img src="/./images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_3.png" alt="å›¾ç‰‡"></p>
<p>è¿è¡Œç¤ºä¾‹ç¨‹åºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./vkcube</span><br></pre></td></tr></table></figure>

<p><img src="/./images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_4.png" alt="å›¾ç‰‡"></p>
<p>ä¸€ä¸ªæ—‹è½¬çš„ç«‹æ–¹ä½“ï½</p>
<h1 id="äºŒ-GLFW-å®‰è£…"><a href="#äºŒ-GLFW-å®‰è£…" class="headerlink" title="äºŒ. GLFW å®‰è£…"></a>äºŒ. GLFW å®‰è£…</h1><p>Vulkanæœ¬èº«æ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œä¸åŒ…æ‹¬ç”¨äºåˆ›å»ºæ˜¾ç¤ºæ¸²æŸ“ç»“æœçš„çª—å£çš„å·¥å…·ã€‚ ä¸ºäº†ä»Vulkançš„è·¨å¹³å°ä¼˜åŠ¿ä¸­å—ç›Šå¹¶é¿å…X11çš„é™åˆ¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨GLFWåº“æ¥åˆ›å»ºä¸€ä¸ªæ”¯æŒWindowsï¼ŒLinuxå’ŒMacOSçš„çª—å£ã€‚<br>è¿˜æœ‰å…¶ä»–å¯ç”¨äºæ­¤ç›®çš„çš„åº“ï¼Œå¦‚SDLï¼Œä½†GLFWçš„ä¼˜åŠ¿åœ¨äºå®ƒé™¤äº†çª—å£åˆ›å»ºä¹‹å¤–ï¼Œè¿˜æŠ½è±¡äº†Vulkanä¸­ä¸€äº›å…¶ä»–ç‰¹å®šäºå¹³å°çš„ä¸œè¥¿ã€‚<br>æˆ‘ä»¬å°†ä»æºä»£ç å®‰è£…GLFWè€Œä¸æ˜¯ä½¿ç”¨è½¯ä»¶åŒ…ï¼Œå› ä¸ºVulkanæ”¯æŒéœ€è¦æœ€æ–°ç‰ˆæœ¬ã€‚ å¯ä»¥åœ¨å®˜æ–¹ç½‘ç«™ä¸Šæ‰¾åˆ°è¿™äº›æ¥æºã€‚<br>å°†æºä»£ç è§£å‹ç¼©åˆ°ä¸€ä¸ªæ–¹ä¾¿çš„ç›®å½•ï¼Œå¹¶ä½¿ç”¨CMakeLists.txtç­‰æ–‡ä»¶æ‰“å¼€ç›®å½•ä¸­çš„ç»ˆç«¯ã€‚</p>
<p>githubåœ°å€ï¼š<a href="https://github.com/glfw/glfw">https://github.com/glfw/glfw</a><br>è§£å‹åè¿›å…¥å…¶ä¸»ç›®å½•ï¼šcmake .<br>æœ‰æŠ¥é”™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-- Looking <span class="keyword">for</span> shmat - found</span><br><span class="line">-- Found X11: /usr/lib/x86_64-linux-gnu/libX11.so</span><br><span class="line">CMake Error at CMakeLists.txt:<span class="number">220</span> (message):</span><br><span class="line">  The Xinerama headers were not found</span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also <span class="string">&quot;/home/jh/Program/vulkan/glfw-master/CMakeFiles/CMakeOutput.log&quot;</span>.</span><br><span class="line">See also <span class="string">&quot;/home/jh/Program/vulkan/glfw-master/CMakeFiles/CMakeError.log&quot;</span>.</span><br></pre></td></tr></table></figure>

<p>ç¼ºå°‘ç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ ~/Program/vulkan/glfw-master î‚° sudo apt-get install libsdl2-dev</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡æ–°: cmake .</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ğŸ¦„ î‚° ~/Program/vulkan/glfw-master î‚° cmake .</span><br><span class="line">-- Could NOT find <span class="title function_">Doxygen</span> <span class="params">(missing: DOXYGEN_EXECUTABLE)</span> </span><br><span class="line">-- Using X11 <span class="keyword">for</span> window creation</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/jh/Program/vulkan/glfw-master</span><br></pre></td></tr></table></figure>
<p>æ¿¡æŸ“æ²¡æœ‰æŠ¥é”™ï¼Œä½†è¿™ä¸ªä¹Ÿæ˜¯æ²¡æœ‰æˆåŠŸçš„ï¼šç¼ºå°‘Doxygen<br>sudo apt-get install doxygen</p>
<p>é‡æ–°: cmake .<br>æœ€å: make<br>æˆåŠŸåï¼šsudo make install</p>
<h1 id="ä¸‰-GLM-å®‰è£…"><a href="#ä¸‰-GLM-å®‰è£…" class="headerlink" title="ä¸‰. GLM å®‰è£…"></a>ä¸‰. GLM å®‰è£…</h1><p>ä¸DirectX 12ä¸åŒï¼ŒVulkanä¸åŒ…å«ç”¨äºçº¿æ€§ä»£æ•°è¿ç®—çš„åº“ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä¸‹è½½ä¸€ä¸ªã€‚<br>GLMæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åº“ï¼Œè®¾è®¡ç”¨äºå›¾å½¢APIï¼Œä¹Ÿå¸¸ç”¨äºOpenGLã€‚<br>å®ƒæ˜¯ä¸€ä¸ªåªæœ‰å¤´çš„åº“ï¼Œå¯ä»¥ä»libglm-devåŒ…å®‰è£…ï¼š</p>
<p>sudo apt install libglm-dev</p>
<h1 id="å››-æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç "><a href="#å››-æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç " class="headerlink" title="å››. æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç "></a>å››. æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç </h1><h2 id="4-1-åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚"><a href="#4-1-åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚" class="headerlink" title="4.1 åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚"></a>4.1 åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ gcc -o main main.cpp -lglfw3</span><br><span class="line">In file included from main.cpp:2:</span><br><span class="line">/usr/local/include/GLFW/glfw3.h:215:12: fatal error: vulkan/vulkan.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line">   #include &lt;vulkan/vulkan.h&gt;</span><br><span class="line">            ^~~~~~~~~~~~~~~~~</span><br><span class="line">compilation terminated.</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶æ˜¯ç¯å¢ƒè®¾ç½®çš„é—®é¢˜ï¼šéœ€è¦å°†å¤´æ–‡ä»¶ç­‰æ‹·è´åˆ°å¯¹åº”systemæ–‡ä»¶å¤¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd Program/vulkan/1.2.170.0/x86_64</span><br><span class="line">sudo cp -r include/vulkan/ /usr/local/include/</span><br><span class="line">sudo cp -P lib/libvulkan.so* /usr/local/lib/</span><br><span class="line">sudo cp lib/libVkLayer_*.so /usr/local/lib/</span><br><span class="line">sudo mkdir -p /usr/local/share/vulkan/explicit_layer.d</span><br><span class="line">sudo cp etc/explicit_layer.d/VkLayer_*.json /usr/local/share/vulkan/explicit_layer.d    </span><br><span class="line"></span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure>

<h2 id="4-2-error-adding-symbols-DSO-missing-from-command-line"><a href="#4-2-error-adding-symbols-DSO-missing-from-command-line" class="headerlink" title="4.2 error adding symbols: DSO missing from command line"></a>4.2 error adding symbols: DSO missing from command line</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">g++ -std=c++17 -I/home/jh/Program/vulkan/1.1.160.0/x86_64/include -o VulkanTest main.cpp -L/home/jh/Program/vulkan/1.1.160.0/x86_64/lib -lvulkan -lglfw3</span><br><span class="line">/usr/bin/ld: //usr/local/lib/libglfw3.a(vulkan.c.o): undefined reference to symbol &#x27;dlclose@@GLIBC_2.2.5&#x27;</span><br><span class="line">/usr/bin/ld: //lib/x86_64-linux-gnu/libdl.so.2: error adding symbols: DSO missing from command line</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br><span class="line">make: *** [Makefile:8ï¼šVulkanTest] é”™è¯¯ 1</span><br></pre></td></tr></table></figure>

<p>cd &#x2F;usr&#x2F;lib&#x2F;<br>ll |grep -iE â€œliblogâ€<br>æ²¡æœ‰æ–‡ä»¶</p>
<p><a href="https://github.com/google/glog">https://github.com/google/glog</a><br>ä¸‹è½½è§£å‹, è¿›å…¥è§£å‹åçš„ä¸»ç›®å½•ï¼Œæ‰§è¡Œï¼š<br>.&#x2F;autogen.sh &amp;&amp; .&#x2F;configure &amp;&amp; make &amp;&amp; make install</p>
<p>å¦‚æœæŠ¥é”™ï¼šautogen.sh: 5: autogen.sh: autoreconf: not found<br>sudo apt-get install autoconf<br>sudo apt-get install automake<br>sudo apt-get install libtool</p>
<p>é‡æ–°æ‰§è¡Œï¼š.&#x2F;autogen.sh &amp;&amp; .&#x2F;configure &amp;&amp; make &amp;&amp; make install<br>å¯èƒ½è¿˜æœ‰æƒé™é—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- Up-to-date: /usr/local/include/GLFW</span><br><span class="line">CMake Error at cmake_install.cmake:41 (file):</span><br><span class="line">  file INSTALL cannot set permissions on &quot;/usr/local/include/GLFW&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make: *** [Makefile:118ï¼šinstall] é”™è¯¯ 1</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œï¼š<br>cd ..<br>chmod a+x glog-master -R<br>cd glog-master<br>make &amp;&amp; make install</p>
<p>okay,ç°åœ¨å¯ä»¥åœ¨Makefileæ–‡ä»¶ä¸­æ·»åŠ ï¼š-lglog</p>
<p>é‡æ–° make è¿˜æ˜¯ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œç¬”è€…æŸ¥é˜…å„ç§èµ„æ–™ï¼Œå¤§éƒ¨åˆ†æŒ‡æ˜åœ¨Makefileä¸­åŠ å…¥ -ldl å³å¯ï¼Œå°è¯•åå¤±è´¥ã€‚<br>æœ€åå‘ç°æ˜¯ Makefile æ–‡ä»¶å†™çš„æœ‰é—®é¢˜ï¼Œæ”¹æˆå¦‚[#5.2]å³å¯.</p>
<h2 id="4-3-è¿è¡Œç¤ºä¾‹"><a href="#4-3-è¿è¡Œç¤ºä¾‹" class="headerlink" title="4.3 è¿è¡Œç¤ºä¾‹"></a>4.3 è¿è¡Œç¤ºä¾‹</h2><p>make æˆåŠŸåï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ VulkanTest å¯æ‰§è¡Œæ–‡ä»¶:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./VulkanTest</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹:</p>
<p><img src="/./images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_5.png" alt="å›¾ç‰‡"></p>
<h1 id="äº”-ä¸»è¦ä»£ç "><a href="#äº”-ä¸»è¦ä»£ç " class="headerlink" title="äº”. ä¸»è¦ä»£ç "></a>äº”. ä¸»è¦ä»£ç </h1><h2 id="5-1-main-cpp"><a href="#5-1-main-cpp" class="headerlink" title="5.1 main.cpp"></a>5.1 main.cpp</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> GLFW_INCLUDE_VULKAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLM_FORCE_RADIANS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLM_FORCE_DEPTH_ZERO_TO_ONE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/vec4.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/mat4x4.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">glfwInit</span>();</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line">    GLFWwindow* window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Vulkan window&quot;</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> extensionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">vkEnumerateInstanceExtensionProperties</span>(<span class="literal">nullptr</span>, &amp;extensionCount, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; extensionCount &lt;&lt; <span class="string">&quot; extensions supported&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    glm::mat4 matrix;</span><br><span class="line">    glm::vec4 vec;</span><br><span class="line">    <span class="keyword">auto</span> test = matrix * vec;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">glfwWindowShouldClose</span>(window)) &#123;</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-Makefile"><a href="#5-2-Makefile" class="headerlink" title="5.2 Makefile"></a>5.2 Makefile</h2><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">VULKAN_SDK_PATH = /home/jh/Program/vulkan/1.1.160.0/x86_64</span><br><span class="line"></span><br><span class="line">CFLAGS = -std=c++17 -I<span class="variable">$(VULKAN_SDK_PATH)</span>/<span class="keyword">include</span></span><br><span class="line">LDFLAGS = -L<span class="variable">$(VULKAN_SDK_PATH)</span>/lib -lvulkan `pkg-config --static --libs glfw3`</span><br><span class="line">LDFLAGS += -ldl</span><br><span class="line"></span><br><span class="line"><span class="section">VulkanTest: main.cpp</span></span><br><span class="line">	g++ <span class="variable">$(CFLAGS)</span> -o VulkanTest main.cpp <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: test clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">test: VulkanTest</span></span><br><span class="line">    LD_LIBRARY_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/lib</span><br><span class="line">        VK_LAYER_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/etc/explicit_layer.d ./VulkanTest</span><br><span class="line"></span><br><span class="line"><span class="section">clean:rm -f VulkanTest</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(2)-åˆ›å»ºVulkanç¤ºä¾‹åŠéªŒè¯å±‚</title>
    <url>/2022/02/26/Vulkan%E5%85%A5%E9%97%A8-2-%E5%88%9B%E5%BB%BAVulkan%E7%A4%BA%E4%BE%8B%E5%8F%8A%E9%AA%8C%E8%AF%81%E5%B1%82/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡ä¸»è¦æ˜¯å®ç°Vulkan Tutorial.pdfæ–‡æ¡£ä¸­çš„Base Code, Instanceå’ŒValidation Layerséƒ¨åˆ†ã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs">https://github.com/KhronosGroup/Vulkan-Docs</a></li>
<li><a href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/html/vkspec.html#vkCreateInstance">https://www.khronos.org/registry/vulkan/specs/1.1-extensions/html/vkspec.html#vkCreateInstance</a></li>
<li><a href="https://github.com/SaschaWillems/Vulkan/blob/master/base/vulkanexamplebase.h">https://github.com/SaschaWillems/Vulkan/blob/master/base/vulkanexamplebase.h</a></li>
</ol>
<h1 id="ä¸€-åˆ›å»º-vulkan-å®ä¾‹"><a href="#ä¸€-åˆ›å»º-vulkan-å®ä¾‹" class="headerlink" title="ä¸€. åˆ›å»º vulkan å®ä¾‹"></a>ä¸€. åˆ›å»º vulkan å®ä¾‹</h1><h2 id="1-1-åˆ›å»º-Window-å®ä¾‹"><a href="#1-1-åˆ›å»º-Window-å®ä¾‹" class="headerlink" title="1.1 åˆ›å»º Window å®ä¾‹"></a>1.1 åˆ›å»º Window å®ä¾‹</h2><p>å…ˆåˆ›å»ºä¸ª window çª—å£</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥ä¸€å®šæ˜¯å…ˆåˆå§‹åŒ–GLFWåº“.</span></span><br><span class="line">    <span class="built_in">glfwInit</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸ºGLFWæœ€åˆæ˜¯ä¸ºåˆ›å»ºOpenGLä¸Šä¸‹æ–‡è€Œè®¾è®¡çš„ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒä¸è¦é€šè¿‡åç»­è°ƒç”¨åˆ›å»ºOpenGLä¸Šä¸‹æ–‡ï¼šGLFW_NO_API</span></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸ºå¤„ç†å¤§å°å¯å˜çš„çª—å£æ¯”è¾ƒå¤æ‚ï¼Œæš‚æ—¶å…ˆè®©çª—å£ä¸å¯å˜</span></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_RESIZABLE, GLFW_FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºçª—å£</span></span><br><span class="line">    <span class="comment">// GLFWwindow *glfwCreateWindow(int width, int height, const char *title, GLFWmonitor *monitor, GLFWwindow *share)</span></span><br><span class="line">    window = <span class="built_in">glfwCreateWindow</span>(WIDTH, HEIGHT, WINDOW_TITLE, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-åˆ›å»º-Vulkan-å®ä¾‹"><a href="#1-2-åˆ›å»º-Vulkan-å®ä¾‹" class="headerlink" title="1.2 åˆ›å»º Vulkan å®ä¾‹"></a>1.2 åˆ›å»º Vulkan å®ä¾‹</h2><ol>
<li>åˆ›å»º VkApplicationInfo ç»“æ„ä½“å˜é‡ï¼Œå‚æ•°å¯é€‰</li>
<li>åˆ›å»º VkInstanceCreateInfo ç»“æ„ä½“å˜é‡ï¼Œå¿…é¡»æŒ‡æ˜<ol>
<li>ä½¿ç”¨ GLFW (glfwGetRequiredInstanceExtensions) åˆ›å»º glfwExtensions, ä»¥ä¾¿ä¸ºGLFWçª—å£åˆ›å»ºVulkan surface</li>
</ol>
</li>
<li>è°ƒç”¨ vkCreateInstance, åˆ›å»º vulkan å®ä¾‹</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå®ä¾‹é¦–å…ˆå¿…é¡»å¡«å†™ä¸€ä¸ªåŒ…å«æœ‰å…³æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ä¿¡æ¯çš„ç»“æ„: VkApplicationInfo</span></span><br><span class="line">    <span class="comment">// è¿™äº›æ•°æ®åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯é€‰çš„ï¼Œä½†å®ƒå¯ä»¥ä¸ºé©±åŠ¨ç¨‹åºæä¾›ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä»¥ä¾¿é’ˆå¯¹æˆ‘ä»¬çš„ç‰¹å®šåº”ç”¨è¿›è¡Œä¼˜åŒ–</span></span><br><span class="line">    VkApplicationInfo appInfo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Vulkanä¸­çš„è®¸å¤šç»“æ„è¦æ±‚åœ¨sTypeæˆå‘˜ä¸­æ˜ç¡®æŒ‡å®šç±»å‹ã€‚ </span></span><br><span class="line">    <span class="comment">// è¿™ä¹Ÿæ˜¯å…·æœ‰pNextæˆå‘˜çš„è®¸å¤šç»“æ„ä¸­çš„ä¸€ä¸ªï¼Œè¯¥æˆå‘˜å¯ä»¥åœ¨å°†æ¥æŒ‡å‘æ‰©å±•ä¿¡æ¯ã€‚</span></span><br><span class="line">    appInfo.sType = VK_STRUCTURE_TYPE_APPLICATION_INFO;</span><br><span class="line"></span><br><span class="line">    appInfo.pApplicationName = <span class="string">&quot;Hello Triangle&quot;</span>;</span><br><span class="line">    appInfo.applicationVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    appInfo.pEngineName = <span class="string">&quot;No Engine&quot;</span>;</span><br><span class="line">    appInfo.engineVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    appInfo.apiVersion = VK_API_VERSION_1_1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Vulkanä¸­çš„å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯é€šè¿‡ç»“æ„è€Œä¸æ˜¯å‡½æ•°å‚æ•°ä¼ é€’çš„ï¼Œ</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¿…é¡»å†å¡«å……ä¸€ä¸ªç»“æ„ä½“ VkInstanceCreateInfo æ¥ä¸ºåˆ›å»ºå®ä¾‹æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="comment">// VkInstanceCreateInfoç»“æ„æ˜¯å¿…é¡»æŒ‡æ˜çš„ï¼Œå®ƒå‘Šè¯‰Vulkané©±åŠ¨ç¨‹åºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨å“ªäº›å…¨å±€æ‰©å±•å’ŒéªŒè¯å±‚ã€‚ </span></span><br><span class="line">    VkInstanceCreateInfo createInfo = &#123;&#125;;</span><br><span class="line">    createInfo.sType = VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO;</span><br><span class="line">    createInfo.pNext = <span class="literal">nullptr</span>;</span><br><span class="line">    createInfo.pApplicationInfo = &amp;appInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰ä¸¤ä¸ªå‚æ•°å¾ˆç®€å•ã€‚ </span></span><br><span class="line">    <span class="comment">// Vulkanæ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œè¿™æ„å‘³ç€éœ€è¦ä¸€ä¸ªä¸çª—å£ç³»ç»Ÿæ¥å£çš„æ‰©å±•ã€‚</span></span><br><span class="line">    <span class="comment">// GLFWæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„å†…ç½®å‡½æ•°ï¼Œå®ƒè¿”å›å®ƒéœ€è¦åšçš„æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ç»™ç»“æ„ä½“ï¼šVkInstanceCreateInfo</span></span><br><span class="line">    <span class="type">uint32_t</span> glfwExtensionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>** glfwExtensions;</span><br><span class="line">    <span class="comment">// è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•ã€‚</span></span><br><span class="line">    <span class="comment">// æ­¤å‡½æ•°è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•åçš„æ•°ç»„ï¼Œä»¥ä¾¿ä¸ºGLFWçª—å£åˆ›å»ºVulkan surfaceã€‚ </span></span><br><span class="line">    <span class="comment">// å¦‚æœæˆåŠŸï¼Œåˆ—è¡¨å°†å§‹ç»ˆåŒ…å«`VK_KHR_surface`ï¼Œå› æ­¤å¦‚æœæ‚¨ä¸éœ€è¦ä»»ä½•å…¶ä»–æ‰©å±•ï¼Œåˆ™å¯ä»¥å°†æ­¤åˆ—è¡¨ç›´æ¥ä¼ é€’ç»™`VkInstanceCreateInfo`ç»“æ„ã€‚</span></span><br><span class="line">    <span class="comment">// å¦‚æœæœºå™¨ä¸Šæ²¡æœ‰Vulkanï¼Œåˆ™æ­¤å‡½æ•°è¿”å›â€œNULLâ€å¹¶ç”Ÿæˆ GLFW_API_UNAVAILABLEé”™è¯¯ã€‚</span></span><br><span class="line">    glfwExtensions = <span class="built_in">glfwGetRequiredInstanceExtensions</span>(&amp;glfwExtensionCount);</span><br><span class="line"></span><br><span class="line">    createInfo.enabledExtensionCount = glfwExtensionCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// createInfo.ppEnabledLayerNames = glfwExtensions;</span></span><br><span class="line">    <span class="comment">// ç¬”è€…æ›¾åœ¨è¿™é‡Œæ ½äº†ä¸ªè·Ÿå¤´ï¼Œå†™é”™äº†ã€‚å¦‚ä¸Šå†™ï¼Œç¼–è¯‘ä¸å‡ºé—®é¢˜ï¼Œä½†è¿è¡Œæ—¶ä¼šæŠ¥ Segmentation fault (core dumped)</span></span><br><span class="line">    <span class="comment">// æ‰“å°å †æ ˆï¼Œçœ‹äº†åŠå¤©ï¼Œæ‰å‘ç°çš„ï¼Œå¼•ä»¥ä¸ºæˆ’ï¼Œä¸è¿‡è¿™ä¸¤å˜é‡åå­—å¾ˆåƒã€‚</span></span><br><span class="line">    createInfo.ppEnabledExtensionNames = glfwExtensions;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»“æ„ä½“çš„æœ€åä¸¤ä¸ªæˆå‘˜ç¡®å®šè¦å¯ç”¨çš„å…¨å±€éªŒè¯å±‚ã€‚</span></span><br><span class="line">    createInfo.enabledLayerCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// VkResult vkCreateInstance(const VkInstanceCreateInfo *pCreateInfo, const VkAllocationCallbacks *pAllocator, VkInstance *pInstance)</span></span><br><span class="line">    VkResult res = <span class="built_in">vkCreateInstance</span>(&amp;createInfo, <span class="literal">nullptr</span>, &amp;instance);</span><br><span class="line">    <span class="keyword">if</span> (res != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create instance!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="äºŒ-éªŒè¯å±‚-Validation-layers"><a href="#äºŒ-éªŒè¯å±‚-Validation-layers" class="headerlink" title="äºŒ. éªŒè¯å±‚(Validation layers)"></a>äºŒ. éªŒè¯å±‚(Validation layers)</h1><h2 id="2-1-ä»€ä¹ˆæ˜¯-Validation-layersï¼Ÿ"><a href="#2-1-ä»€ä¹ˆæ˜¯-Validation-layersï¼Ÿ" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯ Validation layersï¼Ÿ"></a>2.1 ä»€ä¹ˆæ˜¯ Validation layersï¼Ÿ</h2><p>Vulkan APIå›´ç»•æœ€å°é©±åŠ¨ç¨‹åºå¼€é”€çš„æƒ³æ³•è€Œè®¾è®¡ï¼Œè¯¥ç›®æ ‡çš„ä¸€ä¸ªè¡¨ç°å½¢å¼æ˜¯é»˜è®¤æƒ…å†µä¸‹APIä¸­çš„é”™è¯¯æ£€æŸ¥éå¸¸æœ‰é™ã€‚<br>å³ä½¿æ˜¯å°†æšä¸¾è®¾ç½®ä¸ºä¸æ­£ç¡®çš„å€¼æˆ–å°†ç©ºæŒ‡é’ˆä¼ é€’ç»™æ‰€éœ€å‚æ•°è¿™æ ·ç®€å•çš„é”™è¯¯é€šå¸¸ä¹Ÿä¸ä¼šè¢«æ˜¾å¼å¤„ç†ï¼Œåªä¼šå¯¼è‡´å´©æºƒæˆ–æœªå®šä¹‰çš„è¡Œä¸ºã€‚<br>è¿™ä¸€ç‚¹ï¼Œç¬”è€…å·²ç»æ·±åˆ»ä½“ä¼šåˆ°äº†ï¼Œ(â•¯ï¹â•°)<br>å› ä¸ºVulkanè¦æ±‚ä½ å¯¹ä½ æ‰€åšçš„ä¸€åˆ‡éƒ½éå¸¸æ˜ç¡®ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“çŠ¯å¾ˆå¤šå°é”™è¯¯ï¼Œä¾‹å¦‚ä½¿ç”¨æ–°çš„GPUåŠŸèƒ½è€Œå¿˜è®°åœ¨é€»è¾‘è®¾å¤‡åˆ›å»ºæ—¶è¯·æ±‚å®ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ— æ³•å°†è¿™äº›æ£€æŸ¥æ·»åŠ åˆ°APIä¸­ã€‚<br>Vulkanä¸ºè¿™ç§ç§°ä¸ºéªŒè¯å±‚çš„ç³»ç»Ÿå¼•å…¥äº†ä¸€ä¸ªä¼˜é›…çš„ç³»ç»Ÿ: Validation layers.<br>éªŒè¯å±‚æ˜¯å¯é€‰ç»„ä»¶ï¼Œå®ƒæŒ‚æ¥åˆ°Vulkanå‡½æ•°è°ƒç”¨ä»¥åº”ç”¨å…¶ä»–æ“ä½œã€‚ </p>
<p>éªŒè¯å±‚ä¸­çš„å¸¸è§æ“ä½œæ˜¯ï¼š</p>
<ol>
<li>æ ¹æ®è§„èŒƒæ£€æŸ¥å‚æ•°å€¼ä»¥æ£€æµ‹è¯¯ç”¨</li>
<li>è·Ÿè¸ªå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ä»¥æŸ¥æ‰¾èµ„æºæ³„æ¼</li>
<li>é€šè¿‡è·Ÿè¸ªè°ƒç”¨çš„çº¿ç¨‹æ¥æ£€æŸ¥çº¿ç¨‹å®‰å…¨æ€§</li>
<li>å°†æ¯ä¸ªè°ƒç”¨åŠå…¶å‚æ•°è®°å½•åˆ°æ ‡å‡†è¾“å‡ºæ–¹ä¾¿è°ƒè¯•</li>
<li>è·Ÿè¸ªVulkanè¦æ±‚è¿›è¡Œæ€§èƒ½åˆ†æå’Œé‡æ”¾</li>
</ol>
<h2 id="2-2-Validation-layersç¤ºä¾‹"><a href="#2-2-Validation-layersç¤ºä¾‹" class="headerlink" title="2.2 Validation layersç¤ºä¾‹"></a>2.2 Validation layersç¤ºä¾‹</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateInstance</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkInstanceCreateInfo* pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks* pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkInstance* instance)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pCreateInfo == <span class="literal">nullptr</span> || instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="built_in">log</span>(<span class="string">&quot;Null pointer passed to required parameter!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> VK_ERROR_INITIALIZATION_FAILED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">real_vkCreateInstance</span>(pCreateInfo, pAllocator, instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚ä¸Šé¢çš„vkCreateInstanceä¸­çš„ifè¯­å¥ã€‚å®˜æ–¹æ–‡æ¡£ä¸Šå¦‚æ­¤è¯´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿™äº›éªŒè¯å±‚å¯ä»¥è‡ªç”±å †å ï¼Œä»¥åŒ…å«æ‚¨æ„Ÿå…´è¶£çš„æ‰€æœ‰è°ƒè¯•åŠŸèƒ½ã€‚</span><br><span class="line">æ‚¨å¯ä»¥ç®€å•åœ°ä¸ºè°ƒè¯•ç‰ˆæœ¬å¯ç”¨éªŒè¯å±‚ï¼Œå¹¶ä¸ºå‘å¸ƒç‰ˆæœ¬å®Œå…¨ç¦ç”¨å®ƒä»¬ï¼Œè¿™å°†ä¸ºæ‚¨æä¾›ä¸¤å…¨å…¶ç¾çš„ä¼˜åŠ¿ï¼</span><br><span class="line">Vulkanæ²¡æœ‰å†…ç½®ä»»ä½•éªŒè¯å±‚ï¼Œä½†LunarG Vulkan SDKæä¾›äº†ä¸€ç»„å¾ˆå¥½çš„å±‚æ¥æ£€æŸ¥å¸¸è§é”™è¯¯ã€‚</span><br><span class="line">å®ƒä»¬ä¹Ÿæ˜¯å®Œå…¨å¼€æºçš„ï¼Œå› æ­¤æ‚¨å¯ä»¥æ£€æŸ¥å®ƒä»¬æ£€æŸ¥å’Œè´¡çŒ®çš„é”™è¯¯ç±»å‹ã€‚</span><br><span class="line">ä½¿ç”¨éªŒè¯å±‚æ˜¯é¿å…åº”ç”¨ç¨‹åºå› æ„å¤–ä¾èµ–æœªå®šä¹‰è¡Œä¸ºè€Œç ´åä¸åŒé©±åŠ¨ç¨‹åºçš„æœ€ä½³æ–¹æ³•ã€‚</span><br><span class="line">éªŒè¯å±‚åªæœ‰åœ¨å·²å®‰è£…åˆ°ç³»ç»Ÿä¸Šæ—¶æ‰èƒ½ä½¿ç”¨ã€‚</span><br><span class="line">ä¾‹å¦‚ï¼ŒLunarGéªŒè¯å±‚ä»…é€‚ç”¨äºå®‰è£…äº†Vulkan SDKçš„PCã€‚</span><br><span class="line">Vulkanä¸­ä»¥å‰æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„éªŒè¯å±‚ï¼šå®ä¾‹å’Œè®¾å¤‡ç‰¹å®šã€‚</span><br><span class="line">æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ï¼Œå®ä¾‹å±‚åªä¼šæ£€æŸ¥ä¸å…¨å±€Vulkanå¯¹è±¡ï¼ˆå¦‚å®ä¾‹ï¼‰ç›¸å…³çš„è°ƒç”¨ï¼Œè€Œè®¾å¤‡ç‰¹å®šå±‚åªä¼šæ£€æŸ¥ä¸ç‰¹å®šGPUç›¸å…³çš„è°ƒç”¨ã€‚</span><br><span class="line">ç°åœ¨å·²å¼ƒç”¨ç‰¹å®šäºè®¾å¤‡çš„å±‚ï¼Œè¿™æ„å‘³ç€å®ä¾‹éªŒè¯å±‚é€‚ç”¨äºæ‰€æœ‰Vulkanè°ƒç”¨ã€‚</span><br><span class="line">è§„èŒƒæ–‡æ¡£ä»å»ºè®®æ‚¨åœ¨è®¾å¤‡çº§åˆ«å¯ç”¨éªŒè¯å±‚ä»¥åŠå…¼å®¹æ€§ï¼Œè¿™æ˜¯æŸäº›å®ç°æ‰€éœ€çš„ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="2-3-å¯ç”¨éªŒè¯å±‚"><a href="#2-3-å¯ç”¨éªŒè¯å±‚" class="headerlink" title="2.3 å¯ç”¨éªŒè¯å±‚"></a>2.3 å¯ç”¨éªŒè¯å±‚</h2><p>å¦‚ä½•å¯ç”¨Vulkan SDKæä¾›çš„æ ‡å‡†è¯Šæ–­å±‚? å°±åƒæ‰©å±•ä¸€æ ·ï¼Œéœ€è¦é€šè¿‡æŒ‡å®šå…¶åç§°æ¥å¯ç”¨éªŒè¯å±‚ã€‚<br>æ‰€æœ‰æœ‰ç”¨çš„æ ‡å‡†éªŒè¯éƒ½æ†ç»‘åœ¨SDKä¸­åŒ…å«çš„å±‚ä¸­ï¼Œç§°ä¸ºVK_LAYER_KHRONOS_validationã€‚<br>è®©æˆ‘ä»¬é¦–å…ˆå‘ç¨‹åºæ·»åŠ ä¸¤ä¸ªé…ç½®å˜é‡ï¼Œä»¥æŒ‡å®šè¦å¯ç”¨çš„å±‚ä»¥åŠæ˜¯å¦å¯ç”¨å®ƒä»¬ã€‚ æˆ‘å·²ç»é€‰æ‹©å°†è¯¥å€¼ä½œä¸ºç¨‹åºæ˜¯å¦åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ç¼–è¯‘ã€‚<br>NDEBUGå®æ˜¯C ++æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œæ„å‘³ç€â€œä¸è°ƒè¯•â€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; validationLayers = &#123;</span><br><span class="line">    <span class="string">&quot;VK_LAYER_KHRONOS_validation&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> NDEBUG</span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">false</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">true</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-æ¶ˆæ¯å›è°ƒ"><a href="#2-4-æ¶ˆæ¯å›è°ƒ" class="headerlink" title="2.4 æ¶ˆæ¯å›è°ƒ"></a>2.4 æ¶ˆæ¯å›è°ƒ</h2><p>ä»…å¯ç”¨è¿™äº›å±‚å¹¶æ²¡æœ‰å¤šå¤§å¸®åŠ©ï¼Œå› ä¸ºå®ƒä»¬ç›®å‰æ— æ³•å°†è°ƒè¯•æ¶ˆæ¯ä¸­ç»§å›æˆ‘ä»¬çš„ç¨‹åºã€‚<br>è¦æ¥æ”¶è¿™äº›æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®ä¸€ä¸ªå¸¦å›è°ƒçš„è°ƒè¯•ä¿¡ä½¿ï¼Œè¿™éœ€è¦VK_EXT_debug_utilsæ‰©å±•ã€‚<br>æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªgetRequiredExtensionså‡½æ•°ï¼Œæ ¹æ®æ˜¯å¦å¯ç”¨éªŒè¯å±‚è¿”å›æ‰€éœ€çš„æ‰©å±•ååˆ—è¡¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">getRequiredExtensions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> glfwExtensionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>** glfwExtensions;</span><br><span class="line">    glfwExtensions = <span class="built_in">glfwGetRequiredInstanceExtensions</span>(&amp;glfwExtensionCount);</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">extensions</span><span class="params">(glfwExtensions, glfwExtensions + glfwExtensionCount)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">        extensions.<span class="built_in">push_back</span>(VK_EXT_DEBUG_UTILS_EXTENSION_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> extensions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GLFWæŒ‡å®šçš„æ‰©å±•å§‹ç»ˆæ˜¯å¿…éœ€çš„ï¼Œä½†æœ‰æ¡ä»¶åœ°æ·»åŠ äº†è°ƒè¯•ä¿¡ä½¿æ‰©å±•(VK_EXT_debug_utils)ã€‚<br>è¯·æ³¨æ„ï¼Œåœ¨è¿™é‡Œä½¿ç”¨äº†VK_EXT_DEBUG_UTILS_EXTENSION_NAMEå®ï¼Œå®ƒç­‰äºæ–‡å­—å­—ç¬¦ä¸²â€œVK_EXT_debug_utilsâ€ã€‚ ä½¿ç”¨æ­¤å®å¯ä»¥é¿å…æ‹¼å†™é”™è¯¯ã€‚<br>æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨createInstanceä¸­ä½¿ç”¨æ­¤å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> extensions = <span class="built_in">getRequiredExtensions</span>();</span><br><span class="line">createInfo.enabledExtensionCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(extensions.<span class="built_in">size</span>());</span><br><span class="line">createInfo.ppEnabledExtensionNames = extensions.<span class="built_in">data</span>();</span><br></pre></td></tr></table></figure>

<h3 id="2-4-1-è°ƒè¯•å›è°ƒå‡½æ•°-debugCallback"><a href="#2-4-1-è°ƒè¯•å›è°ƒå‡½æ•°-debugCallback" class="headerlink" title="2.4.1 è°ƒè¯•å›è°ƒå‡½æ•° debugCallback"></a>2.4.1 è°ƒè¯•å›è°ƒå‡½æ•° debugCallback</h3><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è°ƒè¯•å›è°ƒå‡½æ•°çš„æ ·å­ã€‚<br>ä½¿ç”¨PFN_vkDebugUtilsMessengerCallbackEXTåŸå‹æ·»åŠ ä¸€ä¸ªåä¸ºdebugCallbackçš„æ–°é™æ€æˆå‘˜å‡½æ•°ã€‚<br>VKAPI_ATTRå’ŒVKAPI_CALLç¡®ä¿è¯¥å‡½æ•°å…·æœ‰Vulkanè°ƒç”¨å®ƒçš„æ­£ç¡®ç­¾åã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> VKAPI_ATTR VkBool32 VKAPI_CALL <span class="title">debugCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessageSeverityFlagBitsEXT messageSeverity,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessageTypeFlagsEXT messageType,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkDebugUtilsMessengerCallbackDataEXT* pCallbackData,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">void</span>* pUserData)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;validation layer: &quot;</span> &lt;&lt; pCallbackData-&gt;pMessage&lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> VK_FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>ç¬¬ä¸€ä¸ªå‚æ•°: VkDebugUtilsMessageSeverityFlagBitsEXT æŒ‡æ˜äº†æ¶ˆæ¯çš„ä¸¥é‡ç¨‹åº¦<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXTï¼šè¯Šæ–­æ¶ˆæ¯<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXTï¼šä¿¡æ¯æ€§æ¶ˆæ¯ï¼Œå¦‚åˆ›å»ºèµ„æº<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXTï¼šæœ‰å…³è¡Œä¸ºçš„æ¶ˆæ¯ä¸ä¸€å®šæ˜¯é”™è¯¯ï¼Œä½†å¾ˆå¯èƒ½æ˜¯åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXTï¼šæœ‰å…³æ— æ•ˆè¡Œä¸ºçš„æ¶ˆæ¯ï¼Œå¯èƒ½å¯¼è‡´å´©æºƒ<br>å¯ä»¥æ ¹æ®è¿™ä¸ªå‚æ•°è¿‡æ»¤æ‰€éœ€çš„ä¿¡æ¯ã€‚</li>
<li>ç¬¬äºŒä¸ªå‚æ•°: VkDebugUtilsMessageTypeFlagsEXT æŒ‡æ˜äº†æ¶ˆæ¯çš„ç±»å‹<br>â€¢VK_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXTï¼šå‘ç”Ÿäº†ä¸è§„èŒƒæˆ–æ€§èƒ½æ— å…³çš„æŸäº›äº‹ä»¶<br>â€¢VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXTï¼šå‘ç”Ÿäº†è¿åè§„èŒƒæˆ–è¡¨æ˜å¯èƒ½å­˜åœ¨é”™è¯¯çš„äº‹æƒ…<br>â€¢VK_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXTï¼šæ½œåœ¨çš„éæœ€ä½³ä½¿ç”¨Vulkan</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°: VkDebugUtilsMessengerCallbackDataEXT è¿™ä¸ªç»“æ„ä½“åŒ…å«äº†æ¶ˆæ¯æ›´å¤šçš„ç»†èŠ‚å†…å®¹<br>â€¢pMessageï¼šè°ƒè¯•æ¶ˆæ¯ä¸ºä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²<br>â€¢pObjectsï¼šä¸æ¶ˆæ¯ç›¸å…³çš„Vulkanå¯¹è±¡å¥æŸ„æ•°ç»„<br>â€¢object Countï¼šæ•°ç»„ä¸­çš„å¯¹è±¡æ•°</li>
<li>ç¬¬å››ä¸ªå‚æ•°: pUserData åŒ…å«åœ¨å›è°ƒè®¾ç½®æœŸé—´æŒ‡å®šçš„æŒ‡é’ˆï¼Œå¹¶å…è®¸æ‚¨å°†è‡ªå·±çš„æ•°æ®ä¼ é€’ç»™å®ƒã€‚</li>
</ol>
<p>å›è°ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦åº”è¯¥ä¸­æ­¢è§¦å‘éªŒè¯å±‚æ¶ˆæ¯çš„Vulkanè°ƒç”¨ã€‚<br>å¦‚æœå›è°ƒè¿”å›trueï¼Œåˆ™è°ƒç”¨å°†å› VK_ERROR_VALIDATION_FAILED_EXTé”™è¯¯è€Œä¸­æ­¢ã€‚<br>è¿™é€šå¸¸ä»…ç”¨äºæµ‹è¯•éªŒè¯å±‚æœ¬èº«ï¼Œå› æ­¤åº”å§‹ç»ˆè¿”å›VK_FALSEã€‚</p>
<h3 id="2-4-2-æ³¨å†Œè°ƒè¯•å›è°ƒ"><a href="#2-4-2-æ³¨å†Œè°ƒè¯•å›è°ƒ" class="headerlink" title="2.4.2 æ³¨å†Œè°ƒè¯•å›è°ƒ"></a>2.4.2 æ³¨å†Œè°ƒè¯•å›è°ƒ</h3><p>åœ¨Vulkanä¸­, è°ƒè¯•å›è°ƒä¹Ÿæ˜¯é€šè¿‡éœ€è¦æ˜¾å¼åˆ›å»ºå’Œé”€æ¯çš„å¥æŸ„æ¥ç®¡ç†çš„ã€‚ è¿™æ ·çš„å›è°ƒæ˜¯debug messageçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®å°½å¯èƒ½å¤šçš„å›è°ƒã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨æˆå‘˜å˜é‡ä¸­æ·»åŠ ï¼šVkDebugUtilsMessengerEXT</span></span><br><span class="line">VkDebugUtilsMessengerEXT debugMessenger;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">createInstance</span>();</span><br><span class="line">    <span class="built_in">setupDebugMessenger</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupDebugMessenger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!enableValidationLayers) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    VkDebugUtilsMessengerCreateInfoEXT createInfo = &#123;&#125;;</span><br><span class="line">    createInfo.sType = VK_STRUCTURE_TYPE_DEBUG_UTILS_MESSENGER_CREATE_INFO_EXT;</span><br><span class="line">    createInfo.messageSeverity =</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT;</span><br><span class="line">    createInfo.messageType =</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXT;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ¶ˆæ¯å›è°ƒå‡½æ•°</span></span><br><span class="line">    createInfo.pfnUserCallback = debugCallback;</span><br><span class="line">    createInfo.pUserData = <span class="literal">nullptr</span>; <span class="comment">// å¯é€‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>messageSeverityå­—æ®µå…è®¸æŒ‡å®šè¦ä¸ºå…¶è°ƒç”¨å›è°ƒçš„æ‰€æœ‰ç±»å‹çš„ä¸¥é‡æ€§ã€‚<br>åœ¨è¿™é‡ŒæŒ‡å®šäº†é™¤VK_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXTä¹‹å¤–çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥æ¥æ”¶æœ‰å…³å¯èƒ½é—®é¢˜çš„é€šçŸ¥ï¼ŒåŒæ—¶çœç•¥è¯¦ç»†çš„ä¸€èˆ¬è°ƒè¯•ä¿¡æ¯ã€‚<br>ç±»ä¼¼åœ°ï¼ŒmessageTypeå­—æ®µå¯ä»¥è¿‡æ»¤é€šçŸ¥å›è°ƒçš„æ¶ˆæ¯ç±»å‹ã€‚ åœ¨è¿™é‡Œå¯ç”¨äº†æ‰€æœ‰ç±»å‹ã€‚<br>æœ€åï¼ŒpfnUserCallbackå­—æ®µæŒ‡å®šå›è°ƒå‡½æ•°çš„æŒ‡é’ˆã€‚å¯ä»¥é€‰æ‹©å°†æŒ‡é’ˆä¼ é€’ç»™pUserDataå­—æ®µï¼Œè¯¥å­—æ®µå°†é€šè¿‡pUserDataå‚æ•°ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚<br>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥ä¼ é€’æŒ‡å‘HelloTriangleApplicationç±»çš„æŒ‡é’ˆã€‚</p>
<p>åº”è¯¥å°†ç»“æ„ä½“ VkDebugUtilsMessengerEXT ä¼ é€’ç»™vkCreateDebugUtilsMessengerEXTå‡½æ•°ä»¥åˆ›å»ºVkDebugUtilsMessengerEXTå¯¹è±¡ã€‚<br>ç„¶è€Œå› ä¸ºè¿™ä¸ªfunctionæ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨åŠ è½½ã€‚<br>å¿…é¡»ä½¿ç”¨vkGetInstanceProcAddræŸ¥æ‰¾å…¶åœ°å€ã€‚ åˆ›å»ºä»£ç†å‡½æ•°ï¼Œç„¶ååœ¨å¤„ç†å®ƒï¼Œå¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">CreateDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessengerCreateInfoEXT* pCreateInfo, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">    VkAllocationCallbacks* pAllocator, VkDebugUtilsMessengerEXT*</span></span></span><br><span class="line"><span class="params"><span class="function">    pDebugMessenger)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> func = (PFN_vkCreateDebugUtilsMessengerEXT)</span><br><span class="line">    <span class="built_in">vkGetInstanceProcAddr</span>(instance,<span class="string">&quot;vkCreateDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">func</span>(instance, pCreateInfo, pAllocator, pDebugMessenger);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> VK_ERROR_EXTENSION_NOT_PRESENT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ setupDebugMessenger ä¸­è°ƒç”¨æ­¤å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupDebugMessenger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!enableValidationLayers) <span class="keyword">return</span>;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–DebugUtilsMessengerEXT</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CreateDebugUtilsMessengerEXT</span>(instance, &amp;createInfo, <span class="literal">nullptr</span>,</span><br><span class="line">        &amp;debugMessenger) != VK_SUCCESS) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to set up debug messenger!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åæ³¨æ„ï¼Œæ—¢ç„¶æœ‰ vkCreateXXX, å°±éœ€è¦æ˜¾ç¤ºè°ƒç”¨ vkDestroyXXX å“¦ï¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessengerEXT debugMessenger, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">    VkAllocationCallbacks* pAllocator)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> func = (PFN_vkDestroyDebugUtilsMessengerEXT)</span><br><span class="line">    <span class="built_in">vkGetInstanceProcAddr</span>(instance, <span class="string">&quot;vkDestroyDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="built_in">func</span>(instance, debugMessenger, pAllocator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ å¿˜äº†è°ƒç”¨DestroyDebugUtilsMessengerEXTå»é”€æ¯debugMessengerï¼Œåœ¨å…³é—­çª—å£çš„æ—¶å€™å°±ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-2-%E5%88%9B%E5%BB%BAVulkan%E7%A4%BA%E4%BE%8B%E5%8F%8A%E9%AA%8C%E8%AF%81%E5%B1%82/Vulkan_2_1.png" alt="å›¾ç‰‡"></p>
<h1 id="ä¸‰-ä»£ç "><a href="#ä¸‰-ä»£ç " class="headerlink" title="ä¸‰. ä»£ç "></a>ä¸‰. ä»£ç </h1><h2 id="3-1-Makefile"><a href="#3-1-Makefile" class="headerlink" title="3.1 Makefile"></a>3.1 Makefile</h2><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">VULKAN_SDK_PATH = /home/jh/Program/vulkan/1.1.160.0/x86_64</span><br><span class="line"></span><br><span class="line">CFLAGS = -std=c++17 -I<span class="variable">$(VULKAN_SDK_PATH)</span>/<span class="keyword">include</span></span><br><span class="line">LDFLAGS = -L<span class="variable">$(VULKAN_SDK_PATH)</span>/lib -lvulkan `pkg-config --static --libs glfw3`</span><br><span class="line">LDFLAGS += -ldl</span><br><span class="line"></span><br><span class="line"><span class="section">HelloTriangleApplication: main.cpp</span></span><br><span class="line">	g++ <span class="variable">$(CFLAGS)</span> -o HelloTriangleApplication main.cpp <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: test clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">test: HelloTriangleApplication</span></span><br><span class="line">    LD_LIBRARY_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/lib</span><br><span class="line">        VK_LAYER_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/etc/explicit_layer.d ./HelloTriangleApplication</span><br><span class="line"></span><br><span class="line"><span class="section">clean:rm -f HelloTriangleApplication</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-main-cpp"><a href="#3-2-main-cpp" class="headerlink" title="3.2 main.cpp"></a>3.2 main.cpp</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * #include &lt;vulkan/vulkan.h&gt; // vulkan å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ä¸‹é¢ä¸¤è¡Œæ›¿æ¢ vulkanå¤´æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> *   #define GLFW_INCLUDE_VULKAN</span></span><br><span class="line"><span class="comment"> *   #include &lt;GLFW/glfw3.h&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  GLFW ä¼šè‡ªåŠ¨åŠ è½½ vulkan å¤´æ–‡ä»¶çš„ã€‚</span></span><br><span class="line"><span class="comment"> * GLFWæ˜¯ä¸€ä¸ªå¼€æºï¼Œå¤šå¹³å°çš„åº“ï¼Œç”¨äºæ¡Œé¢ä¸Šçš„OpenGLï¼ŒOpenGL ESå’ŒVulkanå¼€å‘ã€‚ </span></span><br><span class="line"><span class="comment"> * å®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„APIï¼Œç”¨äºåˆ›å»ºçª—å£ï¼Œä¸Šä¸‹æ–‡å’Œæ›²é¢ï¼Œæ¥æ”¶è¾“å…¥å’Œäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment"> * GLFWæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œå¹¶ä¸”ä½¿ç”¨X Windowç³»ç»Ÿï¼ˆä¾‹å¦‚Linuxå’ŒFreeBSDï¼‰å¯¹Windowsï¼ŒmacOSå’Œè®¸å¤šç±»Unixç³»ç»Ÿæä¾›åŸç”Ÿæ”¯æŒã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLFW_INCLUDE_VULKAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span> <span class="comment">// åŒ…å«ç”¨äºæŠ¥å‘Šé”™è¯¯çš„å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span> <span class="comment">// ç”¨äºèµ„æºç®¡ç†éƒ¨åˆ†ä¸­çš„lambdaå‡½æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span> <span class="comment">// cstdlib: EXIT_FAILURE, EXIT_SUCCESS</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> NDEBUG</span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">false</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">true</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloTriangleApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">initWindow</span>();</span><br><span class="line">        <span class="built_in">initVulkan</span>();</span><br><span class="line">        <span class="built_in">mainLoop</span>();</span><br><span class="line">        <span class="built_in">cleanup</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> WIDTH = <span class="number">800</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> HEIGHT = <span class="number">600</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> * WINDOW_TITLE = <span class="string">&quot;Vulkan&quot;</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ­¥ä¸€å®šæ˜¯å…ˆåˆå§‹åŒ–GLFWåº“.</span></span><br><span class="line">        <span class="built_in">glfwInit</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å› ä¸ºGLFWæœ€åˆæ˜¯ä¸ºåˆ›å»ºOpenGLä¸Šä¸‹æ–‡è€Œè®¾è®¡çš„ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥æˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒä¸è¦é€šè¿‡åç»­è°ƒç”¨åˆ›å»ºOpenGLä¸Šä¸‹æ–‡ï¼šGLFW_NO_API</span></span><br><span class="line">        <span class="built_in">glfwWindowHint</span>(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å› ä¸ºå¤„ç†å¤§å°å¯å˜çš„çª—å£æ¯”è¾ƒå¤æ‚ï¼Œæš‚æ—¶å…ˆè®©çª—å£ä¸å¯å˜</span></span><br><span class="line">        <span class="built_in">glfwWindowHint</span>(GLFW_RESIZABLE, GLFW_FALSE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºçª—å£</span></span><br><span class="line">        <span class="comment">// GLFWwindow *glfwCreateWindow(int width, int height, const char *title, GLFWmonitor *monitor, GLFWwindow *share)</span></span><br><span class="line">        window = <span class="built_in">glfwCreateWindow</span>(WIDTH, HEIGHT, WINDOW_TITLE, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">checkAvailableExtensions</span>();</span><br><span class="line">        <span class="built_in">createInstance</span>();</span><br><span class="line">        <span class="comment">// åˆ›å»ºDEBUGæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">        <span class="built_in">setupDebugMessenger</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setupDebugMessenger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!enableValidationLayers) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        VkDebugUtilsMessengerCreateInfoEXT createInfo = &#123;&#125;;</span><br><span class="line">        createInfo.sType = VK_STRUCTURE_TYPE_DEBUG_UTILS_MESSENGER_CREATE_INFO_EXT;</span><br><span class="line">        createInfo.messageSeverity =</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT;</span><br><span class="line">        createInfo.messageType =</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXT;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆæ¯å›è°ƒå‡½æ•°</span></span><br><span class="line">        createInfo.pfnUserCallback = debugCallback;</span><br><span class="line">        createInfo.pUserData = <span class="literal">nullptr</span>; <span class="comment">// å¯é€‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–DebugUtilsMessengerEXT</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">CreateDebugUtilsMessengerEXT</span>(instance, &amp;createInfo, <span class="literal">nullptr</span>,</span><br><span class="line">                &amp;debugMessenger) != VK_SUCCESS) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to set up debug messenger!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">checkAvailableExtensions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> extensionCount = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceExtensionProperties</span>(<span class="literal">nullptr</span>, &amp;extensionCount, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="function">std::vector&lt;VkExtensionProperties&gt; <span class="title">extensions</span><span class="params">(extensionCount)</span></span>;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceExtensionProperties</span>(<span class="literal">nullptr</span>, &amp;extensionCount, extensions.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;available extensions:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; extension : extensions) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;\t&quot;</span> &lt;&lt; extension.extensionName &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkValidationLayerSupport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> layerCount;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceLayerProperties</span>(&amp;layerCount, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="function">std::vector&lt;VkLayerProperties&gt; <span class="title">availableLayers</span><span class="params">(layerCount)</span></span>;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceLayerProperties</span>(&amp;layerCount, availableLayers.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="type">char</span>* layerName : validationLayers) &#123;</span><br><span class="line">            <span class="comment">//bool layerFound = false;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; layerProperties : availableLayers) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(layerName, layerProperties.layerName) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//layerFound = true;</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// éªŒè¯å±‚ï¼Œæ£€éªŒVK_LAYER_KHRONOS_validation</span></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers &amp;&amp; !<span class="built_in">checkValidationLayerSupport</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;validation layers requested, but not available!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå®ä¾‹é¦–å…ˆå¿…é¡»å¡«å†™ä¸€ä¸ªåŒ…å«æœ‰å…³æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ä¿¡æ¯çš„ç»“æ„: VkApplicationInfo</span></span><br><span class="line">        <span class="comment">// è¿™äº›æ•°æ®åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯é€‰çš„ï¼Œä½†å®ƒå¯ä»¥ä¸ºé©±åŠ¨ç¨‹åºæä¾›ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä»¥ä¾¿é’ˆå¯¹æˆ‘ä»¬çš„ç‰¹å®šåº”ç”¨è¿›è¡Œä¼˜åŒ–</span></span><br><span class="line">        VkApplicationInfo appInfo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Vulkanä¸­çš„è®¸å¤šç»“æ„è¦æ±‚åœ¨sTypeæˆå‘˜ä¸­æ˜ç¡®æŒ‡å®šç±»å‹ã€‚ </span></span><br><span class="line">        <span class="comment">// è¿™ä¹Ÿæ˜¯å…·æœ‰pNextæˆå‘˜çš„è®¸å¤šç»“æ„ä¸­çš„ä¸€ä¸ªï¼Œè¯¥æˆå‘˜å¯ä»¥åœ¨å°†æ¥æŒ‡å‘æ‰©å±•ä¿¡æ¯ã€‚</span></span><br><span class="line">        appInfo.sType = VK_STRUCTURE_TYPE_APPLICATION_INFO;</span><br><span class="line"></span><br><span class="line">        appInfo.pApplicationName = <span class="string">&quot;Hello Triangle&quot;</span>;</span><br><span class="line">        appInfo.applicationVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        appInfo.pEngineName = <span class="string">&quot;No Engine&quot;</span>;</span><br><span class="line">        appInfo.engineVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        appInfo.apiVersion = VK_API_VERSION_1_1;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Vulkanä¸­çš„å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯é€šè¿‡ç»“æ„è€Œä¸æ˜¯å‡½æ•°å‚æ•°ä¼ é€’çš„ï¼Œ</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬å¿…é¡»å†å¡«å……ä¸€ä¸ªç»“æ„ä½“ VkInstanceCreateInfo æ¥ä¸ºåˆ›å»ºå®ä¾‹æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ã€‚</span></span><br><span class="line">        <span class="comment">// VkInstanceCreateInfoç»“æ„æ˜¯å¿…é¡»æŒ‡æ˜çš„ï¼Œå®ƒå‘Šè¯‰Vulkané©±åŠ¨ç¨‹åºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨å“ªäº›å…¨å±€æ‰©å±•å’ŒéªŒè¯å±‚ã€‚ </span></span><br><span class="line">        VkInstanceCreateInfo createInfo = &#123;&#125;;</span><br><span class="line">        createInfo.sType = VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO;</span><br><span class="line">        createInfo.pNext = <span class="literal">nullptr</span>;</span><br><span class="line">        createInfo.pApplicationInfo = &amp;appInfo;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        // å‰ä¸¤ä¸ªå‚æ•°å¾ˆç®€å•ã€‚ </span></span><br><span class="line"><span class="comment">        // Vulkanæ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œè¿™æ„å‘³ç€éœ€è¦ä¸€ä¸ªä¸çª—å£ç³»ç»Ÿæ¥å£çš„æ‰©å±•ã€‚</span></span><br><span class="line"><span class="comment">        // GLFWæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„å†…ç½®å‡½æ•°ï¼Œå®ƒè¿”å›å®ƒéœ€è¦åšçš„æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ç»™ç»“æ„ä½“ï¼šVkInstanceCreateInfo</span></span><br><span class="line"><span class="comment">        uint32_t glfwExtensionCount = 0;</span></span><br><span class="line"><span class="comment">        const char** glfwExtensions;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">        // è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•ã€‚</span></span><br><span class="line"><span class="comment">        // æ­¤å‡½æ•°è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•åçš„æ•°ç»„ï¼Œä»¥ä¾¿ä¸ºGLFWçª—å£åˆ›å»ºVulkan surfaceã€‚ </span></span><br><span class="line"><span class="comment">        // å¦‚æœæˆåŠŸï¼Œåˆ—è¡¨å°†å§‹ç»ˆåŒ…å«`VK_KHR_surface`ï¼Œå› æ­¤å¦‚æœæ‚¨ä¸éœ€è¦ä»»ä½•å…¶ä»–æ‰©å±•ï¼Œåˆ™å¯ä»¥å°†æ­¤åˆ—è¡¨ç›´æ¥ä¼ é€’ç»™`VkInstanceCreateInfo`ç»“æ„ã€‚</span></span><br><span class="line"><span class="comment">        // å¦‚æœæœºå™¨ä¸Šæ²¡æœ‰Vulkanï¼Œåˆ™æ­¤å‡½æ•°è¿”å›â€œNULLâ€å¹¶ç”Ÿæˆ GLFW_API_UNAVAILABLEé”™è¯¯ã€‚</span></span><br><span class="line"><span class="comment">        glfwExtensions = glfwGetRequiredInstanceExtensions(&amp;glfwExtensionCount);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // ç¬”è€…æ›¾åœ¨è¿™é‡Œæ ½äº†ä¸ªè·Ÿå¤´ï¼Œå†™é”™äº†ã€‚å¦‚ä¸Šå†™ï¼Œç¼–è¯‘ä¸å‡ºé—®é¢˜ï¼Œä½†è¿è¡Œæ—¶ä¼šæŠ¥ Segmentation fault (core dumped)</span></span><br><span class="line"><span class="comment">        // æ‰“å°å †æ ˆï¼Œçœ‹äº†åŠå¤©ï¼Œæ‰å‘ç°çš„ï¼Œå¼•ä»¥ä¸ºæˆ’ï¼Œä¸è¿‡è¿™ä¸¤å˜é‡åå­—å¾ˆåƒã€‚</span></span><br><span class="line"><span class="comment">        createInfo.ppEnabledLayerNames = glfwExtensions;</span></span><br><span class="line"><span class="comment">        createInfo.ppEnabledExtensionNames = glfwExtensions;</span></span><br><span class="line"><span class="comment">        createInfo.enabledExtensionCount = glfwExtensionCount;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="comment">// è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•, æ”¯æŒæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">        <span class="keyword">auto</span> extensions = <span class="built_in">getRequiredExtensions</span>();</span><br><span class="line">        createInfo.enabledExtensionCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(extensions.<span class="built_in">size</span>());</span><br><span class="line">        createInfo.ppEnabledExtensionNames = extensions.<span class="built_in">data</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»“æ„ä½“çš„æœ€åä¸¤ä¸ªæˆå‘˜ç¡®å®šè¦å¯ç”¨çš„å…¨å±€éªŒè¯å±‚ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">            createInfo.enabledLayerCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(validationLayers.<span class="built_in">size</span>());</span><br><span class="line">            createInfo.ppEnabledLayerNames = validationLayers.<span class="built_in">data</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            createInfo.enabledLayerCount = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// VkResult vkCreateInstance(const VkInstanceCreateInfo *pCreateInfo, const VkAllocationCallbacks *pAllocator, VkInstance *pInstance)</span></span><br><span class="line">        VkResult res = <span class="built_in">vkCreateInstance</span>(&amp;createInfo, <span class="literal">nullptr</span>, &amp;instance);</span><br><span class="line">        <span class="keyword">if</span> (res != VK_SUCCESS) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create instance!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mainLoop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¾ªç¯, ä½¿åº”ç”¨ç¨‹åºä¿æŒè¿è¡Œç›´åˆ°å‘ç”Ÿé”™è¯¯æˆ–çª—å£å…³é—­</span></span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window)) &#123;</span><br><span class="line">            <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ vulkan ä¸­æ¨èåœ¨åˆ›å»ºçš„èµ„æºä¸éœ€è¦åä¸»åŠ¨é‡Šæ”¾</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾debugMessenger(VkDebugUtilsMessengerEXT, ç”¨äºæ‰“å°è°ƒè¯•ä¿¡æ¯)</span></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">            <span class="built_in">DestroyDebugUtilsMessengerEXT</span>(instance, debugMessenger, <span class="literal">nullptr</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åœ¨ vulkan ä¸­èµ„æºä¸€èˆ¬éƒ½æ˜¯ vkCreateXXX åˆ›å»ºï¼Œç”± vkDestroyXXX æˆ– vkFreeXXX é‡Šæ”¾.</span></span><br><span class="line">        <span class="built_in">vkDestroyInstance</span>(instance, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤å‡½æ•°ä¼šç ´åæŒ‡å®šçš„çª—å£åŠå…¶ä¸Šä¸‹æ–‡ã€‚ åœ¨è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œä¸ä¼šä¸ºè¯¥çª—å£è°ƒç”¨å…¶ä»–å›è°ƒã€‚</span></span><br><span class="line">        <span class="comment">// å¦‚æœæŒ‡å®šçª—å£çš„ä¸Šä¸‹æ–‡åœ¨ä¸»çº¿ç¨‹ä¸Šæ˜¯æœ€æ–°çš„ï¼Œåˆ™åœ¨é”€æ¯ä¹‹å‰å°†å…¶åˆ†ç¦»ã€‚</span></span><br><span class="line">        <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤åŠŸèƒ½ä¼šé‡Šæ”¾æ‰€æœ‰å‰©ä½™çš„çª—å£å’Œå…‰æ ‡å¹¶é‡Šæ”¾ä»»ä½•å…¶ä»–å·²åˆ†é…çš„èµ„æºã€‚ </span></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ­¤å‡½æ•°åï¼Œå¿…é¡»å†æ¬¡æˆåŠŸè°ƒç”¨@ref glfwInitï¼Œç„¶åæ‰èƒ½ä½¿ç”¨å¤§å¤šæ•°GLFWå‡½æ•°ã€‚</span></span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºæ¶ˆæ¯å›è°ƒMessage Callback</span></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">getRequiredExtensions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> glfwExtensionCount = <span class="number">0</span>;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>** glfwExtensions;</span><br><span class="line">        glfwExtensions = <span class="built_in">glfwGetRequiredInstanceExtensions</span>(&amp;glfwExtensionCount);</span><br><span class="line"></span><br><span class="line">        <span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">extensions</span><span class="params">(glfwExtensions, glfwExtensions + glfwExtensionCount)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">            extensions.<span class="built_in">push_back</span>(VK_EXT_DEBUG_UTILS_EXTENSION_NAME);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> extensions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°debugä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="type">static</span> VKAPI_ATTR VkBool32 VKAPI_CALL <span class="title">debugCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessageSeverityFlagBitsEXT messageSeverity,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessageTypeFlagsEXT messageType,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">const</span> VkDebugUtilsMessengerCallbackDataEXT* pCallbackData,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">void</span>* pUserData)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;validation layer: &quot;</span> &lt;&lt; pCallbackData-&gt;pMessage&lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> VK_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º VkDebugUtilsMessengerEXT å¯¹è±¡debugMessenger</span></span><br><span class="line">    <span class="function">VkResult <span class="title">CreateDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessengerCreateInfoEXT* pCreateInfo, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">        VkAllocationCallbacks* pAllocator, VkDebugUtilsMessengerEXT*</span></span></span><br><span class="line"><span class="params"><span class="function">        pDebugMessenger)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†ç»“æ„ä½“ VkDebugUtilsMessengerEXT ä¼ é€’ç»™vkCreateDebugUtilsMessengerEXTå‡½æ•°ä»¥åˆ›å»ºVkDebugUtilsMessengerEXTå¯¹è±¡ã€‚ </span></span><br><span class="line">        <span class="comment">// ç„¶è€Œå› ä¸ºè¿™ä¸ªfunctionæ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨åŠ è½½ã€‚</span></span><br><span class="line">        <span class="comment">// å¿…é¡»ä½¿ç”¨vkGetInstanceProcAddræŸ¥æ‰¾å…¶åœ°å€ã€‚</span></span><br><span class="line">        <span class="keyword">auto</span> func = (PFN_vkCreateDebugUtilsMessengerEXT)</span><br><span class="line">        <span class="built_in">vkGetInstanceProcAddr</span>(instance,<span class="string">&quot;vkCreateDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">func</span>(instance, pCreateInfo, pAllocator, pDebugMessenger);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> VK_ERROR_EXTENSION_NOT_PRESENT;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é”€æ¯VkDebugUtilsMessengerEXT</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">DestroyDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessengerEXT debugMessenger, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">        VkAllocationCallbacks* pAllocator)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> func = (PFN_vkDestroyDebugUtilsMessengerEXT)</span><br><span class="line">        <span class="built_in">vkGetInstanceProcAddr</span>(instance, <span class="string">&quot;vkDestroyDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="built_in">func</span>(instance, debugMessenger, pAllocator);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Windowå®ä¾‹</span></span><br><span class="line">    GLFWwindow* window;</span><br><span class="line">    <span class="comment">// Vulkanå®ä¾‹</span></span><br><span class="line">    VkInstance instance;</span><br><span class="line">    <span class="comment">// DEBUGæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">    VkDebugUtilsMessengerEXT debugMessenger;</span><br><span class="line">    <span class="comment">// éªŒè¯å±‚</span></span><br><span class="line">    <span class="type">const</span> std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; validationLayers = &#123;</span><br><span class="line">        <span class="string">&quot;VK_LAYER_KHRONOS_validation&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HelloTriangleApplication app;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        app.<span class="built_in">run</span>();</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cerr &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
  </entry>
</search>
