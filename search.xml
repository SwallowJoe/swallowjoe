<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Vulkanå…¥é—¨(1)-ç¯å¢ƒé…ç½®</title>
    <url>/2022/02/26/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡ä¸»è¦æ˜¯ä»‹ç»å¦‚ä½•åœ¨ ubuntu æœºå™¨ä¸Šå®‰è£…å¹¶ç¼–è¯‘Vulkanç¨‹åºã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li><a href="https://vulkan.lunarg.com/doc/sdk/1.2.170.0/linux/getting_started.html">https://vulkan.lunarg.com/doc/sdk/1.2.170.0/linux/getting_started.html</a></li>
<li><a href="https://github.com/google/glog">https://github.com/google/glog</a></li>
<li>[pkg-configçš„ç”¨æ³•]<a href="https://www.cnblogs.com/chris-cp/p/3580002.html">https://www.cnblogs.com/chris-cp/p/3580002.html</a></li>
<li>[è§£å†³&#x2F;usr&#x2F;local&#x2F;lib&#x2F;libglog.so.0: error adding symbols: DSO missing from command line]<a href="https://blog.csdn.net/u010987458/article/details/72235408">https://blog.csdn.net/u010987458/article/details/72235408</a></li>
<li><a href="https://www.glfw.org/docs/3.3/build_guide.html#build_link_cmake_package">https://www.glfw.org/docs/3.3/build_guide.html#build_link_cmake_package</a></li>
<li>[GLFW]<a href="https://www.glfw.org/">https://www.glfw.org/</a></li>
<li>[GLM]<a href="https://github.com/g-truc/glm">https://github.com/g-truc/glm</a></li>
</ol>
<h1 id="ä¸€-å‡†å¤‡ç¯å¢ƒ"><a href="#ä¸€-å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="ä¸€. å‡†å¤‡ç¯å¢ƒ"></a>ä¸€. å‡†å¤‡ç¯å¢ƒ</h1><h2 id="1-1-å¼€å‘ç¯å¢ƒ"><a href="#1-1-å¼€å‘ç¯å¢ƒ" class="headerlink" title="1.1 å¼€å‘ç¯å¢ƒ"></a>1.1 å¼€å‘ç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get dist-upgrade</span><br><span class="line">sudo apt-get install libglm-dev cmake libxcb-dri3-0 libxcb-present0 libpciaccess0 libpng-dev libxcb-keysyms1-dev libxcb-dri3-dev libx11-dev  libmirclient-dev libwayland-dev libxrandr-dev libxcb-ewmh-dev</span><br><span class="line"></span><br><span class="line">sudo apt-get install git libpython2.7</span><br></pre></td></tr></table></figure>

<h2 id="1-2-ä¸‹è½½-SDK"><a href="#1-2-ä¸‹è½½-SDK" class="headerlink" title="1.2 ä¸‹è½½ SDK"></a>1.2 ä¸‹è½½ SDK</h2><p>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://vulkan.lunarg.com/">https://vulkan.lunarg.com/</a> ä¸‹è½½SDKåŒ…ï¼švulkan-sdk.tar.gz</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd ~/Program</span><br><span class="line">mkdir vulkan</span><br><span class="line">cd vulkan</span><br><span class="line">tar zxf $HOME/Downloads/vulkan-sdk.tar.gz</span><br></pre></td></tr></table></figure>
<p>è§£å‹åçš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ–‡ä»¶å¤¹</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>x86_64&#x2F;bin</td>
<td>Vulkanå·¥å…·å’Œå‘½ä»¤</td>
</tr>
<tr>
<td>x86_64&#x2F;include&#x2F;vulkan</td>
<td>ç¼–è¯‘é“¾æ¥å¤´æ–‡ä»¶</td>
</tr>
<tr>
<td>x86_64&#x2F;lib</td>
<td>VulkanåŠ è½½ç¨‹åºåº“å’Œlayerè¿è¡Œæ—¶åº“</td>
</tr>
<tr>
<td>x86_64&#x2F;etc&#x2F;explicit_layer.d</td>
<td>.json ç”¨äºVulkanéªŒè¯å±‚çš„æ¸…å•æ–‡ä»¶</td>
</tr>
<tr>
<td>config</td>
<td>æ ·æœ¬å±‚è®¾ç½®æ–‡ä»¶ï¼Œç³»ç»Ÿé…ç½®è¯´æ˜</td>
</tr>
<tr>
<td>doc</td>
<td>Khronos SPIRVï¼ŒVulkanï¼ŒLoaderå’ŒWSIè§„èŒƒ</td>
</tr>
<tr>
<td>examples</td>
<td>Vulkanç¨‹åºç¤ºä¾‹</td>
</tr>
<tr>
<td>samples</td>
<td>Vulkançš„ç¤ºä¾‹ä»£ç </td>
</tr>
<tr>
<td>source</td>
<td>glslangå’Œæ‰€é€‰Vulkanç»„ä»¶çš„æºå’Œè°ƒè¯•åº“</td>
</tr>
</tbody></table>
<h2 id="1-3-å®‰è£…SDK"><a href="#1-3-å®‰è£…SDK" class="headerlink" title="1.3 å®‰è£…SDK"></a>1.3 å®‰è£…SDK</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source ~/Program/vulkan/1.2.170.0/setup-env.sh</span><br><span class="line"></span><br><span class="line">export VULKAN_SDK=~/vulkan/1.2.170.0/x86_64</span><br><span class="line">export PATH=$VULKAN_SDK/bin:$PATH</span><br><span class="line">export LD_LIBRARY_PATH=$VULKAN_SDK/lib:$LD_LIBRARY_PATH</span><br><span class="line">export VK_LAYER_PATH=$VULKAN_SDK/etc/explicit_layer.d</span><br></pre></td></tr></table></figure>

<p>å¤§åŠŸå‘Šæˆï¼Œæ£€æŸ¥ä¸€ä¸‹ï¼šè¾“å…¥vulkaninfo<br><a href="mailto:&#117;&#98;&#x75;&#110;&#116;&#117;&#64;&#49;&#x38;&#46;&#48;&#x34;&#76;">&#117;&#98;&#x75;&#110;&#116;&#117;&#64;&#49;&#x38;&#46;&#48;&#x34;&#76;</a> ~  vulkaninfo<br>Cannot create Vulkan instance.<br>&#x2F;home&#x2F;lunarg&#x2F;sdk-build&#x2F;Vulkan-Tools&#x2F;vulkaninfo&#x2F;vulkaninfo.c:921: failed with VK_ERROR_INCOMPATIBLE_DRIVER</p>
<p>wtf, å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿç­‰ç­‰ï¼Œè²Œä¼¼æˆ‘ä»¬æ²¡æœ‰æ£€æŸ¥æ˜¯å¦å®‰è£…äº†é©±åŠ¨ã€‚ã€‚ã€‚</p>
<h2 id="1-4-å®‰è£…é©±åŠ¨"><a href="#1-4-å®‰è£…é©±åŠ¨" class="headerlink" title="1.4 å®‰è£…é©±åŠ¨"></a>1.4 å®‰è£…é©±åŠ¨</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:oibaf/graphics-drivers</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade</span><br><span class="line">apt install libvulkan1 mesa-vulkan-drivers vulkan-utils</span><br><span class="line"></span><br><span class="line">// æˆ–è€…è¯•è¯•ï¼š</span><br><span class="line">sudo add-apt-repository ppa:graphics-drivers/ppa</span><br><span class="line">sudo apt upgrade</span><br><span class="line">sudo apt install nvidia-graphics-drivers-396 nvidia-settings vulkan vulkan-utils</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ä¸€ä¸‹ï¼šè¾“å…¥vulkaninfo</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_1.png" alt="å›¾ç‰‡"></p>
<p>æˆ–è€…ï¼švulkaninfo â€“html , åœ¨å½“å‰ç›®å½•ç”Ÿæˆ vulkaninfo.html æ–‡ä»¶ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°æ›´å¤šä¿¡æ¯</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_2.png" alt="å›¾ç‰‡"></p>
<h2 id="1-5-è¿è¡Œç¤ºä¾‹ç¨‹åº"><a href="#1-5-è¿è¡Œç¤ºä¾‹ç¨‹åº" class="headerlink" title="1.5. è¿è¡Œç¤ºä¾‹ç¨‹åº"></a>1.5. è¿è¡Œç¤ºä¾‹ç¨‹åº</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd Program/vulkan/1.1.160.0/examples</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br></pre></td></tr></table></figure>
<p>makeæˆåŠŸåä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆï¼š</p>
<p><img src="/./images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_3.png" alt="å›¾ç‰‡"></p>
<p>è¿è¡Œç¤ºä¾‹ç¨‹åºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./vkcube</span><br></pre></td></tr></table></figure>

<p><img src="/./images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_4.png" alt="å›¾ç‰‡"></p>
<p>ä¸€ä¸ªæ—‹è½¬çš„ç«‹æ–¹ä½“ï½</p>
<h1 id="äºŒ-GLFW-å®‰è£…"><a href="#äºŒ-GLFW-å®‰è£…" class="headerlink" title="äºŒ. GLFW å®‰è£…"></a>äºŒ. GLFW å®‰è£…</h1><p>Vulkanæœ¬èº«æ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œä¸åŒ…æ‹¬ç”¨äºåˆ›å»ºæ˜¾ç¤ºæ¸²æŸ“ç»“æœçš„çª—å£çš„å·¥å…·ã€‚ ä¸ºäº†ä»Vulkançš„è·¨å¹³å°ä¼˜åŠ¿ä¸­å—ç›Šå¹¶é¿å…X11çš„é™åˆ¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨GLFWåº“æ¥åˆ›å»ºä¸€ä¸ªæ”¯æŒWindowsï¼ŒLinuxå’ŒMacOSçš„çª—å£ã€‚<br>è¿˜æœ‰å…¶ä»–å¯ç”¨äºæ­¤ç›®çš„çš„åº“ï¼Œå¦‚SDLï¼Œä½†GLFWçš„ä¼˜åŠ¿åœ¨äºå®ƒé™¤äº†çª—å£åˆ›å»ºä¹‹å¤–ï¼Œè¿˜æŠ½è±¡äº†Vulkanä¸­ä¸€äº›å…¶ä»–ç‰¹å®šäºå¹³å°çš„ä¸œè¥¿ã€‚<br>æˆ‘ä»¬å°†ä»æºä»£ç å®‰è£…GLFWè€Œä¸æ˜¯ä½¿ç”¨è½¯ä»¶åŒ…ï¼Œå› ä¸ºVulkanæ”¯æŒéœ€è¦æœ€æ–°ç‰ˆæœ¬ã€‚ å¯ä»¥åœ¨å®˜æ–¹ç½‘ç«™ä¸Šæ‰¾åˆ°è¿™äº›æ¥æºã€‚<br>å°†æºä»£ç è§£å‹ç¼©åˆ°ä¸€ä¸ªæ–¹ä¾¿çš„ç›®å½•ï¼Œå¹¶ä½¿ç”¨CMakeLists.txtç­‰æ–‡ä»¶æ‰“å¼€ç›®å½•ä¸­çš„ç»ˆç«¯ã€‚</p>
<p>githubåœ°å€ï¼š<a href="https://github.com/glfw/glfw">https://github.com/glfw/glfw</a><br>è§£å‹åè¿›å…¥å…¶ä¸»ç›®å½•ï¼šcmake .<br>æœ‰æŠ¥é”™ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-- Looking <span class="keyword">for</span> shmat - found</span><br><span class="line">-- Found X11: /usr/lib/x86_64-linux-gnu/libX11.so</span><br><span class="line">CMake Error at CMakeLists.txt:<span class="number">220</span> (message):</span><br><span class="line">  The Xinerama headers were not found</span><br><span class="line"></span><br><span class="line">-- Configuring incomplete, errors occurred!</span><br><span class="line">See also <span class="string">&quot;/home/jh/Program/vulkan/glfw-master/CMakeFiles/CMakeOutput.log&quot;</span>.</span><br><span class="line">See also <span class="string">&quot;/home/jh/Program/vulkan/glfw-master/CMakeFiles/CMakeError.log&quot;</span>.</span><br></pre></td></tr></table></figure>

<p>ç¼ºå°‘ç¯å¢ƒï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ ~/Program/vulkan/glfw-master î‚° sudo apt-get install libsdl2-dev</span><br></pre></td></tr></table></figure>

<p>ç„¶åé‡æ–°: cmake .</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ğŸ¦„ î‚° ~/Program/vulkan/glfw-master î‚° cmake .</span><br><span class="line">-- Could NOT find <span class="title function_">Doxygen</span> <span class="params">(missing: DOXYGEN_EXECUTABLE)</span> </span><br><span class="line">-- Using X11 <span class="keyword">for</span> window creation</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/jh/Program/vulkan/glfw-master</span><br></pre></td></tr></table></figure>
<p>æ¿¡æŸ“æ²¡æœ‰æŠ¥é”™ï¼Œä½†è¿™ä¸ªä¹Ÿæ˜¯æ²¡æœ‰æˆåŠŸçš„ï¼šç¼ºå°‘Doxygen<br>sudo apt-get install doxygen</p>
<p>é‡æ–°: cmake .<br>æœ€å: make<br>æˆåŠŸåï¼šsudo make install</p>
<h1 id="ä¸‰-GLM-å®‰è£…"><a href="#ä¸‰-GLM-å®‰è£…" class="headerlink" title="ä¸‰. GLM å®‰è£…"></a>ä¸‰. GLM å®‰è£…</h1><p>ä¸DirectX 12ä¸åŒï¼ŒVulkanä¸åŒ…å«ç”¨äºçº¿æ€§ä»£æ•°è¿ç®—çš„åº“ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä¸‹è½½ä¸€ä¸ªã€‚<br>GLMæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åº“ï¼Œè®¾è®¡ç”¨äºå›¾å½¢APIï¼Œä¹Ÿå¸¸ç”¨äºOpenGLã€‚<br>å®ƒæ˜¯ä¸€ä¸ªåªæœ‰å¤´çš„åº“ï¼Œå¯ä»¥ä»libglm-devåŒ…å®‰è£…ï¼š</p>
<p>sudo apt install libglm-dev</p>
<h1 id="å››-æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç "><a href="#å››-æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç " class="headerlink" title="å››. æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç "></a>å››. æ‰‹åŠ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç </h1><h2 id="4-1-åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚"><a href="#4-1-åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚" class="headerlink" title="4.1 åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚"></a>4.1 åœ¨ç¼–è¯‘ç¤ºä¾‹ä»£ç çš„æ—¶å€™è€æ˜¯æŠ¥é”™ï¼Œæ‰¾ä¸åˆ°vulkanå¤´æ–‡ä»¶ã€‚</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ gcc -o main main.cpp -lglfw3</span><br><span class="line">In file included from main.cpp:2:</span><br><span class="line">/usr/local/include/GLFW/glfw3.h:215:12: fatal error: vulkan/vulkan.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line">   #include &lt;vulkan/vulkan.h&gt;</span><br><span class="line">            ^~~~~~~~~~~~~~~~~</span><br><span class="line">compilation terminated.</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶æ˜¯ç¯å¢ƒè®¾ç½®çš„é—®é¢˜ï¼šéœ€è¦å°†å¤´æ–‡ä»¶ç­‰æ‹·è´åˆ°å¯¹åº”systemæ–‡ä»¶å¤¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd Program/vulkan/1.2.170.0/x86_64</span><br><span class="line">sudo cp -r include/vulkan/ /usr/local/include/</span><br><span class="line">sudo cp -P lib/libvulkan.so* /usr/local/lib/</span><br><span class="line">sudo cp lib/libVkLayer_*.so /usr/local/lib/</span><br><span class="line">sudo mkdir -p /usr/local/share/vulkan/explicit_layer.d</span><br><span class="line">sudo cp etc/explicit_layer.d/VkLayer_*.json /usr/local/share/vulkan/explicit_layer.d    </span><br><span class="line"></span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure>

<h2 id="4-2-error-adding-symbols-DSO-missing-from-command-line"><a href="#4-2-error-adding-symbols-DSO-missing-from-command-line" class="headerlink" title="4.2 error adding symbols: DSO missing from command line"></a>4.2 error adding symbols: DSO missing from command line</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">g++ -std=c++17 -I/home/jh/Program/vulkan/1.1.160.0/x86_64/include -o VulkanTest main.cpp -L/home/jh/Program/vulkan/1.1.160.0/x86_64/lib -lvulkan -lglfw3</span><br><span class="line">/usr/bin/ld: //usr/local/lib/libglfw3.a(vulkan.c.o): undefined reference to symbol &#x27;dlclose@@GLIBC_2.2.5&#x27;</span><br><span class="line">/usr/bin/ld: //lib/x86_64-linux-gnu/libdl.so.2: error adding symbols: DSO missing from command line</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br><span class="line">make: *** [Makefile:8ï¼šVulkanTest] é”™è¯¯ 1</span><br></pre></td></tr></table></figure>

<p>cd &#x2F;usr&#x2F;lib&#x2F;<br>ll |grep -iE â€œliblogâ€<br>æ²¡æœ‰æ–‡ä»¶</p>
<p><a href="https://github.com/google/glog">https://github.com/google/glog</a><br>ä¸‹è½½è§£å‹, è¿›å…¥è§£å‹åçš„ä¸»ç›®å½•ï¼Œæ‰§è¡Œï¼š<br>.&#x2F;autogen.sh &amp;&amp; .&#x2F;configure &amp;&amp; make &amp;&amp; make install</p>
<p>å¦‚æœæŠ¥é”™ï¼šautogen.sh: 5: autogen.sh: autoreconf: not found<br>sudo apt-get install autoconf<br>sudo apt-get install automake<br>sudo apt-get install libtool</p>
<p>é‡æ–°æ‰§è¡Œï¼š.&#x2F;autogen.sh &amp;&amp; .&#x2F;configure &amp;&amp; make &amp;&amp; make install<br>å¯èƒ½è¿˜æœ‰æƒé™é—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- Up-to-date: /usr/local/include/GLFW</span><br><span class="line">CMake Error at cmake_install.cmake:41 (file):</span><br><span class="line">  file INSTALL cannot set permissions on &quot;/usr/local/include/GLFW&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make: *** [Makefile:118ï¼šinstall] é”™è¯¯ 1</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œï¼š<br>cd ..<br>chmod a+x glog-master -R<br>cd glog-master<br>make &amp;&amp; make install</p>
<p>okay,ç°åœ¨å¯ä»¥åœ¨Makefileæ–‡ä»¶ä¸­æ·»åŠ ï¼š-lglog</p>
<p>é‡æ–° make è¿˜æ˜¯ä¼šå­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œç¬”è€…æŸ¥é˜…å„ç§èµ„æ–™ï¼Œå¤§éƒ¨åˆ†æŒ‡æ˜åœ¨Makefileä¸­åŠ å…¥ -ldl å³å¯ï¼Œå°è¯•åå¤±è´¥ã€‚<br>æœ€åå‘ç°æ˜¯ Makefile æ–‡ä»¶å†™çš„æœ‰é—®é¢˜ï¼Œæ”¹æˆå¦‚[#5.2]å³å¯.</p>
<h2 id="4-3-è¿è¡Œç¤ºä¾‹"><a href="#4-3-è¿è¡Œç¤ºä¾‹" class="headerlink" title="4.3 è¿è¡Œç¤ºä¾‹"></a>4.3 è¿è¡Œç¤ºä¾‹</h2><p>make æˆåŠŸåï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ VulkanTest å¯æ‰§è¡Œæ–‡ä»¶:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./VulkanTest</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹:</p>
<p><img src="/./images/Vulkan%E5%85%A5%E9%97%A8-1-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Vulkan_1_5.png" alt="å›¾ç‰‡"></p>
<h1 id="äº”-ä¸»è¦ä»£ç "><a href="#äº”-ä¸»è¦ä»£ç " class="headerlink" title="äº”. ä¸»è¦ä»£ç "></a>äº”. ä¸»è¦ä»£ç </h1><h2 id="5-1-main-cpp"><a href="#5-1-main-cpp" class="headerlink" title="5.1 main.cpp"></a>5.1 main.cpp</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> GLFW_INCLUDE_VULKAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLM_FORCE_RADIANS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLM_FORCE_DEPTH_ZERO_TO_ONE</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/vec4.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/mat4x4.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">glfwInit</span>();</span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line">    GLFWwindow* window = <span class="built_in">glfwCreateWindow</span>(<span class="number">800</span>, <span class="number">600</span>, <span class="string">&quot;Vulkan window&quot;</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> extensionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">vkEnumerateInstanceExtensionProperties</span>(<span class="literal">nullptr</span>, &amp;extensionCount, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; extensionCount &lt;&lt; <span class="string">&quot; extensions supported&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    glm::mat4 matrix;</span><br><span class="line">    glm::vec4 vec;</span><br><span class="line">    <span class="keyword">auto</span> test = matrix * vec;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!<span class="built_in">glfwWindowShouldClose</span>(window)) &#123;</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line">    <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-Makefile"><a href="#5-2-Makefile" class="headerlink" title="5.2 Makefile"></a>5.2 Makefile</h2><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">VULKAN_SDK_PATH = /home/jh/Program/vulkan/1.1.160.0/x86_64</span><br><span class="line"></span><br><span class="line">CFLAGS = -std=c++17 -I<span class="variable">$(VULKAN_SDK_PATH)</span>/<span class="keyword">include</span></span><br><span class="line">LDFLAGS = -L<span class="variable">$(VULKAN_SDK_PATH)</span>/lib -lvulkan `pkg-config --static --libs glfw3`</span><br><span class="line">LDFLAGS += -ldl</span><br><span class="line"></span><br><span class="line"><span class="section">VulkanTest: main.cpp</span></span><br><span class="line">	g++ <span class="variable">$(CFLAGS)</span> -o VulkanTest main.cpp <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: test clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">test: VulkanTest</span></span><br><span class="line">    LD_LIBRARY_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/lib</span><br><span class="line">        VK_LAYER_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/etc/explicit_layer.d ./VulkanTest</span><br><span class="line"></span><br><span class="line"><span class="section">clean:rm -f VulkanTest</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(10)-é‡å»ºäº¤æ¢é“¾</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-10-%E9%87%8D%E5%BB%BA%E4%BA%A4%E6%8D%A2%E9%93%BE/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>åœ¨ä¸Šä¸€ç¯‡é‡Œï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸç»˜åˆ¶äº†ä¸€ä¸ªé¢œè‰²æ¸å˜çš„ä¸‰è§’å½¢ï¼Œå¹¶å°†å…¶æ˜¾ç¤ºåœ¨çª—å£ä¸Šäº†ã€‚ä½†æ˜¯çª—å£Surfaceå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œä½¿äº¤æ¢é“¾ä¸å†ä¸ä¹‹å…¼å®¹ï¼Œæ¯”å¦‚æ˜¯çª—å£å¤§å°çš„å˜åŒ–ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ•è·è¿™äº›äº‹ä»¶å¹¶é‡æ–°åˆ›å»ºäº¤æ¢é“¾ã€‚</p>
<span id="more"></span>

<h1 id="ä¸€-é‡å»ºäº¤æ¢é“¾"><a href="#ä¸€-é‡å»ºäº¤æ¢é“¾" class="headerlink" title="ä¸€. é‡å»ºäº¤æ¢é“¾"></a>ä¸€. é‡å»ºäº¤æ¢é“¾</h1><p>åˆ›å»ºä¸€ä¸ªæ–°çš„recreateSwapChainå‡½æ•°ï¼Œè¯¥å‡½æ•°è°ƒç”¨createSwapChainå’Œæ‰€æœ‰ä¾èµ–äºäº¤æ¢é“¾æˆ–çª—å£å¤§å°çš„å¯¹è±¡çš„åˆ›å»ºå‡½æ•°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanupSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">recreateSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç­‰å¾…é˜Ÿåˆ—ä¸­æ‰€æœ‰æ“ä½œå®Œæˆ</span></span><br><span class="line">    <span class="built_in">vkDeviceWaitIdle</span>(device);</span><br><span class="line">    <span class="comment">// å…ˆæ¸…ç†ååˆ›å»º</span></span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">createSwapChain</span>();</span><br><span class="line">    <span class="built_in">createImageViews</span>();</span><br><span class="line">    <span class="built_in">createRenderPass</span>();</span><br><span class="line">    <span class="built_in">createGraphicsPipeline</span>();</span><br><span class="line">    <span class="built_in">createFramebuffers</span>();</span><br><span class="line">    <span class="built_in">createCommandBuffers</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆè°ƒç”¨vkDeviceWaitIdleï¼Œç¡®ä¿ä¸è§¦åŠå¯èƒ½ä»åœ¨ä½¿ç”¨çš„èµ„æºã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬å¿…é¡»åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯é‡æ–°åˆ›å»ºäº¤æ¢é“¾æœ¬èº«ã€‚</p>
<p>éœ€è¦é‡æ–°åˆ›å»ºå›¾åƒè§†å›¾ï¼Œå› ä¸ºå®ƒä»¬ç›´æ¥åŸºäºäº¤æ¢é“¾å›¾åƒã€‚æ¸²æŸ“é€šé“éœ€è¦é‡æ–°åˆ›å»ºï¼Œå› ä¸ºå®ƒå–å†³äºäº¤æ¢é“¾å›¾åƒçš„æ ¼å¼ã€‚äº¤æ¢é“¾çš„å›¾åƒæ ¼å¼å¾ˆå°‘åœ¨çª—å£è°ƒæ•´ç­‰æ“ä½œæœŸé—´å‘ç”Ÿæ”¹å˜ï¼Œä½†å®ƒä»ç„¶åº”è¯¥è¢«å¤„ç†ã€‚è§†å£å’Œå‰ªåˆ€çŸ©å½¢å¤§å°æ˜¯åœ¨å›¾å½¢ç®¡é“åˆ›å»ºæ—¶æŒ‡å®šçš„ï¼Œå› æ­¤ç®¡é“ä¹Ÿéœ€è¦é‡æ–°æ„å»ºã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨åŠ¨æ€çŠ¶æ€çš„è§†å›¾å’Œå‰ªåˆ€çŸ©å½¢æ¥é¿å…è¿™ç§æƒ…å†µã€‚æœ€åï¼Œå¸§ç¼“å†²åŒºå’Œå‘½ä»¤ç¼“å†²åŒºä¹Ÿç›´æ¥ä¾èµ–äºäº¤æ¢é“¾å›¾åƒã€‚</p>
<p>ä¸ºäº†ç¡®ä¿è¿™äº›å¯¹è±¡çš„æ—§ç‰ˆæœ¬åœ¨é‡æ–°åˆ›å»ºå®ƒä»¬ä¹‹å‰å¾—åˆ°æ¸…ç†ï¼Œæˆ‘ä»¬åº”è¯¥å°†ä¸€äº›æ¸…ç†ä»£ç ç§»åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»recreateSwapChainå‡½æ•°è°ƒç”¨è¿™ä¸ªå‡½æ•°cleanupSwapChainã€‚</p>
<h2 id="1-1-cleanupSwapChain"><a href="#1-1-cleanupSwapChain" class="headerlink" title="1.1 cleanupSwapChain"></a>1.1 cleanupSwapChain</h2><p>å°†æ‰€æœ‰å’Œäº¤æ¢é“¾ç›¸å…³çš„èµ„æºä»cleanupå‡½æ•°ä¸­ç§»åˆ°æ­¤å‡½æ•°å†…ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanupSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾æ‰€æœ‰çš„å¸§ç¼“å†²åŒº</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> framebuffer : swapChainFramebuffers) &#123;</span><br><span class="line">        <span class="built_in">vkDestroyFramebuffer</span>(device, framebuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾æŒ‡ä»¤ç¼“å†²åŒº</span></span><br><span class="line">    <span class="comment">// å¯ä»¥ä»å¤´é‡æ–°åˆ›å»ºå‘½ä»¤æ± ï¼Œä½†ç›¸å½“æµªè´¹ã€‚æ‰€ä»¥é€‰æ‹©ä½¿ç”¨vkFreeCommandBufferså‡½æ•°æ¸…ç†ç°æœ‰çš„å‘½ä»¤ç¼“å†²åŒºã€‚</span></span><br><span class="line">    <span class="comment">// è¿™æ ·å¯ä»¥é‡ç”¨ç°æœ‰çš„æ± æ¥åˆ†é…æ–°çš„å‘½ä»¤ç¼“å†²åŒºã€‚</span></span><br><span class="line">    <span class="built_in">vkFreeCommandBuffers</span>(device, commandPool,</span><br><span class="line">            <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(commandBuffers.<span class="built_in">size</span>()), commandBuffers.<span class="built_in">data</span>());</span><br><span class="line">    <span class="comment">// é”€æ¯å›¾å½¢ç®¡é“</span></span><br><span class="line">    <span class="built_in">vkDestroyPipeline</span>(device, graphicsPipeline, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// é‡Šæ”¾ç®¡é“å¸ƒå±€</span></span><br><span class="line">    <span class="built_in">vkDestroyPipelineLayout</span>(device, pipelineLayout, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// é‡Šæ”¾æ¸²æŸ“é€šé“</span></span><br><span class="line">    <span class="built_in">vkDestroyRenderPass</span>(device, renderPass, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="comment">// é‡Šæ”¾äº¤æ¢é“¾å¯¹åº”çš„å›¾åƒè§†å›¾</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> imageView : swapChainImageViews) &#123;</span><br><span class="line">        <span class="built_in">vkDestroyImageView</span>(device, imageView, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾äº¤æ¢é“¾</span></span><br><span class="line">    <span class="built_in">vkDestroySwapchainKHR</span>(device, swapChain, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä»å¤´é‡æ–°åˆ›å»ºå‘½ä»¤æ± ï¼Œä½†ç›¸å½“æµªè´¹ã€‚æ‰€ä»¥é€‰æ‹©ä½¿ç”¨vkFreeCommandBufferså‡½æ•°æ¸…ç†ç°æœ‰çš„å‘½ä»¤ç¼“å†²åŒº, è¿™æ ·å¯ä»¥é‡ç”¨ç°æœ‰çš„æ± æ¥åˆ†é…æ–°çš„å‘½ä»¤ç¼“å†²åŒºã€‚</p>
<h2 id="1-2-è·å–çª—å£æœ€æ–°å¤§å°"><a href="#1-2-è·å–çª—å£æœ€æ–°å¤§å°" class="headerlink" title="1.2 è·å–çª—å£æœ€æ–°å¤§å°"></a>1.2 è·å–çª—å£æœ€æ–°å¤§å°</h2><p>ä¸ºäº†æ­£ç¡®åœ°å¤„ç†çª—å£çš„å¤§å°ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŸ¥è¯¢framebufferçš„å½“å‰å¤§å°ï¼Œä»¥ç¡®ä¿äº¤æ¢é“¾å›¾åƒå…·æœ‰(æ–°çš„)æ­£ç¡®çš„å¤§å°ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ”¹å˜chooseSwapExtentå‡½æ•°æ¥è€ƒè™‘å®é™…çš„å¤§å°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€‰æ‹©äº¤æ¢é“¾åˆ†è¾¨ç‡</span></span><br><span class="line"><span class="function">VkExtent2D <span class="title">chooseSwapExtent</span><span class="params">(<span class="type">const</span> VkSurfaceCapabilitiesKHR&amp; capabilities)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (capabilities.currentExtent.width != std::numeric_limits&lt;<span class="type">uint32_t</span>&gt;::<span class="built_in">max</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> capabilities.currentExtent;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">int</span> width, height;</span><br><span class="line">        <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line"></span><br><span class="line">        VkExtent2D actualExtent = &#123;</span><br><span class="line">            <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(width),</span><br><span class="line">            <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(height)&#125;;</span><br><span class="line">        actualExtent.width = std::<span class="built_in">max</span>(capabilities.minImageExtent.width, std::<span class="built_in">min</span>(capabilities.maxImageExtent.width, actualExtent.width));</span><br><span class="line">        actualExtent.height = std::<span class="built_in">max</span>(capabilities.minImageExtent.height, std::<span class="built_in">min</span>(capabilities.maxImageExtent.height, actualExtent.height));</span><br><span class="line">        <span class="keyword">return</span> actualExtent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡glfwGetFramebufferSizeå‡½æ•°æ¥è·å–å½“å‰çª—å£å¤§å°ã€‚</p>
<p>è¿™å°±æ˜¯é‡å»ºäº¤æ¢é“¾æ‰€éœ€è¦çš„å…¨éƒ¨!ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯:éœ€è¦åœ¨åˆ›å»ºæ–°çš„äº¤æ¢é“¾ä¹‹å‰åœæ­¢æ‰€æœ‰çš„å‘ˆç°ã€‚å½“ä»æ—§çš„äº¤æ¢é“¾åœ¨å›¾åƒä¸Šç»˜åˆ¶å‘½ä»¤æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„äº¤æ¢é“¾ã€‚éœ€è¦å°†ä¹‹å‰çš„äº¤æ¢é“¾ä¼ é€’ç»™VkSwapchainCreateInfoKHRç»“æ„ä¸­çš„oldswarechainå­—æ®µï¼Œå¹¶åœ¨ä½¿ç”¨å®Œæ—§çš„äº¤æ¢é“¾åç«‹å³é”€æ¯å®ƒã€‚</p>
<h2 id="1-3-æ¬¡ä¼˜æˆ–è¿‡æ—¶çš„äº¤æ¢é“¾"><a href="#1-3-æ¬¡ä¼˜æˆ–è¿‡æ—¶çš„äº¤æ¢é“¾" class="headerlink" title="1.3 æ¬¡ä¼˜æˆ–è¿‡æ—¶çš„äº¤æ¢é“¾"></a>1.3 æ¬¡ä¼˜æˆ–è¿‡æ—¶çš„äº¤æ¢é“¾</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ç¡®å®šä½•æ—¶éœ€è¦é‡æ–°åˆ›å»ºäº¤æ¢é“¾ï¼Œå¹¶è°ƒç”¨æ–°çš„recreateSwapChainå‡½æ•°ã€‚å¹¸è¿çš„æ˜¯ï¼ŒVulkané€šå¸¸ä¼šå‘Šè¯‰æˆ‘ä»¬äº¤æ¢é“¾åœ¨æ˜¾ç¤ºè¿‡ç¨‹ä¸­ä¸å†è¶³å¤Ÿã€‚vkAcquireNextImageKHRå’ŒvkQueuePresentKHRå‡½æ•°å¯ä»¥è¿”å›ä»¥ä¸‹ç‰¹æ®Šå€¼æ¥è¡¨ç¤ºè¿™ä¸€ç‚¹:</p>
<ol>
<li>VK_ERROR_OUT_OF_DATE_KHR: äº¤æ¢é“¾å·²ç»å˜å¾—ä¸è¡¨é¢ä¸å…¼å®¹ï¼Œä¸èƒ½å†ç”¨äºæ¸²æŸ“ã€‚é€šå¸¸å‘ç”Ÿåœ¨çª—å£å¤§å°è°ƒæ•´ä¹‹åã€‚</li>
<li>VK_SUBOPTIMAL_KHR:äº¤æ¢é“¾ä»ç„¶å¯ä»¥æˆåŠŸåœ°å‘ˆç°åˆ°è¡¨é¢ï¼Œä½†æ˜¯è¡¨é¢çš„å±æ€§ä¸å†å®Œå…¨åŒ¹é…ã€‚</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkResult result = <span class="built_in">vkAcquireNextImageKHR</span>(device, swapChain,</span><br><span class="line">        std::numeric_limits&lt;<span class="type">uint64_t</span>&gt;::<span class="built_in">max</span>(),</span><br><span class="line">        imageAvailableSemaphores[currentFrame], VK_NULL_HANDLE, &amp;imageIndex);</span><br><span class="line"><span class="keyword">if</span> (result == VK_ERROR_OUT_OF_DATE_KHR) &#123;</span><br><span class="line">    <span class="built_in">recreateSwapChain</span>();</span><br><span class="line">    <span class="comment">// å·²ç»è·å¾—äº†ä¸€ä¸ªæ˜ åƒã€‚VK_SUCCESSå’ŒVK_SUBOPTIMAL_KHRéƒ½è¢«è®¤ä¸ºæ˜¯â€œæˆåŠŸâ€è¿”å›ç , ä¹Ÿå¯ä»¥å»æ‰return</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (result != VK_SUCCESS &amp;&amp; result != VK_SUBOPTIMAL_KHR) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to acquire swap chain image!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœäº¤æ¢é“¾åœ¨è¯•å›¾è·å–æ˜ åƒæ—¶å·²ç»è¿‡æœŸï¼Œé‚£ä¹ˆå°±ä¸å¯èƒ½å†å‘å…¶å‘ˆç°ã€‚å› æ­¤ï¼Œåº”è¯¥ç«‹å³é‡æ–°åˆ›å»ºäº¤æ¢é“¾ï¼Œå¹¶åœ¨ä¸‹ä¸€ä¸ªdrawFrameè°ƒç”¨ä¸­å†æ¬¡å°è¯•ã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨è¿™ä¸­æ­¢ç»˜å›¾ï¼Œé‚£ä¹ˆæ …æ å°†æ°¸è¿œä¸ä¼šé€šè¿‡vkqueuessubmitæäº¤ï¼Œå½“æˆ‘ä»¬ç¨åå°è¯•ç­‰å¾…å®ƒæ—¶ï¼Œå®ƒå°†å¤„äºä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥é‡å»ºfenceä½œä¸ºäº¤æ¢é“¾é‡å»ºçš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯ç§»åŠ¨vkResetFencesè°ƒç”¨æ›´å®¹æ˜“:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vkResetFences</span>(device, <span class="number">1</span>, &amp;inFlightFences[currentFrame]);</span><br><span class="line"><span class="comment">// VkQueueæ˜¯Vulkanä¸­åº”ç”¨ç¨‹åºå‘GPUæäº¤å‘½ä»¤çš„å”¯ä¸€é€”å¾„</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">vkQueueSubmit</span>(graphicsQueue, <span class="number">1</span>, &amp;submitInfo, inFlightFences[currentFrame]) != VK_SUCCESS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to submit draw command buffer!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠfenceæ”¾åœ¨vkQueueSubmitä¹‹å‰ï¼Œè€Œä¸æ˜¯åœ¨vkWaitForFencesåç«‹åˆ»è°ƒç”¨ã€‚è¿™æ˜¯ä»€ä¹ˆåŸç†å‘¢ï¼Ÿ</p>
<h3 id="1-3-1-fence"><a href="#1-3-1-fence" class="headerlink" title="1.3.1 fence"></a>1.3.1 fence</h3><p>fenceæ˜¯ä¸€ç§åŒæ­¥åŸè¯­ï¼Œå¯ç”¨äºå°†ä¾èµ–é¡¹ä»é˜Ÿåˆ—æ’å…¥åˆ°ä¸»æœºã€‚fenceæœ‰ä¸¤ç§çŠ¶æ€â€”â€”æœ‰ä¿¡å·çš„å’Œæ²¡æœ‰ä¿¡å·çš„, fenceå¯ä»¥ä½œä¸ºé˜Ÿåˆ—æäº¤å‘½ä»¤æ‰§è¡Œçš„ä¸€éƒ¨åˆ†å‘å‡ºä¿¡å·ã€‚</p>
<p>ä½¿ç”¨vkResetFenceså¯ä»¥å°†fenceç½®ä¸ºunsignalçŠ¶æ€ã€‚ä¸»æœºå¯ä»¥é€šè¿‡vkWaitForFenceså‘½ä»¤æ¥ç­‰å¾…fenceï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡vkGetFenceStatusæ¥æŸ¥è¯¢å½“å‰çš„çŠ¶æ€ã€‚</p>
<p>å¦‚æœvkWaitForFencesè¢«è°ƒç”¨æ—¶æ¡ä»¶è¢«æ»¡è¶³ï¼Œé‚£ä¹ˆvkWaitForFencesä¼šç«‹å³è¿”å›ã€‚å¦‚æœåœ¨vkWaitForFencesè¢«è°ƒç”¨çš„æ—¶å€™æ¡ä»¶æ²¡æœ‰è¢«æ»¡è¶³ï¼Œé‚£ä¹ˆvkWaitForFenceså°†ä¼šé˜»å¡å¹¶ç­‰å¾…åˆ°è¶…æ—¶çº³ç§’ï¼Œç›´åˆ°æ¡ä»¶è¢«æ»¡è¶³ã€‚è¿™é‡Œçš„æ¡ä»¶å°±æ˜¯fenceçŠ¶æ€æ˜¯ä¸æ˜¯signalçŠ¶æ€ã€‚vkQueueSubmitä¼šå°†fenceç½®ä¸ºsignalçŠ¶æ€ï¼Œé‚£ä¹ˆvkWaitForFenceså°±ä¼šé€šè¿‡ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“vkWaitForFencesä¹‹åç«‹åˆ»è°ƒç”¨vkResetFencesï¼Œé‚£ä¹ˆå½“vkAcquireNextImageKHRå‘ç”Ÿå¼‚å¸¸å¯¼è‡´è¿”å›æ—¶ï¼Œä¸‹æ¬¡åœ¨è¿›å…¥drawFrameè°ƒç”¨vkWaitForFenceså°±æ°¸è¿œå¤„äºç­‰å¾…çŠ¶æ€äº†ã€‚</p>
<h3 id="1-3-2-vkQueuePresentKHR"><a href="#1-3-2-vkQueuePresentKHR" class="headerlink" title="1.3.2 vkQueuePresentKHR"></a>1.3.2 vkQueuePresentKHR</h3><p>å¦‚æœäº¤æ¢é“¾ä¸æ˜¯æœ€ä¼˜çš„ï¼Œä¹Ÿå¯ä»¥ç»§ç»­å‘ˆç°ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»è·å¾—äº†ä¸€ä¸ªæ˜ åƒã€‚VK_SUCCESSå’ŒVK_SUBOPTIMAL_KHRéƒ½è¢«è®¤ä¸ºæ˜¯â€œæˆåŠŸâ€è¿”å›ç ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">result = <span class="built_in">vkQueuePresentKHR</span>(presentQueue, &amp;presentInfo);</span><br><span class="line"><span class="keyword">if</span> (result == VK_ERROR_OUT_OF_DATE_KHR || result == VK_SUBOPTIMAL_KHR) &#123;</span><br><span class="line">    <span class="built_in">recreateSwapChain</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (result != VK_SUCCESS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to present swap chain image!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>vkQueuePresentKHRå‡½æ•°è¿”å›å…·æœ‰ç›¸åŒå«ä¹‰çš„ç›¸åŒå€¼ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœäº¤æ¢é“¾ä¸æ˜¯æ¬¡ä¼˜çš„ï¼Œä¸ºè·å¾—æœ€å¥½çš„ç»“æœï¼Œæœ€å¥½é‡æ–°åˆ›å»ºäº¤æ¢é“¾ã€‚</p>
<h2 id="1-4-ä¸»åŠ¨å¤„ç†çª—å£å˜åŒ–"><a href="#1-4-ä¸»åŠ¨å¤„ç†çª—å£å˜åŒ–" class="headerlink" title="1.4 ä¸»åŠ¨å¤„ç†çª—å£å˜åŒ–"></a>1.4 ä¸»åŠ¨å¤„ç†çª—å£å˜åŒ–</h2><p>å°½ç®¡è®¸å¤šé©±åŠ¨ç¨‹åºå’Œå¹³å°åœ¨è°ƒæ•´çª—å£å¤§å°åä¼šè‡ªåŠ¨è§¦å‘VK_ERROR_OUT_OF_DATE_KHRï¼Œä½†ä¸èƒ½ä¿è¯ä¸€å®šä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚æ‰€ä»¥æœ€å¥½é€šè¿‡ç›‘å¬çª—å£å˜åŒ–æ¥ä¸»åŠ¨é‡å»ºäº¤æ¢é“¾ã€‚</p>
<p>æ·»åŠ ä¸€ä¸ªæ–°çš„æˆå‘˜å˜é‡ï¼Œè¯¥å˜é‡æŒ‡ç¤ºå·²è°ƒæ•´å¤§å°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">bool</span> framebufferResized = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    result = <span class="built_in">vkQueuePresentKHR</span>(presentQueue, &amp;presentInfo);</span><br><span class="line">    <span class="keyword">if</span> (result == VK_ERROR_OUT_OF_DATE_KHR || result == VK_SUBOPTIMAL_KHR || framebufferResized) &#123;</span><br><span class="line">        framebufferResized = <span class="literal">false</span>;</span><br><span class="line">        <span class="built_in">recreateSwapChain</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-1-ç›‘å¬çª—å£å˜åŒ–"><a href="#1-4-1-ç›‘å¬çª—å£å˜åŒ–" class="headerlink" title="1.4.1 ç›‘å¬çª—å£å˜åŒ–"></a>1.4.1 ç›‘å¬çª—å£å˜åŒ–</h3><p>è¦å®é™…æ£€æµ‹çª—å£å¤§å°è°ƒæ•´ï¼Œå¯ä»¥ä½¿ç”¨GLFWæ¡†æ¶ä¸­çš„glfwSetFramebufferSizeCallbackå‡½æ•°æ¥è®¾ç½®å›è°ƒï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">glfwInit</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line"></span><br><span class="line">    window = <span class="built_in">glfwCreateWindow</span>(WIDTH, HEIGHT, <span class="string">&quot;Vulkan&quot;</span>, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">glfwSetWindowUserPointer</span>(window, <span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">glfwSetFramebufferSizeCallback</span>(window, framebufferResizeCallback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">framebufferResizeCallback</span><span class="params">(GLFWwindow* window, <span class="type">int</span> width, <span class="type">int</span> height)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> app = </span><br><span class="line">        <span class="built_in">reinterpret_cast</span>&lt;HelloTriangleApplication*&gt;(<span class="built_in">glfwGetWindowUserPointer</span>(window));</span><br><span class="line">    app-&gt;framebufferResized = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºglfwå›è°ƒåªèƒ½é€šè¿‡é™æ€å‡½æ•°å®ç°ï¼Œæ‰€ä»¥é€šè¿‡glfwSetWindowUserPointerä¿å­˜å½“å‰å®ä¾‹æŒ‡é’ˆã€‚</p>
<h2 id="1-5-çª—å£æœ€å°åŒ–"><a href="#1-5-çª—å£æœ€å°åŒ–" class="headerlink" title="1.5 çª—å£æœ€å°åŒ–"></a>1.5 çª—å£æœ€å°åŒ–</h2><p>è¿˜æœ‰ä¸€ç§ç‰¹æ®ŠçŠ¶æ€æ˜¯ï¼Œå½“æœ€å°åŒ–çª—å£æ—¶ï¼Œæ‹¿åˆ°çš„çª—å£å¤§å°æ˜¯0, è¿™æ ·åˆ›å»ºå‡ºæ¥çš„å¸§ç¼“å†²åŒºå¤§å°ä¹Ÿåº”è¯¥æ˜¯0ï¼Œæ ¹æœ¬ä¸éœ€è¦æ¸²æŸ“ã€‚æ‰€ä»¥è¿™é‡Œåšä¸€ä¸ªç®€å•çš„ç­‰å¾…å¤„ç†:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">recreateSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> width = <span class="number">0</span>, height = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (width == <span class="number">0</span> || height == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">glfwGetFramebufferSize</span>(window, &amp;width, &amp;height);</span><br><span class="line">        <span class="built_in">glfwWaitEvents</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vkDeviceWaitIdle</span>(device);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çªç„¶æœ‰ç‚¹å¥½å¥‡è¿™ä¸ªç»˜åˆ¶çš„åˆ·æ–°ç‡ï¼Œé€šè¿‡åœ¨drawFrameé‡ŒåµŒå…¥å‡½æ•°computeRefreshRateæ¥è®¡ç®—åˆ·æ–°ç‡:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">computeRefreshRate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> fps = <span class="number">0</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">int64_t</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">int64_t</span> lastCount = <span class="number">0</span>;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">auto</span> lastTimestamp = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="type">static</span> <span class="keyword">auto</span> now = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    count++;</span><br><span class="line"></span><br><span class="line">    now = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="type">float</span> duration = std::chrono::duration_cast&lt;std::chrono::duration&lt;<span class="type">float</span>&gt;&gt;(now-lastTimestamp).<span class="built_in">count</span>();</span><br><span class="line">    <span class="keyword">if</span> (duration &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        lastTimestamp = now;</span><br><span class="line">        fps = (count - lastCount)/duration;</span><br><span class="line">        lastCount = count;</span><br><span class="line">        std::cout&lt;&lt;<span class="string">&quot;computeRefreshRate: fps=&quot;</span>&lt;&lt;fps&lt;&lt;<span class="string">&quot;, count=&quot;</span>&lt;&lt;count&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®—å‡ºæ¥é«˜è¾¾4kï¼Œçœ‹èµ·æ¥è¿™ä¸ªfenceä¹Ÿå¹¶æ²¡æœ‰åŒæ­¥gpuæ˜¾ç¤ºï¼Œåªæ˜¯ä¸åœçš„æäº¤ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬æƒ³å§è¿™ä¸ªå®æ—¶åˆ·æ–°ç‡æ˜¾ç¤ºåœ¨æˆ‘ä»¬ç¨‹åºçš„å·¦ä¸Šè§’ï¼Œè¯¥æ€ä¹ˆåšå‘¢? </p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(11)-é¡¶ç‚¹è¾“å…¥æè¿°åŠé¡¶ç‚¹ç¼“å†²çš„åˆ›å»º</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-11-%E9%A1%B6%E7%82%B9%E8%BE%93%E5%85%A5%E6%8F%8F%E8%BF%B0%E5%8F%8A%E9%A1%B6%E7%82%B9%E7%BC%93%E5%86%B2%E7%9A%84%E5%88%9B%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç”¨å†…å­˜ä¸­çš„é¡¶ç‚¹ç¼“å†²åŒºæ›¿æ¢é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„ç¡¬ç¼–ç é¡¶ç‚¹æ•°æ®ã€‚æˆ‘ä»¬å°†ä»åˆ›å»ºCPUå¯è§ç¼“å†²åŒºçš„æœ€ç®€å•æ–¹æ³•å¼€å§‹ï¼Œå¹¶ä½¿ç”¨memcpyå°†é¡¶ç‚¹æ•°æ®ç›´æ¥å¤åˆ¶åˆ°å…¶ä¸­ï¼Œç„¶åæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨åˆ†æ®µç¼“å†²åŒºå°†é¡¶ç‚¹æ•°æ®å¤åˆ¶åˆ°é«˜æ€§èƒ½å†…å­˜ã€‚</p>
<span id="more"></span>

<p>é¦–å…ˆä¿®æ”¹é¡¶ç‚¹ç€è‰²å™¨ä¸å†åŒ…å«é¡¶ç‚¹æ•°æ®åœ¨ç€è‰²å™¨ä»£ç æœ¬èº«ï¼Œ é¡¶ç‚¹ç€è‰²å™¨ä½¿ç”¨inå…³é”®å­—ä»é¡¶ç‚¹ç¼“å†²åŒºè·å–è¾“å…¥ã€‚</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"><span class="meta">#extension GL_ARB_separate_shader_objects : enable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec2</span> inPosition;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> inColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºä¸ºfragColor</span></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(inPosition, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    fragColor = inColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>inPositionå’ŒinColorå˜é‡æ˜¯é¡¶ç‚¹å±æ€§ã€‚ å®ƒä»¬æ˜¯åœ¨é¡¶ç‚¹ç¼“å†²åŒºä¸­ä¸ºæ¯ä¸ªé¡¶ç‚¹æŒ‡å®šçš„å±æ€§ï¼Œå°±åƒæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªæ•°ç»„ä¸ºæ¯ä¸ªé¡¶ç‚¹æ‰‹åŠ¨æŒ‡å®šä½ç½®å’Œé¢œè‰²ä¸€æ ·ã€‚ æ›´æ”¹åè®°å¾—é‡æ–°ç¼–è¯‘é¡¶ç‚¹ç€è‰²å™¨ï¼</p>
<p>åƒfragColorä¸€æ ·ï¼Œlayoutï¼ˆlocation &#x3D; xï¼‰æ‰¹æ³¨ä¸ºè¾“å…¥åˆ†é…ç´¢å¼•ï¼Œæˆ‘ä»¬ä¹‹åå¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥å¼•ç”¨å®ƒä»¬ã€‚ é‡è¦çš„æ˜¯è¦çŸ¥é“æŸäº›ç±»å‹ï¼ˆä¾‹å¦‚dvec3 64ä½å‘é‡ï¼‰ä½¿ç”¨å¤šä¸ªæ’æ§½ã€‚ è¿™æ„å‘³ç€ä¹‹åçš„ç´¢å¼•å¿…é¡»è‡³å°‘é«˜2å€ï¼ˆè¿™é‡Œæ²¡ææ‡‚, éœ€è¦å­¦ä¹ ä¸€ä¸‹GLSLçš„è¯­æ³•:<a href="https://www.khronos.org/opengl/wiki/Layout_Qualifier_(GLSL)%EF%BC%89%EF%BC%9A">https://www.khronos.org/opengl/wiki/Layout_Qualifier_(GLSL)ï¼‰ï¼š</a></p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">dvec3</span> inPosition;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">2</span>) <span class="keyword">in</span> <span class="type">vec3</span> inColor;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸€-é¡¶ç‚¹æ•°æ®"><a href="#ä¸€-é¡¶ç‚¹æ•°æ®" class="headerlink" title="ä¸€. é¡¶ç‚¹æ•°æ®"></a>ä¸€. é¡¶ç‚¹æ•°æ®</h1><p>å°†é¡¶ç‚¹æ•°æ®ä»ç€è‰²å™¨ä»£ç ç§»åŠ¨åˆ°ç¨‹åºä»£ç ä¸­çš„æ•°ç»„ä¸­ã€‚éœ€è¦å¼•å…¥GLMåº“ï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä¸çº¿æ€§ä»£æ•°ç›¸å…³çš„ç±»å‹ï¼Œå¦‚å‘é‡å’ŒçŸ©é˜µ, æœ‰ä¸ç€è‰²å™¨è¯­è¨€ä¸­ä½¿ç”¨çš„å‘é‡ç±»å‹å®Œå…¨åŒ¹é…çš„c++ç±»å‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›ç±»å‹æ¥æŒ‡å®šä½ç½®å’Œé¢œè‰²å‘é‡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Vertex</span> &#123;</span><br><span class="line">    glm::vec2 pos;</span><br><span class="line">    glm::vec3 color;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> std::vector&lt;Vertex&gt; vertices = &#123;</span><br><span class="line">    &#123;&#123;<span class="number">0.0f</span>, <span class="number">-0.5f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">-0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸€ä¸ªåä¸ºVertexçš„æ–°ç»“æ„ï¼Œå†…æœ‰ä¸¤ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å°†åœ¨å…¶å†…éƒ¨çš„é¡¶ç‚¹ç€è‰²å™¨ä¸­ä½¿ç”¨. ä½¿ç”¨é¡¶ç‚¹ç»“æ„æ¥æŒ‡å®šé¡¶ç‚¹æ•°æ®çš„æ•°ç»„ã€‚æˆ‘ä»¬ä½¿ç”¨å’Œä¹‹å‰å®Œå…¨ç›¸åŒçš„ä½ç½®å’Œé¢œè‰²å€¼ï¼Œä½†ç°åœ¨å®ƒä»¬è¢«ç»„åˆåˆ°ä¸€ä¸ªé¡¶ç‚¹æ•°ç»„ä¸­, è¿™å°±æ˜¯æ‰€è°“çš„äº¤é”™é¡¶ç‚¹(interleaving vertex)å±æ€§ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯å‘Šè¯‰Vulkanï¼Œä¸€æ—¦æ•°æ®æ ¼å¼è¢«ä¸Šä¼ åˆ°GPUå†…å­˜ï¼Œå¦‚ä½•å°†å…¶ä¼ é€’åˆ°é¡¶ç‚¹ç€è‰²å™¨ã€‚è€Œä¼ è¾¾è¿™ä¸ªä¿¡æ¯éœ€è¦æœ‰ä¸¤ç§ç±»å‹çš„ç»“æ„: VkVertexInputBindingDescriptionå’ŒVkVertexInputAttributeDescription.</p>
<h2 id="1-1-ç»‘å®šæè¿°"><a href="#1-1-ç»‘å®šæè¿°" class="headerlink" title="1.1 ç»‘å®šæè¿°"></a>1.1 ç»‘å®šæè¿°</h2><p>ç¬¬ä¸€ä¸ªç»“æ„æ˜¯VkVertexInputBindingDescriptionï¼Œæˆ‘ä»¬å°†å‘é¡¶ç‚¹ç»“æ„æ·»åŠ ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œç”¨æ­£ç¡®çš„æ•°æ®å¡«å……å®ƒã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Vertex</span> &#123;</span><br><span class="line">    glm::vec2 pos;</span><br><span class="line">    glm::vec3 color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> VkVertexInputBindingDescription <span class="title">getBindingDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        VkVertexInputBindingDescription bindingDescription = &#123;&#125;;</span><br><span class="line">        <span class="keyword">return</span> bindingDescription;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="1-1-1-VkVertexInputBindingDescription"><a href="#1-1-1-VkVertexInputBindingDescription" class="headerlink" title="1.1.1 VkVertexInputBindingDescription"></a>1.1.1 VkVertexInputBindingDescription</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkVertexInputBindingDescription</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span>             binding;</span><br><span class="line">    <span class="type">uint32_t</span>             stride;</span><br><span class="line">    VkVertexInputRate    inputRate;</span><br><span class="line">&#125; VkVertexInputBindingDescription;</span><br></pre></td></tr></table></figure>
<ol>
<li>binding: è¯¥ç»“æ„æè¿°çš„ç»‘å®šå·</li>
<li>stride : æ˜¯ç¼“å†²åŒºä¸­ä¸¤ä¸ªè¿ç»­å…ƒç´ ä¹‹é—´çš„è·ç¦»(ä»¥å­—èŠ‚ä¸ºå•ä½)</li>
<li>inputRate: æ˜¯ä¸€ä¸ªVkVertexInputRateå€¼ï¼ŒæŒ‡å®šé¡¶ç‚¹å±æ€§å¯»å€æ˜¯é¡¶ç‚¹ç´¢å¼•è¿˜æ˜¯å®ä¾‹ç´¢å¼•çš„å‡½æ•°<ol>
<li>VK_VERTEX_INPUT_RATE_VERTEX: æŒ‡å®šé¡¶ç‚¹å±æ€§å¯»å€æ˜¯é¡¶ç‚¹ç´¢å¼•çš„å‡½æ•°ï¼Œå³ç§»åŠ¨åˆ°æ¯ä¸ªé¡¶ç‚¹åçš„ä¸‹ä¸€ä¸ªæ•°æ®é¡¹</li>
<li>VK_VERTEX_INPUT_RATE_INSTANCE: æŒ‡å®šé¡¶ç‚¹å±æ€§å¯»å€æ˜¯å®ä¾‹ç´¢å¼•çš„å‡½æ•°ï¼Œå³ç§»åˆ°æ¯ä¸ªå®ä¾‹ä¹‹åçš„ä¸‹ä¸€ä¸ªæ•°æ®é¡¹</li>
</ol>
</li>
</ol>
<p>é¡¶ç‚¹ç»‘å®šæè¿°åœ¨æ‰€æœ‰é¡¶ç‚¹ä¸­ä»å†…å­˜åŠ è½½æ•°æ®çš„é€Ÿç‡ã€‚å®ƒæŒ‡å®šæ•°æ®æ¡ç›®ä¹‹é—´çš„å­—èŠ‚æ•°ï¼Œä»¥åŠæ˜¯åœ¨æ¯ä¸ªé¡¶ç‚¹ä¹‹åè¿˜æ˜¯åœ¨æ¯ä¸ªå®ä¾‹ä¹‹åç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°æ®æ¡ç›®ã€‚</p>
<h3 id="1-1-2-ç»‘å®š"><a href="#1-1-2-ç»‘å®š" class="headerlink" title="1.1.2 ç»‘å®š"></a>1.1.2 ç»‘å®š</h3><p>æ‰€æœ‰çš„é¡¶ç‚¹æ•°æ®éƒ½æ‰“åŒ…åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç»‘å®š:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> VkVertexInputBindingDescription <span class="title">getBindingDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkVertexInputBindingDescription bindingDescription = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    VkVertexInputBindingDescription bindingDescription = &#123;&#125;;</span><br><span class="line">    bindingDescription.binding = <span class="number">0</span>;</span><br><span class="line">    bindingDescription.stride = <span class="built_in">sizeof</span>(Vertex);</span><br><span class="line">    bindingDescription.inputRate = VK_VERTEX_INPUT_RATE_VERTEX;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bindingDescription;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-å±æ€§æè¿°"><a href="#1-2-å±æ€§æè¿°" class="headerlink" title="1.2 å±æ€§æè¿°"></a>1.2 å±æ€§æè¿°</h2><p>ç¬¬äºŒä¸ªæè¿°å¦‚ä½•å¤„ç†é¡¶ç‚¹è¾“å…¥çš„ç»“æ„æ˜¯VkVertexInputAttributeDescriptionã€‚æˆ‘ä»¬å°†æ·»åŠ å¦ä¸€ä¸ªè¾…åŠ©å‡½æ•°åˆ°é¡¶ç‚¹æ¥å¡«å……è¿™äº›ç»“æ„ä½“ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;array&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Vertex</span> &#123;</span><br><span class="line">    glm::vec2 pos;</span><br><span class="line">    glm::vec3 color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> VkVertexInputBindingDescription <span class="title">getBindingDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        VkVertexInputBindingDescription bindingDescription = &#123;&#125;;</span><br><span class="line">        <span class="keyword">return</span> bindingDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> std::array&lt;VkVertexInputAttributeDescription, 2&gt; <span class="title">getAttributeDescriptions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::array&lt;VkVertexInputAttributeDescription, 2&gt; attributeDescriptions = &#123;&#125;;</span><br><span class="line">        <span class="keyword">return</span> attributeDescriptions;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ­£å¦‚å‡½æ•°åŸå‹æ‰€è¡¨æ˜çš„ï¼Œæœ‰ä¸¤ä¸ªVkVertexInputAttributeDescription,åˆ†åˆ«ä»£è¡¨ä½ç½®å’Œé¢œè‰²ã€‚</p>
<p>å±æ€§æè¿°ç»“æ„æè¿°å¦‚ä½•ä»æºè‡ªç»‘å®šæè¿°çš„é¡¶ç‚¹æ•°æ®å—ä¸­æå–é¡¶ç‚¹å±æ€§ã€‚</p>
<h3 id="1-2-1-VkVertexInputAttributeDescription"><a href="#1-2-1-VkVertexInputAttributeDescription" class="headerlink" title="1.2.1 VkVertexInputAttributeDescription"></a>1.2.1 VkVertexInputAttributeDescription</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkVertexInputAttributeDescription</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span>    location;</span><br><span class="line">    <span class="type">uint32_t</span>    binding;</span><br><span class="line">    VkFormat    format;</span><br><span class="line">    <span class="type">uint32_t</span>    offset;</span><br><span class="line">&#125; VkVertexInputAttributeDescription;</span><br></pre></td></tr></table></figure>
<ol>
<li>location: å±æ€§çš„ç€è‰²å™¨ç»‘å®šä½ç½®å·</li>
<li>binding: è¯¥å±æ€§è·å–å…¶æ•°æ®çš„ç»‘å®šå·</li>
<li>format: æŒ‡é¡¶ç‚¹å±æ€§æ•°æ®çš„å¤§å°å’Œç±»å‹, åº”ä½¿ç”¨é¢œè‰²é€šé“æ•°é‡ä¸ç€è‰²å™¨æ•°æ®ç±»å‹ä¸­çš„ç»„ä»¶æ•°é‡ç›¸åŒ¹é…çš„æ ¼å¼<ol>
<li>float: VK_FORMAT_R32_SFLOAT</li>
<li>vec2: VK_FORMAT_R32G32_SFLOAT</li>
<li>vec3: VK_FORMAT_R32G32B32_SFLOAT</li>
<li>vec4: VK_FORMAT_R32G32B32A32_SFLOAT</li>
</ol>
</li>
<li>offset: è¯¥å±æ€§ç›¸å¯¹äºé¡¶ç‚¹è¾“å…¥ç»‘å®šä¸­å…ƒç´ å¼€å§‹çš„å­—èŠ‚åç§»é‡</li>
</ol>
<h3 id="1-2-2-ç»‘å®š"><a href="#1-2-2-ç»‘å®š" class="headerlink" title="1.2.2 ç»‘å®š"></a>1.2.2 ç»‘å®š</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> std::array&lt;VkVertexInputAttributeDescription, 2&gt; <span class="title">getAttributeDescriptions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::array&lt;VkVertexInputAttributeDescription, 2&gt; attributeDescriptions = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// position</span></span><br><span class="line">    attributeDescriptions[<span class="number">0</span>].binding = <span class="number">0</span>;</span><br><span class="line">    attributeDescriptions[<span class="number">0</span>].location = <span class="number">0</span>;</span><br><span class="line">    attributeDescriptions[<span class="number">0</span>].format = VK_FORMAT_R32G32_SFLOAT;</span><br><span class="line">    attributeDescriptions[<span class="number">0</span>].offset = <span class="built_in">offsetof</span>(Vertex, pos);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// color</span></span><br><span class="line">    attributeDescriptions[<span class="number">1</span>].binding = <span class="number">0</span>;</span><br><span class="line">    attributeDescriptions[<span class="number">1</span>].location = <span class="number">1</span>;</span><br><span class="line">    attributeDescriptions[<span class="number">1</span>].format = VK_FORMAT_R32G32B32_SFLOAT;</span><br><span class="line">    attributeDescriptions[<span class="number">1</span>].offset = <span class="built_in">offsetof</span>(Vertex, color);</span><br><span class="line">    <span class="keyword">return</span> attributeDescriptions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œoffsetofå‡½æ•°æ˜¯ç”¨æ¥è·å–åç§»é‡çš„ã€‚</p>
<h2 id="1-3-ç®¡é“è¾“å…¥é¡¶ç‚¹"><a href="#1-3-ç®¡é“è¾“å…¥é¡¶ç‚¹" class="headerlink" title="1.3 ç®¡é“è¾“å…¥é¡¶ç‚¹"></a>1.3 ç®¡é“è¾“å…¥é¡¶ç‚¹</h2><p>ç°åœ¨éœ€è¦é€šè¿‡å¼•ç”¨createGraphicsPipelineä¸­çš„ç»“æ„æ¥è®¾ç½®å›¾å½¢ç®¡é“ä»¥æ¥å—è¿™ç§æ ¼å¼çš„é¡¶ç‚¹æ•°æ®ã€‚æ‰¾åˆ°vertexInputInfoç»“æ„ä½“å¹¶ä¿®æ”¹å®ƒä»¥å¼•ç”¨ä»¥ä¸‹ä¸¤ç§æè¿°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> bindingDescription = Vertex::<span class="built_in">getBindingDescription</span>();</span><br><span class="line"><span class="keyword">auto</span> attributeDescriptions = Vertex::<span class="built_in">getAttributeDescriptions</span>();</span><br><span class="line">vertexInputInfo.vertexBindingDescriptionCount = <span class="number">1</span>;</span><br><span class="line">vertexInputInfo.vertexAttributeDescriptionCount =</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(attributeDescriptions.<span class="built_in">size</span>());</span><br><span class="line">vertexInputInfo.pVertexBindingDescriptions = &amp;bindingDescription;</span><br><span class="line">vertexInputInfo.pVertexAttributeDescriptions = attributeDescriptions.<span class="built_in">data</span>();</span><br></pre></td></tr></table></figure>
<p>ç®¡é“ç°åœ¨å·²ç»å‡†å¤‡å¥½æ¥å—é¡¶ç‚¹å®¹å™¨æ ¼å¼çš„é¡¶ç‚¹æ•°æ®ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨ã€‚</p>
<p>å¦‚æœåœ¨å¯ç”¨éªŒè¯å±‚çš„æƒ…å†µä¸‹è¿è¡Œç¨‹åºï¼Œå°†æŠ¥å‡ºæ²¡æœ‰é¡¶ç‚¹ç¼“å†²åŒºç»‘å®šåˆ°ç»‘å®šã€‚ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹ç¼“å†²åŒºï¼Œå¹¶å°†é¡¶ç‚¹æ•°æ®ç§»åŠ¨åˆ°å…¶ä¸­ï¼Œä»¥ä¾¿GPUèƒ½å¤Ÿè®¿é—®å®ƒã€‚</p>
<h1 id="äºŒ-é¡¶ç‚¹ç¼“å†²åŒº"><a href="#äºŒ-é¡¶ç‚¹ç¼“å†²åŒº" class="headerlink" title="äºŒ. é¡¶ç‚¹ç¼“å†²åŒº"></a>äºŒ. é¡¶ç‚¹ç¼“å†²åŒº</h1><p>Vulkanä¸­çš„ç¼“å†²åŒºæ˜¯ç”¨äºå­˜å‚¨ä»»æ„æ•°æ®çš„å†…å­˜åŒºåŸŸï¼Œè¿™äº›æ•°æ®å¯ä»¥è¢«æ˜¾å¡è¯»å–ï¼Œé€šè¿‡æè¿°ç¬¦é›†æˆ–ç‰¹å®šå‘½ä»¤å°†å®ƒä»¬ç»‘å®šåˆ°å›¾å½¢æˆ–è®¡ç®—ç®¡é“ï¼Œæˆ–è€…ç›´æ¥å°†å®ƒä»¬æŒ‡å®šä¸ºç‰¹å®šå‘½ä»¤çš„å‚æ•°ã€‚å®ƒä»¬å¯ä»¥ç”¨æ¥å­˜å‚¨é¡¶ç‚¹æ•°æ®ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨äºè®¸å¤šå…¶ä»–ç›®çš„ï¼Œä»¥åä¸­æ¢è®¨ã€‚</p>
<p>ä¸æˆ‘ä»¬ç›®å‰å¤„ç†çš„Vulkanå¯¹è±¡ä¸åŒï¼Œç¼“å†²åŒºä¸ä¼šè‡ªåŠ¨ä¸ºè‡ªå·±åˆ†é…å†…å­˜ï¼Œ Vulkan APIè®©ç¨‹åºå‘˜æ§åˆ¶äº†å‡ ä¹æ‰€æœ‰çš„äº‹æƒ…ï¼Œå†…å­˜ç®¡ç†å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚</p>
<h2 id="2-1-åˆ›å»ºç¼“å†²åŒº"><a href="#2-1-åˆ›å»ºç¼“å†²åŒº" class="headerlink" title="2.1 åˆ›å»ºç¼“å†²åŒº"></a>2.1 åˆ›å»ºç¼“å†²åŒº</h2><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°createVertexBufferï¼Œå¹¶åœ¨createCommandBuffersä¹‹å‰ä»initVulkanè°ƒç”¨å®ƒï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createCommandPool</span>();</span><br><span class="line">    <span class="comment">// æœ‰å¯èƒ½ä½¿ç”¨æŒ‡ä»¤ï¼Œæ‰€ä»¥éœ€è¦åœ¨æŒ‡ä»¤æ± åˆ›å»ºä¹‹ååˆ›å»º</span></span><br><span class="line">    <span class="built_in">createVertexBuffer</span>();</span><br><span class="line">    <span class="built_in">createCommandBuffers</span>();</span><br><span class="line">    <span class="built_in">createSyncObjects</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createVertexBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºé¡¶ç‚¹ç¼“å†²åŒºéœ€è¦å¡«å……VkBufferCreateInfoç»“æ„ã€‚</p>
<h3 id="2-1-1-VkBufferCreateInfo"><a href="#2-1-1-VkBufferCreateInfo" class="headerlink" title="2.1.1 VkBufferCreateInfo"></a>2.1.1 VkBufferCreateInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkBufferCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType        sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*            pNext;</span><br><span class="line">    VkBufferCreateFlags    flags;</span><br><span class="line">    VkDeviceSize           size;</span><br><span class="line">    VkBufferUsageFlags     usage;</span><br><span class="line">    VkSharingMode          sharingMode;</span><br><span class="line">    <span class="type">uint32_t</span>               queueFamilyIndexCount;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span>*        pQueueFamilyIndices;</span><br><span class="line">&#125; VkBufferCreateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: ç»“æ„ä½“ç±»å‹, VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>flags: VkBufferCreateFlagBitsçš„ä½æ©ç ï¼ŒæŒ‡å®šç¼“å†²åŒºçš„é™„åŠ å‚æ•°, ç”¨äºé…ç½®ç¨€ç–ç¼“å†²åŒºå†…å­˜</li>
<li>size:  æ˜¯è¦åˆ›å»ºçš„ç¼“å†²åŒºçš„å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)</li>
<li>usage: VkBufferUsageFlagBitsçš„ä½æ©ç ï¼ŒæŒ‡å®šç¼“å†²åŒºå…è®¸çš„ç”¨æ³•</li>
<li>sharingMode: VkSharingModeå€¼ï¼ŒæŒ‡å®šå½“å¤šä¸ªé˜Ÿåˆ—æ—è®¿é—®ç¼“å†²åŒºæ—¶ï¼Œç¼“å†²åŒºçš„å…±äº«æ¨¡å¼<ol>
<li>VK_SHARING_MODE_EXCLUSIVE:  æŒ‡å®šå¯¹å¯¹è±¡çš„ä»»ä½•èŒƒå›´æˆ–å›¾åƒå­èµ„æºçš„è®¿é—®ä¸€æ¬¡åªèƒ½ç”±å•ä¸ªé˜Ÿåˆ—æ—ç‹¬å </li>
<li>VK_SHARING_MODE_CONCURRENT: æŒ‡å®šæ”¯æŒå¯¹æ¥è‡ªå¤šä¸ªé˜Ÿåˆ—æ—çš„å¯¹è±¡çš„ä»»ä½•èŒƒå›´æˆ–æ˜ åƒå­èµ„æºçš„å¹¶å‘è®¿é—®</li>
</ol>
</li>
<li>queueFamilyIndexCount: æ˜¯pQueueFamilyIndicesæ•°ç»„ä¸­çš„æ•°é‡</li>
<li>pQueueFamilyIndices: å°†è®¿é—®è¿™ä¸ªç¼“å†²åŒºçš„é˜Ÿåˆ—æ—åˆ—è¡¨(å¦‚æœshareingmodeä¸æ˜¯VK_SHARING_MODE_CONCURRENTåˆ™å¿½ç•¥)</li>
</ol>
<h3 id="2-1-2-vkCreateBuffer"><a href="#2-1-2-vkCreateBuffer" class="headerlink" title="2.1.2 vkCreateBuffer"></a>2.1.2 vkCreateBuffer</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateBuffer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkBufferCreateInfo*                   pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer*                                   pBuffer)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: åˆ›å»ºç¼“å†²åŒºå¯¹è±¡çš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfo: æŒ‡å‘VkBufferCreateInfoç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„åŒ…å«å½±å“ç¼“å†²åŒºåˆ›å»ºçš„å‚æ•°</li>
<li>pAllocator: æ§åˆ¶ä¸»æœºå†…å­˜åˆ†é…</li>
<li>pBuffer: æŒ‡å‘VkBufferå¥æŸ„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥å¥æŸ„ä¸­è¿”å›ç»“æœç¼“å†²åŒºå¯¹è±¡</li>
</ol>
<p>VkBufferç¼“å†²åŒºè¡¨ç¤ºç”¨äºå„ç§ç›®çš„çš„æ•°æ®çš„çº¿æ€§æ•°ç»„ï¼Œé€šè¿‡æè¿°ç¬¦é›†æˆ–ç‰¹å®šå‘½ä»¤å°†å®ƒä»¬ç»‘å®šåˆ°å›¾å½¢æˆ–è®¡ç®—ç®¡é“ï¼Œæˆ–è€…ç›´æ¥å°†å®ƒä»¬æŒ‡å®šä¸ºç‰¹å®šå‘½ä»¤çš„å‚æ•°ã€‚</p>
<p>ç¼“å†²åŒºç”±VkBufferå¥æŸ„è¡¨ç¤ºï¼š</p>
<h3 id="2-1-3-createVertexBuffer"><a href="#2-1-3-createVertexBuffer" class="headerlink" title="2.1.3 createVertexBuffer"></a>2.1.3 createVertexBuffer</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkBuffer vertexBuffer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createVertexBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkBufferCreateInfo bufferInfo = &#123;&#125;;</span><br><span class="line">    bufferInfo.sType = VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO;</span><br><span class="line">    bufferInfo.size = <span class="built_in">sizeof</span>(vertices[<span class="number">0</span>]) * vertices.<span class="built_in">size</span>();</span><br><span class="line">    bufferInfo.usage = VK_BUFFER_USAGE_VERTEX_BUFFER_BIT;</span><br><span class="line">    bufferInfo.sharingMode = VK_SHARING_MODE_EXCLUSIVE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateBuffer</span>(device, &amp;bufferInfo, <span class="literal">nullptr</span>, &amp;vertexBuffer) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create vertex buffer!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºåä¸éœ€è¦æ—¶åº”è¯¥æ‰‹åŠ¨é”€æ¯:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkDestroyBuffer</span>(device, vertexBuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-ç»™é¡¶ç‚¹ç¼“å†²åŒºåˆ†é…å†…å­˜"><a href="#2-2-ç»™é¡¶ç‚¹ç¼“å†²åŒºåˆ†é…å†…å­˜" class="headerlink" title="2.2 ç»™é¡¶ç‚¹ç¼“å†²åŒºåˆ†é…å†…å­˜"></a>2.2 ç»™é¡¶ç‚¹ç¼“å†²åŒºåˆ†é…å†…å­˜</h2><p>ç¼“å†²åŒºå·²åˆ›å»ºï¼Œä½†å®é™…ä¸Šå°šæœªåˆ†é…ä»»ä½•å†…å­˜ã€‚ä¸ºç¼“å†²åŒºåˆ†é…å†…å­˜çš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨vkGetBufferMemoryRequirementså‡½æ•°æŸ¥è¯¢å…¶å†…å­˜éœ€æ±‚.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkMemoryRequirements memRequirements;</span><br><span class="line"><span class="built_in">vkGetBufferMemoryRequirements</span>(device, vertexBuffer, &amp;memRequirements);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-1-vkGetBufferMemoryRequirements"><a href="#2-2-1-vkGetBufferMemoryRequirements" class="headerlink" title="2.2.1 vkGetBufferMemoryRequirements"></a>2.2.1 vkGetBufferMemoryRequirements</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkGetBufferMemoryRequirements</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkMemoryRequirements*                       pMemoryRequirements)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: åˆ›å»ºç¼“å†²åŒºå¯¹è±¡çš„é€»è¾‘è®¾å¤‡</li>
<li>buffer: å¾…è¯·æ±‚æ‰€éœ€å†…å­˜å¤§å°çš„ç¼“å†²åŒº</li>
<li>pMemoryRequirements: æŒ‡å‘VkMemoryRequirementsç»“æ„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥ç»“æ„ä¸­è¿”å›ç¼“å†²åŒºå¯¹è±¡çš„å†…å­˜éœ€æ±‚</li>
</ol>
<h3 id="2-2-2-VkMemoryRequirements"><a href="#2-2-2-VkMemoryRequirements" class="headerlink" title="2.2.2 VkMemoryRequirements"></a>2.2.2 VkMemoryRequirements</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkMemoryRequirements</span> &#123;</span><br><span class="line">    VkDeviceSize    size;</span><br><span class="line">    VkDeviceSize    alignment;</span><br><span class="line">    <span class="type">uint32_t</span>        memoryTypeBits;</span><br><span class="line">&#125; VkMemoryRequirements;</span><br></pre></td></tr></table></figure>
<ol>
<li>size: èµ„æºæ‰€éœ€çš„å†…å­˜åˆ†é…çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰</li>
<li>alignment: èµ„æºæ‰€éœ€çš„åˆ†é…å†…åç§»é‡çš„å¯¹é½ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰,å³ç¼“å†²åŒºåœ¨åˆ†é…çš„å†…å­˜åŒºåŸŸä¸­å¼€å§‹çš„åç§»é‡</li>
<li>memoryTypeBits: é€‚åˆç¼“å†²åŒºçš„å†…å­˜ç±»å‹çš„ä½å­—æ®µ</li>
</ol>
<h3 id="2-2-3-findMemoryType"><a href="#2-2-3-findMemoryType" class="headerlink" title="2.2.3 findMemoryType"></a>2.2.3 findMemoryType</h3><p>å›¾å½¢æ˜¾å¡å¯ä»¥æä¾›ä¸åŒç±»å‹çš„å†…å­˜è¿›è¡Œåˆ†é…ã€‚æ¯ç§ç±»å‹çš„å†…å­˜åœ¨å…è®¸çš„æ“ä½œå’Œæ€§èƒ½ç‰¹æ€§æ–¹é¢éƒ½æœ‰æ‰€ä¸åŒã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ç»“åˆç¼“å†²åŒºçš„éœ€æ±‚å’Œæˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ç¨‹åºéœ€æ±‚æ¥æ‰¾åˆ°åˆé€‚çš„å†…å­˜ç±»å‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°findMemoryType:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">uint32_t</span> <span class="title">findMemoryType</span><span class="params">(<span class="type">uint32_t</span> typeFilter, VkMemoryPropertyFlags properties)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆè·å–ç‰©ç†æ˜¾å¡æ”¯æŒçš„å†…å­˜ç±»å‹</span></span><br><span class="line">    VkPhysicalDeviceMemoryProperties memProperties;</span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceMemoryProperties</span>(physicalDevice, &amp;memProperties);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; memProperties.memoryTypeCount; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (typeFilter &amp; (<span class="number">1</span> &lt;&lt; i) &amp;&amp;</span><br><span class="line">                <span class="comment">// å¯èƒ½æœ‰å¤šä¸ªå±æ€§</span></span><br><span class="line">                (memProperties.memoryTypes[i].propertyFlags &amp; properties) == properties) &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to find suitable memory type!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>typeFilterå‚æ•°ç”¨äºæŒ‡å®šé€‚åˆçš„å†…å­˜ç±»å‹çš„ä½å­—æ®µã€‚</p>
<h4 id="2-2-3-1-VkPhysicalDeviceMemoryProperties"><a href="#2-2-3-1-VkPhysicalDeviceMemoryProperties" class="headerlink" title="2.2.3.1 VkPhysicalDeviceMemoryProperties"></a>2.2.3.1 VkPhysicalDeviceMemoryProperties</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkPhysicalDeviceMemoryProperties</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span>        memoryTypeCount;</span><br><span class="line">    VkMemoryType    memoryTypes[VK_MAX_MEMORY_TYPES];</span><br><span class="line">    <span class="type">uint32_t</span>        memoryHeapCount;</span><br><span class="line">    VkMemoryHeap    memoryHeaps[VK_MAX_MEMORY_HEAPS];</span><br><span class="line">&#125; VkPhysicalDeviceMemoryProperties;</span><br></pre></td></tr></table></figure>
<ol>
<li>memoryTypeCount: memoryTypesæ•°ç»„ä¸­çš„æœ‰æ•ˆå…ƒç´ æ•°ã€‚</li>
<li>memoryTypes: VK_MAX_MEMORY_TYPES_Vk MemoryTypeç»“æ„æ•°ç»„ï¼Œæè¿°å¯ç”¨äºè®¿é—®ä»memoryHeapsæŒ‡å®šçš„å †ä¸­åˆ†é…çš„å†…å­˜çš„å†…å­˜ç±»å‹ã€‚</li>
<li>memoryHeapCount: memoryHeapsæ•°ç»„ä¸­çš„æœ‰æ•ˆå…ƒç´ æ•°ã€‚</li>
<li>memoryHeaps: VK_MAX_MEMORY_HEAPS VkMemoryHeapç»“æ„çš„æ•°ç»„ï¼Œæè¿°å¯ä»¥ä»ä¸­åˆ†é…å†…å­˜çš„å†…å­˜å †ã€‚</li>
</ol>
<p>VkPhysicalDeviceMemoryPropertiesç»“æ„æè¿°äº†è®¸å¤šå†…å­˜å †ä»¥åŠä¸€äº›å†…å­˜ç±»å‹ï¼Œè¿™äº›å†…å­˜ç±»å‹å¯ç”¨äºè®¿é—®è¿™äº›å †ä¸­åˆ†é…çš„å†…å­˜ã€‚æ¯ä¸ªå †æè¿°ç‰¹å®šå¤§å°çš„å†…å­˜èµ„æºï¼Œæ¯ä¸ªå†…å­˜ç±»å‹æè¿°ä¸€ç»„å†…å­˜å±æ€§ï¼ˆä¾‹å¦‚ï¼Œä¸»æœºç¼“å­˜ä¸æœªç¼“å­˜ï¼‰ï¼Œè¿™äº›å±æ€§å¯ä»¥ä¸ç»™å®šå†…å­˜å †ä¸€èµ·ä½¿ç”¨ã€‚ä½¿ç”¨ç‰¹å®šå†…å­˜ç±»å‹çš„åˆ†é…å°†æ¶ˆè€—è¯¥å†…å­˜ç±»å‹çš„å †ç´¢å¼•æŒ‡ç¤ºçš„å †ä¸­çš„èµ„æºã€‚å¤šä¸ªå†…å­˜ç±»å‹å¯ä»¥å…±äº«æ¯ä¸ªå †ï¼Œå †å’Œå†…å­˜ç±»å‹æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä»¥å®£å‘Šç‰©ç†å†…å­˜èµ„æºçš„ç²¾ç¡®å¤§å°ï¼ŒåŒæ—¶å…è®¸å°†å†…å­˜ä¸å„ç§ä¸åŒçš„å±æ€§ä¸€èµ·ä½¿ç”¨ã€‚</p>
<h3 id="2-2-4-åˆ†é…å†…å­˜"><a href="#2-2-4-åˆ†é…å†…å­˜" class="headerlink" title="2.2.4 åˆ†é…å†…å­˜"></a>2.2.4 åˆ†é…å†…å­˜</h3><p>é€šè¿‡findMemoryType, ç°åœ¨å¯ä»¥è·å–æ­£ç¡®çš„å†…å­˜ç±»å‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç»™VkBufferåˆ†é…å†…å­˜äº†ã€‚</p>
<p>ä¸åŒç±»å‹çš„å†…å­˜å…·æœ‰ä¸åŒçš„å±æ€§ã€‚ä¸€äº›ç±»å‹çš„å†…å­˜å¯ä»¥è¢«CPUè®¿é—®ï¼Œä¸€äº›ä¸å¯ä»¥ã€‚ä¸€äº›ç±»å‹å¯ä»¥åœ¨GPUå’ŒCPUé—´ä¿æŒæ•°æ®ä¸€è‡´æ€§ã€ä¸€äº›ç±»å‹å¯ä»¥è¢«CPUç¼“å­˜ä½¿ç”¨ç­‰ç­‰ã€‚å¯ä»¥é€šè¿‡æŸ¥è¯¢ç‰©ç†è®¾å¤‡è·å–è¿™äº›ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ä¸åŒçš„å†…å­˜ç±»å‹ï¼Œæ¯”å¦‚å¯¹äºæš‚å­˜èµ„æºï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¯ä»¥è¢«CPUè®¿é—®çš„å†…å­˜ç±»å‹ã€‚å¯¹äºç”¨äºæ¸²æŸ“çš„å›¾åƒã€é¡¶ç‚¹æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸ä¸ºå…¶åˆ†é…GPUå†…å­˜ã€‚</p>
<p>å†…å­˜åˆ†é…ç°åœ¨åªéœ€æŒ‡å®šå¤§å°å’Œç±»å‹å°±å¯ä»¥äº†ï¼Œè¿™ä¸¤ç§ç±»å‹éƒ½æ¥è‡ªäºé¡¶ç‚¹ç¼“å†²åŒºçš„å†…å­˜éœ€æ±‚å’Œæ‰€éœ€çš„å±æ€§ã€‚åˆ›å»ºä¸€ä¸ªç±»æˆå‘˜æ¥å°†å¥æŸ„å­˜å‚¨åˆ°å†…å­˜ä¸­ï¼Œå¹¶ç”¨vkallocatemoryåˆ†é…å®ƒã€‚</p>
<h4 id="2-2-4-1-VkMemoryAllocateInfo"><a href="#2-2-4-1-VkMemoryAllocateInfo" class="headerlink" title="2.2.4.1 VkMemoryAllocateInfo"></a>2.2.4.1 VkMemoryAllocateInfo</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkMemoryAllocateInfo</span> &#123;</span><br><span class="line">    VkStructureType    sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*        pNext;</span><br><span class="line">    VkDeviceSize       allocationSize;</span><br><span class="line">    <span class="type">uint32_t</span>           memoryTypeIndex;</span><br><span class="line">&#125; VkMemoryAllocateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: ç»“æ„ä½“ç±»å‹, VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>allocationSize: å†…å­˜åˆ†é…å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½</li>
<li>memoryTypeIndex: å†…å­˜ç±»å‹çš„ç´¢å¼•ï¼ŒVkPhysicalDeviceMemoryPropertiesç»“æ„çš„memoryTypesæ•°ç»„ä¸­çš„æ•°æ®</li>
</ol>
<h4 id="2-2-4-2-å†…å­˜åˆ†é…"><a href="#2-2-4-2-å†…å­˜åˆ†é…" class="headerlink" title="2.2.4.2 å†…å­˜åˆ†é…"></a>2.2.4.2 å†…å­˜åˆ†é…</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createVertexBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    VkMemoryAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.allocationSize = memRequirements.size;</span><br><span class="line">    allocInfo.memoryTypeIndex = <span class="built_in">findMemoryType</span>(memRequirements.memoryTypeBits,</span><br><span class="line">                VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT | VK_MEMORY_PROPERTY_HOST_COHERENT_BIT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkAllocateMemory</span>(device, &amp;allocInfo, <span class="literal">nullptr</span>, &amp;vertexBufferMemory) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to allocate vertex buffer memory!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å†…å­˜å¯¹è±¡å¯¹è®¾å¤‡å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œå¯ä»¥ä½¿ç”¨vkAllocateMemoryå‡½æ•°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkAllocateMemory</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkMemoryAllocateInfo*                 pAllocateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceMemory*                             pMemory)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: æ˜¯æ‹¥æœ‰å†…å­˜çš„é€»è¾‘è®¾å¤‡</li>
<li>pAllocateInfo: æŒ‡å‘æè¿°åˆ†é…å‚æ•°çš„VkMemoryAllocateInfoç»“æ„çš„æŒ‡é’ˆã€‚æˆåŠŸè¿”å›çš„åˆ†é…å¿…é¡»ä½¿ç”¨è¯·æ±‚çš„å‚æ•°â€‰-â€‰å®ç°ä¸å…è®¸æ›¿æ¢ã€‚</li>
<li>pAllocator: æ§åˆ¶å†…å­˜åˆ†é…</li>
<li>pMemory: æŒ‡å‘VkDeviceMemoryå¥æŸ„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥å¥æŸ„ä¸­è¿”å›æœ‰å…³å·²åˆ†é…å†…å­˜çš„ä¿¡æ¯</li>
</ol>
<p>vkallocatemoryè¿”å›çš„åˆ†é…ä¿è¯æ»¡è¶³å®ç°çš„ä»»ä½•å¯¹é½è¦æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå®ç°éœ€è¦128å­—èŠ‚çš„å›¾åƒå¯¹é½å’Œ64å­—èŠ‚çš„ç¼“å†²åŒºå¯¹é½ï¼Œé‚£ä¹ˆé€šè¿‡è¿™ä¸ªæœºåˆ¶è¿”å›çš„è®¾å¤‡å†…å­˜å°†æ˜¯128å­—èŠ‚å¯¹é½çš„ã€‚è¿™ç¡®ä¿äº†åº”ç”¨ç¨‹åºå¯ä»¥åœ¨åŒä¸€å†…å­˜å¯¹è±¡ä¸­æ­£ç¡®åœ°å­åˆ†é…ä¸åŒç±»å‹çš„å¯¹è±¡ï¼ˆå…·æœ‰å¯èƒ½ä¸åŒçš„å¯¹é½è¦æ±‚ï¼‰ã€‚</p>
<h4 id="2-2-4-3-å†…å­˜ä¸ç¼“å†²åŒºå…³è”"><a href="#2-2-4-3-å†…å­˜ä¸ç¼“å†²åŒºå…³è”" class="headerlink" title="2.2.4.3 å†…å­˜ä¸ç¼“å†²åŒºå…³è”"></a>2.2.4.3 å†…å­˜ä¸ç¼“å†²åŒºå…³è”</h4><p>å¦‚æœå†…å­˜åˆ†é…æˆåŠŸï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨vkBindBufferMemoryå°†æ­¤å†…å­˜ä¸ç¼“å†²åŒºå…³è”ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vkBindBufferMemory</span>(device, vertexBuffer, vertexBufferMemory, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>è¦å°†å†…å­˜é™„åŠ åˆ°ç¼“å†²åŒºå¯¹è±¡å¯ä»¥è°ƒç”¨vkBindBufferMemoryå‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkBindBufferMemory</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceMemory                              memory,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                memoryOffset)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: æ˜¯æ‹¥æœ‰å†…å­˜çš„é€»è¾‘è®¾å¤‡</li>
<li>buffer: è¦é™„åŠ åˆ°å†…å­˜çš„ç¼“å†²åŒº</li>
<li>memory: æè¿°è¦é™„åŠ çš„è®¾å¤‡å†…å­˜çš„VkDeviceMemoryå¯¹è±¡</li>
<li>memoryOffset: è¦ç»‘å®šåˆ°ç¼“å†²åŒºçš„å†…å­˜åŒºåŸŸçš„èµ·å§‹åç§»é‡ã€‚å› ä¸ºè¿™ä¸ªå†…å­˜è¢«ä¸“é—¨åˆ†é…ç»™è¿™ä¸ªé¡¶ç‚¹ç¼“å†²åŒºï¼Œæ‰€ä»¥åç§»é‡æ˜¯0ã€‚å¦‚æœåç§»é‡ä¸ä¸ºé›¶ï¼Œåˆ™è¦æ±‚å®ƒå¯ä»¥è¢«æ•´é™¤å†…å­˜memRequirements.alignment.</li>
</ol>
<p>ä¸€æ—¦ç¼“å†²åŒºä¸å†ä½¿ç”¨ï¼Œç»‘å®šåˆ°ç¼“å†²åŒºå¯¹è±¡çš„å†…å­˜å¯èƒ½ä¼šè¢«é‡Šæ”¾ï¼Œå› æ­¤è®©æˆ‘ä»¬åœ¨ç¼“å†²åŒºè¢«é”€æ¯åé‡Šæ”¾å®ƒï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨ vulkan ä¸­æ¨èåœ¨åˆ›å»ºçš„èµ„æºä¸éœ€è¦åä¸»åŠ¨é‡Šæ”¾</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¸…ç†äº¤æ¢é“¾å…³è”èµ„æº</span></span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line">    <span class="comment">// æ¸…ç†é¡¶ç‚¹ç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">vkDestroyBuffer</span>(device, vertexBuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, vertexBufferMemory, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-3-å¡«å……é¡¶ç‚¹ç¼“å†²åŒº"><a href="#2-3-å¡«å……é¡¶ç‚¹ç¼“å†²åŒº" class="headerlink" title="2.3 å¡«å……é¡¶ç‚¹ç¼“å†²åŒº"></a>2.3 å¡«å……é¡¶ç‚¹ç¼“å†²åŒº</h2><p>ç°åœ¨æ˜¯æ—¶å€™å°†é¡¶ç‚¹æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒºäº†ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨vkMapMemoryå°†ç¼“å†²å†…å­˜æ˜ å°„åˆ°CPUå¯è®¿é—®å†…å­˜æ¥å®ç°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkMapMemory</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceMemory                              memory,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                size,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkMemoryMapFlags                            flags,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">void</span>**                                      ppData)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: æ‹¥æœ‰å†…å­˜çš„é€»è¾‘è®¾å¤‡</li>
<li>memory: è¦æ˜ å°„çš„VkDeviceMemoryå¯¹è±¡</li>
<li>offset: ä»å†…å­˜å¯¹è±¡å¼€å§‹çš„ä»¥é›¶ä¸ºåŸºç¡€çš„å­—èŠ‚åç§»é‡</li>
<li>size:  æ˜ å°„çš„å†…å­˜èŒƒå›´çš„å¤§å°ï¼Œæˆ–è€…æ˜¯è¦ä»åç§»é‡æ˜ å°„åˆ°åˆ†é…æœ«å°¾çš„VK_WHOLE_SIZEå¤§å°</li>
<li>flags: ä¿ç•™ä¾›å°†æ¥ä½¿ç”¨</li>
<li>ppData: æŒ‡å‘void*å˜é‡çš„æŒ‡é’ˆï¼ŒæŒ‡å‘æ˜ å°„å†…å­˜çš„æŒ‡é’ˆçš„è¾“å‡ºã€‚åœ¨è¯¥å˜é‡ä¸­è¿”å›æŒ‡å‘æ˜ å°„èŒƒå›´å¼€å¤´çš„ä¸»æœºå¯è®¿é—®æŒ‡é’ˆã€‚æ­¤æŒ‡é’ˆå‡å»åç§»é‡å¿…é¡»è‡³å°‘ä¸VkPhysicalDeviceLimits:ï¼šminMemoryMapAlignmentå¯¹é½</li>
</ol>
<p>æ­¤å‡½æ•°å…è®¸æˆ‘ä»¬è®¿é—®ç”±åç§»é‡å’Œå¤§å°å®šä¹‰çš„æŒ‡å®šå†…å­˜èµ„æºåŒºåŸŸ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span>* data;</span><br><span class="line"><span class="comment">// å°†ç¼“å†²å†…å­˜æ˜ å°„åˆ°CPUå¯è®¿é—®å†…å­˜</span></span><br><span class="line"><span class="built_in">vkMapMemory</span>(device, vertexBufferMemory, <span class="number">0</span>, bufferInfo.size, <span class="number">0</span>, &amp;data);</span><br><span class="line"><span class="comment">// å°†é¡¶ç‚¹æ•°æ®æ‹·è´åˆ°æ˜ å°„å†…å­˜ä¸­</span></span><br><span class="line"><span class="built_in">memcpy</span>(data, vertices.<span class="built_in">data</span>(), (<span class="type">size_t</span>) bufferInfo.size);</span><br><span class="line"><span class="comment">// ä½¿ç”¨vkUnmapMemoryå†æ¬¡å–æ¶ˆæ˜ å°„</span></span><br><span class="line"><span class="built_in">vkUnmapMemory</span>(device, vertexBufferMemory);</span><br></pre></td></tr></table></figure>

<p>å¡«å……é¡¶ç‚¹æ•°æ®åˆ°ç¼“å†²åŒºå†…å­˜çš„æ–¹å¼å°±æ˜¯å…ˆæ˜ å°„ç„¶åæ‹·è´ï¼Œæœ€åè§£æ˜ å°„ã€‚</p>
<p>ä½†æ˜¯é©±åŠ¨ç¨‹åºå¯èƒ½ä¸ä¼šç«‹å³å°†æ•°æ®å¤åˆ¶åˆ°ç¼“å†²åŒºå†…å­˜ä¸­ï¼Œä¾‹å¦‚å› ä¸ºç¼“å­˜(Cache)æœºåˆ¶ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ç¼“å­˜çš„å†…å­˜ç±»å‹ä½¿ç”¨ä¸»æœºç›¸å…³çš„å†…å­˜å †ï¼Œç”¨VK_MEMORY_PROPERTY_HOST_COHERENT_BITè¡¨ç¤º</li>
<li>åœ¨å†™å…¥æ˜ å°„å†…å­˜åè°ƒç”¨vkFlushMappedMemoryRangesä»¥åŠåœ¨ä»æ˜ å°„å†…å­˜è¯»å–ä¹‹å‰è°ƒç”¨vkInvalidateMappedMemoryRanges</li>
</ol>
<p>å¯¹äºCPUå¯ä»¥è®¿é—®çš„å†…å­˜ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨vkMapMemory&#x2F;vkUnmapMemoryå‡½æ•°å¯¹å…¶è¿›è¡Œæ˜ å°„ã€‚è¿™ä¸€æ˜ å°„æ˜¯æŒä¹…åŒ–çš„ï¼Œåªè¦è¿›è¡Œäº†æ­£ç¡®çš„åŒæ­¥ï¼Œå¯ä»¥åœ¨GPUä½¿ç”¨è¿™ä¸€å†…å­˜åŒºåŸŸæ—¶è®¿é—®å®ƒã€‚</p>
<p>vkMapMemoryå‡½æ•°è¿”å›çš„æŒ‡é’ˆå¯ä»¥è¢«ä¿å­˜ä½¿ç”¨ï¼Œåªè¦è¿›è¡Œäº†æ­£ç¡®çš„åŒæ­¥ï¼Œç”šè‡³å¯ä»¥åœ¨GPUä½¿ç”¨è¿™ä¸€å†…å­˜åŒºåŸŸæ—¶å¯¹å…¶è¿›è¡Œå†™å…¥æ“ä½œï¼ŒåŒæ­¥è§„åˆ™å¯ä»¥ä¿è¯CPUä¸ä¼šå†™å…¥æ•°æ®åˆ°GPUæ­£åœ¨ä½¿ç”¨çš„é‚£éƒ¨åˆ†å†…å­˜ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ä¸ªæ–¹å¼å®ç°ï¼Œç¡®ä¿æ˜ å°„å†…å­˜å§‹ç»ˆä¸åˆ†é…å†…å­˜çš„å†…å®¹åŒ¹é…ã€‚</p>
<p>åˆ·æ–°å†…å­˜èŒƒå›´æˆ–ä½¿ç”¨ä¸€è‡´çš„å†…å­˜å †æ„å‘³ç€é©±åŠ¨ç¨‹åºå°†çŸ¥é“æˆ‘ä»¬å¯¹ç¼“å†²åŒºçš„å†™å…¥ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬åœ¨GPUä¸Šå®é™…ä¸Šæ˜¯å¯è§çš„ã€‚å°†æ•°æ®ä¼ è¾“åˆ°GPUæ˜¯ä¸€ä¸ªåœ¨åå°å‘ç”Ÿçš„æ“ä½œï¼Œè§„èŒƒç®€å•åœ°å‘Šè¯‰æˆ‘ä»¬ï¼Œå®ƒä¿è¯åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨vkQueueSubmitæ—¶å®Œæˆã€‚</p>
<h2 id="2-4-ç»‘å®šé¡¶ç‚¹ç¼“å†²åŒº"><a href="#2-4-ç»‘å®šé¡¶ç‚¹ç¼“å†²åŒº" class="headerlink" title="2.4 ç»‘å®šé¡¶ç‚¹ç¼“å†²åŒº"></a>2.4 ç»‘å®šé¡¶ç‚¹ç¼“å†²åŒº</h2><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†é¡¶ç‚¹ç¼“å†²åŒºï¼Œä¹Ÿåˆ†é…äº†å†…å­˜å¹¶å¡«å……äº†é¡¶ç‚¹æ•°æ®ï¼Œå°±å‰©ä¸‹åœ¨æ¸²æŸ“æ“ä½œæœŸé—´ç»‘å®šé¡¶ç‚¹ç¼“å†²åŒºã€‚</p>
<p>é€šè¿‡æ‰©å±•createCommandBufferså‡½æ•°æ¥å®ç°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vkCmdBindPipeline</span>(commandBuffers[i], VK_PIPELINE_BIND_POINT_GRAPHICS, graphicsPipeline);</span><br><span class="line"></span><br><span class="line">VkBuffer vertexBuffers[] = &#123;vertexBuffer&#125;;</span><br><span class="line">VkDeviceSize offsets[] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">vkCmdBindVertexBuffers</span>(commandBuffers[i], <span class="number">0</span>, <span class="number">1</span>, vertexBuffers, offsets);</span><br><span class="line"><span class="built_in">vkCmdDraw</span>(commandBuffers[i], <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(vertices.<span class="built_in">size</span>()), <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">vkCmdEndRenderPass</span>(commandBuffers[i]);</span><br></pre></td></tr></table></figure>

<p>å°†é¡¶ç‚¹ç¼“å†²åŒºç»‘å®šåˆ°å‘½ä»¤ç¼“å†²åŒºï¼Œä»¥ä¾¿åœ¨åç»­ç»˜åˆ¶å‘½ä»¤ä¸­ä½¿ç”¨ï¼Œéœ€è¦ä½¿ç”¨vkCmdBindVertexBuffers:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdBindVertexBuffers</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstBinding,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    bindingCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkBuffer*                             pBuffers,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkDeviceSize*                         pOffsets)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBuffer: è®°å½•å‘½ä»¤çš„å‘½ä»¤ç¼“å†²åŒºã€‚</li>
<li>firstBinding: ç¬¬ä¸€ä¸ªé¡¶ç‚¹è¾“å…¥ç»‘å®šçš„ç´¢å¼•ï¼Œå…¶çŠ¶æ€ç”±å‘½ä»¤æ›´æ–°ã€‚</li>
<li>bindingCount: çŠ¶æ€ç”±å‘½ä»¤æ›´æ–°çš„é¡¶ç‚¹è¾“å…¥ç»‘å®šæ•°</li>
<li>pBuffers: æŒ‡å‘ç¼“å†²åŒºå¥æŸ„æ•°ç»„çš„æŒ‡é’ˆã€‚</li>
<li>pOffsets: æŒ‡å‘ç¼“å†²åŒºåç§»é‡æ•°ç»„çš„æŒ‡é’ˆã€‚</li>
</ol>
<p>ä»pBufferså’Œpoffsetçš„å…ƒç´ iè·å–çš„å€¼æ›¿æ¢äº†é¡¶ç‚¹è¾“å…¥ç»‘å®šfirstBinding+içš„å½“å‰çŠ¶æ€ï¼Œå³[0ï¼ŒbindingCount]ä¸­çš„iã€‚é¡¶ç‚¹è¾“å…¥ç»‘å®šå°†æ›´æ–°ä¸ºä»ç¼“å†²åŒºpBuffers[i]å¼€å§‹çš„ç”±pOffsets[i]æŒ‡ç¤ºçš„åç§»å¤„å¼€å§‹ã€‚æ‰€æœ‰ä½¿ç”¨è¿™äº›ç»‘å®šçš„é¡¶ç‚¹è¾“å…¥å±æ€§éƒ½å°†åœ¨åç»­ç»˜åˆ¶å‘½ä»¤çš„åœ°å€è®¡ç®—ä¸­ä½¿ç”¨è¿™äº›æ›´æ–°çš„åœ°å€ã€‚</p>
<h1 id="ä¸‰-æ ¹æ®é¼ æ ‡ç§»åŠ¨å˜åŒ–é¢œè‰²"><a href="#ä¸‰-æ ¹æ®é¼ æ ‡ç§»åŠ¨å˜åŒ–é¢œè‰²" class="headerlink" title="ä¸‰. æ ¹æ®é¼ æ ‡ç§»åŠ¨å˜åŒ–é¢œè‰²"></a>ä¸‰. æ ¹æ®é¼ æ ‡ç§»åŠ¨å˜åŒ–é¢œè‰²</h1><p>ç°åœ¨æˆ‘ä»¬å®Œæˆäº†ä»ç¡¬ç¼–ç çš„é¡¶ç‚¹è¾“å…¥è½¬ä¸ºç¨‹åºå†…çš„é¡¶ç‚¹æ•°æ®è¾“å…¥ï¼Œ æ›´æ”¹verticeså°±å¯ä»¥çœ‹åˆ°é¢œè‰²æœ‰å˜åŒ–ï¼Œæ¯”å¦‚:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹æ•°æ®</span></span><br><span class="line"><span class="type">const</span> std::vector&lt;Vertex&gt; vertices = &#123;</span><br><span class="line">    &#123;&#123;<span class="number">0.0f</span>, <span class="number">-0.5f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">-0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„å›¾å½¢å°±æ˜¯: </p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-11-%E9%A1%B6%E7%82%B9%E8%BE%93%E5%85%A5%E6%8F%8F%E8%BF%B0%E5%8F%8A%E9%A1%B6%E7%82%B9%E7%BC%93%E5%86%B2%E7%9A%84%E5%88%9B%E5%BB%BA/Vulkan_11_1.png" alt="å›¾å½¢"></p>
<p>ç°åœ¨æˆ‘ä»¬åŠ¨æ‰‹åšæ ¹æ®é¼ æ ‡ç§»åŠ¨åŠ¨æ€å˜åŒ–é¢œè‰²:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// å¤„ç†äº‹ä»¶</span></span><br><span class="line">    <span class="built_in">initGlfwInput</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initGlfwInput</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ³¨å†Œé¼ æ ‡ä½ç½®ç›‘å¬</span></span><br><span class="line">    <span class="built_in">glfwSetCursorPosCallback</span>(window, cursor_position_callback);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">cursor_position_callback</span><span class="params">(GLFWwindow* window, <span class="type">double</span> xpos, <span class="type">double</span> ypos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> app = <span class="built_in">reinterpret_cast</span>&lt;HelloTriangleApplication*&gt;(<span class="built_in">glfwGetWindowUserPointer</span>(window));</span><br><span class="line">    <span class="keyword">if</span> (app-&gt;widthOfWindow != <span class="number">0</span> &amp;&amp; app-&gt;heightOfWindow != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">float</span> xP = xpos/app-&gt;widthOfWindow;</span><br><span class="line">        <span class="type">float</span> yP = ypos/app-&gt;heightOfWindow;</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> x = xP * <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">        <span class="type">float</span> y = yP * <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">        app-&gt;vertices = &#123;</span><br><span class="line">            &#123;&#123;x, y&#125;, &#123;xP, xP, xP&#125;&#125;,</span><br><span class="line">            &#123;&#123;<span class="number">0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;yP, yP, yP&#125;&#125;,</span><br><span class="line">            &#123;&#123;<span class="number">-0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// é¡¶ç‚¹æ•°æ®å˜åŒ–åï¼Œé‡æ–°æ‹·è´è‡³å†…å­˜ä¸­</span></span><br><span class="line">        app-&gt;<span class="built_in">reMemcpyVertexBuffer</span>(<span class="built_in">sizeof</span>(app-&gt;vertices[<span class="number">0</span>]) * app-&gt;vertices.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reMemcpyVertexBuffer</span><span class="params">(VkDeviceSize size)</span> </span>&#123;</span><br><span class="line">    <span class="type">void</span>* data;</span><br><span class="line">    <span class="built_in">vkMapMemory</span>(device, vertexBufferMemory, <span class="number">0</span>, size, <span class="number">0</span>, &amp;data);</span><br><span class="line">    <span class="built_in">memcpy</span>(data, vertices.<span class="built_in">data</span>(), (<span class="type">size_t</span>) size);</span><br><span class="line">    <span class="built_in">vkUnmapMemory</span>(device, vertexBufferMemory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åçš„ç»“æœ:<br><img src="/images/Vulkan%E5%85%A5%E9%97%A8-11-%E9%A1%B6%E7%82%B9%E8%BE%93%E5%85%A5%E6%8F%8F%E8%BF%B0%E5%8F%8A%E9%A1%B6%E7%82%B9%E7%BC%93%E5%86%B2%E7%9A%84%E5%88%9B%E5%BB%BA/Vulkan_11_2.png" alt="å›¾ç‰‡"></p>
<p>å“ˆå“ˆï¼Œæœ‰é‚£ä¹ˆå›äº‹äº†ï¼Œç¬¬ä¸€ä¸ªé¡¶ç‚¹ä¼šè·Ÿéšé¼ æ ‡ç§»åŠ¨è€Œç§»åŠ¨ï¼Œå¹¶ä¸”ä¸‰è§’å½¢ä¹Ÿä¼šå˜å¹»é¢œè‰², ä¸è¿‡è¿™é‡Œåªæ˜¯ç®€å•çš„å¤„ç†ï¼Œç”šè‡³æ²¡æœ‰è€ƒè™‘åŒæ­¥é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(12)-æš‚å­˜ç¼“å†²å’Œç´¢å¼•ç¼“å†²</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-12-%E6%9A%82%E5%AD%98%E7%BC%93%E5%86%B2%E5%92%8C%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>è™½ç„¶ç°åœ¨æˆ‘ä»¬åˆ›å»ºçš„é¡¶ç‚¹ç¼“å†²åŒºå·¥ä½œæ­£å¸¸ï¼Œä½†æ˜¯ä»CPUè®¿é—®å®ƒçš„å†…å­˜ç±»å‹å¯èƒ½ä¸æ˜¯å›¾å½¢æ˜¾å¡æœ¬èº«è¯»å–çš„æœ€ä½³å†…å­˜ç±»å‹ï¼Œæœ€ç†æƒ³çš„å†…å­˜å…·æœ‰VK_MEMORY_PROPERTY_DEVICE_LOCAL_BITä½æ ‡å¿—ï¼Œå¹¶ä¸”é€šå¸¸ä¸å¯ç”±ä¸“ç”¨å›¾å½¢æ˜¾å¡ä¸Šçš„CPUè®¿é—®ã€‚è€Œä¸”æˆ‘ä»¬ä¸Šä¸€ç¯‡æœ€åå®ç°çš„éšé¼ æ ‡ç§»åŠ¨çš„åŠŸèƒ½ä¹Ÿæ²¡æœ‰è€ƒè™‘åŒæ­¥ï¼Œç®€å•ä¸€ç‚¹ï¼Œè€ƒè™‘è¯»å†™åˆ†ç¦»ã€‚</p>
<p>ç°åœ¨åˆ›å»ºä¸¤ä¸ªé¡¶ç‚¹ç¼“å†²åŒºï¼šCPUå¯è®¿é—®å†…å­˜ä¸­çš„ä¸€ä¸ªæš‚å­˜ç¼“å†²åŒºç”¨äºä»é¡¶ç‚¹æ•°ç»„ä¸Šä¼ æ•°æ®ï¼Œæœ€ç»ˆé¡¶ç‚¹ç¼“å†²åŒºä½äºè®¾å¤‡æœ¬åœ°å†…å­˜ä¸­ã€‚ç„¶åæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç¼“å†²åŒºå¤åˆ¶å‘½ä»¤å°†æ•°æ®ä»æš‚å­˜ç¼“å†²åŒºç§»åŠ¨åˆ°å®é™…çš„é¡¶ç‚¹ç¼“å†²åŒºã€‚ç®€å•æ¥è¯´å°±æ˜¯æš‚å­˜ç¼“å†²åŒºç”¨äºcpuå†™å…¥ï¼Œé¡¶ç‚¹ç¼“å†²åŒºç”¨äºGPUè¯»å–æ•°æ®ã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li>Vulkan coordinate system <a href="http://vulkano.rs/guide/vertex-input">http://vulkano.rs/guide/vertex-input</a></li>
</ol>
<h1 id="ä¸€-ä¼ è¾“é˜Ÿåˆ—"><a href="#ä¸€-ä¼ è¾“é˜Ÿåˆ—" class="headerlink" title="ä¸€. ä¼ è¾“é˜Ÿåˆ—"></a>ä¸€. ä¼ è¾“é˜Ÿåˆ—</h1><p>buffer copyå‘½ä»¤éœ€è¦æ”¯æŒä¼ è¾“æ“ä½œçš„é˜Ÿåˆ—æ—ï¼Œä½¿ç”¨VK_QUEUE_TRANSFER_BITè¡¨ç¤ºã€‚ä¸è¿‡ä»»ä½•å…·æœ‰VK_QUEUE_GRAPHICS_BITæˆ–VK_QUEUE_COMPUTE_BITåŠŸèƒ½çš„é˜Ÿåˆ—å®¶æ—éƒ½å·²ç»éšå¼æ”¯æŒVK_QUEUE_TRANSFER_BITæ“ä½œã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä¸éœ€è¦å®ç°åœ¨queueFlagsä¸­æ˜¾å¼åœ°åˆ—å‡ºå®ƒã€‚</p>
<p>ä½†å¯ä»¥å°è¯•ä½¿ç”¨ä¸“é—¨ç”¨äºä¼ è¾“æ“ä½œçš„ä¸åŒé˜Ÿåˆ—æ—ï¼Œ å¯ä»¥å¦‚ä¸‹æ“ä½œ:</p>
<ol>
<li>ä¿®æ”¹QueueFamilyIndiceså’ŒfindQueueFamiliesæ¥æ˜¾å¼åœ°æŸ¥æ‰¾å…·æœ‰VK_QUEUE_TRANSFERä½çš„é˜Ÿåˆ—æ—ï¼Œè€Œä¸æ˜¯VK_QUEUE_GRAPHICS_BITä½</li>
<li>ä¿®æ”¹createLogicalDeviceä»¥è¯·æ±‚ä¼ è¾“é˜Ÿåˆ—çš„å¥æŸ„</li>
<li>ä¸ºä¼ è¾“é˜Ÿåˆ—ç³»åˆ—ä¸Šæäº¤çš„å‘½ä»¤ç¼“å†²åŒºåˆ›å»ºç¬¬äºŒä¸ªå‘½ä»¤æ± </li>
<li>ä¿®æ”¹èµ„æºçš„å…±äº«æ¨¡å¼ä¸ºVK_SHARING_MODE_CONCURRENTï¼Œå¹¶æŒ‡å®šå›¾å½¢å’Œä¼ è¾“é˜Ÿåˆ—æ—</li>
<li>æäº¤ä¼ è¾“å‘½ä»¤ï¼Œå¦‚vkCmdCopyBufferåˆ°ä¼ è¾“é˜Ÿåˆ—ï¼Œè€Œä¸æ˜¯å›¾å½¢é˜Ÿåˆ—</li>
</ol>
<h1 id="äºŒ-æš‚å­˜ç¼“å†²åŒº"><a href="#äºŒ-æš‚å­˜ç¼“å†²åŒº" class="headerlink" title="äºŒ. æš‚å­˜ç¼“å†²åŒº"></a>äºŒ. æš‚å­˜ç¼“å†²åŒº</h1><p>å› ä¸ºæˆ‘ä»¬è¦åˆ›å»ºå¤šä¸ªVkBufferï¼Œæ‰€ä»¥æœ€å¥½æŠŠå…±æœ‰çš„éƒ¨åˆ†æŠ½å‡ºï¼Œä»¥é¿å…ä»£ç ç´¯èµ˜:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼ å…¥å¿…è¦å‚æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createBuffer</span><span class="params">(VkDeviceSize size, VkBufferUsageFlags usage,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkMemoryPropertyFlags properties, VkBuffer&amp; buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDeviceMemory&amp; bufferMemory, VkSharingMode mode)</span> </span>&#123;</span><br><span class="line">    VkBufferCreateInfo bufferInfo = &#123;&#125;;</span><br><span class="line">    bufferInfo.sType = VK_STRUCTURE_TYPE_BUFFER_CREATE_INFO;</span><br><span class="line">    bufferInfo.size = size;</span><br><span class="line">    bufferInfo.usage = usage;</span><br><span class="line">    bufferInfo.sharingMode = mode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateBuffer</span>(device, &amp;bufferInfo, <span class="literal">nullptr</span>, &amp;buffer) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create vertex buffer!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    VkMemoryRequirements memRequirements;</span><br><span class="line">    <span class="built_in">vkGetBufferMemoryRequirements</span>(device, buffer, &amp;memRequirements);</span><br><span class="line"></span><br><span class="line">    VkMemoryAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.allocationSize = memRequirements.size;</span><br><span class="line">    allocInfo.memoryTypeIndex = <span class="built_in">findMemoryType</span>(memRequirements.memoryTypeBits, properties);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkAllocateMemory</span>(device, &amp;allocInfo, <span class="literal">nullptr</span>, &amp;bufferMemory) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to allocate vertex buffer memory!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">vkBindBufferMemory</span>(device, buffer, bufferMemory, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createVertexBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDeviceSize bufferSize = <span class="built_in">sizeof</span>(vertices[<span class="number">0</span>]) * vertices.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    VkBuffer stagingBuffer;</span><br><span class="line">    VkDeviceMemory stagingBufferMemory;</span><br><span class="line">    <span class="built_in">createBuffer</span>(bufferSize, VK_BUFFER_USAGE_TRANSFER_SRC_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT |</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_COHERENT_BIT, stagingBuffer,</span><br><span class="line">            <span class="comment">// èµ„æºåªèƒ½ç”±å•ä¸ªé˜Ÿåˆ—æ—ç‹¬å </span></span><br><span class="line">            stagingBufferMemory, VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line">    <span class="type">void</span>* data;</span><br><span class="line">    <span class="built_in">vkMapMemory</span>(device, stagingBufferMemory, <span class="number">0</span>, bufferSize, <span class="number">0</span>, &amp;data);</span><br><span class="line">    <span class="built_in">memcpy</span>(data, vertices.<span class="built_in">data</span>(), (<span class="type">size_t</span>) bufferSize);</span><br><span class="line">    <span class="built_in">vkUnmapMemory</span>(device, stagingBufferMemory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œçš„MEMORY_PROPERTYæ˜¯VK_MEMORY_PROPERTY_DEVICE_LOCAL_BITï¼</span></span><br><span class="line">    <span class="built_in">createBuffer</span>(bufferSize, VK_BUFFER_USAGE_TRANSFER_DST_BIT |</span><br><span class="line">            VK_BUFFER_USAGE_VERTEX_BUFFER_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT, vertexBuffer,</span><br><span class="line">            <span class="comment">// èµ„æºåªèƒ½ç”±å•ä¸ªé˜Ÿåˆ—æ—ç‹¬å </span></span><br><span class="line">            vertexBufferMemory, VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¼ è¾“é˜Ÿåˆ—ï¼Œæ‰€ä»¥æ³¨æ„stagingBufferçš„usageæ˜¯ç”¨çš„VK_BUFFER_USAGE_TRANSFER_SRC_BITï¼Œè€ŒvertexBufferç°åœ¨ç”¨çš„æ˜¯VK_BUFFER_USAGE_TRANSFER_DST_BITï¼</p>
<p>vertexBufferç°åœ¨ä»è®¾å¤‡æœ¬åœ°çš„å†…å­˜ç±»å‹åˆ†é…ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨vkMapMemoryã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®ä»stagingBufferå¤åˆ¶åˆ°vertexBufferã€‚æˆ‘ä»¬å¿…é¡»é€šè¿‡æŒ‡å®šstagingBufferçš„ä¼ è¾“æºæ ‡å¿—å’ŒvertexBufferçš„ä¼ è¾“ç›®æ ‡æ ‡å¿—ä»¥åŠé¡¶ç‚¹ç¼“å†²åŒºä½¿ç”¨æ ‡å¿—æ¥è¡¨æ˜æˆ‘ä»¬æ‰“ç®—è¿™æ ·åšã€‚</p>
<h2 id="2-1-VkBufferUsageFlagBits"><a href="#2-1-VkBufferUsageFlagBits" class="headerlink" title="2.1 VkBufferUsageFlagBits"></a>2.1 VkBufferUsageFlagBits</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkBufferUsageFlagBits</span> &#123;</span><br><span class="line">    VK_BUFFER_USAGE_TRANSFER_SRC_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_BUFFER_USAGE_TRANSFER_DST_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_BUFFER_USAGE_UNIFORM_TEXEL_BUFFER_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_BUFFER_USAGE_STORAGE_TEXEL_BUFFER_BIT = <span class="number">0x00000008</span>,</span><br><span class="line">    VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT = <span class="number">0x00000010</span>,</span><br><span class="line">    VK_BUFFER_USAGE_STORAGE_BUFFER_BIT = <span class="number">0x00000020</span>,</span><br><span class="line">    VK_BUFFER_USAGE_INDEX_BUFFER_BIT = <span class="number">0x00000040</span>,</span><br><span class="line">    VK_BUFFER_USAGE_VERTEX_BUFFER_BIT = <span class="number">0x00000080</span>,</span><br><span class="line">    VK_BUFFER_USAGE_INDIRECT_BUFFER_BIT = <span class="number">0x00000100</span>,</span><br><span class="line">    VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT = <span class="number">0x00020000</span>,</span><br><span class="line">    VK_BUFFER_USAGE_TRANSFORM_FEEDBACK_BUFFER_BIT_EXT = <span class="number">0x00000800</span>,</span><br><span class="line">    VK_BUFFER_USAGE_TRANSFORM_FEEDBACK_COUNTER_BUFFER_BIT_EXT = <span class="number">0x00001000</span>,</span><br><span class="line">    VK_BUFFER_USAGE_CONDITIONAL_RENDERING_BIT_EXT = <span class="number">0x00000200</span>,</span><br><span class="line">    VK_BUFFER_USAGE_RAY_TRACING_BIT_NV = <span class="number">0x00000400</span>,</span><br><span class="line">    VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT_EXT = VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT,</span><br><span class="line">    VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT_KHR = VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BIT,</span><br><span class="line">    VK_BUFFER_USAGE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkBufferUsageFlagBits;</span><br></pre></td></tr></table></figure>
<p>VkBufferUsageFlagBitsè®¾ç½®çš„ä½å¯ä»¥æŒ‡å®šç¼“å†²åŒºçš„ä½¿ç”¨è¡Œä¸ºï¼š</p>
<ol>
<li>VK_BUFFER_USAGE_TRANSFER_SRC_BITæŒ‡å®šç¼“å†²åŒºå¯ä»¥ç”¨ä½œä¼ è¾“å‘½ä»¤çš„æº(è¯·å‚é˜…VK_PIPELINE_STAGE_TRANSFER_BITçš„å®šä¹‰)ã€‚</li>
<li>VK_BUFFER_USAGE_TRANSFER_DST_BITæŒ‡å®šç¼“å†²åŒºå¯ä»¥ç”¨ä½œä¼ è¾“å‘½ä»¤çš„ç›®çš„åœ°ã€‚</li>
<li>VK_BUFFER_USAGE_UNIFORM_TEXEL_BUFFER_BITç¼“å†²åŒºå¯ç”¨äºåˆ›å»ºä¸€ä¸ªVkBufferViewï¼Œè¯¥è§†å›¾é€‚åˆå ç”¨VK_DESCRIPTOR_TYPE_UNIFORM_TEXEL_BUFFERç±»å‹çš„VkDescriptorSetæ§½ä½ã€‚</li>
<li>VK_BUFFER_USAGE_STORAGE_TEXEL_BUFFER_BITæŒ‡å®šè¯¥ç¼“å†²åŒºå¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªVkBufferViewï¼Œè¯¥è§†å›¾é€‚åˆäºå ç”¨VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFERç±»å‹çš„VkDescriptorSetæ§½ä½ã€‚</li>
<li>VK_BUFFER_USAGE_UNIFORM_BUFFER_BITç¼“å†²åŒºå¯ä»¥ç”¨äºVkDescriptorBufferInfoä¸­ï¼Œè¯¥ç¼“å†²åŒºé€‚åˆäºå ç”¨VkDescriptorSetç±»å‹çš„VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER_DYNAMICæ§½ä½ã€‚</li>
<li>VK_BUFFER_USAGE_STORAGE_BUFFER_BITæŒ‡å®šè¯¥ç¼“å†²åŒºå¯ç”¨äºVkDescriptorBufferInfoä¸­ï¼Œè¯¥ç¼“å†²åŒºé€‚åˆäºå ç”¨VkDescriptorSetç±»å‹çš„VK_DESCRIPTOR_TYPE_STORAGE_BUFFER_DYNAMICæ§½ä½ã€‚</li>
<li>VK_BUFFER_USAGE_INDEX_BUFFER_BITæŒ‡å®šè¯¥ç¼“å†²åŒºé€‚åˆä½œä¸ºbufferå‚æ•°ä¼ é€’ç»™vkCmdBindIndexBufferã€‚</li>
<li>VK_BUFFER_USAGE_VERTEX_BUFFER_BITæŒ‡å®šç¼“å†²åŒºé€‚åˆä½œä¸ºpBuffersæ•°ç»„çš„å…ƒç´ ä¼ é€’ç»™vkCmdBindVertexBuffersã€‚</li>
<li>VK_BUFFER_USAGE_INDIRECT_BUFFER_BITç¼“å†²åŒºé€‚åˆä½œä¸ºbufferå‚æ•°ä¼ é€’ç»™vkCmdDrawIndirectã€vkCmdDrawIndexedIndirectã€vkCmdDrawMeshTasksIndirectNVã€vkCmdDrawMeshTasksIndirectCountNVæˆ–vkCmdDispatchIndirectã€‚å®ƒä¹Ÿé€‚åˆä½œä¸ºVkIndirectCommandsTokenNVXçš„ç¼“å†²åŒºæˆå‘˜ï¼Œæˆ–VkCmdProcessCommandsInfoNVXçš„sequencesCountBufferæˆ–sequencesIndexBufferæˆå‘˜ä¼ é€’</li>
<li>VK_BUFFER_USAGE_CONDITIONAL_RENDERING_BIT_EXTæŒ‡å®šç¼“å†²åŒºé€‚åˆä½œä¸ºbufferå‚æ•°ä¼ é€’ç»™vkCmdBeginConditionalRenderingEXTã€‚</li>
<li>VK_BUFFER_USAGE_TRANSFORM_FEEDBACK_BUFFER_BIT_EXTæŒ‡å®šè¯¥ç¼“å†²åŒºé€‚åˆä½¿ç”¨for bindingä½œä¸ºvkCmdBindTransformFeedbackBuffersEXTçš„è½¬æ¢åé¦ˆç¼“å†²åŒºã€‚</li>
<li>VK_BUFFER_USAGE_TRANSFORM_FEEDBACK_COUNTER_BUFFER_BIT_EXTæŒ‡å®šè¯¥ç¼“å†²åŒºé€‚åˆä¸vkCmdBeginTransformFeedbackEXTå’ŒvkCmdEndTransformFeedbackEXTä¸€èµ·ç”¨ä½œè®¡æ•°å™¨ç¼“å†²åŒºã€‚</li>
<li>VK_BUFFER_USAGE_RAY_TRACING_BIT_NVæŒ‡å®šç¼“å†²åŒºé€‚ç”¨äºvkCmdTraceRaysNVå’ŒvkCmdBuildAccelerationStructureNVã€‚</li>
<li>VK_BUFFER_USAGE_SHADER_DEVICE_ADDRESS_BITæŒ‡å®šç¼“å†²åŒºå¯ä»¥é€šè¿‡vkGetBufferDeviceAddressæ¥æ£€ç´¢ç¼“å†²åŒºè®¾å¤‡åœ°å€ï¼Œå¹¶ä½¿ç”¨è¯¥åœ°å€ä»ç€è‰²å™¨è®¿é—®ç¼“å†²åŒºçš„å†…å­˜ã€‚</li>
</ol>
<h2 id="2-2-VkMemoryPropertyFlags"><a href="#2-2-VkMemoryPropertyFlags" class="headerlink" title="2.2 VkMemoryPropertyFlags"></a>2.2 VkMemoryPropertyFlags</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkMemoryPropertyFlagBits</span> &#123;</span><br><span class="line">    VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_HOST_COHERENT_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_HOST_CACHED_BIT = <span class="number">0x00000008</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT = <span class="number">0x00000010</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_PROTECTED_BIT = <span class="number">0x00000020</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD = <span class="number">0x00000040</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_DEVICE_UNCACHED_BIT_AMD = <span class="number">0x00000080</span>,</span><br><span class="line">    VK_MEMORY_PROPERTY_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkMemoryPropertyFlagBits;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT: æŒ‡å®šä½¿ç”¨è¿™ç§ç±»å‹åˆ†é…çš„å†…å­˜å¯¹äºè®¾å¤‡è®¿é—®æ˜¯æœ€æœ‰æ•ˆçš„ã€‚å½“ä¸”ä»…å½“å†…å­˜ç±»å‹å±äºè®¾ç½®äº†VK_MEMORY_HEAP_DEVICE_LOCAL_BITçš„å †æ—¶ï¼Œæ‰ä¼šè®¾ç½®æ­¤å±æ€§ã€‚</li>
<li>VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT: æŒ‡å®šä½¿ç”¨è¿™ç§ç±»å‹åˆ†é…çš„å†…å­˜å¯ä»¥é€šè¿‡vkMapMemoryæ˜ å°„ç»™ä¸»æœºè®¿é—®ã€‚</li>
<li>VK_MEMORY_PROPERTY_HOST_COHERENT_BIT: æŒ‡å®šä¸»æœºç¼“å­˜ç®¡ç†å‘½ä»¤vkFlushMappedMemoryRangeså’ŒvkInvalidateMappedMemoryRangesåˆ†åˆ«ç”¨äºåˆ·æ–°ä¸»æœºå¯¹è®¾å¤‡çš„å†™æ“ä½œï¼Œæˆ–è€…ä½¿è®¾å¤‡çš„å†™æ“ä½œå¯¹ä¸»æœºå¯è§ã€‚</li>
<li>VK_MEMORY_PROPERTY_HOST_CACHED_BIT: æŒ‡å®šç”¨è¿™ç§ç±»å‹åˆ†é…çš„å†…å­˜ç¼“å­˜åœ¨ä¸»æœºä¸Šã€‚ä¸»æœºå†…å­˜å¯¹éç¼“å­˜å†…å­˜çš„è®¿é—®æ¯”å¯¹ç¼“å­˜å†…å­˜çš„è®¿é—®æ…¢ï¼Œä½†æ˜¯éç¼“å­˜å†…å­˜æ€»æ˜¯ä¸ä¸»æœºä¸€è‡´çš„ã€‚</li>
<li>VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BIT: æŒ‡å®šå†…å­˜ç±»å‹ä»…å…è®¸è®¾å¤‡è®¿é—®å†…å­˜ã€‚å†…å­˜ç±»å‹ä¸èƒ½åŒæ—¶è®¾ç½®VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BITå’ŒVK_MEMORY_PROPERTY_HOST_VISIBLE_BITã€‚å¦å¤–ï¼Œå¯¹è±¡çš„åå¤‡å†…å­˜å¯ä»¥ç”±åœ¨æƒ°æ€§åˆ†é…å†…å­˜ä¸­æŒ‡å®šçš„lazyå®ç°æä¾›ã€‚</li>
<li>VK_MEMORY_PROPERTY_PROTECTED_BIT: æŒ‡å®šå†…å­˜ç±»å‹ä»…å…è®¸è®¾å¤‡è®¿é—®å†…å­˜ï¼Œå¹¶å…è®¸å—ä¿æŠ¤çš„é˜Ÿåˆ—æ“ä½œè®¿é—®å†…å­˜ã€‚å†…å­˜ç±»å‹ä¸èƒ½è®¾ç½®VK_MEMORY_PROPERTY_PROTECTED_BITå’Œä»»ä½•VK_MEMORY_PROPERTY_HOST_VISIBLE_BITã€VK_MEMORY_PROPERTY_HOST_COHERENT_BITæˆ–VK_MEMORY_PROPERTY_HOST_CACHED_BITã€‚</li>
<li>VK_MEMORY_PROPERTY_DEVICE_COHERENT_BIT_AMD: æŒ‡å®šå¯¹è¿™ç§å†…å­˜ç±»å‹åˆ†é…çš„è®¾å¤‡è®¿é—®å°†è‡ªåŠ¨å˜ä¸ºå¯ç”¨å’Œå¯è§çš„ã€‚</li>
<li>VK_MEMORY_PROPERTY_DEVICE_UNCACHHED_BIT_AMD: æŒ‡å®šç”¨è¿™ç§ç±»å‹åˆ†é…çš„å†…å­˜ä¸ä¼šç¼“å­˜åˆ°è®¾å¤‡ä¸Šã€‚éç¼“å­˜è®¾å¤‡å†…å­˜æ€»æ˜¯è®¾å¤‡ä¸€è‡´çš„ã€‚</li>
</ol>
<h2 id="2-3-ç¼“å†²åŒºæ‹·è´å‡½æ•°"><a href="#2-3-ç¼“å†²åŒºæ‹·è´å‡½æ•°" class="headerlink" title="2.3 ç¼“å†²åŒºæ‹·è´å‡½æ•°"></a>2.3 ç¼“å†²åŒºæ‹·è´å‡½æ•°</h2><p>å†…å­˜ä¼ è¾“æ“ä½œä½¿ç”¨å‘½ä»¤ç¼“å†²åŒºæ‰§è¡Œï¼Œå°±åƒç»˜åˆ¶å‘½ä»¤ä¸€æ ·ã€‚å› æ­¤ï¼Œé¦–å…ˆåˆ†é…ä¸€ä¸ªä¸´æ—¶çš„å‘½ä»¤ç¼“å†²åŒºã€‚æ‚¨å¯èƒ½å¸Œæœ›ä¸ºè¿™äº›çŸ­æœŸç¼“å†²åŒºåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å‘½ä»¤æ± ï¼Œå› ä¸ºå®ç°å¯èƒ½èƒ½å¤Ÿåº”ç”¨å†…å­˜åˆ†é…ä¼˜åŒ–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥åœ¨ç”Ÿæˆå‘½ä»¤æ± æœŸé—´ä½¿ç”¨VK_COMMAND_POOL_CREATE_TRANSIENT_BITæ ‡å¿—ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">copyBuffer</span><span class="params">(VkBuffer srcBuffer, VkBuffer dstBuffer, VkDeviceSize size)</span> </span>&#123;</span><br><span class="line">    VkCommandBufferAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.level = VK_COMMAND_BUFFER_LEVEL_PRIMARY;</span><br><span class="line">    allocInfo.commandPool = commandPool;</span><br><span class="line">    allocInfo.commandBufferCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    VkCommandBuffer commandBuffer;</span><br><span class="line">    <span class="built_in">vkAllocateCommandBuffers</span>(device, &amp;allocInfo, &amp;commandBuffer);</span><br><span class="line">    <span class="comment">// å¼€å§‹è®°å½•æŒ‡ä»¤</span></span><br><span class="line">    VkCommandBufferBeginInfo beginInfo = &#123;&#125;;</span><br><span class="line">    beginInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO;</span><br><span class="line">    <span class="comment">// åªä½¿ç”¨ä¸€æ¬¡å‘½ä»¤ç¼“å†²åŒºï¼Œå¹¶ç­‰å¾…å‡½æ•°è¿”å›ï¼Œç›´åˆ°å¤åˆ¶æ“ä½œå®Œæˆæ‰§è¡Œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥ä½¿ç”¨VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BITæ ‡å¿—</span></span><br><span class="line">    beginInfo.flags = VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT;</span><br><span class="line">    <span class="built_in">vkBeginCommandBuffer</span>(commandBuffer, &amp;beginInfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¼“å†²æ‹·è´æŒ‡ä»¤</span></span><br><span class="line">    VkBufferCopy copyRegion = &#123;&#125;;</span><br><span class="line">    copyRegion.srcOffset = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    copyRegion.dstOffset = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    copyRegion.size = size;</span><br><span class="line">    <span class="comment">// ç¼“å†²åŒºçš„å†…å®¹ä½¿ç”¨vkCmdCopyBufferå‘½ä»¤ä¼ è¾“ã€‚</span></span><br><span class="line">    <span class="comment">// æºå’Œç›®æ ‡ç¼“å†²åŒºä»¥åŠè¦å¤åˆ¶çš„åŒºåŸŸæ•°ç»„ä½œä¸ºå‚æ•°ã€‚copyRegionç”±æºç¼“å†²åŒºåç§»é‡ã€ç›®æ ‡ç¼“å†²åŒºåç§»é‡å’Œå¤§å°ç»„æˆ</span></span><br><span class="line">    <span class="built_in">vkCmdCopyBuffer</span>(commandBuffer, srcBuffer, dstBuffer, <span class="number">1</span>, &amp;copyRegion);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkEndCommandBuffer</span>(commandBuffer);</span><br><span class="line">    VkSubmitInfo submitInfo = &#123;&#125;;</span><br><span class="line">    submitInfo.sType = VK_STRUCTURE_TYPE_SUBMIT_INFO;</span><br><span class="line">    submitInfo.commandBufferCount = <span class="number">1</span>;</span><br><span class="line">    submitInfo.pCommandBuffers = &amp;commandBuffer;</span><br><span class="line">    <span class="built_in">vkQueueSubmit</span>(graphicsQueue, <span class="number">1</span>, &amp;submitInfo, VK_NULL_HANDLE);</span><br><span class="line">    <span class="built_in">vkQueueWaitIdle</span>(graphicsQueue);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkFreeCommandBuffers</span>(device, commandPool, <span class="number">1</span>, &amp;commandBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‹·è´ç¼“å†²æŒ‡ä»¤çš„ä¸€èˆ¬æµç¨‹æ˜¯:</p>
<ol>
<li>vkAllocateCommandBuffers åˆ›å»ºæŒ‡ä»¤ç¼“å†²ï¼Œåˆ†é…å†…å­˜</li>
<li>vkBeginCommandBuffer     å¼€å§‹æŒ‡ä»¤è®°å½•</li>
<li>vkCmdCopyBuffer          æ‰§è¡Œå…·ä½“æŒ‡ä»¤</li>
<li>vkEndCommandBuffer       ç»“æŸæŒ‡ä»¤è®°å½•</li>
<li>vkQueueSubmit            å°†æŒ‡ä»¤æäº¤åˆ°ç®¡é“</li>
<li>vkQueueWaitIdle          ç­‰å¾…ç®¡é“æ‰§è¡ŒæŒ‡ä»¤,ä¹Ÿå¯ä»¥é€šè¿‡fenceæœºåˆ¶</li>
<li>vkFreeCommandBuffers     é‡Šæ”¾æŒ‡ä»¤ç¼“å†²åŒº</li>
</ol>
<h3 id="2-2-1-vkCmdCopyBuffer-æ‹·è´ç¼“å†²åŒº"><a href="#2-2-1-vkCmdCopyBuffer-æ‹·è´ç¼“å†²åŒº" class="headerlink" title="2.2.1 vkCmdCopyBuffer æ‹·è´ç¼“å†²åŒº"></a>2.2.1 vkCmdCopyBuffer æ‹·è´ç¼“å†²åŒº</h3><p>åœ¨ç¼“å†²åŒºå¯¹è±¡ä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œè°ƒç”¨:vkCmdCopyBuffer</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdCopyBuffer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    srcBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    dstBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    regionCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkBufferCopy*                         pRegions)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯å‘½ä»¤å°†è¢«è®°å½•åˆ°çš„å‘½ä»¤ç¼“å†²åŒºã€‚</li>
<li>srcBufferæ˜¯æºç¼“å†²åŒºã€‚</li>
<li>dstBufferæ˜¯ç›®æ ‡ç¼“å†²åŒºã€‚</li>
<li>regionCountæ˜¯è¦å¤åˆ¶çš„åŒºåŸŸæ•°ã€‚</li>
<li>pRegionsæ˜¯ä¸€ä¸ªæŒ‡å‘VkBufferCopyç»“æ„ä½“æ•°ç»„çš„æŒ‡é’ˆï¼Œè¯¥æ•°ç»„æŒ‡å®šäº†è¦å¤åˆ¶çš„åŒºåŸŸã€‚</li>
</ol>
<h2 id="2-3-ç¼“å†²åŒºæ‹·è´"><a href="#2-3-ç¼“å†²åŒºæ‹·è´" class="headerlink" title="2.3 ç¼“å†²åŒºæ‹·è´"></a>2.3 ç¼“å†²åŒºæ‹·è´</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createVertexBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDeviceSize bufferSize = <span class="built_in">sizeof</span>(vertices[<span class="number">0</span>]) * vertices.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    VkBuffer stagingBuffer;</span><br><span class="line">    VkDeviceMemory stagingBufferMemory;</span><br><span class="line">    <span class="built_in">createBuffer</span>(bufferSize, VK_BUFFER_USAGE_TRANSFER_SRC_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT |</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_COHERENT_BIT, stagingBuffer,</span><br><span class="line">            <span class="comment">// èµ„æºåªèƒ½ç”±å•ä¸ªé˜Ÿåˆ—æ—ç‹¬å </span></span><br><span class="line">            stagingBufferMemory, VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line">    <span class="type">void</span>* data;</span><br><span class="line">    <span class="built_in">vkMapMemory</span>(device, stagingBufferMemory, <span class="number">0</span>, bufferSize, <span class="number">0</span>, &amp;data);</span><br><span class="line">    <span class="built_in">memcpy</span>(data, vertices.<span class="built_in">data</span>(), (<span class="type">size_t</span>) bufferSize);</span><br><span class="line">    <span class="built_in">vkUnmapMemory</span>(device, stagingBufferMemory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œçš„MEMORY_PROPERTYæ˜¯VK_MEMORY_PROPERTY_DEVICE_LOCAL_BITï¼</span></span><br><span class="line">    <span class="built_in">createBuffer</span>(bufferSize, VK_BUFFER_USAGE_TRANSFER_DST_BIT |</span><br><span class="line">            VK_BUFFER_USAGE_VERTEX_BUFFER_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT, vertexBuffer,</span><br><span class="line">            <span class="comment">// èµ„æºåªèƒ½ç”±å•ä¸ªé˜Ÿåˆ—æ—ç‹¬å </span></span><br><span class="line">            vertexBufferMemory, VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†æš‚å­˜ç¼“å†²åŒºçš„æ•°æ®å†…å®¹æ‹·è´åˆ°é¡¶ç‚¹ç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">copyBuffer</span>(stagingBuffer, vertexBuffer, bufferSize);</span><br><span class="line">    <span class="comment">// é”€æ¯æš‚å­˜ç¼“å†²åŒºï¼Œé‡Šæ”¾å†…å­˜</span></span><br><span class="line">    <span class="built_in">vkDestroyBuffer</span>(device, stagingBuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, stagingBufferMemory, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸€ä¸ªæš‚å­˜ç¼“å†²åŒºæ›¿æ¢åŸæ¥çš„ç›´æ¥ä½¿ç”¨memcpyå‘¢ï¼Œè€Œä¸”ä½¿ç”¨æš‚å­˜ç¼“å†²è¿˜é¢å¤–å¤šäº†ä¸€ä¸ªåˆ›å»ºç¼“å†²åŒºçš„æ“ä½œï¼Ÿ</p>
<p>å› ä¸ºå›¾å½¢ç®¡é“ä½¿ç”¨é¡¶ç‚¹æ•°æ®ç¼“å†²åŒºæ—¶ï¼Œå¦‚æœéœ€è¦æ›´æ”¹é¡¶ç‚¹æ•°æ®å†…å®¹ï¼Œè¿˜éœ€è¦ç­‰å¾…memcpy,å¦‚æœä½¿ç”¨æš‚å­˜ç¼“å†²åŒºï¼Œå¯ä»¥å°†æ›´æ”¹é¡¶ç‚¹æ•°æ®å†…å®¹çš„æ“ä½œæ”¾åœ¨å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œç­‰åˆ°å†™å®Œä¹‹åï¼Œå†ä½¿ç”¨vkCmdCopyBufferæŒ‡ä»¤æ‹·è´å†…å­˜æ•°æ®ï¼Œè¿™æ ·å›¾å½¢ç®¡é“æœ€å¤šç­‰å¾…è¿™ä¸ªæŒ‡ä»¤æ‹·è´çš„æ—¶é—´ã€‚å½“ç„¶è¿™ä¸€ç‚¹ç°åœ¨çœ‹ä¸å‡ºæ¥ä¼˜åŠ¿ï¼Œç­‰æˆ‘ä»¬çš„é¡¶ç‚¹æ•°æ®å¤šè€Œä¸”ç»˜åˆ¶å†…å®¹å¤æ‚çš„æ—¶å€™å°±å¯ä»¥ä½“ç°å‡ºæ¥äº†ã€‚</p>
<p>è®©æˆ‘ä»¬æ›´è¿‘ä¸€æ­¥ï¼Œè€ƒè™‘åˆ°æ¯æ¬¡æ‹·è´éƒ½éœ€è¦æ‰§è¡ŒvkAllocateCommandBuffersåˆ†é…å†…å­˜ï¼Œä¸å¦‚ä¸€å¼€å§‹å°±è¯·æ±‚ä¸€å—åˆé€‚çš„å†…å­˜åŒºåŸŸï¼Œæ¯•ç«Ÿè¿™ä¸ªå‡½æ•°å¼€é”€è¿˜æ˜¯å¾ˆå¤§çš„ã€‚é€šè¿‡ä½¿ç”¨æˆ‘ä»¬åœ¨è®¸å¤šå‡½æ•°ä¸­çœ‹åˆ°çš„åç§»å‚æ•°ï¼Œåœ¨è®¸å¤šä¸åŒçš„å¯¹è±¡ä¹‹é—´åˆ†å‰²å•ä¸ªåˆ†é…æˆ–å›æ”¶ã€‚å¯ä»¥è‡ªå·±å®ç°ä¹Ÿå¯ä»¥ä½¿ç”¨GPUOpenå€¡è®®æä¾›çš„VulkanMemoryAllocatoråº“ã€‚</p>
<h1 id="ä¸‰-ç´¢å¼•ç¼“å†²åŒº"><a href="#ä¸‰-ç´¢å¼•ç¼“å†²åŒº" class="headerlink" title="ä¸‰. ç´¢å¼•ç¼“å†²åŒº"></a>ä¸‰. ç´¢å¼•ç¼“å†²åŒº</h1><p>åœ¨çœŸå®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºä¸­æ¸²æŸ“çš„3Dç½‘æ ¼ç»å¸¸ä¼šåœ¨å¤šä¸ªä¸‰è§’å½¢ä¹‹é—´å…±äº«é¡¶ç‚¹ã€‚æ¯”å¦‚ç”»ä¸€ä¸ªçŸ©å½¢:<br><img src="/images/Vulkan%E5%85%A5%E9%97%A8-12-%E6%9A%82%E5%AD%98%E7%BC%93%E5%86%B2%E5%92%8C%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2/Vulkan_12_1.png" alt="12_1"></p>
<p>ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢éœ€è¦ä¸¤ä¸ªä¸‰è§’å½¢(åŸºæœ¬ç»˜åˆ¶å•å…ƒåªæœ‰ç‚¹ã€çº¿å’Œä¸‰è§’å½¢ï¼Œæ‰€ä»¥çŸ©å½¢æ˜¯ä¸¤ä¸ªä¸‰è§’å½¢ä¹‹å’Œ)ï¼Œè¿™æ„å‘³ç€éœ€è¦æœ‰6ä¸ªé¡¶ç‚¹çš„é¡¶ç‚¹ç¼“å†²åŒºã€‚é—®é¢˜æ˜¯ä¸¤ä¸ªé¡¶ç‚¹çš„éƒ¨åˆ†æ•°æ®é‡å¤ï¼Œä¼šäº§ç”Ÿ50%çš„å†—ä½™ã€‚åœ¨æ›´å¤æ‚çš„ç½‘æ ¼ä¸­ï¼Œåªä¼šå˜å¾—æ›´ç³Ÿï¼Œå› ä¸ºé¡¶ç‚¹ä¼šåœ¨å¹³å‡3ä¸ªä¸‰è§’å½¢ä¸­é‡å¤ä½¿ç”¨ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç´¢å¼•ç¼“å†²åŒºã€‚</p>
<p>ç´¢å¼•ç¼“å†²åŒºæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘é¡¶ç‚¹ç¼“å†²åŒºçš„æŒ‡é’ˆæ•°ç»„ã€‚å®ƒå…è®¸é‡æ–°æ’åºé¡¶ç‚¹æ•°æ®ï¼Œå¹¶ä¸ºå¤šä¸ªé¡¶ç‚¹é‡ç”¨ç°æœ‰æ•°æ®ã€‚ä¸Šé¢çš„æ’å›¾æ¼”ç¤ºäº†ä¸€ä¸ªé¡¶ç‚¹ç¼“å†²åŒºåŒ…å«å››ä¸ªä¸åŒçš„é¡¶ç‚¹ï¼Œå…¶ç´¢å¼•ç¼“å†²åŒºä¼šæ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚å‰ä¸‰ä¸ªç´¢å¼•å®šä¹‰äº†å³ä¸Šè§’çš„ä¸‰è§’å½¢ï¼Œåä¸‰ä¸ªç´¢å¼•å®šä¹‰äº†å·¦ä¸‹è§’ä¸‰è§’å½¢çš„é¡¶ç‚¹(é¡ºæ—¶é’Ÿ)ã€‚</p>
<h2 id="3-1-åˆ›å»ºç´¢å¼•ç¼“å†²åŒº"><a href="#3-1-åˆ›å»ºç´¢å¼•ç¼“å†²åŒº" class="headerlink" title="3.1 åˆ›å»ºç´¢å¼•ç¼“å†²åŒº"></a>3.1 åˆ›å»ºç´¢å¼•ç¼“å†²åŒº</h2><p>æ¥ä¸‹æ¥å°†ä¿®æ”¹é¡¶ç‚¹æ•°æ®å¹¶æ·»åŠ ç´¢å¼•æ•°æ®æ¥ç»˜åˆ¶ä¸€ä¸ªçŸ©å½¢ï¼Œåƒä¸Šå›¾ä¸­ä¸€æ ·ã€‚ä¿®æ”¹é¡¶ç‚¹æ•°æ®ä»¥è¡¨ç¤ºå››ä¸ªè§’:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> std::vector&lt;Vertex&gt; vertices = &#123;</span><br><span class="line">    &#123;&#123;<span class="number">-0.5f</span>, <span class="number">-0.5f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.5f</span>, <span class="number">-0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">-0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>&#125;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å·¦ä¸Šè§’æ˜¯çº¢è‰²çš„ï¼Œå³ä¸Šæ–¹æ˜¯ç»¿è‰²çš„ï¼Œå³ä¸‹è§’æ˜¯è“è‰²çš„ï¼Œå·¦ä¸‹è§’æ˜¯ç™½è‰²çš„ã€‚ç°åœ¨æ·»åŠ ä¸€ä¸ªæ–°çš„æ•°ç»„ç´¢å¼•æ¥è¡¨ç¤ºç´¢å¼•ç¼“å†²åŒºçš„å†…å®¹ï¼ŒåŒ¹é…å›¾ä¸­çš„ç´¢å¼•æ¥ç»˜åˆ¶å³ä¸Šä¸‰è§’å½¢å’Œå·¦ä¸‹ä¸‰è§’å½¢ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> std::vector&lt;<span class="type">uint16_t</span>&gt; indices = &#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨uint16_tæˆ–uint32_tä½œä¸ºç´¢å¼•ç¼“å†²åŒºï¼Œè¿™å–å†³äºé¡¶ç‚¹ä¸­æ¡ç›®çš„æ•°é‡ã€‚æˆ‘ä»¬å¯ä»¥åšæŒuint16_tç°åœ¨ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨å°‘äº65535å”¯ä¸€é¡¶ç‚¹ã€‚</p>
<p>å°±åƒé¡¶ç‚¹æ•°æ®ä¸€æ ·ï¼Œç´¢å¼•éœ€è¦ä¸Šä¼ åˆ°VkBufferä¸­ï¼ŒGPUæ‰èƒ½è®¿é—®å®ƒä»¬ã€‚å®šä¹‰ä¸¤ä¸ªæ–°çš„ç±»æˆå‘˜æ¥ä¿å­˜ç´¢å¼•ç¼“å†²åŒºçš„èµ„æº:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkBuffer indexBuffer;</span><br><span class="line">VkDeviceMemory indexBufferMemory;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createVertexBuffer</span>();</span><br><span class="line">    <span class="built_in">createIndexBuffer</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createIndexBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDeviceSize bufferSize = <span class="built_in">sizeof</span>(indices[<span class="number">0</span>]) * indices.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">    VkBuffer stagingBuffer;</span><br><span class="line">    VkDeviceMemory stagingBufferMemory;</span><br><span class="line">    <span class="built_in">createBuffer</span>(bufferSize, VK_BUFFER_USAGE_TRANSFER_SRC_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT |</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_COHERENT_BIT, stagingBuffer,</span><br><span class="line">            <span class="comment">// èµ„æºåªèƒ½ç”±å•ä¸ªé˜Ÿåˆ—æ—ç‹¬å </span></span><br><span class="line">            stagingBufferMemory, VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line">    <span class="type">void</span>* data;</span><br><span class="line">    <span class="built_in">vkMapMemory</span>(device, stagingBufferMemory, <span class="number">0</span>, bufferSize, <span class="number">0</span>, &amp;data);</span><br><span class="line">    <span class="built_in">memcpy</span>(data, indices.<span class="built_in">data</span>(), (<span class="type">size_t</span>) bufferSize);</span><br><span class="line">    <span class="built_in">vkUnmapMemory</span>(device, stagingBufferMemory);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">createBuffer</span>(bufferSize, VK_BUFFER_USAGE_TRANSFER_DST_BIT</span><br><span class="line">            | VK_BUFFER_USAGE_INDEX_BUFFER_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT, indexBuffer,</span><br><span class="line">            <span class="comment">// èµ„æºåªèƒ½ç”±å•ä¸ªé˜Ÿåˆ—æ—ç‹¬å </span></span><br><span class="line">            indexBufferMemory, VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line">    <span class="comment">// å°†æš‚å­˜ç¼“å†²åŒºçš„æ•°æ®å†…å®¹æ‹·è´åˆ°é¡¶ç‚¹ç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">copyBuffer</span>(stagingBuffer, indexBuffer, bufferSize);</span><br><span class="line">    <span class="comment">// é”€æ¯æš‚å­˜ç¼“å†²åŒºï¼Œé‡Šæ”¾å†…å­˜</span></span><br><span class="line">    <span class="built_in">vkDestroyBuffer</span>(device, stagingBuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, stagingBufferMemory, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° createIndexBuffer å‡ ä¹å’Œ createVertexBuffer ä¸€æ ·ï¼Œåªæœ‰bufferSizeå’ŒVkBufferUsageFlagsä¸åŒè€Œå·²ï¼Œæ¯•ç«Ÿéƒ½æ˜¯åªæ˜¯ç¼“å†²åŒºã€‚</p>
<p>ç´¢å¼•ç¼“å†²åŒæ ·ä¹Ÿéœ€è¦æ˜¾ç¤ºé”€æ¯ï¼š </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line">    <span class="built_in">vkDestroyBuffer</span>(device, indexBuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, indexBufferMemory, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkDestroyBuffer</span>(device, vertexBuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, vertexBufferMemory, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-ä½¿ç”¨é¡¶ç‚¹ç¼“å†²"><a href="#3-2-ä½¿ç”¨é¡¶ç‚¹ç¼“å†²" class="headerlink" title="3.2 ä½¿ç”¨é¡¶ç‚¹ç¼“å†²"></a>3.2 ä½¿ç”¨é¡¶ç‚¹ç¼“å†²</h2><p>ä½¿ç”¨ç´¢å¼•ç¼“å†²åŒºç»˜åˆ¶æ¶‰åŠcreateCommandBuffersçš„ä¸¤ä¸ªæ›´æ”¹ã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦ç»‘å®šç´¢å¼•ç¼“å†²åŒºï¼Œå°±åƒæˆ‘ä»¬å¯¹é¡¶ç‚¹ç¼“å†²åŒºæ‰€åšçš„é‚£æ ·ã€‚ä½†æ˜¯ç´¢å¼•ç¼“å†²åŒºåªèƒ½æœ‰ä¸€ä¸ªã€‚è€Œä¸”ï¼Œä¸å¯èƒ½å¯¹æ¯ä¸ªé¡¶ç‚¹å±æ€§ä½¿ç”¨ä¸åŒçš„ç´¢å¼•ï¼Œæ‰€ä»¥å³ä½¿åªæœ‰ä¸€ä¸ªå±æ€§å‘ç”Ÿå˜åŒ–ï¼Œä»ç„¶éœ€è¦å®Œå…¨å¤åˆ¶é¡¶ç‚¹æ•°æ®ã€‚</p>
<p>ç´¢å¼•ç¼“å†²åŒºä¸vkCmdBindIndexBufferç»‘å®šï¼ŒvkCmdBindIndexBufferåŒ…å«ç´¢å¼•ç¼“å†²åŒºã€å…¶ä¸­çš„å­—èŠ‚åç§»é‡å’Œç´¢å¼•æ•°æ®ç±»å‹ä½œä¸ºå‚æ•°ã€‚å¦‚å‰æ‰€è¿°ï¼Œå¯èƒ½çš„ç±»å‹æ˜¯VK_INDEX_TYPE_UINT16å’ŒVK_INDEX_TYPE_UINT32ã€‚</p>
<p>ä»…ä»…ç»‘å®šç´¢å¼•ç¼“å†²åŒºè¿˜ä¸èƒ½æ”¹å˜ä»»ä½•ä¸œè¥¿ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ›´æ”¹ç»˜å›¾å‘½ä»¤æ¥å‘Šè¯‰Vulkanä½¿ç”¨ç´¢å¼•ç¼“å†²åŒºã€‚ç§»é™¤vkCmdDrawï¼Œå¹¶ç”¨vkCmdDrawIndexedæ›¿æ¢:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkBuffer vertexBuffers[] = &#123;vertexBuffer&#125;;</span><br><span class="line">VkDeviceSize offsets[] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">vkCmdBindVertexBuffers</span>(commandBuffers[i], <span class="number">0</span>, <span class="number">1</span>, vertexBuffers, offsets);</span><br><span class="line"><span class="comment">// VK_INDEX_TYPE_UINT16 æ˜¯å› ä¸ºæˆ‘ä»¬ç´¢å¼•ç”¨çš„å°±æ˜¯uint16_t</span></span><br><span class="line"><span class="built_in">vkCmdBindIndexBuffer</span>(commandBuffers[i], indexBuffer, <span class="number">0</span>, VK_INDEX_TYPE_UINT16);</span><br><span class="line"><span class="comment">// ä½¿ç”¨vkCmdDrawIndexedæ›¿æ¢vkCmdDraw</span></span><br><span class="line"><span class="comment">// vkCmdDraw(commandBuffers[i], static_cast&lt;uint32_t&gt;(vertices.size()), 1, 0, 0);</span></span><br><span class="line"><span class="built_in">vkCmdDrawIndexed</span>(commandBuffers[i], <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(indices.<span class="built_in">size</span>()), <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">vkCmdEndRenderPass</span>(commandBuffers[i]);</span><br></pre></td></tr></table></figure>

<p>å¯¹vkCmdDrawIndexedå‡½æ•°çš„è°ƒç”¨éå¸¸ç±»ä¼¼äºvkCmdDrawã€‚å‰ä¸¤ä¸ªå‚æ•°æŒ‡å®šç´¢å¼•çš„æ•°é‡å’Œå®ä¾‹çš„æ•°é‡ã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨å®ä¾‹ï¼Œæ‰€ä»¥åªæŒ‡å®šä¸€ä¸ªå®ä¾‹ã€‚ç´¢å¼•çš„æ•°é‡è¡¨ç¤ºå°†è¢«ä¼ é€’åˆ°é¡¶ç‚¹ç¼“å†²åŒºçš„é¡¶ç‚¹çš„æ•°é‡ã€‚ä¸‹ä¸€ä¸ªå‚æ•°æŒ‡å®šåˆ°ç´¢å¼•ç¼“å†²åŒºçš„åç§»é‡ï¼Œä½¿ç”¨å€¼1å°†å¯¼è‡´æ˜¾å¡ä»ç¬¬äºŒä¸ªç´¢å¼•å¼€å§‹è¯»å–ã€‚å€’æ•°ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¦æ·»åŠ åˆ°ç´¢å¼•ç¼“å†²åŒºä¸­çš„ç´¢å¼•çš„åç§»é‡ã€‚æœ€åä¸€ä¸ªå‚æ•°æŒ‡å®šäº†å®ä¾‹åŒ–çš„åç§»é‡ã€‚</p>
<h1 id="å››-ç»˜åˆ¶å‘½ä»¤æ¦‚è¿°"><a href="#å››-ç»˜åˆ¶å‘½ä»¤æ¦‚è¿°" class="headerlink" title="å››. ç»˜åˆ¶å‘½ä»¤æ¦‚è¿°"></a>å››. ç»˜åˆ¶å‘½ä»¤æ¦‚è¿°</h1><p>ç»˜åˆ¶å‘½ä»¤å¤§è‡´åˆ†ä¸ºä¸¤ç±»:éç´¢å¼•ç»˜å›¾å‘½ä»¤å’Œç´¢å¼•ç»˜å›¾å‘½ä»¤ã€‚</p>
<h2 id="4-1-éç´¢å¼•ç»˜å›¾å‘½ä»¤"><a href="#4-1-éç´¢å¼•ç»˜å›¾å‘½ä»¤" class="headerlink" title="4.1 éç´¢å¼•ç»˜å›¾å‘½ä»¤"></a>4.1 éç´¢å¼•ç»˜å›¾å‘½ä»¤</h2><p>éç´¢å¼•ç»˜å›¾å‘½ä»¤ä¸ºé¡¶ç‚¹ç€è‰²å™¨æä¾›ä¸€ä¸ªè¿ç»­çš„vertexIndexã€‚é¡ºåºç´¢å¼•æ˜¯ç”±è®¾å¤‡è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè¿™äº›å‘½ä»¤æœ‰:</p>
<ol>
<li>vkCmdDraw</li>
<li>vkCmdDrawIndirect</li>
<li>vkCmdDrawIndirectCount</li>
<li>vkCmdDrawIndirectCountKHR</li>
<li>vkCmdDrawIndirectCountAMD</li>
</ol>
<h3 id="4-1-1-vkCmdDraw"><a href="#4-1-1-vkCmdDraw" class="headerlink" title="4.1.1 vkCmdDraw"></a>4.1.1 vkCmdDraw</h3><p>vkCmdDrawå¯ä»¥è®°å½•ä¸€ä¸ªéç´¢å¼•çš„ç»˜åˆ¶ï¼Œå…¶åŸå‹å¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDraw</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    vertexCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    instanceCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstVertex,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstInstance)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯å‘½ä»¤è®°å½•åˆ°çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>vertexCountæ˜¯è¦ç»˜åˆ¶çš„é¡¶ç‚¹æ•°</li>
<li>instanceCountæ˜¯è¦ç»˜åˆ¶çš„å®ä¾‹æ•°é‡</li>
<li>firstVertexæ˜¯ç»˜åˆ¶çš„ç¬¬ä¸€ä¸ªé¡¶ç‚¹çš„ç´¢å¼•</li>
<li>firstInstanceæ˜¯ç»˜åˆ¶çš„ç¬¬ä¸€ä¸ªå®ä¾‹çš„å®ä¾‹ID</li>
</ol>
<p>æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œå°†ä½¿ç”¨å½“å‰åŸºæœ¬ä½“æ‹“æ‰‘å’Œé¡¶ç‚¹è®¡æ•°è¿ç»­é¡¶ç‚¹ç´¢å¼•ï¼ˆç¬¬ä¸€ä¸ªé¡¶ç‚¹ç´¢å¼•å€¼ç­‰äºç¬¬ä¸€ä¸ªé¡¶ç‚¹ï¼‰ç»„è£…åŸºæœ¬ä½“ã€‚åŸè¯­ç»˜åˆ¶å®ä¾‹æ•°é‡ä¸ºinstanceCountï¼ŒinstanceIndexä»firstInstanceå¼€å§‹ï¼Œæ¯ä¸ªå®ä¾‹ä¾æ¬¡é€’å¢ã€‚<strong>ç»„è£…åŸè¯­çš„æ‰§è¡Œè¦ç»‘å®šåˆ°å›¾å½¢ç®¡é“</strong>ã€‚</p>
<h3 id="4-1-2-vkCmdDrawIndirect"><a href="#4-1-2-vkCmdDrawIndirect" class="headerlink" title="4.1.2 vkCmdDrawIndirect"></a>4.1.2 vkCmdDrawIndirect</h3><p>vkCmdDrawIndirectç”¨äºè®°å½•éç´¢å¼•çš„é—´æ¥ç»˜åˆ¶ï¼Œå…¶åŸå‹å¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndirect</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    drawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯è®°å½•å‘½ä»¤çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>bufferæ˜¯åŒ…å«ç»˜å›¾å‚æ•°çš„ç¼“å†²åŒº</li>
<li>offsetæ˜¯å‚æ•°å¼€å§‹çš„ç¼“å†²åŒºä¸­çš„å­—èŠ‚åç§»é‡</li>
<li>drawCountæ˜¯è¦æ‰§è¡Œçš„ç»˜åˆ¶æ•°ï¼Œå¯ä»¥ä¸ºé›¶</li>
<li>strideæ˜¯è¿ç»­ç»˜å›¾å‚æ•°é›†ä¹‹é—´çš„å­—èŠ‚æ­¥å¹…</li>
</ol>
<p>vkCmdDrawIndirectçš„è¡Œä¸ºä¸vkCmdDrawç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å‚æ•°æ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±è®¾å¤‡ä»ç¼“å†²åŒºè¯»å–çš„ã€‚drawCountç»˜åˆ¶ç”±å‘½ä»¤æ‰§è¡Œï¼Œå‚æ•°ä»ç¼“å†²åŒºçš„åç§»é‡å¼€å§‹ï¼Œæ¯æ¬¡ç»˜åˆ¶æ—¶æŒ‰æ­¥é•¿å­—èŠ‚é€’å¢ã€‚æ¯æ¬¡ç»˜åˆ¶çš„å‚æ•°éƒ½ç¼–ç åœ¨ä¸€ä¸ªVkDrawIndirectCommandç»“æ„æ•°ç»„ä¸­ã€‚å¦‚æœdrawCountå°äºæˆ–ç­‰äº1ï¼Œåˆ™å¿½ç•¥strideã€‚</p>
<h3 id="4-1-3-vkCmdDrawIndirectCountã€vkCmdDrawIndirectCountKHRã€vkCmdDrawIndirectCountAMD"><a href="#4-1-3-vkCmdDrawIndirectCountã€vkCmdDrawIndirectCountKHRã€vkCmdDrawIndirectCountAMD" class="headerlink" title="4.1.3 vkCmdDrawIndirectCountã€vkCmdDrawIndirectCountKHRã€vkCmdDrawIndirectCountAMD"></a>4.1.3 vkCmdDrawIndirectCountã€vkCmdDrawIndirectCountKHRã€vkCmdDrawIndirectCountAMD</h3><p>è®°å½•æ¥è‡ªç¼“å†²åŒºçš„drawè°ƒç”¨è®¡æ•°çš„éç´¢å¼•ç»˜åˆ¶è°ƒç”¨,å¯ä»¥ä½¿ç”¨vkCmdDrawIndirectCountï¼ŒvkCmdDrawIndirectCountKHRæˆ–è€…vkCmdDrawIndirectCountAMD, è¿™ä¸‰ä¸ªæŒ‡ä»¤å‡ ä¹ç­‰æ•ˆï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndirectCount</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    countBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                countBufferOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    maxDrawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndirectCountKHR</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    countBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                countBufferOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    maxDrawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndirectCountAMD</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    countBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                countBufferOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    maxDrawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯è®°å½•å‘½ä»¤çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>bufferæ˜¯åŒ…å«ç»˜å›¾å‚æ•°çš„ç¼“å†²åŒº</li>
<li>offsetæ˜¯å‚æ•°å¼€å§‹çš„ç¼“å†²åŒºä¸­çš„å­—èŠ‚åç§»é‡</li>
<li>countBufferæ˜¯åŒ…å«ç»˜å›¾è®¡æ•°çš„ç¼“å†²åŒº</li>
<li>countBufferOffsetæ˜¯å¼€å§‹ç»˜åˆ¶è®¡æ•°çš„å­—èŠ‚åç§»åˆ°countBufferä¸­</li>
<li>maxDrawCountæŒ‡å®šå°†æ‰§è¡Œçš„æœ€å¤§ç»˜åˆ¶æ•°ã€‚å®é™…æ‰§è¡Œçš„ç»˜åˆ¶è°ƒç”¨æ•°æ˜¯countBufferå’ŒmaxDrawCountä¸­æŒ‡å®šçš„æœ€å°è®¡æ•°</li>
<li>strideæ˜¯è¿ç»­ç»˜å›¾å‚æ•°é›†ä¹‹é—´çš„å­—èŠ‚æ­¥å¹…</li>
</ol>
<p>vkCmdDrawIndirectCountçš„è¡Œä¸ºä¸vkCmdDrawIndirectCountç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ‰§è¡ŒæœŸé—´è®¾å¤‡ä»ç¼“å†²åŒºè¯»å–ç»˜åˆ¶è®¡æ•°ã€‚è¯¥å‘½ä»¤å°†ä»ä½äºcountBufferOffsetçš„countBufferä¸­è¯»å–ä¸€ä¸ªæ— ç¬¦å·32ä½æ•´æ•°ï¼Œå¹¶å°†å…¶ç”¨ä½œç»˜å›¾è®¡æ•°ã€‚</p>
<h2 id="4-2-ç´¢å¼•ç»˜å›¾å‘½ä»¤"><a href="#4-2-ç´¢å¼•ç»˜å›¾å‘½ä»¤" class="headerlink" title="4.2 ç´¢å¼•ç»˜å›¾å‘½ä»¤"></a>4.2 ç´¢å¼•ç»˜å›¾å‘½ä»¤</h2><p>ç´¢å¼•å›¾å½¢å‘½ä»¤ä»ç´¢å¼•ç¼“å†²åŒºè¯»å–ç´¢å¼•å€¼ï¼Œå¹¶ä½¿ç”¨æ­¤å‘½ä»¤è®¡ç®—é¡¶ç‚¹ç€è‰²å™¨çš„vertexIndexå€¼ã€‚è¿™äº›å‘½ä»¤æœ‰ï¼š</p>
<ol>
<li>vkCmdDrawIndexed</li>
<li>vkCmdDrawIndexedIndirect</li>
<li>vkCmdDrawIndexedIndirectCount</li>
<li>vkCmdDrawIndexedIndirectCountKHR</li>
<li>vkCmdDrawIndexedIndirectCountAMD</li>
</ol>
<h3 id="4-2-1-vkCmdDrawIndexed"><a href="#4-2-1-vkCmdDrawIndexed" class="headerlink" title="4.2.1 vkCmdDrawIndexed"></a>4.2.1 vkCmdDrawIndexed</h3><p>vkCmdDrawIndexedå¯ä»¥è®°å½•ä¸€ä¸ªç´¢å¼•çš„ç»˜åˆ¶ï¼Œå…¶åŸå‹å¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndexed</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    indexCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    instanceCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstIndex,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">int32_t</span>                                     vertexOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstInstance)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯å‘½ä»¤è®°å½•åˆ°çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>indexCountæ˜¯è¦ç»˜åˆ¶çš„é¡¶ç‚¹æ•°</li>
<li>instanceCountæ˜¯è¦ç»˜åˆ¶çš„å®ä¾‹æ•°</li>
<li>firstIndexæ˜¯ç´¢å¼•ç¼“å†²åŒºä¸­çš„åŸºç´¢å¼•</li>
<li>vertexOffsetæ˜¯åœ¨ç´¢å¼•åˆ°é¡¶ç‚¹ç¼“å†²åŒºä¹‹å‰æ·»åŠ åˆ°é¡¶ç‚¹ç´¢å¼•çš„å€¼</li>
<li>firstInstanceæ˜¯è¦ç»˜åˆ¶çš„ç¬¬ä¸€ä¸ªå®ä¾‹çš„å®ä¾‹ID</li>
</ol>
<p>åœ¨æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œä½¿ç”¨å½“å‰åŸºå…ƒæ‹“æ‰‘å’ŒindexCounté¡¶ç‚¹ç»„è£…åŸºå…ƒï¼Œè¿™äº›é¡¶ç‚¹çš„ç´¢å¼•æ˜¯ä»ç´¢å¼•ç¼“å†²åŒºæ£€ç´¢çš„ã€‚ç´¢å¼•ç¼“å†²åŒºè¢«è§†ä¸ºä¸€ä¸ªç´§å‡‘å°è£…çš„å¤§å°æ— ç¬¦å·æ•´æ•°æ•°ç»„ï¼Œè¯¥æ•´æ•°ç”±vkCmdBindIndexBuffer::indexTypeå½¢å‚å®šä¹‰ï¼Œè¯¥å½¢å‚ä¸è¯¥ç¼“å†²åŒºç»‘å®šã€‚</p>
<p>ç¬¬ä¸€ä¸ªé¡¶ç‚¹ç´¢å¼•ä½äºç»‘å®šç´¢å¼•ç¼“å†²åŒºä¸­çš„firstIndex * indexSize + offsetçš„åç§»é‡ï¼Œå…¶ä¸­offsetæ˜¯ç”±vkCmdBindIndexBufferæŒ‡å®šçš„åç§»é‡ï¼ŒindexSizeæ˜¯ç”±indexTypeæŒ‡å®šçš„ç±»å‹çš„å­—èŠ‚å¤§å°ã€‚ä»ç´¢å¼•ç¼“å†²åŒºä¸­è¿ç»­çš„ä½ç½®æ£€ç´¢åç»­çš„ç´¢å¼•å€¼ã€‚ç´¢å¼•é¦–å…ˆä¸åŸå§‹çš„é‡å¯å€¼æ¯”è¾ƒï¼Œç„¶å0æ‰©å±•åˆ°32ä½(å¦‚æœindexTypeæ˜¯VK_INDEX_TYPE_UINT8_EXTæˆ–VK_INDEX_TYPE_UINT16)ï¼Œå¹¶æ·»åŠ vertexOffsetï¼Œç„¶åå†ä½œä¸ºvertexIndexå€¼æä¾›ã€‚</p>
<p>è¿™äº›åŸè¯­æ˜¯ç”¨ä»firstInstanceå¼€å§‹çš„instanceIndexç»˜åˆ¶instanceCountæ¬¡æ•°ï¼Œå¹¶æŒ‰é¡ºåºå¢åŠ æ¯ä¸ªå®ä¾‹ã€‚<strong>ç»„è£…çš„åŸè¯­æ‰§è¡Œåº”ç»‘å®šå›¾å½¢ç®¡é“</strong>ã€‚</p>
<h3 id="4-2-2-vkCmdDrawIndexedIndirect"><a href="#4-2-2-vkCmdDrawIndexedIndirect" class="headerlink" title="4.2.2 vkCmdDrawIndexedIndirect"></a>4.2.2 vkCmdDrawIndexedIndirect</h3><p>vkCmdDrawIndexedIndirectç”¨äºè®°å½•ç´¢å¼•çš„é—´æ¥ç»˜åˆ¶ï¼Œå…¶åŸå‹å¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndexedIndirect</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    drawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯è®°å½•å‘½ä»¤çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>bufferæ˜¯åŒ…å«ç»˜å›¾å‚æ•°çš„ç¼“å†²åŒº</li>
<li>offsetæ˜¯å‚æ•°å¼€å§‹çš„ç¼“å†²åŒºä¸­çš„å­—èŠ‚åç§»é‡</li>
<li>drawCountæ˜¯è¦æ‰§è¡Œçš„ç»˜åˆ¶æ•°ï¼Œå¯ä»¥ä¸ºé›¶</li>
<li>strideæ˜¯è¿ç»­ç»˜å›¾å‚æ•°é›†ä¹‹é—´çš„å­—èŠ‚æ­¥å¹…</li>
</ol>
<p>vkCmdDrawIndexedIndirectçš„è¡Œä¸ºä¸vkcmddrawindexç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å‚æ•°æ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±è®¾å¤‡ä»ç¼“å†²åŒºä¸­è¯»å–çš„ã€‚drawCountç»˜åˆ¶ç”±å‘½ä»¤æ‰§è¡Œï¼Œå‚æ•°ä»ç¼“å†²åŒºçš„åç§»é‡å¼€å§‹ï¼Œæ¯æ¬¡ç»˜åˆ¶æ—¶æŒ‰æ­¥é•¿å­—èŠ‚é€’å¢ã€‚æ¯æ¬¡ç»˜åˆ¶çš„å‚æ•°éƒ½ç¼–ç åœ¨vkdrawindexdindirectcommandç»“æ„çš„æ•°ç»„ä¸­ã€‚å¦‚æœdrawCountå°äºæˆ–ç­‰äº1ï¼Œåˆ™å¿½ç•¥strideã€‚</p>
<h3 id="4-2-3-vkCmdDrawIndexedIndirectCountã€vkCmdDrawIndexedIndirectKHRã€vkCmdDrawIndexedIndirectAMD"><a href="#4-2-3-vkCmdDrawIndexedIndirectCountã€vkCmdDrawIndexedIndirectKHRã€vkCmdDrawIndexedIndirectAMD" class="headerlink" title="4.2.3 vkCmdDrawIndexedIndirectCountã€vkCmdDrawIndexedIndirectKHRã€vkCmdDrawIndexedIndirectAMD"></a>4.2.3 vkCmdDrawIndexedIndirectCountã€vkCmdDrawIndexedIndirectKHRã€vkCmdDrawIndexedIndirectAMD</h3><p>åŒæ ·çš„ï¼Œè®°å½•æ¥è‡ªç¼“å†²åŒºçš„drawè°ƒç”¨è®¡æ•°çš„ç´¢å¼•ç»˜åˆ¶è°ƒç”¨,å¯ä»¥ä½¿ç”¨, è¿™ä¸‰ä¸ªæŒ‡ä»¤å‡ ä¹ç­‰æ•ˆï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndexedIndirectCount</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    countBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                countBufferOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    maxDrawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndexedIndirectCountKHR</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    countBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                countBufferOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    maxDrawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDrawIndexedIndirectCountAMD</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    buffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                offset,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    countBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDeviceSize                                countBufferOffset,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    maxDrawCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    stride)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯è®°å½•å‘½ä»¤çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>bufferæ˜¯åŒ…å«ç»˜å›¾å‚æ•°çš„ç¼“å†²åŒº</li>
<li>offsetæ˜¯å‚æ•°å¼€å§‹çš„ç¼“å†²åŒºä¸­çš„å­—èŠ‚åç§»é‡</li>
<li>countBufferæ˜¯åŒ…å«ç»˜åˆ¶è®¡æ•°çš„ç¼“å†²åŒº</li>
<li>countBufferOffsetæ˜¯è¿›å…¥countBufferçš„å­—èŠ‚åç§»é‡ï¼Œåœ¨è¿™é‡Œå¼€å§‹ç»˜åˆ¶è®¡æ•°</li>
<li>maxDrawCountæŒ‡å®šå°†æ‰§è¡Œçš„æœ€å¤§ç»˜åˆ¶æ•°ã€‚å®é™…æ‰§è¡Œçš„drawè°ƒç”¨æ•°æ˜¯countBufferå’ŒmaxDrawCountä¸­æŒ‡å®šçš„æœ€å°è®¡æ•°</li>
<li>strideæ˜¯è¿ç»­ç»˜å›¾å‚æ•°é›†ä¹‹é—´çš„å­—èŠ‚æ­¥å¹…</li>
</ol>
<p>vkCmdDrawIndexedIndirectCountçš„è¡Œä¸ºä¸vkCmdDrawIndexedIndirectç±»ä¼¼ï¼Œåªæ˜¯åœ¨æ‰§è¡ŒæœŸé—´è®¾å¤‡ä»ç¼“å†²åŒºè¯»å–ç»˜åˆ¶è®¡æ•°ã€‚è¯¥å‘½ä»¤å°†ä»ä½äºcountBufferOffsetçš„countBufferä¸­è¯»å–ä¸€ä¸ªæ— ç¬¦å·32ä½æ•´æ•°ï¼Œå¹¶å°†å…¶ç”¨ä½œç»˜å›¾è®¡æ•°ã€‚</p>
<h1 id="äº”-å°ç»“"><a href="#äº”-å°ç»“" class="headerlink" title="äº”. å°ç»“"></a>äº”. å°ç»“</h1><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é¡¶ç‚¹æè¿°ç¬¦VkVertexInputBindingDescriptionå’ŒVkVertexInputAttributeDescriptionæ›¿æ¢äº†ç¡¬ç¼–ç é¡¶ç‚¹ï¼Œå¹¶ä¸”ä½¿ç”¨VkBufferå­˜å‚¨äº†é¡¶ç‚¹æ•°æ®ï¼Œå¥½å¤„æ˜¯å¯éšæ—¶æ›´æ”¹é¡¶ç‚¹ä¿¡æ¯ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åˆä½¿ç”¨äº†æš‚å­˜ç¼“å†²ä¼˜åŒ–äº†é¡¶ç‚¹ç¼“å†²æ¯æ¬¡éƒ½éœ€è¦memcpyçš„å¼Šç«¯ï¼Œè¿˜ä»‹ç»äº†é¡¶ç‚¹ç´¢å¼•ï¼Œä½¿å¾—æˆ‘ä»¬çš„ç¨‹åºå¯ä»¥ç”»å‡ºæ›´å¤šçš„å›¾å½¢ã€‚</p>
<p>ä½¿ç”¨æš‚å­˜ç¼“å†²æ˜¯å› ä¸ºå›¾å½¢ç®¡é“ä½¿ç”¨é¡¶ç‚¹æ•°æ®ç¼“å†²åŒºæ—¶ï¼Œå¦‚æœéœ€è¦æ›´æ”¹é¡¶ç‚¹æ•°æ®å†…å®¹ï¼Œè¿˜éœ€è¦ç­‰å¾…memcpy,å¦‚æœä½¿ç”¨æš‚å­˜ç¼“å†²åŒºï¼Œå¯ä»¥å°†æ›´æ”¹é¡¶ç‚¹æ•°æ®å†…å®¹çš„æ“ä½œæ”¾åœ¨å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œç­‰åˆ°å†™å®Œä¹‹åï¼Œå†ä½¿ç”¨vkCmdCopyBufferæŒ‡ä»¤æ‹·è´å†…å­˜æ•°æ®ï¼Œè¿™æ ·å›¾å½¢ç®¡é“æœ€å¤šç­‰å¾…è¿™ä¸ªæŒ‡ä»¤æ‹·è´çš„æ—¶é—´ã€‚å½“é¡¶ç‚¹æ•°æ®å¤šè€Œä¸”ç»˜åˆ¶å†…å®¹å¤æ‚çš„æ—¶å€™å°±å¯ä»¥ä½“ç°å‡ºæ¥äº†ã€‚</p>
<p>è€Œä½¿ç”¨é¡¶ç‚¹ç´¢å¼•ç¼“å†²æ˜¯å’Œé¡¶ç‚¹ç¼“å†²å‡ ä¹ä¸€æ ·çš„æµç¨‹ï¼Œåªæ˜¯VkBufferåˆ›å»ºæ—¶çš„VkBufferUsageFlagså’Œsize(å¯¹åº”çš„æ•°æ®ä¸åŒå˜›)ä¸åŒã€‚</p>
<p>ä¸è¿‡è¿™é‡Œè¿˜æ˜¯å¾ˆå¥½å¥‡ï¼Œé¡¶ç‚¹ç´¢å¼•å’Œé¡¶ç‚¹çš„å…³ç³»ï¼Œæ¯”å¦‚å¦‚æœæˆ‘ä»¬é¡¶ç‚¹åæ ‡ä¸å˜ï¼Œé¡¶ç‚¹ç´¢å¼•æ”¹æˆï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹ç´¢å¼•</span></span><br><span class="line">std::vector&lt;<span class="type">uint16_t</span>&gt; indices = &#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„å›¾å½¢å°±å˜æˆäº†:<br><img src="/images/Vulkan%E5%85%A5%E9%97%A8-12-%E6%9A%82%E5%AD%98%E7%BC%93%E5%86%B2%E5%92%8C%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2/Vulkan_12_2.png" alt="å›¾å½¢"></p>
<p>ä½†æ˜¯å½“é¡¶ç‚¹ç´¢å¼•æ”¹æˆ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹ç´¢å¼•</span></span><br><span class="line">std::vector&lt;<span class="type">uint16_t</span>&gt; indices = &#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„å›¾å½¢å°±å˜æˆäº†:<br><img src="/images/Vulkan%E5%85%A5%E9%97%A8-12-%E6%9A%82%E5%AD%98%E7%BC%93%E5%86%B2%E5%92%8C%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2/Vulkan_12_3.png" alt="å›¾å½¢"></p>
<p>è¿™ä¸ªé¡¶ç‚¹ç´¢å¼•å’Œæœ€ç»ˆå›¾åƒçš„ç”Ÿæˆåˆ°åº•æ˜¯ä»€ä¹ˆä¸ªå…³ç³»å‘¢ï¼Œå‚è€ƒ:<a href="https://zhuanlan.zhihu.com/p/97496535">https://zhuanlan.zhihu.com/p/97496535</a></p>
<p>Vulkanä¸­çš„åæ ‡ç³»ä½¿ç”¨çš„å³æ‰‹åæ ‡ç³»ï¼Œç›¸æ¯”OpenGLæ˜¯ç”¨çš„å·¦æ‰‹åæ ‡ç³»ï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-12-%E6%9A%82%E5%AD%98%E7%BC%93%E5%86%B2%E5%92%8C%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2/Vulkan_12_4.png" alt="åæ ‡ç³»"></p>
<p>å…¶ä¸­åŸç‚¹(0,0,0)åœ¨å±å¹•ä¸­å¤®, æ‰€ä»¥å½“æˆ‘ä»¬æƒ³ç”»ä¸€ä¸ªä¸‰æ£±é”¥å¯ä»¥ä½¿ç”¨å¦‚ä¸‹é¡¶ç‚¹åŠç´¢å¼•:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é¡¶ç‚¹æ•°æ®</span></span><br><span class="line">std::vector&lt;Vertex&gt; vertices = &#123;</span><br><span class="line">    &#123;&#123;<span class="number">-0.25f</span>, <span class="number">-0.01f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.01f</span>, <span class="number">-0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.25f</span>, <span class="number">0.01f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">-0.01f</span>, <span class="number">0.15f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>&#125;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é¡¶ç‚¹ç´¢å¼•</span></span><br><span class="line">std::vector&lt;<span class="type">uint16_t</span>&gt; indices = &#123;</span><br><span class="line">    <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-12-%E6%9A%82%E5%AD%98%E7%BC%93%E5%86%B2%E5%92%8C%E7%B4%A2%E5%BC%95%E7%BC%93%E5%86%B2/Vulkan_12_5.png" alt="ä¸‰æ£±é”¥"></p>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å†æ¥å†å‰ï¼Œå­¦ä¹ ä½¿ç”¨èµ„æºæè¿°ç¬¦æ¥åŠ è½½3Då›¾å½¢ã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(13)-æè¿°ç¬¦å¸ƒå±€åŠç¼“å­˜</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-13-%E6%8F%8F%E8%BF%B0%E7%AC%A6%E5%B8%83%E5%B1%80%E5%8F%8A%E7%BC%93%E5%AD%98/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä¸ºæ¯ä¸ªé¡¶ç‚¹ä¼ é€’ä»»æ„å±æ€§åˆ°é¡¶ç‚¹ç€è‰²å™¨ï¼Œä½†æ˜¯å…¨å±€å˜é‡å‘¢ï¼Ÿæˆ‘ä»¬å°†ä»æœ¬ç« å¼€å§‹è®¨è®ºä¸‰ç»´å›¾å½¢ï¼Œè¿™éœ€è¦ä¸€ä¸ªæ¨¡å‹è§†å›¾æŠ•å½±çŸ©é˜µã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶ä½œä¸ºé¡¶ç‚¹æ•°æ®åŒ…å«ï¼Œä½†è¿™æ˜¯å¯¹å†…å­˜çš„æµªè´¹ï¼Œè€Œä¸”æ¯å½“å˜æ¢å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½éœ€è¦æˆ‘ä»¬æ›´æ–°é¡¶ç‚¹ç¼“å†²åŒºã€‚ç„¶è€Œè¿™ç§è½¬æ¢å¯èƒ½åœ¨æ¯ä¸€å¸§éƒ½æœ‰ã€‚</p>
<span id="more"></span>

<p>åœ¨Vulkanä¸­è§£å†³è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®æ–¹æ³•æ˜¯ä½¿ç”¨èµ„æºæè¿°ç¬¦ï¼ˆresource descriptorï¼‰ã€‚æè¿°ç¬¦æ˜¯ç€è‰²å™¨è‡ªç”±è®¿é—®ç¼“å†²åŒºå’Œå›¾åƒç­‰èµ„æºçš„ä¸€ç§æ–¹å¼ã€‚æˆ‘ä»¬å°†è®¾ç½®ä¸€ä¸ªåŒ…å«å˜æ¢çŸ©é˜µçš„ç¼“å†²åŒºï¼Œå¹¶è®©é¡¶ç‚¹ç€è‰²å™¨é€šè¿‡æè¿°ç¬¦è®¿é—®å®ƒä»¬ã€‚æè¿°ç¬¦çš„ä½¿ç”¨åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>åœ¨ç®¡é“åˆ›å»ºæœŸé—´æŒ‡å®šæè¿°ç¬¦å¸ƒå±€</li>
<li>ä»æè¿°ç¬¦æ± åˆ†é…æè¿°ç¬¦é›†</li>
<li>æ¸²æŸ“æœŸé—´ç»‘å®šæè¿°ç¬¦é›†</li>
</ol>
<p>æè¿°ç¬¦æ˜¯è¡¨ç¤ºç€è‰²å™¨èµ„æºçš„ä¸é€æ˜æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ç¼“å†²åŒºã€ç¼“å†²åŒºè§†å›¾ã€å›¾åƒè§†å›¾ã€é‡‡æ ·å™¨æˆ–ç»„åˆå›¾åƒé‡‡æ ·å™¨ã€‚æè¿°ç¬¦è¢«ç»„ç»‡æˆæè¿°ç¬¦é›†ï¼Œè¿™äº›æè¿°ç¬¦é›†åœ¨å‘½ä»¤è®°å½•æœŸé—´è¢«ç»‘å®šï¼Œä»¥ä¾¿åœ¨åç»­çš„ç»˜åˆ¶å‘½ä»¤ä¸­ä½¿ç”¨ã€‚æ¯ä¸ªæè¿°ç¬¦é›†ä¸­å†…å®¹çš„å®‰æ’ç”±æè¿°ç¬¦é›†å¸ƒå±€å†³å®šï¼Œè¯¥å¸ƒå±€å†³å®šäº†å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨å“ªäº›æè¿°ç¬¦ã€‚ç®¡é“å¯ä½¿ç”¨çš„æè¿°ç¬¦é›†å¸ƒå±€åºåˆ—åœ¨ç®¡é“å¸ƒå±€ä¸­æŒ‡å®šã€‚æ¯ä¸ªç®¡é“å¯¹è±¡æœ€å¤šå¯ä»¥ä½¿ç”¨maxBoundDescriptorSets(å‚è§é™åˆ¶)æè¿°ç¬¦é›†ã€‚</p>
<p>æè¿°ç¬¦å¸ƒå±€æŒ‡å®šç®¡é“è¦è®¿é—®çš„èµ„æºç±»å‹ï¼Œå°±åƒæ¸²æŸ“è¿‡ç¨‹æŒ‡å®šè¦è®¿é—®çš„é™„ä»¶ç±»å‹ä¸€æ ·ã€‚æè¿°ç¬¦é›†æŒ‡å®šå°†ç»‘å®šåˆ°æè¿°ç¬¦çš„å®é™…ç¼“å†²åŒºæˆ–å›¾åƒèµ„æºï¼Œå°±åƒå¸§ç¼“å†²åŒºæŒ‡å®šè¦ç»‘å®šåˆ°æ¸²æŸ“è¿‡ç¨‹é™„ä»¶çš„å®é™…å›¾åƒè§†å›¾ä¸€æ ·ã€‚ç„¶åä¸ºç»˜å›¾å‘½ä»¤ç»‘å®šæè¿°ç¬¦é›†ï¼Œå°±åƒé¡¶ç‚¹ç¼“å†²åŒºå’Œå¸§ç¼“å†²åŒºä¸€æ ·ã€‚</p>
<p>ç€è‰²å™¨é€šè¿‡è£…é¥°æœ‰æè¿°ç¬¦é›†å’Œç»‘å®šæ•°çš„å˜é‡è®¿é—®èµ„æºï¼Œè¿™äº›å˜é‡å°†å®ƒä»¬è¿æ¥åˆ°æè¿°ç¬¦é›†ä¸­çš„æè¿°ç¬¦ã€‚ç€è‰²å™¨æ¥å£åˆ°ç»‘å®šæè¿°ç¬¦é›†çš„æ˜ å°„åœ¨ç€è‰²å™¨èµ„æºæ¥å£éƒ¨åˆ†æè¿°ã€‚ç€è‰²å™¨ä¹Ÿå¯ä»¥é€šè¿‡64ä½åœ°å€ä½¿ç”¨ç‰©ç†å­˜å‚¨ç¼“å†²åŒºè®¿é—®ï¼Œè€Œä¸éœ€è¦é€šè¿‡æè¿°ç¬¦æ¥è®¿é—®ç¼“å†²åŒºã€‚</p>
<p>æè¿°ç¬¦æœ‰å¾ˆå¤šç§ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨ç»Ÿä¸€ç¼“å†²åŒºå¯¹è±¡(UBO)ã€‚å¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">UniformBufferObject</span> &#123;</span><br><span class="line">    glm::mat4 model;</span><br><span class="line">    glm::mat4 view;</span><br><span class="line">    glm::mat4 proj;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨GLMä¸­çš„æ•°æ®ç±»å‹ç²¾ç¡®åŒ¹é…ç€è‰²å™¨ä¸­çš„å®šä¹‰ã€‚çŸ©é˜µä¸­çš„æ•°æ®ä¸ç€è‰²å™¨æœŸæœ›çš„æ–¹å¼æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç¨åå°†UniformBufferObjectçš„memcpyè½¬æ¢ä¸ºVkBufferã€‚</p>
<p>éœ€è¦æ›´æ”¹é¡¶ç‚¹ç€è‰²å™¨:</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"><span class="meta">#extension GL_ARB_separate_shader_objects : enable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">0</span>) <span class="keyword">uniform</span> UniformBufferObject &#123;</span><br><span class="line">    <span class="type">mat4</span> model;</span><br><span class="line">    <span class="type">mat4</span> view;</span><br><span class="line">    <span class="type">mat4</span> proj;</span><br><span class="line">&#125; ubo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec2</span> inPosition;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> inColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = ubo.proj * ubo.view * ubo.model * <span class="type">vec4</span>(inPosition, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    fragColor = inColor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»‘å®šæŒ‡ä»¤ç±»ä¼¼äºå±æ€§çš„ä½ç½®æŒ‡ä»¤ã€‚ æˆ‘ä»¬å°†åœ¨æè¿°ç¬¦å¸ƒå±€ä¸­å¼•ç”¨æ­¤ç»‘å®šã€‚ æ›´æ”¹äº†å¸¦æœ‰gl_Positionçš„è¡Œï¼Œä»¥ä½¿ç”¨è½¬æ¢æ¥è®¡ç®—å‰ªè¾‘åæ ‡ä¸­çš„æœ€ç»ˆä½ç½®ã€‚ ä¸2Dä¸‰è§’å½¢ä¸åŒï¼Œå‰ªè¾‘åæ ‡çš„æœ€åä¸€ä¸ªåˆ†é‡å¯èƒ½ä¸æ˜¯1ï¼Œè¿™åœ¨è½¬æ¢ä¸ºå±å¹•ä¸Šçš„æœ€ç»ˆå½’ä¸€åŒ–è®¾å¤‡åæ ‡æ—¶å°†å¯¼è‡´é™¤æ³•ã€‚ è¿™åœ¨é€è§†æŠ•å½±ä¸­ç”¨ä½œé€è§†åˆ’åˆ†ï¼Œå¯¹äºä½¿è¾ƒè¿‘çš„å¯¹è±¡çœ‹èµ·æ¥æ¯”è¾ƒè¿œçš„å¯¹è±¡çœ‹èµ·æ¥æ›´å¤§ï¼Œè¿™æ˜¯å¿…ä¸å¯å°‘çš„ã€‚</p>
<h1 id="ä¸€-æè¿°ç¬¦é›†å¸ƒå±€"><a href="#ä¸€-æè¿°ç¬¦é›†å¸ƒå±€" class="headerlink" title="ä¸€. æè¿°ç¬¦é›†å¸ƒå±€"></a>ä¸€. æè¿°ç¬¦é›†å¸ƒå±€</h1><p>æˆ‘ä»¬éœ€è¦æä¾›ç€è‰²å™¨ä¸­ç”¨äºç®¡é“åˆ›å»ºçš„æ¯ä¸ªæè¿°ç¬¦ç»‘å®šçš„è¯¦ç»†ä¿¡æ¯ï¼Œå°±åƒæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªé¡¶ç‚¹å±æ€§åŠå…¶ä½ç½®ç´¢å¼•æ‰€åšçš„é‚£æ ·ã€‚æˆ‘ä»¬å°†è®¾ç½®ä¸€ä¸ªæ–°å‡½æ•°æ¥å®šä¹‰æ‰€æœ‰è¿™äº›ä¿¡æ¯ï¼Œç§°ä¸ºcreateDescriptorSetLayoutã€‚åœ¨åˆ›å»ºç®¡é“ä¹‹å‰åº”è¯¥è°ƒç”¨:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createDescriptorSetLayout</span>();</span><br><span class="line">    <span class="built_in">createGraphicsPipeline</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createDescriptorSetLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDescriptorSetLayoutBinding uboLayoutBinding = &#123;&#125;;</span><br><span class="line">    <span class="comment">// æŒ‡å®šåœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çš„ç»‘å®š</span></span><br><span class="line">    uboLayoutBinding.binding = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æè¿°ç¬¦çš„ç±»å‹</span></span><br><span class="line">    uboLayoutBinding.descriptorType = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">    uboLayoutBinding.descriptorCount = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæè¿°ç¬¦å°†åœ¨é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µè¢«å¼•ç”¨</span></span><br><span class="line">    uboLayoutBinding.stageFlags = VK_SHADER_STAGE_VERTEX_BIT;</span><br><span class="line">    <span class="comment">// pImmutableSamplersä»…ä¸å›¾åƒé‡‡æ ·æè¿°ç¬¦æœ‰å…³</span></span><br><span class="line">    uboLayoutBinding.pImmutableSamplers = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªç»‘å®šéƒ½éœ€è¦é€šè¿‡VkDescriptorSetLayoutBindingç»“æ„æ¥æè¿°ã€‚å‰ä¸¤ä¸ªå­—æ®µæŒ‡å®šåœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çš„ç»‘å®šå’Œæè¿°ç¬¦çš„ç±»å‹ï¼Œè¯¥æè¿°ç¬¦æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ç¼“å†²åŒºå¯¹è±¡ã€‚ç€è‰²å™¨å˜é‡å¯èƒ½è¡¨ç¤ºä¸€ä¸ªç»Ÿä¸€ç¼“å†²åŒºå¯¹è±¡çš„æ•°ç»„ï¼Œè€Œæè¿°ç¬¦è®¡æ•°æŒ‡å®šè¯¥æ•°ç»„ä¸­å€¼çš„æ•°é‡ã€‚ ä¾‹å¦‚ï¼Œè¿™å¯ç”¨äºä¸ºéª¨éª¼åŠ¨ç”»æŒ‡å®šéª¨éª¼ä¸­æ¯ä¸ªéª¨éª¼çš„å˜æ¢ã€‚ æˆ‘ä»¬çš„MVPè½¬æ¢ä½äºå•ä¸ªç»Ÿä¸€ç¼“å†²åŒºå¯¹è±¡ä¸­ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨çš„æè¿°ç¬¦æ•°ä¸º1ã€‚</p>
<h2 id="1-1-VkDescriptorSetLayoutBinding"><a href="#1-1-VkDescriptorSetLayoutBinding" class="headerlink" title="1.1 VkDescriptorSetLayoutBinding"></a>1.1 VkDescriptorSetLayoutBinding</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkDescriptorSetLayoutBinding</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span>              binding;</span><br><span class="line">    VkDescriptorType      descriptorType;</span><br><span class="line">    <span class="type">uint32_t</span>              descriptorCount;</span><br><span class="line">    VkShaderStageFlags    stageFlags;</span><br><span class="line">    <span class="type">const</span> VkSampler*      pImmutableSamplers;</span><br><span class="line">&#125; VkDescriptorSetLayoutBinding;</span><br></pre></td></tr></table></figure>
<ol>
<li>bindingæ˜¯æ­¤æ¡ç›®çš„ç»‘å®šå·ï¼Œå¹¶ä¸”ä¸ç€è‰²å™¨é˜¶æ®µä¸­å…·æœ‰ç›¸åŒç»‘å®šå·çš„èµ„æºç›¸å¯¹åº”ã€‚</li>
<li>descriptorTypeæ˜¯VkDescriptorTypeï¼Œå®ƒæŒ‡å®šç”¨äºæ­¤ç»‘å®šçš„èµ„æºæè¿°ç¬¦çš„ç±»å‹ã€‚</li>
<li>descriptorCountæ˜¯ç»‘å®šä¸­åŒ…å«çš„æè¿°ç¬¦æ•°é‡ï¼Œåœ¨ç€è‰²å™¨ä¸­ä»¥æ•°ç»„å½¢å¼è®¿é—®ï¼Œé™¤éæè¿°ç¬¦ç±»å‹ä¸ºVK_DESCRIPTOR_TYPE_INLINE_UNIFORM_BLOCK_EXTï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæè¿°ç¬¦è®¡æ•°æ˜¯åµŒå…¥å¼ç»Ÿä¸€å—çš„å­—èŠ‚å¤§å°ã€‚å¦‚æœæè¿°ç¬¦è®¡æ•°ä¸ºé›¶ï¼Œåˆ™æ­¤ç»‘å®šæ¡ç›®è¢«ä¿ç•™ï¼Œå¹¶ä¸”ä¸å¾—ä½¿ç”¨è®¾ç½®çš„å¸ƒå±€åœ¨ä»»ä½•ç®¡é“å†…é€šè¿‡ä»»ä½•ç»‘å®šä»ä»»ä½•é˜¶æ®µè®¿é—®èµ„æºã€‚</li>
<li>stageFlagsæˆå‘˜æ˜¯VkShaderStageFlagBitsçš„ä½æ©ç ï¼Œç”¨äºæŒ‡å®šå“ªäº›ç®¡é“ç€è‰²å™¨é˜¶æ®µå¯ä»¥è®¿é—®æ­¤ç»‘å®šçš„èµ„æºã€‚ VK_SHADER_STAGE_ALLæ˜¯ä¸€ç§ç®€å†™å½¢å¼ï¼Œç”¨äºæŒ‡å®šæ‰€æœ‰å®šä¹‰çš„ç€è‰²å™¨é˜¶æ®µï¼ŒåŒ…æ‹¬æ‰©å±•å®šä¹‰çš„ä»»ä½•å…¶ä»–é˜¶æ®µï¼Œéƒ½å¯ä»¥è®¿é—®è¯¥èµ„æºã€‚å¦‚æœstageFlagsä¸­æœªåŒ…å«ç€è‰²å™¨é˜¶æ®µï¼Œåˆ™ä¸å¾—ä½¿ç”¨è®¾ç½®çš„å¸ƒå±€åœ¨ä»»ä½•ç®¡é“ä¸­é€šè¿‡æ­¤ç»‘å®šä»è¯¥é˜¶æ®µè®¿é—®èµ„æºã€‚é™¤äº†é™äºç‰‡æ®µç€è‰²å™¨çš„è¾“å…¥é™„ä»¶ä¹‹å¤–ï¼Œå¯¹äºé˜¶æ®µçš„å“ªäº›ç»„åˆå¯ä»¥ä½¿ç”¨æè¿°ç¬¦ç»‘å®šæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œç‰¹åˆ«æ˜¯å›¾å½¢é˜¶æ®µå’Œè®¡ç®—é˜¶æ®µéƒ½å¯ä»¥ä½¿ç”¨ç»‘å®šã€‚</li>
<li>pImmutableSamplerså½±å“é‡‡æ ·å™¨çš„åˆå§‹åŒ–ã€‚å¦‚æœæè¿°ç¬¦ç±»å‹æŒ‡å®šVK_DESCRIPTOR_TYPE_SAMPLERæˆ–VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLERç±»å‹æè¿°ç¬¦ï¼Œåˆ™å¯ä»¥ä½¿ç”¨pImmutableSamplersåˆå§‹åŒ–ä¸€ç»„ä¸å¯å˜çš„é‡‡æ ·å™¨ã€‚ä¸å¯å˜çš„é‡‡æ ·å™¨æ°¸ä¹…ç»‘å®šåˆ°è®¾ç½®çš„å¸ƒå±€ä¸­ï¼Œä¸å¾—æ›´æ”¹ã€‚ä¸å…è®¸ä½¿ç”¨ä¸å¯å˜é‡‡æ ·å™¨æ›´æ–°VK_DESCRIPTOR_TYPE_SAMPLERæè¿°ç¬¦ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸å¯å˜é‡‡æ ·å™¨æ›´æ–°VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLERæè¿°ç¬¦ä¸ä¼šä¿®æ”¹é‡‡æ ·å™¨ï¼ˆå°†æ›´æ–°å›¾åƒè§†å›¾ï¼Œä½†ä¼šå¿½ç•¥é‡‡æ ·å™¨æ›´æ–°ï¼‰ã€‚å¦‚æœpImmutableSamplersä¸ä¸ºNULLï¼Œåˆ™å®ƒæŒ‡å‘ä¸€ä¸ªé‡‡æ ·å™¨å¥æŸ„æ•°ç»„ï¼Œè¯¥æ•°ç»„å°†è¢«å¤åˆ¶åˆ°setå¸ƒå±€ä¸­å¹¶ç”¨äºç›¸åº”çš„ç»‘å®šã€‚ä»…é‡‡æ ·å™¨å¥æŸ„è¢«å¤åˆ¶ï¼›åœ¨æœ€ç»ˆä½¿ç”¨é›†åˆå¸ƒå±€ä»¥åŠä½¿ç”¨å®ƒåˆ›å»ºçš„ä»»ä½•æè¿°ç¬¦æ± å’Œé›†åˆä¹‹å‰ï¼Œä¸å¾—ç ´åé‡‡æ ·å™¨å¯¹è±¡ã€‚å¦‚æœpImmutableSamplersä¸ºNULLï¼Œåˆ™é‡‡æ ·å™¨æ’æ§½æ˜¯åŠ¨æ€çš„ï¼Œå¿…é¡»ä½¿ç”¨æ­¤å¸ƒå±€å°†é‡‡æ ·å™¨å¥æŸ„ç»‘å®šåˆ°æè¿°ç¬¦é›†ä¸­ã€‚å¦‚æœæè¿°ç¬¦ç±»å‹ä¸æ˜¯è¿™äº›æè¿°ç¬¦ç±»å‹ä¹‹ä¸€ï¼Œåˆ™å°†å¿½ç•¥pImmutableSamplersã€‚</li>
</ol>
<h3 id="1-1-1-VkDescriptorType"><a href="#1-1-1-VkDescriptorType" class="headerlink" title="1.1.1 VkDescriptorType"></a>1.1.1 VkDescriptorType</h3><p>å…¶ä¸­æè¿°ç¬¦çš„ç±»å‹VkDescriptorTypeæœ‰å¦‚ä¸‹å–å€¼:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkDescriptorType</span> &#123;</span><br><span class="line">    VK_DESCRIPTOR_TYPE_SAMPLER = <span class="number">0</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER = <span class="number">1</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_SAMPLED_IMAGE = <span class="number">2</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_STORAGE_IMAGE = <span class="number">3</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_UNIFORM_TEXEL_BUFFER = <span class="number">4</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFER = <span class="number">5</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER = <span class="number">6</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_STORAGE_BUFFER = <span class="number">7</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER_DYNAMIC = <span class="number">8</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_STORAGE_BUFFER_DYNAMIC = <span class="number">9</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENT = <span class="number">10</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_INLINE_UNIFORM_BLOCK_EXT = <span class="number">1000138000</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_ACCELERATION_STRUCTURE_NV = <span class="number">1000165000</span>,</span><br><span class="line">    VK_DESCRIPTOR_TYPE_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkDescriptorType;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_DESCRIPTOR_TYPE_SAMPLER: æŒ‡å®šé‡‡æ ·å™¨æè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER: æŒ‡å®šç»„åˆå›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_SAMPLED_IMAGE: æŒ‡å®šé‡‡æ ·å›¾åƒæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_STORAGE_IMAGE: æŒ‡å®šå­˜å‚¨æ˜ åƒæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_UNIFORM_TEXEL_BUFFER: æŒ‡å®šç»Ÿä¸€çº¹ç†åƒç´ ç¼“å†²åŒºæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_STORAGE_TEXEL_BUFFER: æŒ‡å®šå­˜å‚¨çº¹ç†å…ƒç´ ç¼“å†²åŒºæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER: ç»Ÿä¸€ç¼“å†²åŒºæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_STORAGE_BUFFER: æŒ‡å®šå­˜å‚¨ç¼“å†²åŒºæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER_DYNAMIC: æŒ‡å®šåŠ¨æ€ç»Ÿä¸€ç¼“å†²åŒºæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_STORAGE_BUFFER_DYNAMIC: æŒ‡å®šåŠ¨æ€å­˜å‚¨ç¼“å†²åŒºæè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENT: æŒ‡å®šè¾“å…¥é™„ä»¶æè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_TYPE_INLINE_UNIFORM_BLOCK_EXT: æŒ‡å®šå†…è”ç»Ÿä¸€å—</li>
</ol>
<h3 id="1-1-2-VkShaderStageFlags"><a href="#1-1-2-VkShaderStageFlags" class="headerlink" title="1.1.2 VkShaderStageFlags"></a>1.1.2 VkShaderStageFlags</h3><p>éœ€è¦æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç€è‰²å™¨é˜¶æ®µçš„å‘½ä»¤å’Œç»“æ„ä½¿ç”¨ä½å¯¹åº”äºé˜¶æ®µçš„ä½æ©ç æ¥æŒ‡å®šã€‚å¯ä»¥è®¾ç½®ä¸ºæŒ‡å®šç€è‰²å™¨é˜¶æ®µçš„ä½æœ‰ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkShaderStageFlagBits</span> &#123;</span><br><span class="line">    VK_SHADER_STAGE_VERTEX_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_SHADER_STAGE_GEOMETRY_BIT = <span class="number">0x00000008</span>,</span><br><span class="line">    VK_SHADER_STAGE_FRAGMENT_BIT = <span class="number">0x00000010</span>,</span><br><span class="line">    VK_SHADER_STAGE_COMPUTE_BIT = <span class="number">0x00000020</span>,</span><br><span class="line">    VK_SHADER_STAGE_ALL_GRAPHICS = <span class="number">0x0000001F</span>,</span><br><span class="line">    VK_SHADER_STAGE_ALL = <span class="number">0x7FFFFFFF</span>,</span><br><span class="line">    VK_SHADER_STAGE_RAYGEN_BIT_NV = <span class="number">0x00000100</span>,</span><br><span class="line">    VK_SHADER_STAGE_ANY_HIT_BIT_NV = <span class="number">0x00000200</span>,</span><br><span class="line">    VK_SHADER_STAGE_CLOSEST_HIT_BIT_NV = <span class="number">0x00000400</span>,</span><br><span class="line">    VK_SHADER_STAGE_MISS_BIT_NV = <span class="number">0x00000800</span>,</span><br><span class="line">    VK_SHADER_STAGE_INTERSECTION_BIT_NV = <span class="number">0x00001000</span>,</span><br><span class="line">    VK_SHADER_STAGE_CALLABLE_BIT_NV = <span class="number">0x00002000</span>,</span><br><span class="line">    VK_SHADER_STAGE_TASK_BIT_NV = <span class="number">0x00000040</span>,</span><br><span class="line">    VK_SHADER_STAGE_MESH_BIT_NV = <span class="number">0x00000080</span>,</span><br><span class="line">    VK_SHADER_STAGE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkShaderStageFlagBits;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_SHADER_STAGE_VERTEX_BIT: é¡¶ç‚¹é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT: ç»†åˆ†æ§åˆ¶é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT: ç»†åˆ†è¯„ä¼°é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_GEOMETRY_BIT: å‡ ä½•å›¾å½¢é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_FRAGMENT_BIT: ç‰‡æ®µé˜¶æ®µ</li>
<li>VK_SHADER_STAGE_COMPUTE_BIT: è®¡ç®—é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_ALL_GRAPHICS: ç”¨ä½œé€Ÿè®°çš„ä½çš„ç»„åˆï¼Œç”¨äºæŒ‡å®šä¸Šé¢å®šä¹‰çš„æ‰€æœ‰å›¾å½¢é˜¶æ®µï¼ˆè®¡ç®—é˜¶æ®µé™¤å¤–ï¼‰</li>
<li>VK_SHADER_STAGE_ALL: ç”¨ä½œç®€å†™çš„ä½çš„ç»„åˆï¼Œç”¨äºæŒ‡å®šè®¾å¤‡æ”¯æŒçš„æ‰€æœ‰ç€è‰²å™¨é˜¶æ®µï¼ŒåŒ…æ‹¬æ‰©å±•å¼•å…¥çš„æ‰€æœ‰å…¶ä»–é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_TASK_BIT_NV: ä»»åŠ¡é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_MESH_BIT_NV: ç½‘æ ¼é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_RAYGEN_BIT_NV: å°„çº¿ç”Ÿæˆé˜¶æ®µ</li>
<li>VK_SHADER_STAGE_ANY_HIT_BIT_NV: ä»»ä½•å‘½ä¸­é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_CLOSEST_HIT_BIT_NV: æœ€æ¥è¿‘çš„å‘½ä¸­é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_MISS_BIT_NV: æœªå‘½ä¸­é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_INTERSECTION_BIT_NV: ç›¸äº¤é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_CALLABLE_BIT_NV: å¯è°ƒç”¨é˜¶æ®µ</li>
</ol>
<h2 id="1-2-åˆ›å»ºVkDescriptorSetLayout"><a href="#1-2-åˆ›å»ºVkDescriptorSetLayout" class="headerlink" title="1.2 åˆ›å»ºVkDescriptorSetLayout"></a>1.2 åˆ›å»ºVkDescriptorSetLayout</h2><p>æ‰€æœ‰æè¿°ç¬¦ç»‘å®šéƒ½åˆå¹¶åˆ°ä¸€ä¸ªvkDescriptorSetLayoutå¯¹è±¡ä¸­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkDescriptorSetLayout descriptorSetLayout;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createDescriptorSetLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDescriptorSetLayoutBinding uboLayoutBinding = &#123;&#125;;</span><br><span class="line">    <span class="comment">// æŒ‡å®šåœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çš„ç»‘å®š</span></span><br><span class="line">    uboLayoutBinding.binding = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æè¿°ç¬¦çš„ç±»å‹</span></span><br><span class="line">    uboLayoutBinding.descriptorType = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">    uboLayoutBinding.descriptorCount = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæè¿°ç¬¦å°†åœ¨é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µè¢«å¼•ç”¨</span></span><br><span class="line">    uboLayoutBinding.stageFlags = VK_SHADER_STAGE_VERTEX_BIT;</span><br><span class="line">    <span class="comment">// pImmutableSamplersä»…ä¸å›¾åƒé‡‡æ ·æè¿°ç¬¦æœ‰å…³</span></span><br><span class="line">    uboLayoutBinding.pImmutableSamplers = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    VkDescriptorSetLayoutCreateInfo layoutInfo = &#123;&#125;;</span><br><span class="line">    layoutInfo.sType = VK_STRUCTURE_TYPE_DESCRIPTOR_SET_LAYOUT_CREATE_INFO;</span><br><span class="line">    layoutInfo.bindingCount = <span class="number">1</span>;</span><br><span class="line">    layoutInfo.pBindings = &amp;uboLayoutBinding;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæè¿°ç¬¦é›†å¸ƒå±€</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateDescriptorSetLayout</span>(device, &amp;layoutInfo, <span class="literal">nullptr</span>, &amp;descriptorSetLayout) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create descriptor set layout!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-1-VkDescriptorSetLayoutCreateInfo"><a href="#1-2-1-VkDescriptorSetLayoutCreateInfo" class="headerlink" title="1.2.1 VkDescriptorSetLayoutCreateInfo"></a>1.2.1 VkDescriptorSetLayoutCreateInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkDescriptorSetLayoutCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType                        sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                            pNext;</span><br><span class="line">    VkDescriptorSetLayoutCreateFlags       flags;</span><br><span class="line">    <span class="type">uint32_t</span>                               bindingCount;</span><br><span class="line">    <span class="type">const</span> VkDescriptorSetLayoutBinding*    pBindings;</span><br><span class="line">&#125; VkDescriptorSetLayoutCreateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sTypeå°±æ˜¯è¿™ç§ç»“æ„çš„ç±»å‹, VK_STRUCTURE_TYPE_DESCRIPTOR_SET_LAYOUT_CREATE_INFO</li>
<li>pNextä¸ºNULLæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>flagsæ˜¯VkDescriptorSetLayoutCreateFlagBitsçš„ä½æ©ç ï¼Œç”¨äºæŒ‡å®šæè¿°ç¬¦é›†å¸ƒå±€åˆ›å»ºçš„é€‰é¡¹</li>
<li>bindingCountæ˜¯pBindingsä¸­çš„å…ƒç´ æ•°</li>
<li>pBindingsæ˜¯æŒ‡å‘VkDescriptorSetLayoutBindingç»“æ„æ•°ç»„çš„æŒ‡é’ˆ</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkDescriptorSetLayoutCreateFlagBits</span> &#123;</span><br><span class="line">    VK_DESCRIPTOR_SET_LAYOUT_CREATE_UPDATE_AFTER_BIND_POOL_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_DESCRIPTOR_SET_LAYOUT_CREATE_PUSH_DESCRIPTOR_BIT_KHR = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_DESCRIPTOR_SET_LAYOUT_CREATE_UPDATE_AFTER_BIND_POOL_BIT_EXT = VK_DESCRIPTOR_SET_LAYOUT_CREATE_UPDATE_AFTER_BIND_POOL_BIT,</span><br><span class="line">    VK_DESCRIPTOR_SET_LAYOUT_CREATE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkDescriptorSetLayoutCreateFlagBits;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_DESCRIPTOR_SET_LAYOUT_CREATE_UPDATE_AFTER_BIND_POOL_BIT: æŒ‡å®šä¸å¾—ä½¿ç”¨æ­¤å¸ƒå±€åˆ†é…æè¿°ç¬¦é›†ï¼Œè€Œæ˜¯ç”±vkCmdPushDescriptorSetKHRæ¨é€æè¿°ç¬¦</li>
<li>VK_DESCRIPTOR_SET_LAYOUT_CREATE_PUSH_DESCRIPTOR_BIT_KHR: æŒ‡å®šæè¿°ç¬¦é›†ä½¿ç”¨æ­¤å¸ƒå±€å¿…é¡»ä»åˆ›å»ºä¸€ä¸ªæè¿°ç¬¦æ± åˆ†é…VK_DESCRIPTOR_POOL_CREATE_UPDATE_AFTER_BIND_BITä½é›†ã€‚æè¿°ç¬¦é›†å¸ƒå±€åˆ›å»ºè¿™éƒ¨åˆ†è®¾ç½®æœ‰å¤‡ç”¨é™åˆ¶æè¿°ç¬¦çš„æœ€å¤§æ•°é‡æ¯çº§å’Œper-pipelineå¸ƒå±€ã€‚non-UpdateAfterBindé™åˆ¶ä»…è®¡æ•°åœ¨æ²¡æœ‰æ­¤æ ‡å¿—çš„æƒ…å†µä¸‹åˆ›å»ºçš„é›†åˆä¸­çš„æè¿°ç¬¦ã€‚UpdateAfterBindé™åˆ¶è®¡ç®—æ‰€æœ‰æè¿°ç¬¦ï¼Œä½†æ˜¯é™åˆ¶å¯èƒ½é«˜äºéUpdateAfterBindé™åˆ¶ã€‚</li>
</ol>
<h3 id="1-2-2-vkCreateDescriptorSetLayout"><a href="#1-2-2-vkCreateDescriptorSetLayout" class="headerlink" title="1.2.2 vkCreateDescriptorSetLayout"></a>1.2.2 vkCreateDescriptorSetLayout</h3><p>æè¿°ç¬¦é›†å¸ƒå±€å¯¹è±¡ç”±é›¶ä¸ªæˆ–å¤šä¸ªæè¿°ç¬¦ç»‘å®šçš„æ•°ç»„å®šä¹‰ã€‚æ¯ä¸ªå•ç‹¬çš„æè¿°ç¬¦ç»‘å®šç”±æè¿°ç¬¦ç±»å‹ã€ç»‘å®šä¸­æè¿°ç¬¦æ•°é‡çš„è®¡æ•°ï¼ˆæ•°ç»„å¤§å°ï¼‰ã€å¯ä»¥è®¿é—®ç»‘å®šçš„ä¸€ç»„ç€è‰²å™¨é˜¶æ®µä»¥åŠï¼ˆå¦‚æœä½¿ç”¨ä¸å¯å˜é‡‡æ ·å™¨ï¼‰é‡‡æ ·å™¨æè¿°ç¬¦æ•°ç»„æŒ‡å®šã€‚</p>
<p>åˆ›å»ºæè¿°ç¬¦é›†å¸ƒå±€å¯ä»¥ä½¿ç”¨å‡½æ•°: vkCreateDescriptorSetLayout</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateDescriptorSetLayout</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkDescriptorSetLayoutCreateInfo*      pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDescriptorSetLayout*                      pSetLayout)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: åˆ›å»ºæè¿°ç¬¦é›†å¸ƒå±€çš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfo: æŒ‡å‘VkDescriptorSetLayoutCreateInfoç»“æ„çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å®šäº†æè¿°ç¬¦é›†å¸ƒå±€å¯¹è±¡çš„çŠ¶æ€</li>
<li>pAllocator: æ§åˆ¶ä¸»æœºå†…å­˜åˆ†é…</li>
<li>pSetLayout: æŒ‡å‘VkDescriptorSetLayoutå¥æŸ„çš„æŒ‡é’ˆï¼Œåœ¨è¿™ä¸ªå¥æŸ„ä¸­è¿”å›ç»“æœæè¿°ç¬¦é›†å¸ƒå±€å¯¹è±¡</li>
</ol>
<p>å½“ç„¶é€šè¿‡vkCreate*åˆ›å»ºçš„å¯¹è±¡æˆ–èµ„æºï¼Œä¸€èˆ¬éœ€è¦æ˜¾ç¤ºé”€æ¯:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line">    <span class="built_in">vkDestroyDescriptorSetLayout</span>(device, descriptorSetLayout, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-3-ç®¡é“æŒ‡å®šæè¿°ç¬¦é›†å¸ƒå±€"><a href="#1-3-ç®¡é“æŒ‡å®šæè¿°ç¬¦é›†å¸ƒå±€" class="headerlink" title="1.3 ç®¡é“æŒ‡å®šæè¿°ç¬¦é›†å¸ƒå±€"></a>1.3 ç®¡é“æŒ‡å®šæè¿°ç¬¦é›†å¸ƒå±€</h2><p>æˆ‘ä»¬éœ€è¦åœ¨ç®¡é“åˆ›å»ºæœŸé—´æŒ‡å®šæè¿°ç¬¦é›†å¸ƒå±€ï¼Œä»¥å‘Šè¯‰Vulkanç€è‰²å™¨å°†ä½¿ç”¨å“ªäº›æè¿°ç¬¦ã€‚æè¿°ç¬¦é›†å¸ƒå±€åœ¨ç®¡é“å¸ƒå±€å¯¹è±¡ä¸­æŒ‡å®šã€‚ä¿®æ”¹VkPipelineLayoutCreateInfoä»¥å¼•ç”¨å¸ƒå±€å¯¹è±¡ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineLayoutCreateInfo pipelineLayoutInfo = &#123;&#125;;</span><br><span class="line">pipelineLayoutInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_LAYOUT_CREATE_INFO;</span><br><span class="line">pipelineLayoutInfo.setLayoutCount = <span class="number">1</span>;</span><br><span class="line">pipelineLayoutInfo.pSetLayouts = &amp;descriptorSetLayout;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç•™ä¸ªæ‚¬å¿µï¼Œä¸ºä»€ä¹ˆå¯ä»¥æŒ‡å®šå¤šä¸ªæè¿°ç¬¦é›†å¸ƒå±€ã€‚</p>
<h2 id="1-4-ç»Ÿä¸€ç¼“å­˜"><a href="#1-4-ç»Ÿä¸€ç¼“å­˜" class="headerlink" title="1.4 ç»Ÿä¸€ç¼“å­˜"></a>1.4 ç»Ÿä¸€ç¼“å­˜</h2><p>æˆ‘ä»¬å°†æŒ‡å®šåŒ…å«ç€è‰²å™¨çš„UBOæ•°æ®çš„ç¼“å†²åŒºï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦é¦–å…ˆåˆ›å»ºè¿™ä¸ªç¼“å†²åŒºã€‚æˆ‘ä»¬å°†åœ¨æ¯ä¸€å¸§å°†æ–°æ•°æ®å¤åˆ¶åˆ°ç»Ÿä¸€ç¼“å†²åŒºï¼Œå› æ­¤ä½¿ç”¨æš‚å­˜ç¼“å†²åŒºå®é™…ä¸Šæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåªä¼šå¢åŠ é¢å¤–çš„å¼€é”€ï¼Œè€Œä¸”å¯èƒ½ä¼šé™ä½æ€§èƒ½ã€‚</p>
<p>æˆ‘ä»¬åº”è¯¥æœ‰å¤šä¸ªç¼“å†²åŒºï¼Œå› ä¸ºå¤šä¸ªå¸§å¯èƒ½åœ¨åŒä¸€æ—¶é—´ç»˜åˆ¶ï¼Œæˆ‘ä»¬ä¸æƒ³æ›´æ–°ç¼“å†²åŒºï¼Œå‡†å¤‡ä¸‹ä¸€å¸§ï¼Œè€Œå‰ä¸€å¸§ä»åœ¨è¯»å–å®ƒï¼æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªå¸§æˆ–æ¯ä¸ªäº¤æ¢é“¾å›¾åƒæä¾›ç»Ÿä¸€çš„ç¼“å†²åŒºã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬éœ€è¦ä»æ¯ä¸ªäº¤æ¢é“¾æ˜ åƒæ‰€æ‹¥æœ‰çš„å‘½ä»¤ç¼“å†²åŒºå¼•ç”¨ç»Ÿä¸€ç¼“å†²åŒºï¼Œå› æ­¤æœ€å¥½ä¹Ÿä¸ºæ¯ä¸ªäº¤æ¢é“¾æ˜ åƒåˆ›å»ºä¸€ä¸ªç»Ÿä¸€ç¼“å†²åŒºã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkBuffer indexBuffer;</span><br><span class="line">VkDeviceMemory indexBufferMemory;</span><br><span class="line"></span><br><span class="line">std::vector&lt;VkBuffer&gt; uniformBuffers;</span><br><span class="line">std::vector&lt;VkDeviceMemory&gt; uniformBuffersMemory;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createVertexBuffer</span>();</span><br><span class="line">    <span class="built_in">createIndexBuffer</span>();</span><br><span class="line">    <span class="built_in">createUniformBuffers</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createUniformBuffers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDeviceSize bufferSize = <span class="built_in">sizeof</span>(UniformBufferObject);</span><br><span class="line">    uniformBuffers.<span class="built_in">resize</span>(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line">    uniformBuffersMemory.<span class="built_in">resize</span>(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; swapChainImages.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="built_in">createBuffer</span>(bufferSize,</span><br><span class="line">                VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT,</span><br><span class="line">                VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT |</span><br><span class="line">                VK_MEMORY_PROPERTY_HOST_COHERENT_BIT,</span><br><span class="line">                uniformBuffers[i], uniformBuffersMemory[i],</span><br><span class="line">                VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ï¼Œåœ¨æ¯ä¸€å¸§ç”¨ä¸€ä¸ªæ–°çš„è½¬æ¢æ¥æ›´æ–°ç»Ÿä¸€ç¼“å†²åŒºï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰vkMapMemoryã€‚</p>
<p>ç»Ÿä¸€æ•°æ®å°†è¢«ç”¨äºæ‰€æœ‰çš„drawè°ƒç”¨ï¼Œæ‰€ä»¥åŒ…å«å®ƒçš„ç¼“å†²åŒºåªæœ‰åœ¨æˆ‘ä»¬åœæ­¢æ¸²æŸ“æ—¶æ‰ä¼šè¢«é”€æ¯ã€‚å› ä¸ºå®ƒä¹Ÿå–å†³äºäº¤æ¢é“¾å›¾åƒçš„æ•°é‡ï¼Œè¿™å¯èƒ½ä¼šåœ¨é‡æ–°åˆ›å»ºåæ”¹å˜ï¼Œæ‰€ä»¥åœ¨cleanupSwapChainä¸­æ¸…ç†å®ƒ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanupSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; uniformBuffers.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="built_in">vkDestroyBuffer</span>(device, uniformBuffers[i], <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">vkFreeMemory</span>(device, uniformBuffersMemory[i], <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">recreateSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createFramebuffers</span>();</span><br><span class="line">    <span class="built_in">createUniformBuffers</span>();</span><br><span class="line">    <span class="built_in">createCommandBuffers</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-5-æ›´æ–°ç»Ÿä¸€ç¼“å­˜æ•°æ®"><a href="#1-5-æ›´æ–°ç»Ÿä¸€ç¼“å­˜æ•°æ®" class="headerlink" title="1.5 æ›´æ–°ç»Ÿä¸€ç¼“å­˜æ•°æ®"></a>1.5 æ›´æ–°ç»Ÿä¸€ç¼“å­˜æ•°æ®</h2><p>åœ¨ç»˜åˆ¶æ›´æ–°äº¤æ¢é“¾å¸§çš„æ—¶å€™æ›´æ–°ç»Ÿä¸€ç¼“å­˜æ•°æ®ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">updateUniformBuffer</span>(imageIndex);</span><br><span class="line"></span><br><span class="line">    VkSubmitInfo submitInfo = &#123;&#125;;</span><br><span class="line">    submitInfo.sType = VK_STRUCTURE_TYPE_SUBMIT_INFO;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">updateUniformBuffer</span><span class="params">(<span class="type">uint32_t</span> currentImage)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>updateUniformBufferå‡½æ•°å°†åœ¨æ¯å¸§ç”Ÿæˆä¸€ä¸ªæ–°çš„å˜æ¢ï¼Œä»¥ä½¿å‡ ä½•ä½“æ—‹è½¬ã€‚ </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¡®ä¿glm::rotateä¹‹ç±»çš„å‡½æ•°ä½¿ç”¨å¼§åº¦ä½œä¸ºå‚æ•°æ˜¯å¿…è¦çš„ï¼Œä»¥é¿å…ä»»ä½•å¯èƒ½çš„æ··æ·†</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLM_FORCE_RADIANS</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/glm.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span></span><br><span class="line"><span class="comment">// chronoæ ‡å‡†åº“æ ‡å¤´å…¬å¼€äº†æ‰§è¡Œç²¾ç¡®è®¡æ—¶çš„åŠŸèƒ½</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">updateUniformBuffer</span><span class="params">(<span class="type">uint32_t</span> currentImage)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="keyword">auto</span> startTime = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="keyword">auto</span> currentTime = std::chrono::high_resolution_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="comment">// è®¡ç®—æ—¶é•¿</span></span><br><span class="line">    <span class="type">float</span> time = std::chrono::<span class="built_in">duration</span>&lt;<span class="type">float</span>, std::chrono::seconds::period&gt;(currentTime - startTime).<span class="built_in">count</span>();</span><br><span class="line"></span><br><span class="line">    UniformBufferObject ubo = &#123;&#125;;</span><br><span class="line">    <span class="comment">// åœ¨ç»Ÿä¸€ç¼“å†²åŒºå¯¹è±¡ä¸­å®šä¹‰æ¨¡å‹ï¼Œè§†å›¾å’ŒæŠ•å½±è½¬æ¢ã€‚ ä½¿ç”¨æ—¶é—´å˜é‡ï¼Œæ¨¡å‹æ—‹è½¬å°†æ˜¯å›´ç»•Zè½´çš„ç®€å•æ—‹è½¬</span></span><br><span class="line">    <span class="comment">// æ„æ€æ˜¯æ¯ç§’æ—‹è½¬90åº¦</span></span><br><span class="line">    ubo.model = glm::<span class="built_in">rotate</span>(glm::<span class="built_in">mat4</span>(<span class="number">1.0f</span>), time * glm::<span class="built_in">radians</span>(<span class="number">90.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line">    <span class="comment">// è®¾ç½®è§†å›¾è§’åº¦ï¼Œä»ä¸Šæ–¹ä»¥45åº¦è§’æŸ¥çœ‹å‡ ä½•å›¾å½¢ã€‚ glm :: lookAtå‡½æ•°å°†çœ¼ç›ä½ç½®ï¼Œä¸­å¿ƒä½ç½®å’Œä¸Šè½´ä½œä¸ºå‚æ•°ã€‚</span></span><br><span class="line">    ubo.view = glm::<span class="built_in">lookAt</span>(glm::<span class="built_in">vec3</span>(<span class="number">2.0f</span>, <span class="number">2.0f</span>, <span class="number">2.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>), glm::<span class="built_in">vec3</span>(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨å…·æœ‰45åº¦å‚ç›´è§†åœºçš„é€è§†æŠ•å½±ã€‚</span></span><br><span class="line">    <span class="comment">// å…¶ä»–å‚æ•°æ˜¯é•¿å®½æ¯”ï¼Œè¿‘è§†å¹³é¢å’Œè¿œè§†å¹³é¢ã€‚ é‡è¦çš„æ˜¯ä½¿ç”¨å½“å‰äº¤æ¢é“¾èŒƒå›´æ¥è®¡ç®—çºµæ¨ªæ¯”ï¼Œä»¥è€ƒè™‘è°ƒæ•´å¤§å°åçª—å£çš„æ–°å®½åº¦å’Œé«˜åº¦ã€‚</span></span><br><span class="line">    ubo.proj = glm::<span class="built_in">perspective</span>(glm::<span class="built_in">radians</span>(<span class="number">45.0f</span>), swapChainExtent.width / (<span class="type">float</span>) swapChainExtent.height, <span class="number">0.1f</span>, <span class="number">10.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// GLMæœ€åˆæ˜¯ä¸ºOpenGL(å·¦æ‰‹åæ ‡ç³»)è®¾è®¡çš„ï¼Œå°†å…¶ä¸­åæ ‡çš„Yåæ ‡åè½¬ã€‚ æœ€ç®€å•çš„è¡¥å¿æ–¹æ³•æ˜¯åœ¨æŠ•å½±çŸ©é˜µä¸­ç¿»è½¬Yè½´ç¼©æ”¾æ¯”ä¾‹ä¸Šçš„ç¬¦å·ã€‚ </span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸è¿™æ ·åšï¼Œé‚£ä¹ˆå›¾åƒå°†è¢«å€’ç½®å‘ˆç°ã€‚</span></span><br><span class="line">    ubo.proj[<span class="number">1</span>][<span class="number">1</span>] *= <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç»Ÿä¸€ç¼“å†²åŒºå¯¹è±¡ä¸­çš„æ•°æ®å¤åˆ¶åˆ°å½“å‰çš„ç»Ÿä¸€ç¼“å†²åŒºä¸­ã€‚ ä¸ä½¿ç”¨é¡¶ç‚¹ç¼“å†²åŒºçš„æ–¹å¼å®Œå…¨ç›¸åŒï¼Œåªæ˜¯ä¸éœ€è¦æš‚å­˜ç¼“å†²åŒºï¼ˆå› ä¸ºæ¯å¸§éƒ½è¦æ›´æ–°ï¼‰ï¼š</span></span><br><span class="line">    <span class="type">void</span>* data;</span><br><span class="line">    <span class="built_in">vkMapMemory</span>(device, uniformBuffersMemory[currentImage], <span class="number">0</span>, <span class="built_in">sizeof</span>(ubo), <span class="number">0</span>, &amp;data);</span><br><span class="line">    <span class="built_in">memcpy</span>(data, &amp;ubo, <span class="built_in">sizeof</span>(ubo));</span><br><span class="line">    <span class="built_in">vkUnmapMemory</span>(device, uniformBuffersMemory[currentImage]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶æ­¤æ—¶ç¼–è¯‘è¿è¡Œç¨‹åºæ˜¯ä¸æˆåŠŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä»…ä»…æ˜¯æ›´æ–°æ•°æ®ï¼Œä½†æ˜¯æ²¡æœ‰å°†æè¿°ç¬¦é›†ç»‘å®šåˆ°å›¾å½¢ç®¡é“ä¸­ã€‚</p>
<h1 id="äºŒ-æè¿°ç¬¦"><a href="#äºŒ-æè¿°ç¬¦" class="headerlink" title="äºŒ. æè¿°ç¬¦"></a>äºŒ. æè¿°ç¬¦</h1><p>å‰é¢æˆ‘ä»¬åˆ›å»ºäº†æè¿°ç¬¦é›†å¸ƒå±€ï¼Œæè¿°äº†å¯ä»¥ç»‘å®šçš„æè¿°ç¬¦çš„ç±»å‹ï¼Œç°åœ¨æˆ‘ä»¬ç»™ç»Ÿä¸€ç¼“å†²åŒºçš„æ¯ä¸ªç¼“å†²åˆ›å»ºä¸€ä¸ªæè¿°ç¬¦é›†ï¼Œç„¶åå°†å…¶ç»‘å®šåˆ°ç»Ÿä¸€ç¼“å†²åŒºæè¿°ç¬¦ä¸­ã€‚</p>
<h2 id="2-1-æè¿°ç¬¦æ± "><a href="#2-1-æè¿°ç¬¦æ± " class="headerlink" title="2.1 æè¿°ç¬¦æ± "></a>2.1 æè¿°ç¬¦æ± </h2><p>æè¿°ç¬¦é›†æ— æ³•ç›´æ¥åˆ›å»ºï¼Œå®ƒä»¬å¿…é¡»ä»å‘½ä»¤ç¼“å†²åŒºä¹‹ç±»çš„æ± ä¸­åˆ†é…ã€‚æè¿°ç¬¦é›†åˆç§°ä¸ºæè¿°ç¬¦æ± ã€‚ æˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªæ–°å‡½æ•°createDescriptorPoolè¿›è¡Œè®¾ç½®</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createUniformBuffers</span>();</span><br><span class="line">    <span class="built_in">createDescriptorPool</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createDescriptorPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDescriptorPoolSize poolSize = &#123;&#125;;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬åˆ›å»ºçš„æ˜¯ç»Ÿä¸€ç¼“å†²çš„æè¿°ç¬¦</span></span><br><span class="line">    poolSize.type = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">    poolSize.descriptorCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    VkDescriptorPoolCreateInfo poolInfo = &#123;&#125;;</span><br><span class="line">    poolInfo.sType = VK_STRUCTURE_TYPE_DESCRIPTOR_POOL_CREATE_INFO;</span><br><span class="line">    poolInfo.poolSizeCount = <span class="number">1</span>;</span><br><span class="line">    poolInfo.pPoolSizes = &amp;poolSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™¤äº†å¯ç”¨çš„å•ä¸ªæè¿°ç¬¦çš„æœ€å¤§æ•°é‡å¤–ï¼Œè¿˜éœ€è¦æŒ‡å®šå¯ä»¥åˆ†é…çš„æœ€å¤§æè¿°ç¬¦é›†æ•°é‡ï¼šä¸äº¤æ¢é“¾å›¾åƒæ•°é‡ä¸€è‡´</span></span><br><span class="line">    poolInfo.maxSets = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line">    <span class="comment">// åˆ›å»ºæè¿°ç¬¦æ± </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateDescriptorPool</span>(device, &amp;poolInfo, <span class="literal">nullptr</span>, &amp;descriptorPool) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create descriptor pool!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆéœ€è¦ä½¿ç”¨VkDescriptorPoolSizeç»“æ„æ¥æè¿°æˆ‘ä»¬çš„æè¿°ç¬¦é›†å°†åŒ…å«å“ªäº›æè¿°ç¬¦ç±»å‹ä»¥åŠå…¶ä¸­æœ‰å¤šå°‘ä¸ªæè¿°ç¬¦ç±»å‹ã€‚</p>
<h3 id="2-1-1-VkDescriptorPoolSize"><a href="#2-1-1-VkDescriptorPoolSize" class="headerlink" title="2.1.1 VkDescriptorPoolSize"></a>2.1.1 VkDescriptorPoolSize</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkDescriptorPoolSize</span> &#123;</span><br><span class="line">    VkDescriptorType    type;</span><br><span class="line">    <span class="type">uint32_t</span>            descriptorCount;</span><br><span class="line">&#125; VkDescriptorPoolSize;</span><br></pre></td></tr></table></figure>
<ol>
<li>typeæ˜¯æè¿°ç¬¦çš„ç±»å‹</li>
<li>descriptorCountæ˜¯è¦åˆ†é…çš„è¯¥ç±»å‹çš„æè¿°ç¬¦æ•°ã€‚å¦‚æœç±»å‹æ˜¯VK_DESCRIPTOR_TYPE_INLINE_UNIFORM_BLOCK_EXTï¼Œåˆ™descriptorCountæ˜¯è¦ä¸ºæ­¤ç±»å‹çš„æè¿°ç¬¦åˆ†é…çš„å­—èŠ‚æ•°</li>
</ol>
<h3 id="2-1-2-VkDescriptorPoolCreateInfo"><a href="#2-1-2-VkDescriptorPoolCreateInfo" class="headerlink" title="2.1.2 VkDescriptorPoolCreateInfo"></a>2.1.2 VkDescriptorPoolCreateInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkDescriptorPoolCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType                sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                    pNext;</span><br><span class="line">    VkDescriptorPoolCreateFlags    flags;</span><br><span class="line">    <span class="type">uint32_t</span>                       maxSets;</span><br><span class="line">    <span class="type">uint32_t</span>                       poolSizeCount;</span><br><span class="line">    <span class="type">const</span> VkDescriptorPoolSize*    pPoolSizes;</span><br><span class="line">&#125; VkDescriptorPoolCreateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sTypeæ˜¯æ­¤ç»“æ„çš„ç±»å‹, VK_STRUCTURE_TYPE_DESCRIPTOR_POOL_CREATE_INFO</li>
<li>pNextæ˜¯NULLæˆ–æŒ‡å‘æ‰©å±•ç‰¹å®šç»“æ„çš„æŒ‡é’ˆ</li>
<li>flagsæ˜¯VkDescriptorPoolCreateFlagBitsçš„ä½æ©ç ï¼Œç”¨äºæŒ‡å®šæ± ä¸­æŸäº›å—æ”¯æŒçš„æ“ä½œ</li>
<li>maxSetsæ˜¯å¯ä»¥ä»æ± ä¸­åˆ†é…çš„æè¿°ç¬¦é›†çš„æœ€å¤§æ•°é‡</li>
<li>poolSizeCountæ˜¯pPoolSizesä¸­çš„å…ƒç´ æ•°</li>
<li>pPoolSizesæ˜¯ä¸€ä¸ªæŒ‡å‘VkDescriptorPoolSizeç»“æ„æ•°ç»„çš„æŒ‡é’ˆï¼Œæ¯ä¸ªç»“æ„éƒ½åŒ…å«ä¸€ä¸ªæè¿°ç¬¦ç±»å‹å’Œè¦åœ¨æ± ä¸­åˆ†é…çš„è¯¥ç±»å‹çš„æè¿°ç¬¦æ•°é‡</li>
</ol>
<h3 id="2-1-3-vkCreateDescriptorPool"><a href="#2-1-3-vkCreateDescriptorPool" class="headerlink" title="2.1.3 vkCreateDescriptorPool"></a>2.1.3 vkCreateDescriptorPool</h3><p>æè¿°ç¬¦æ± ç»´æŠ¤ç€ä¸€ä¸ªæè¿°ç¬¦æ± ï¼Œä»ä¸­åˆ†é…æè¿°ç¬¦é›†ã€‚ æè¿°ç¬¦æ± æ˜¯å¤–éƒ¨åŒæ­¥çš„ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºä¸å¾—åŒæ—¶ä»å¤šä¸ªçº¿ç¨‹ä¸­çš„åŒä¸€æ± ä¸­åˆ†é…å’Œ&#x2F;æˆ–é‡Šæ”¾æè¿°ç¬¦é›†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateDescriptorPool</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkDescriptorPoolCreateInfo*           pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDescriptorPool*                           pDescriptorPool)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: åˆ›å»ºæè¿°ç¬¦æ± çš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfo: æŒ‡å‘VkDescriptorPoolCreateInfoç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æŒ‡å®šæè¿°ç¬¦æ± å¯¹è±¡çš„çŠ¶æ€</li>
<li>pAllocator: å†…å­˜åˆ†é…</li>
<li>pDescriptorPool: æŒ‡å‘VkDescriptorPoolå¥æŸ„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥å¥æŸ„ä¸­è¿”å›ç”Ÿæˆçš„æè¿°ç¬¦æ± å¯¹è±¡</li>
</ol>
<p>åˆ«å¿˜äº†æ‰‹åŠ¨æ¸…ç†æè¿°ç¬¦æ± ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanupSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">vkDestroyDescriptorPool</span>(device, descriptorPool, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">recreateSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createUniformBuffers</span>();</span><br><span class="line">    <span class="built_in">createDescriptorPool</span>();</span><br><span class="line">    <span class="built_in">createCommandBuffers</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-æè¿°ç¬¦é›†"><a href="#2-2-æè¿°ç¬¦é›†" class="headerlink" title="2.2 æè¿°ç¬¦é›†"></a>2.2 æè¿°ç¬¦é›†</h2><p>æœ‰äº†æè¿°ç¬¦æ± å°±å¯ä»¥åˆ†é…æè¿°ç¬¦é›†äº†ã€‚ä¸ºæ­¤æ·»åŠ createDescriptorSetså‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkDescriptorPool descriptorPool;</span><br><span class="line">std::vector&lt;VkDescriptorSet&gt; descriptorSets;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createDescriptorPool</span>();</span><br><span class="line">    <span class="built_in">createDescriptorSets</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">recreateSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createDescriptorPool</span>();</span><br><span class="line">    <span class="built_in">createDescriptorSets</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createDescriptorSets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::vector&lt;VkDescriptorSetLayout&gt; <span class="title">layouts</span><span class="params">(swapChainImages.size(), descriptorSetLayout)</span></span>;</span><br><span class="line"></span><br><span class="line">    VkDescriptorSetAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_DESCRIPTOR_SET_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.descriptorPool = descriptorPool;</span><br><span class="line">    allocInfo.descriptorSetCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line">    allocInfo.pSetLayouts = layouts.<span class="built_in">data</span>();</span><br><span class="line">    <span class="comment">// é‡ç½®å¤§å°</span></span><br><span class="line">    descriptorSets.<span class="built_in">resize</span>(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line">    <span class="comment">// å†…å­˜åˆ†é…æè¿°ç¬¦é›†</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkAllocateDescriptorSets</span>(device, &amp;allocInfo, descriptorSets.<span class="built_in">data</span>()) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to allocate descriptor sets!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®æè¿°ç¬¦</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; descriptorSets.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        <span class="comment">// å¼•ç”¨ç¼“å†²åŒºçš„æè¿°ç¬¦ï¼ˆä¾‹å¦‚æˆ‘ä»¬çš„ç»Ÿä¸€ç¼“å†²åŒºæè¿°ç¬¦ï¼‰ä½¿ç”¨VkDescriptorBufferInfoç»“æ„è¿›è¡Œé…ç½®</span></span><br><span class="line">        <span class="comment">// æŒ‡å®šç¼“å†²åŒºä»¥åŠå…¶ä¸­åŒ…å«æè¿°ç¬¦æ•°æ®çš„åŒºåŸŸã€‚</span></span><br><span class="line">        VkDescriptorBufferInfo bufferInfo = &#123;&#125;;</span><br><span class="line">        <span class="comment">// ç»‘å®šç¼“å†²åŒº</span></span><br><span class="line">        bufferInfo.buffer = uniformBuffers[i];</span><br><span class="line">        bufferInfo.offset = <span class="number">0</span>;</span><br><span class="line">        bufferInfo.range = <span class="built_in">sizeof</span>(UniformBufferObject);</span><br><span class="line"></span><br><span class="line">        VkWriteDescriptorSet descriptorWrite = &#123;&#125;;</span><br><span class="line">        descriptorWrite.sType = VK_STRUCTURE_TYPE_WRITE_DESCRIPTOR_SET;</span><br><span class="line">        descriptorWrite.dstSet = descriptorSets[i];</span><br><span class="line">        descriptorWrite.dstBinding = <span class="number">0</span>;</span><br><span class="line">        descriptorWrite.dstArrayElement = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        descriptorWrite.descriptorType = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">        descriptorWrite.descriptorCount = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">        descriptorWrite.pBufferInfo = &amp;bufferInfo;</span><br><span class="line">        descriptorWrite.pImageInfo = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">        descriptorWrite.pTexelBufferView = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åº”ç”¨æè¿°ç¬¦é›†æ›´æ–°</span></span><br><span class="line">        <span class="built_in">vkUpdateDescriptorSets</span>(device, <span class="number">1</span>, &amp;descriptorWrite, <span class="number">0</span>, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æè¿°ç¬¦é›†åˆ†é…ç”¨VkDescriptorSetAllocateInfoç»“æ„æè¿°ã€‚éœ€è¦æŒ‡å®šè¦ä»ä¸­åˆ†é…çš„æè¿°ç¬¦æ± ã€è¦åˆ†é…çš„æè¿°ç¬¦é›†çš„æ•°é‡ä»¥åŠåŸºäºå®ƒä»¬çš„æè¿°ç¬¦å¸ƒå±€ã€‚</p>
<h3 id="2-2-1-VkDescriptorSetAllocateInfo"><a href="#2-2-1-VkDescriptorSetAllocateInfo" class="headerlink" title="2.2.1 VkDescriptorSetAllocateInfo"></a>2.2.1 VkDescriptorSetAllocateInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkDescriptorSetAllocateInfo</span> &#123;</span><br><span class="line">    VkStructureType                 sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                     pNext;</span><br><span class="line">    VkDescriptorPool                descriptorPool;</span><br><span class="line">    <span class="type">uint32_t</span>                        descriptorSetCount;</span><br><span class="line">    <span class="type">const</span> VkDescriptorSetLayout*    pSetLayouts;</span><br><span class="line">&#125; VkDescriptorSetAllocateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sTypeæ˜¯æ­¤ç»“æ„çš„ç±»å‹</li>
<li>pNextæ˜¯NULLæˆ–æŒ‡å‘æ‰©å±•ç‰¹å®šç»“æ„çš„æŒ‡é’ˆ</li>
<li>descriptorPoolæ˜¯ä»ä¸­åˆ†é…é›†åˆçš„æ± </li>
<li>descriptorSetCountç¡®å®šè¦ä»æ± ä¸­åˆ†é…çš„æè¿°ç¬¦é›†çš„æ•°é‡</li>
<li>pSetLayoutsæ˜¯ä¸€ä¸ªæŒ‡å‘æè¿°ç¬¦é›†å¸ƒå±€æ•°ç»„çš„æŒ‡é’ˆï¼Œæ¯ä¸ªæˆå‘˜æŒ‡å®šå¦‚ä½•åˆ†é…ç›¸åº”çš„æè¿°ç¬¦é›†</li>
</ol>
<h3 id="2-2-2-vkAllocateDescriptorSets"><a href="#2-2-2-vkAllocateDescriptorSets" class="headerlink" title="2.2.2 vkAllocateDescriptorSets"></a>2.2.2 vkAllocateDescriptorSets</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkAllocateDescriptorSets</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkDescriptorSetAllocateInfo*          pAllocateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDescriptorSet*                            pDescriptorSets)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: æ‹¥æœ‰æè¿°ç¬¦æ± çš„é€»è¾‘è®¾å¤‡</li>
<li>pAllocateInfo: æŒ‡å‘VkDescriptorSetAllocateInfoç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æè¿°åˆ†é…å‚æ•°</li>
<li>pDescriptorSets: æŒ‡å‘VkDescriptorSetå¥æŸ„æ•°ç»„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥æ•°ç»„ä¸­è¿”å›ç”Ÿæˆçš„æè¿°ç¬¦é›†å¯¹è±¡</li>
</ol>
<p>æ— éœ€æ‰‹åŠ¨æ¸…ç†æè¿°ç¬¦é›†ï¼Œå› ä¸ºåœ¨é”€æ¯æè¿°ç¬¦æ± æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾æè¿°ç¬¦é›†ã€‚ å¯¹vkAllocateDescriptorSetsçš„è°ƒç”¨å°†åˆ†é…æè¿°ç¬¦é›†ï¼Œæ¯ä¸ªæè¿°ç¬¦é›†å…·æœ‰ä¸€ä¸ªç»Ÿä¸€çš„ç¼“å†²åŒºæè¿°ç¬¦ã€‚</p>
<h3 id="2-2-3-VkDescriptorBufferInfo"><a href="#2-2-3-VkDescriptorBufferInfo" class="headerlink" title="2.2.3 VkDescriptorBufferInfo"></a>2.2.3 VkDescriptorBufferInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkDescriptorBufferInfo</span> &#123;</span><br><span class="line">    VkBuffer        buffer;</span><br><span class="line">    VkDeviceSize    offset;</span><br><span class="line">    VkDeviceSize    range;</span><br><span class="line">&#125; VkDescriptorBufferInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>bufferæ˜¯ç¼“å†²åŒºèµ„æº</li>
<li>offsetæ˜¯ä»ç¼“å†²åŒºå¼€å§‹çš„åç§»é‡ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ é€šè¿‡æ­¤æè¿°ç¬¦è®¿é—®ç¼“å†²å­˜å‚¨å™¨å°†ä½¿ç”¨ç›¸å¯¹äºæ­¤èµ·å§‹åç§»é‡çš„å¯»å€</li>
<li>rangeæ˜¯ç”¨äºæ­¤æè¿°ç¬¦æ›´æ–°çš„å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ï¼Œæˆ–è€…æ˜¯VK_WHOLE_SIZEä»¥ä½¿ç”¨ä»åç§»é‡åˆ°ç¼“å†²åŒºæœ«å°¾çš„èŒƒå›´</li>
</ol>
<h3 id="2-2-4-VkWriteDescriptorSet"><a href="#2-2-4-VkWriteDescriptorSet" class="headerlink" title="2.2.4 VkWriteDescriptorSet"></a>2.2.4 VkWriteDescriptorSet</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkWriteDescriptorSet</span> &#123;</span><br><span class="line">    VkStructureType                  sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                      pNext;</span><br><span class="line">    VkDescriptorSet                  dstSet;</span><br><span class="line">    <span class="type">uint32_t</span>                         dstBinding;</span><br><span class="line">    <span class="type">uint32_t</span>                         dstArrayElement;</span><br><span class="line">    <span class="type">uint32_t</span>                         descriptorCount;</span><br><span class="line">    VkDescriptorType                 descriptorType;</span><br><span class="line">    <span class="type">const</span> VkDescriptorImageInfo*     pImageInfo;</span><br><span class="line">    <span class="type">const</span> VkDescriptorBufferInfo*    pBufferInfo;</span><br><span class="line">    <span class="type">const</span> VkBufferView*              pTexelBufferView;</span><br><span class="line">&#125; VkWriteDescriptorSet;</span><br></pre></td></tr></table></figure>
<ol>
<li>sTypeæ˜¯æ­¤ç»“æ„çš„ç±»å‹, VK_STRUCTURE_TYPE_WRITE_DESCRIPTOR_SET</li>
<li>pNextæ˜¯NULLæˆ–æŒ‡å‘æ‰©å±•ç‰¹å®šç»“æ„çš„æŒ‡é’ˆ</li>
<li>dstSetæ˜¯è¦æ›´æ–°çš„ç›®æ ‡æè¿°ç¬¦é›†</li>
<li>dstBindingæ˜¯è¯¥é›†åˆå†…çš„æè¿°ç¬¦ç»‘å®š</li>
<li>dstArrayElementæ˜¯è¯¥æ•°ç»„ä¸­çš„èµ·å§‹å…ƒç´ ã€‚å¦‚æœç”±dstSetå’ŒdstBindingæ ‡è¯†çš„æè¿°ç¬¦ç»‘å®šçš„æè¿°ç¬¦ç±»å‹ä¸ºVK_DESCRIPTOR_TYPE_INLINE_UNIFORM_BLOCK_EXTï¼Œåˆ™dstArrayElementæŒ‡å®šç»‘å®šå†…çš„èµ·å§‹å­—èŠ‚åç§»é‡</li>
<li>descriptorCountæ˜¯è¦æ›´æ–°çš„æè¿°ç¬¦çš„æ•°é‡ï¼ˆpImageInfoï¼ŒpBufferInfoæˆ–pTexelBufferViewä¸­çš„å…ƒç´ æ•°é‡ï¼Œæˆ–è€…ä¸pNexté“¾ä¸­çš„VkWriteDescriptorSetInlineUniformBlockEXTç»“æ„çš„dataSizeæˆå‘˜åŒ¹é…çš„å€¼ï¼Œæˆ–è€…ä¸pNextä¸­çš„VkWriteDescriptorSetAccelerationStructureNVç»“æ„çš„AccelerationStructureCountåŒ¹é…çš„å€¼ã€‚é“¾ ï¼‰ã€‚å¦‚æœç”±dstSetå’ŒdstBindingæ ‡è¯†çš„æè¿°ç¬¦ç»‘å®šçš„æè¿°ç¬¦ç±»å‹ä¸ºVK_DESCRIPTOR_TYPE_INLINE_UNIFORM_BLOCK_EXTï¼Œåˆ™æè¿°ç¬¦è®¡æ•°æŒ‡å®šè¦æ›´æ–°çš„å­—èŠ‚æ•°</li>
<li>descriptorTypeæ˜¯VkDescriptorTypeï¼Œç”¨äºæŒ‡å®špImageInfoï¼ŒpBufferInfoæˆ–pTexelBufferViewä¸­æ¯ä¸ªæè¿°ç¬¦çš„ç±»å‹ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚å®ƒå¿…é¡»ä¸åœ¨dstBindingä¸­ä¸ºdstSetçš„VkDescriptorSetLayoutBindingä¸­æŒ‡å®šçš„ç±»å‹ç›¸åŒã€‚æè¿°ç¬¦çš„ç±»å‹è¿˜æ§åˆ¶æè¿°ç¬¦ä»å“ªä¸ªæ•°ç»„è·å–</li>
<li>pImageInfoæ˜¯æŒ‡å‘VkDescriptorImageInfoç»“æ„æ•°ç»„çš„æŒ‡é’ˆ</li>
<li>pBufferInfoæ˜¯æŒ‡å‘VkDescriptorBufferInfoç»“æ„æ•°ç»„çš„æŒ‡é’ˆ</li>
<li>pTexelBufferViewæ˜¯æŒ‡å‘VkBufferViewå¥æŸ„æ•°ç»„çš„æŒ‡é’ˆ</li>
</ol>
<h3 id="2-2-5-vkUpdateDescriptorSets"><a href="#2-2-5-vkUpdateDescriptorSets" class="headerlink" title="2.2.5 vkUpdateDescriptorSets"></a>2.2.5 vkUpdateDescriptorSets</h3><p>å†…å­˜åˆ†é…åï¼Œæè¿°ç¬¦é›†å¯ä»¥ä½¿ç”¨å†™å’Œå¤åˆ¶æ“ä½œçš„ç»„åˆè¿›è¡Œæ›´æ–°ã€‚ è¦æ›´æ–°æè¿°ç¬¦é›†ï¼Œè°ƒç”¨ï¼švkUpdateDescriptorSets</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkUpdateDescriptorSets</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    descriptorWriteCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkWriteDescriptorSet*                 pDescriptorWrites,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    descriptorCopyCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkCopyDescriptorSet*                  pDescriptorCopies)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>deviceæ˜¯æ›´æ–°æè¿°ç¬¦é›†çš„é€»è¾‘è®¾å¤‡</li>
<li>descriptorWriteCountæ˜¯pDescriptorWritesæ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡</li>
<li>pDescriptorWritesæ˜¯æŒ‡å‘VkWriteDescriptorSetç»“æ„æ•°ç»„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æè¿°äº†è¦å†™å…¥çš„æè¿°ç¬¦é›†</li>
<li>descriptorCopyCountæ˜¯pDescriptorCopiesæ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡</li>
<li>pDescriptorCopiesæ˜¯æŒ‡å‘VkCopyDescriptorSetç»“æ„æ•°ç»„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æè¿°äº†è¦åœ¨å…¶é—´å¤åˆ¶çš„æè¿°ç¬¦é›†</li>
</ol>
<h2 id="2-3-ä½¿ç”¨æè¿°ç¬¦é›†"><a href="#2-3-ä½¿ç”¨æè¿°ç¬¦é›†" class="headerlink" title="2.3 ä½¿ç”¨æè¿°ç¬¦é›†"></a>2.3 ä½¿ç”¨æè¿°ç¬¦é›†</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°createCommandBufferså‡½æ•°ï¼Œä»¥å°†æ¯ä¸ªäº¤æ¢é“¾å›¾åƒçš„æ­£ç¡®æè¿°ç¬¦é›†å®é™…ç»‘å®šåˆ°å…·æœ‰cmdBindDescriptorSetsçš„ç€è‰²å™¨ä¸­çš„æè¿°ç¬¦ã€‚ </p>
<p>éœ€è¦åœ¨vkCmdDrawIndexedè°ƒç”¨ä¹‹å‰å®Œæˆï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vkCmdBindDescriptorSets</span>(commandBuffers[i], VK_PIPELINE_BIND_POINT_GRAPHICS, pipelineLayout, <span class="number">0</span>, <span class="number">1</span>, &amp;descriptorSets[i], <span class="number">0</span>, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="built_in">vkCmdDrawIndexed</span>(commandBuffers[i], <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(indices.<span class="built_in">size</span>()), <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>ä¸é¡¶ç‚¹å’Œç´¢å¼•ç¼“å†²åŒºä¸åŒï¼Œæè¿°ç¬¦é›†ä¸æ˜¯å›¾å½¢ç®¡çº¿æ‰€ç‹¬æœ‰çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šæ˜¯å¦è¦å°†æè¿°ç¬¦é›†ç»‘å®šåˆ°å›¾å½¢æˆ–è®¡ç®—ç®¡é“â€“vkCmdBindDescriptorSetsã€‚</p>
<p>ç°åœ¨è¿è¡Œç¨‹åºï¼Œæ˜¯çœ‹ä¸åˆ°ä»»ä½•å†…å®¹çš„ã€‚é—®é¢˜åœ¨äºï¼Œç”±äºæˆ‘ä»¬åœ¨æŠ•å½±çŸ©é˜µä¸­è¿›è¡Œäº†Yç¿»è½¬ï¼Œå› æ­¤ç°åœ¨ä»¥é¡ºæ—¶é’ˆé¡ºåºè€Œä¸æ˜¯é€†æ—¶é’ˆé¡ºåºç»˜åˆ¶äº†é¡¶ç‚¹ã€‚è¿™å°†å¯¼è‡´èƒŒé¢å‰”é™¤ï¼Œå¹¶é˜»æ­¢ç»˜åˆ¶ä»»ä½•å‡ ä½•å›¾å½¢ã€‚</p>
<p>åœ¨createGraphicsPipelineå‡½æ•°ä¸­VkPipelineRasterizationStateCreateInfoä¸­ä¿®æ”¹frontFaceæ¥æ›´æ­£æ­¤é—®é¢˜ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">rasterizer.cullMode = VK_CULL_MODE_BACK_BIT;</span><br><span class="line">rasterizer.frontFace = VK_FRONT_FACE_COUNTER_CLOCKWISE;</span><br></pre></td></tr></table></figure>

<p>frontFaceæ˜¯VkFrontFaceç»“æ„ä½“å†…çš„ç±»å‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkFrontFace</span> &#123;</span><br><span class="line">    VK_FRONT_FACE_COUNTER_CLOCKWISE = <span class="number">0</span>,</span><br><span class="line">    VK_FRONT_FACE_CLOCKWISE = <span class="number">1</span>,</span><br><span class="line">    VK_FRONT_FACE_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkFrontFace;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_FRONT_FACE_COUNTER_CLOCKWISE æŒ‡å®šå…·æœ‰æ­£é¢ç§¯çš„ä¸‰è§’å½¢è¢«è®¤ä¸ºæ˜¯æœå‰çš„</li>
<li>VK_FRONT_FACE_CLOCKWISE æŒ‡å®šå…·æœ‰è´Ÿé¢ç§¯çš„ä¸‰è§’å½¢è¢«è®¤ä¸ºæ˜¯æœå‰çš„</li>
</ol>
<p>å¦‚ä½•è®¡ç®—é¢ç§¯çš„æ­£è´Ÿï¼Œåç»­ç ”ç©¶ã€‚ç°åœ¨è¿è¡Œç¨‹åºå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„å›¾åƒåœ¨æ²¿ç€é€†æ—¶é’ˆæ—‹è½¬~</p>
<h3 id="2-3-1-vkCmdBindDescriptorSets"><a href="#2-3-1-vkCmdBindDescriptorSets" class="headerlink" title="2.3.1 vkCmdBindDescriptorSets"></a>2.3.1 vkCmdBindDescriptorSets</h3><p>ç»‘å®šæè¿°ç¬¦é›†è°ƒç”¨ vkCmdBindDescriptorSets:<br>ä¸€ä¸ªå‚æ•°æ˜¯æè¿°ç¬¦æ‰€åŸºäºçš„å¸ƒå±€ã€‚æ¥ä¸‹æ¥çš„ä¸‰ä¸ªå‚æ•°æŒ‡å®šç¬¬ä¸€ä¸ªæè¿°ç¬¦é›†çš„ç´¢å¼•ï¼Œè¦ç»‘å®šçš„é›†çš„æ•°é‡ä»¥åŠè¦ç»‘å®šçš„é›†çš„æ•°ç»„ã€‚æˆ‘ä»¬å¾…ä¼šå„¿å†è®²è¿™ä¸ªã€‚æœ€åä¸¤ä¸ªå‚æ•°æŒ‡å®šç”¨äºåŠ¨æ€æè¿°ç¬¦çš„åç§»é‡æ•°ç»„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdBindDescriptorSets</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkPipelineBindPoint                         pipelineBindPoint,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkPipelineLayout                            layout,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstSet,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    descriptorSetCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkDescriptorSet*                      pDescriptorSets,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    dynamicOffsetCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> <span class="type">uint32_t</span>*                             pDynamicOffsets)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBufferæ˜¯æè¿°ç¬¦é›†å°†ç»‘å®šåˆ°çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>pipelineBindPointæ˜¯ä¸€ä¸ªVkPipelineBindPointï¼Œå®ƒæŒ‡ç¤ºæè¿°ç¬¦æ˜¯ç”±å›¾å½¢ç®¡çº¿è¿˜æ˜¯ç”±è®¡ç®—ç®¡çº¿ä½¿ç”¨ã€‚ æ¯ä¸ªå›¾å½¢å’Œè®¡ç®—éƒ½æœ‰ä¸€ç»„å•ç‹¬çš„ç»‘å®šç‚¹ï¼Œå› æ­¤ç»‘å®šä¸€ä¸ªä¸ä¼šå¹²æ‰°å¦ä¸€ä¸ª</li>
<li>layoutæ˜¯ä¸€ä¸ªVkPipelineLayoutå¯¹è±¡ï¼Œç”¨äºå¯¹ç»‘å®šè¿›è¡Œç¼–ç¨‹</li>
<li>firstSetæ˜¯è¦ç»‘å®šçš„ç¬¬ä¸€ä¸ªæè¿°ç¬¦é›†çš„é›†å·</li>
<li>descriptorSetCountæ˜¯pDescriptorSetsæ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡</li>
<li>pDescriptorSetsæ˜¯æŒ‡å‘VkDescriptorSetå¯¹è±¡çš„å¥æŸ„æ•°ç»„çš„æŒ‡é’ˆï¼Œè¯¥å¯¹è±¡æè¿°äº†è¦å†™å…¥çš„æè¿°ç¬¦é›†</li>
<li>dynamicOffsetCountæ˜¯pDynamicOffsetsæ•°ç»„ä¸­çš„åŠ¨æ€åç§»é‡</li>
<li>pDynamicOffsetsæ˜¯æŒ‡å‘æŒ‡å®šåŠ¨æ€åç§»é‡çš„uint32_tå€¼æ•°ç»„çš„æŒ‡é’ˆ</li>
</ol>
<p>vkCmdBindDescriptorSetså¯¼è‡´ç¼–å·ä¸º[firstSet..firstSet + descriptorSetCount-1]çš„é›†åˆä½¿ç”¨å­˜å‚¨åœ¨pDescriptorSets [0..descriptorSetCount-1]ä¸­çš„ç»‘å®šç”¨äºåç»­æ¸²æŸ“å‘½ä»¤ï¼ˆæ ¹æ®pipelineBindPointè®¡ç®—æˆ–å›¾å½¢ï¼‰ã€‚ä»¥å‰é€šè¿‡è¿™äº›é›†åˆåº”ç”¨çš„ä»»ä½•ç»‘å®šéƒ½ä¸å†æœ‰æ•ˆã€‚</p>
<p>ç»‘å®šåï¼Œæè¿°ç¬¦é›†ä¼šå½±å“å‘½ä»¤ç¼“å†²åŒºä¸­åç»­å›¾å½¢æˆ–è®¡ç®—å‘½ä»¤çš„æ¸²æŸ“ï¼Œç›´åˆ°å°†ä¸åŒçš„é›†ç»‘å®šåˆ°ç›¸åŒçš„é›†ç¼–å·ï¼Œæˆ–è€…ç›´åˆ°è¯¥é›†å—åˆ°å¹²æ‰°ï¼ˆå¦‚ç®¡çº¿å¸ƒå±€å…¼å®¹æ€§ä¸­æ‰€è¿°ï¼‰ä¸ºæ­¢ã€‚</p>
<p>åœ¨è®°å½•ç»˜åˆ¶æˆ–åˆ†æ´¾å‘½ä»¤ä»¥ä½¿ç”¨è¯¥ç®¡é“æ‰§è¡Œæ—¶ï¼Œå¿…é¡»ä¸ºç®¡é“ä¸­ä»»ä½•ç€è‰²å™¨è®¿é—®çš„æ‰€æœ‰è®¾å®šç¼–å·ç»‘å®šä¸€ä¸ªå…¼å®¹çš„æè¿°ç¬¦é›†ã€‚ä½†æ˜¯ï¼Œå¦‚æœç®¡é“ä¸­çš„æ‰€æœ‰ç€è‰²å™¨éƒ½ä¸é™æ€ä½¿ç”¨å…·æœ‰ç‰¹å®šé›†åˆå·çš„ä»»ä½•ç»‘å®šï¼Œåˆ™å³ä½¿è¯¥ç®¡é“ç¼–å·åŒ…æ‹¬è¯¥é›†åˆå·çš„éå¹³å‡¡æè¿°ç¬¦é›†åˆå¸ƒå±€ï¼Œä¹Ÿä¸éœ€è¦ä¸ºè¯¥é›†åˆå·ç»‘å®šä»»ä½•æè¿°ç¬¦é›†ã€‚</p>
<p>å¦‚æœè¦ç»‘å®šçš„ä»»ä½•é›†åˆåŒ…æ‹¬åŠ¨æ€ç»Ÿä¸€ç¼“å†²åŒºæˆ–å­˜å‚¨ç¼“å†²åŒºï¼Œåˆ™pDynamicOffsetsä¼šä¸ºæ¯ä¸ªé›†åˆä¸­æ¯ä¸ªåŠ¨æ€æè¿°ç¬¦ç±»å‹ç»‘å®šä¸­çš„æ¯ä¸ªæ•°ç»„å…ƒç´ åŒ…å«ä¸€ä¸ªå…ƒç´ ã€‚ä»pDynamicOffsetsä¸­è·å–å€¼çš„é¡ºåºæ˜¯ï¼šé›†åˆNçš„æ‰€æœ‰æ¡ç›®éƒ½åœ¨é›†åˆN + 1ä¹‹å‰ï¼›åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œæ¡ç›®æŒ‰æè¿°ç¬¦é›†åˆå¸ƒå±€ä¸­çš„ç»‘å®šå·æ’åºï¼›åœ¨ç»‘å®šæ•°ç»„ä¸­ï¼Œå…ƒç´ æ˜¯æœ‰åºçš„ã€‚ dynamicOffsetCountå¿…é¡»ç­‰äºè¦ç»‘å®šçš„é›†åˆä¸­åŠ¨æ€æè¿°ç¬¦çš„æ€»æ•°ã€‚</p>
<p>ç”¨äºåŠ¨æ€ç»Ÿä¸€å’Œå­˜å‚¨ç¼“å†²åŒºç»‘å®šçš„æœ‰æ•ˆåç§»é‡æ˜¯ä»pDynamicOffsetsè·å–çš„ç›¸å¯¹åç§»é‡ä¸ç¼“å†²åŒºçš„åŸºåœ°å€åŠ æè¿°ç¬¦é›†ä¸­çš„åŸºæœ¬åç§»é‡ä¹‹å’Œã€‚åŠ¨æ€ç»Ÿä¸€å’Œå­˜å‚¨ç¼“å†²åŒºç»‘å®šçš„èŒƒå›´æ˜¯æè¿°ç¬¦é›†ä¸­æŒ‡å®šçš„ç¼“å†²åŒºèŒƒå›´ã€‚</p>
<p>æ¯ä¸ªpDescriptorSetéƒ½å¿…é¡»ä¸layoutæŒ‡å®šçš„ç®¡é“å¸ƒå±€å…¼å®¹ã€‚ç”¨äºç¼–ç¨‹ç»‘å®šçš„å¸ƒå±€è¿˜å¿…é¡»ä¸åç»­å›¾å½¢æˆ–è®¡ç®—å‘½ä»¤ä¸­ä½¿ç”¨çš„ç®¡çº¿å…¼å®¹ï¼Œå¦‚â€œç®¡çº¿å¸ƒå±€å…¼å®¹æ€§â€éƒ¨åˆ†ä¸­æ‰€å®šä¹‰ã€‚</p>
<p>è°ƒç”¨vkCmdBindDescriptorSetsç»‘å®šçš„æè¿°ç¬¦é›†å†…å®¹å¯èƒ½åœ¨ä»¥ä¸‹æ—¶é—´ä½¿ç”¨ï¼š</p>
<ol>
<li>å¯¹äºä½¿ç”¨VK_DESCRIPTOR_BINDING_UPDATE_AFTER_BIND_BITä½ç½®1åˆ›å»ºçš„æè¿°ç¬¦ç»‘å®šï¼Œåœ¨å°†å‘½ä»¤ç¼“å†²åŒºæäº¤åˆ°é˜Ÿåˆ—æ—¶ï¼Œåœ¨ç€è‰²å™¨æ‰§è¡Œç»“æœç»˜åˆ¶å’Œè°ƒåº¦æ—¶æˆ–åœ¨ä¸¤è€…ä¹‹é—´çš„ä»»ä½•æ—¶é—´ï¼Œå†…å®¹éƒ½å¯èƒ½è¢«æ¶ˆè€—ã€‚</li>
<li>åœ¨å‘½ä»¤çš„ä¸»æœºæ‰§è¡ŒæœŸé—´ï¼Œæˆ–åœ¨ç€è‰²å™¨æ‰§è¡Œç»“æœç»˜åˆ¶å’Œæ´¾å‘æœŸé—´ï¼Œæˆ–ä¹‹é—´çš„ä»»ä½•æ—¶é—´ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œåœ¨æè¿°ç¬¦é›†åˆç»‘å®šçš„å†…å®¹å¯èƒ½è¢«æ¶ˆè€—çš„ç¬¬ä¸€ä¸ªæ—¶é—´ç‚¹å’Œè¯¥å‘½ä»¤åœ¨é˜Ÿåˆ—ä¸Šå®Œæˆæ‰§è¡Œä¹‹é—´ï¼Œä¸å¾—æ›´æ”¹ï¼ˆç”±æ›´æ–°å‘½ä»¤è¦†ç›–æˆ–é‡Šæ”¾ï¼‰æè¿°ç¬¦é›†ç»‘å®šçš„å†…å®¹ã€‚</p>
<p>åœ¨æ‰§è¡ŒvkCmdBindDescriptorSetsæ—¶ï¼ŒpDynamicOffsetsçš„å†…å®¹å°†ç«‹å³æ¶ˆè€—ã€‚ä¸€æ—¦æ‰€æœ‰å¾…å®šç”¨é€”éƒ½å·²å®Œæˆï¼Œå°±å¯ä»¥æ›´æ–°å’Œé‡ç”¨æè¿°ç¬¦é›†ã€‚</p>
<h1 id="ä¸‰-æ€»ç»“"><a href="#ä¸‰-æ€»ç»“" class="headerlink" title="ä¸‰. æ€»ç»“"></a>ä¸‰. æ€»ç»“</h1><p>æè¿°ç¬¦çš„ä½¿ç”¨åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>åœ¨ç®¡é“åˆ›å»ºæœŸé—´æŒ‡å®šæè¿°ç¬¦å¸ƒå±€</li>
<li>ä»æè¿°ç¬¦æ± åˆ†é…æè¿°ç¬¦é›†</li>
<li>æ¸²æŸ“æœŸé—´ç»‘å®šæè¿°ç¬¦é›†</li>
</ol>
<p>æ‰€è°“æè¿°ç¬¦ï¼Œå°±æ˜¯ç”¨æ¥æè¿°ç€è‰²å™¨èµ„æºçš„ä¸é€æ˜æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ç¼“å†²åŒºã€ç¼“å†²åŒºè§†å›¾ã€å›¾åƒè§†å›¾ã€é‡‡æ ·å™¨æˆ–ç»„åˆå›¾åƒé‡‡æ ·å™¨ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•ä¸€äº›æ›´è®©äººæ¿€åŠ¨çš„ä¸œè¥¿â€“è´´å›¾ã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(14)-VkImageå›¾åƒçš„åˆ›å»º</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-14-VkImage%E5%9B%BE%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>åœ¨ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨é¡¶ç‚¹ç€è‰²å™¨ä»¥åŠæè¿°ç¬¦æ¥å®ç°ç»˜åˆ¶æœ‰é¢œè‰²çš„å‡ ä½•ä½“ï¼Œè¿˜å®ç°äº†æ—‹è½¬åŠ¨ç”»ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å­¦ä¹ ä¸€ä¸‹çº¹ç†è´´å›¾ï¼Œè¿™ä¸ªå°†æ˜¯æˆ‘ä»¬å®ç°åŠ è½½ç»˜åˆ¶åŸºæœ¬3Dæ¨¡å‹çš„åŸºç¡€ã€‚</p>
<span id="more"></span>

<p>æ·»åŠ çº¹ç†çš„åŸºæœ¬æ­¥éª¤æœ‰:</p>
<ol>
<li>åˆ›å»ºç”±è®¾å¤‡å†…å­˜æ”¯æŒçš„å›¾åƒå¯¹è±¡</li>
<li>ç”¨å›¾åƒæ–‡ä»¶ä¸­çš„åƒç´ å¡«å……åˆ›å»ºçš„å›¾åƒå¯¹è±¡</li>
<li>åˆ›å»ºå›¾åƒé‡‡æ ·å™¨</li>
<li>æ·»åŠ ä¸€ä¸ªç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦æ¥ä»çº¹ç†ä¸­é‡‡æ ·é¢œè‰²</li>
</ol>
<p>æˆ‘ä»¬ä»¥å‰å·²ç»ä½¿ç”¨è¿‡å›¾åƒå¯¹è±¡ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡æ˜¯ç”±swap chainæ‰©å±•è‡ªåŠ¨åˆ›å»ºçš„ã€‚è¿™æ¬¡éœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼Œåˆ›å»ºå›¾åƒå¹¶å¡«å……æ•°æ®ç±»ä¼¼äºåˆ›å»ºé¡¶ç‚¹ç¼“å†²åŒºã€‚æˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºä¸€ä¸ªæš‚å­˜èµ„æºå’Œå¡«å……å®ƒä¸åƒç´ æ•°æ®ï¼Œç„¶åæˆ‘ä»¬å¤åˆ¶è¿™åˆ°æˆ‘ä»¬å°†ç”¨äºæ¸²æŸ“çš„æœ€ç»ˆå›¾åƒå¯¹è±¡ã€‚</p>
<p>å¯ä»¥åˆ›å»ºä¸€ä¸ªæš‚å­˜å›¾åƒï¼Œä¸è¿‡Vulkanå…è®¸å°†åƒç´ ä»VkBufferå¤åˆ¶åˆ°imageä¸­ï¼Œè€Œä¸”è¿™ä¸ªAPIåœ¨æŸäº›ç¡¬ä»¶ä¸Šå®é™…ä¸Šæ›´å¿«ã€‚æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºè¿™ä¸ªç¼“å†²åŒºå¹¶å¡«å……åƒç´ å€¼ï¼Œç„¶åæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå›¾åƒå¤åˆ¶åƒç´ åˆ°ã€‚åˆ›å»ºimageä¸åˆ›å»ºç¼“å†²åŒºå¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒã€‚å®ƒåŒ…æ‹¬æŸ¥è¯¢å†…å­˜éœ€æ±‚ã€åˆ†é…è®¾å¤‡å†…å­˜å¹¶ç»‘å®šå®ƒï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é‚£æ ·ã€‚</p>
<p>å›¾åƒå¯ä»¥æœ‰ä¸åŒçš„å¸ƒå±€ï¼Œå½±å“åƒç´ åœ¨å†…å­˜ä¸­çš„å­˜å‚¨æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œç”±äºå›¾å½¢ç¡¬ä»¶çš„å·¥ä½œæ–¹å¼ï¼Œç®€å•åœ°é€è¡Œå­˜å‚¨åƒç´ å¯èƒ½ä¸ä¼šå¸¦æ¥æœ€å¥½çš„æ€§èƒ½ã€‚å½“å¯¹å›¾åƒæ‰§è¡Œä»»ä½•æ“ä½œæ—¶ï¼Œç¡®ä¿å®ƒä»¬å…·æœ‰åœ¨è¯¥æ“ä½œä¸­ä½¿ç”¨çš„æœ€ä½³å¸ƒå±€ã€‚æ¯”å¦‚æŒ‡å®šæ¸²æŸ“é€šé“æ—¶å…¶ä¸­ä¸€äº›å¸ƒå±€æœ‰:</p>
<ol>
<li>VK_IMAGE_LAYOUT_PRESENT_SRC_KHR: é€‚åˆå‘ˆç°ï¼ˆpresentï¼‰</li>
<li>VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL:ç‰‡æ®µç€è‰²å™¨ä¸­å†™å…¥é¢œè‰²çš„æœ€ä½³é™„ä»¶</li>
<li>VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL: ä½œä¸ºä¼ è¾“æ“ä½œçš„æœ€ä½³æºï¼Œå¦‚vkCmdCopyImageToBuffer</li>
<li>VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL: ä½œä¸ºä¼ è¾“æ“ä½œçš„æœ€ä½³ç›®çš„åœ°ï¼Œå¦‚vkCmdCopyBufferToImage</li>
<li>VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL: é€‚åˆç€è‰²å™¨é‡‡æ ·</li>
</ol>
<p>è½¬æ¢å›¾åƒå¸ƒå±€çš„æœ€å¸¸è§æ–¹æ³•ä¹‹ä¸€æ˜¯ç®¡é“å±éšœï¼ˆpipeline barrierï¼‰ã€‚ç®¡é“å±éšœä¸»è¦ç”¨äºåŒæ­¥å¯¹èµ„æºçš„è®¿é—®ï¼Œä¾‹å¦‚ç¡®ä¿åœ¨è¯»å–å›¾åƒä¹‹å‰å°†å…¶å†™å…¥ã€‚åé¢æˆ‘ä»¬å°†äº†è§£å¦‚ä½•å°†ç®¡é“å£å’ç”¨äºè½¬æ¢å¸ƒå±€ã€‚</p>
<p>ä½¿ç”¨VK_SHARING_MODE_EXCLUSIVEæ—¶ï¼Œå¯ä»¥å¦å¤–ä½¿ç”¨å±éšœæ¥è½¬ç§»é˜Ÿåˆ—ç³»åˆ—çš„æ‰€æœ‰æƒã€‚</p>
<h1 id="ä¸€-çº¹ç†è´´å›¾"><a href="#ä¸€-çº¹ç†è´´å›¾" class="headerlink" title="ä¸€. çº¹ç†è´´å›¾"></a>ä¸€. çº¹ç†è´´å›¾</h1><h2 id="1-1-å›¾åƒåº“"><a href="#1-1-å›¾åƒåº“" class="headerlink" title="1.1 å›¾åƒåº“"></a>1.1 å›¾åƒåº“</h2><p>æœ‰è®¸å¤šåº“å¯ç”¨äºåŠ è½½å›¾åƒï¼Œæ‚¨ç”šè‡³å¯ä»¥ç¼–å†™è‡ªå·±çš„ä»£ç æ¥åŠ è½½BMPå’ŒPPMç­‰ç®€å•æ ¼å¼ã€‚ è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨stbé›†åˆä¸­çš„stb_imageåº“ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯æ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå› æ­¤ä¸éœ€è¦ä»»ä½•æ£˜æ‰‹çš„æ„å»ºé…ç½®ã€‚ ä¸‹è½½stb_image.hå¹¶å°†å…¶å­˜å‚¨åœ¨æ–¹ä¾¿çš„ä½ç½®ï¼Œä¾‹å¦‚ä¿å­˜GLFWå’ŒGLMçš„ç›®å½•ã€‚ å°†ä½ç½®æ·»åŠ åˆ°æ‚¨çš„åŒ…å«è·¯å¾„ã€‚</p>
<p>stb_imageåº“åœ°å€: <a href="https://github.com/nothings/stb">https://github.com/nothings/stb</a></p>
<p>ä¸‹è½½åè§£å‹ï¼Œæ”¾åœ¨æŒ‡å®šç›®å½•ï¼Œç„¶åä¿®æ”¹æˆ‘ä»¬çš„Makefileæ–‡ä»¶ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">VULKAN_SDK_PATH = /home/jh/Program/vulkan/1.2.170.0/x86_64</span><br><span class="line">STB_IMAGE_PATH = /home/jh/Program/stb-image</span><br><span class="line"></span><br><span class="line">CFLAGS = -std=c++17 -I<span class="variable">$(VULKAN_SDK_PATH)</span>/<span class="keyword">include</span> -I<span class="variable">$(STB_IMAGE_PATH)</span></span><br></pre></td></tr></table></figure>

<h2 id="1-1-è¯»å–å›¾ç‰‡"><a href="#1-1-è¯»å–å›¾ç‰‡" class="headerlink" title="1.1 è¯»å–å›¾ç‰‡"></a>1.1 è¯»å–å›¾ç‰‡</h2><p>åœ¨shadersç›®å½•æ—è¾¹åˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•texturesæ¥å­˜å‚¨çº¹ç†å›¾åƒï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-14-VkImage%E5%9B%BE%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA/texture.jpg" alt="texture"></p>
<p>é¦–å…ˆæ·»åŠ å¤´æ–‡ä»¶:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> STB_IMAGE_IMPLEMENTATION</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stb_image.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤´æ–‡ä»¶åªå®šä¹‰å‡½æ•°çš„åŸå‹ã€‚ä¸€ä¸ªä»£ç æ–‡ä»¶éœ€è¦åŒ…å«STB_IMAGE_IMPLEMENTATIONå®šä¹‰çš„å¤´æ–‡ä»¶æ¥åŒ…å«å‡½æ•°ä½“ï¼Œå¦åˆ™ä¼šæœ‰é“¾æ¥é”™è¯¯ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createCommandPool</span>();</span><br><span class="line">    <span class="comment">// å› ä¸ºéœ€è¦ä½¿ç”¨æŒ‡ä»¤ç¼“å†²ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºæŒ‡ä»¤æ± ä¹‹åè°ƒç”¨</span></span><br><span class="line">    <span class="built_in">createTextureImage</span>();</span><br><span class="line">    <span class="built_in">createVertexBuffer</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createTextureImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> texWidth, texHeight, texChannels;</span><br><span class="line">    <span class="comment">// åŠ è½½texture.jpgå›¾åƒ</span></span><br><span class="line">    stbi_uc* pixels = <span class="built_in">stbi_load</span>(<span class="string">&quot;textures/texture.jpg&quot;</span>, &amp;texWidth, &amp;texHeight, &amp;texChannels, STBI_rgb_alpha);</span><br><span class="line">    <span class="comment">// æ¯ä¸ªåƒç´ 4ä¸ªå­—èŠ‚</span></span><br><span class="line">    VkDeviceSize imageSize = texWidth * texHeight * <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> (!pixels) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to load texture image!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>stbi_loadå‡½æ•°å°†æ–‡ä»¶è·¯å¾„å’Œè¦åŠ è½½çš„é€šé“æ•°é‡ä½œä¸ºå‚æ•°ã€‚STBI_rgb_alphaå€¼ä¼šå¼ºåˆ¶ä¸ºå›¾åƒåŠ è½½Alphaé€šé“ï¼Œå³ä½¿å®ƒæ²¡æœ‰é€šé“ä¹Ÿæ˜¯å¦‚æ­¤, ä¸å…¶ä»–çº¹ç†ä¿æŒä¸€è‡´æ€§ã€‚ä¸­é—´çš„ä¸‰ä¸ªå‚æ•°æ˜¯è¾“å‡ºå›¾åƒä¸­é€šé“çš„å®½åº¦ã€é«˜åº¦å’Œå®é™…æ•°é‡ã€‚è¿”å›çš„æŒ‡é’ˆæ˜¯åƒç´ å€¼æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚åœ¨STBI_rgba_alphaä¸­ï¼Œåƒç´ é€è¡Œæ’åˆ—ï¼Œæ¯ä¸ªåƒç´ 4ä¸ªå­—èŠ‚ï¼Œæ€»å…±texWidth * texHeight * 4ä¸ªå€¼ã€‚</p>
<h2 id="1-2-ç¼“å­˜è¯»å–çš„å›¾ç‰‡"><a href="#1-2-ç¼“å­˜è¯»å–çš„å›¾ç‰‡" class="headerlink" title="1.2 ç¼“å­˜è¯»å–çš„å›¾ç‰‡"></a>1.2 ç¼“å­˜è¯»å–çš„å›¾ç‰‡</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨ä¸»æœºå¯è§å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨vkMapMemoryå¹¶å°†åƒç´ å¤åˆ¶åˆ°å…¶ä¸­ã€‚ å°†æ­¤ä¸´æ—¶ç¼“å†²åŒºçš„å˜é‡æ·»åŠ åˆ°createTextureImageå‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createTextureImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> texWidth, texHeight, texChannels;</span><br><span class="line">    <span class="comment">// åŠ è½½texture.jpgå›¾åƒ</span></span><br><span class="line">    stbi_uc* pixels = <span class="built_in">stbi_load</span>(<span class="string">&quot;textures/texture.jpg&quot;</span>, &amp;texWidth, &amp;texHeight, &amp;texChannels, STBI_rgb_alpha);</span><br><span class="line">    <span class="comment">// æ¯ä¸ªåƒç´ 4ä¸ªå­—èŠ‚</span></span><br><span class="line">    VkDeviceSize imageSize = texWidth * texHeight * <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> (!pixels) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to load texture image!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    VkBuffer stagingBuffer;</span><br><span class="line">    VkDeviceMemory stagingBufferMemory;</span><br><span class="line">    <span class="comment">// ç¼“å†²åŒºåº”è¯¥åœ¨ä¸»æœºå¯è§å†…å­˜ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ˜ å°„å®ƒï¼Œå¹¶ä¸”å®ƒåº”è¯¥å¯ç”¨ä½œä¼ è¾“æºï¼Œä»¥ä¾¿æˆ‘ä»¬ä»¥åå¯ä»¥å¤åˆ¶</span></span><br><span class="line">    <span class="built_in">createBuffer</span>(imageSize, VK_BUFFER_USAGE_TRANSFER_SRC_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT |</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_COHERENT_BIT, stagingBuffer,</span><br><span class="line">            stagingBufferMemory);</span><br><span class="line">    <span class="comment">// å†…å­˜æ˜ å°„</span></span><br><span class="line">    <span class="type">void</span>* data;</span><br><span class="line">    <span class="built_in">vkMapMemory</span>(device, stagingBufferMemory, <span class="number">0</span>, imageSize, <span class="number">0</span>, &amp;data);</span><br><span class="line">    <span class="built_in">memcpy</span>(data, pixels, <span class="built_in">static_cast</span>&lt;<span class="type">size_t</span>&gt;(imageSize));</span><br><span class="line">    <span class="built_in">vkUnmapMemory</span>(device, stagingBufferMemory);</span><br><span class="line">    <span class="comment">// æœ€åé‡Šæ”¾åŸå§‹åƒç´ æ•°æ®</span></span><br><span class="line">    <span class="built_in">stbi_image_free</span>(pixels);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-3-çº¹ç†å›¾åƒ-Texture-Image"><a href="#1-3-çº¹ç†å›¾åƒ-Texture-Image" class="headerlink" title="1.3 çº¹ç†å›¾åƒ(Texture Image)"></a>1.3 çº¹ç†å›¾åƒ(Texture Image)</h2><p>å°½ç®¡æˆ‘ä»¬å¯ä»¥è®¾ç½®ç€è‰²å™¨æ¥è®¿é—®ç¼“å†²åŒºä¸­çš„åƒç´ å€¼ï¼Œä½†ä¸ºæ­¤ç›®çš„æœ€å¥½ä½¿ç”¨Vulkanä¸­çš„å›¾åƒå¯¹è±¡-VkImageã€‚ é€šè¿‡ä½¿ç”¨2Dåæ ‡ï¼Œå›¾åƒå¯¹è±¡å°†ä½¿æ£€ç´¢é¢œè‰²æ›´åŠ å®¹æ˜“å’Œå¿«æ·ã€‚ å›¾åƒå¯¹è±¡ä¸­çš„åƒç´ ç§°ä¸ºçº¹ç†åƒç´ ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkImage textureImage;</span><br><span class="line">VkDeviceMemory textureImageMemory;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createTextureImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    VkImageCreateInfo imageInfo = &#123;&#125;;</span><br><span class="line">    imageInfo.sType = VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO;</span><br><span class="line">    imageInfo.imageType = VK_IMAGE_TYPE_2D; <span class="comment">//äºŒç»´å›¾åƒ</span></span><br><span class="line">    imageInfo.extent.width = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(texWidth);</span><br><span class="line">    imageInfo.extent.height = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(texHeight);</span><br><span class="line">    imageInfo.extent.depth = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å›¾åƒçš„æœ€å°é‡‡æ ·çš„ç»†èŠ‚çº§åˆ«</span></span><br><span class="line">    imageInfo.mipLevels = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å›¾åƒä¸­çš„å±‚æ•°</span></span><br><span class="line">    imageInfo.arrayLayers = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æŒ‡å®šå›¾åƒæ ¼å¼ï¼Œå¯¹äºåƒç´ åƒç´ ï¼Œä½¿ç”¨ä¸ç¼“å†²åŒºä¸­åƒç´ ç›¸åŒçš„æ ¼å¼ï¼Œå¦åˆ™å¤åˆ¶æ“ä½œå°†å¤±è´¥</span></span><br><span class="line">    imageInfo.format = VK_FORMAT_R8G8B8A8_UNORM;</span><br><span class="line">    <span class="comment">// å›¾åƒå¹³é“ºæ¨¡å¼,è¿™é‡ŒæŒ‡å®šå›¾åƒåƒç´ æœ€ä½³å†…å­˜æ‹¼æ¥å¸ƒå±€</span></span><br><span class="line">    <span class="comment">// ä¸å›¾åƒçš„å¸ƒå±€ä¸åŒï¼Œå¹³é“ºæ¨¡å¼ä¸èƒ½åœ¨ä»¥åæ›´æ”¹ã€‚å¦‚æœå¸Œæœ›èƒ½å¤Ÿç›´æ¥è®¿é—®å›¾åƒå†…å­˜ä¸­çš„texelï¼Œåˆ™å¿…é¡»ä½¿ç”¨VK_IMAGE_TILING_OPTIMAL</span></span><br><span class="line">    imageInfo.tiling = VK_IMAGE_TILING_OPTIMAL;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›¾åƒçš„initialLayoutåªæœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼šVK_IMAGE_LAYOUT_UNDEFINED || VK_IMAGE_LAYOUT_PREINITIALIZED</span></span><br><span class="line">    imageInfo.initialLayout = VK_IMAGE_LAYOUT_UNDEFINED;</span><br><span class="line"></span><br><span class="line">    imageInfo.usage = VK_IMAGE_USAGE_TRANSFER_DST_BIT | VK_IMAGE_USAGE_SAMPLED_BIT;</span><br><span class="line">    <span class="comment">// å›¾åƒå°†ä»…ç”±ä¸€ä¸ªé˜Ÿåˆ—æ—ä½¿ç”¨, å› æ­¤ç‹¬å æ¨¡å¼</span></span><br><span class="line">    imageInfo.sharingMode = VK_SHARING_MODE_EXCLUSIVE;</span><br><span class="line">    <span class="comment">// å›¾åƒé‡‡æ ·</span></span><br><span class="line">    imageInfo.samples = VK_SAMPLE_COUNT_1_BIT;</span><br><span class="line">    imageInfo.flags = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºå›¾åƒ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateImage</span>(device, &amp;imageInfo, <span class="literal">nullptr</span>, &amp;textureImage) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create image!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ ·çš„ï¼Œéœ€è¦ç»™Imageåˆ†é…å†…å­˜ç©ºé—´</span></span><br><span class="line">    VkMemoryRequirements memRequirements;</span><br><span class="line">    <span class="built_in">vkGetImageMemoryRequirements</span>(device, textureImage, &amp;memRequirements);</span><br><span class="line">    VkMemoryAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.allocationSize = memRequirements.size;</span><br><span class="line">    allocInfo.memoryTypeIndex =</span><br><span class="line">            <span class="built_in">findMemoryType</span>(memRequirements.memoryTypeBits, VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkAllocateMemory</span>(device, &amp;allocInfo, <span class="literal">nullptr</span>, &amp;textureImageMemory) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to allocate image memory!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»‘å®šå›¾åƒå’Œå†…å­˜</span></span><br><span class="line">    <span class="built_in">vkBindImageMemory</span>(device, textureImage, textureImageMemory, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºinitialLayoutï¼Œå¾ˆå°‘æœ‰æƒ…å†µéœ€è¦åœ¨ç¬¬ä¸€æ¬¡è¿‡æ¸¡æœŸé—´ä¿ç•™çº¹ç†åƒç´ ï¼Œä½†æ˜¯å¦‚æœæƒ³å°†å›¾åƒä¸VK_IMAGE_TILING_LINEARå¸ƒå±€ç»“åˆä½¿ç”¨ä½œä¸ºç¼“å­˜å›¾åƒã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†çº¹ç†åƒç´ æ•°æ®ä¸Šä¼ åˆ°å…¶ä¸­ï¼Œç„¶åå°†å›¾åƒè½¬æ¢ä¸ºä¼ è¾“æºè€Œåˆä¸ä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬é¦–å…ˆå°†å›¾åƒè½¬æ¢ä¸ºä¼ è¾“ç›®æ ‡ï¼Œç„¶åä»ç¼“å†²åŒºå¯¹è±¡å°†çº¹ç†åƒç´ æ•°æ®å¤åˆ¶åˆ°è¯¥å›¾åƒï¼Œå› æ­¤ä½¿ç”¨VK_IMAGE_LAYOUT_UNDEFINEDã€‚</p>
<p>å¯¹äºusage, ä¸ç¼“å†²åŒºåˆ›å»ºæœŸé—´çš„å«ä¹‰ç›¸åŒã€‚ è¯¥å›¾åƒå°†ç”¨ä½œç¼“å†²åŒºå‰¯æœ¬çš„ç›®çš„åœ°ï¼Œå› æ­¤åº”å°†å…¶è®¾ç½®ä¸ºä¼ è¾“ç›®çš„åœ°ã€‚ æˆ‘ä»¬è¿˜å¸Œæœ›èƒ½å¤Ÿä»ç€è‰²å™¨è®¿é—®å›¾åƒæ¥ä¸ºç½‘æ ¼ç€è‰²ï¼Œå› æ­¤ç”¨æ³•åº”åŒ…æ‹¬VK_IMAGE_USAGE_SAMPLED_BITã€‚</p>
<p>é‡‡æ ·æ ‡å¿—ä¸å¤šé‡é‡‡æ ·æœ‰å…³ã€‚ è¿™ä»…ä¸å°†ç”¨ä½œé™„ä»¶çš„å›¾åƒæœ‰å…³ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ªæ ·æœ¬ã€‚ å¯¹äºä¸ç¨€ç–å›¾åƒæœ‰å…³çš„å›¾åƒï¼Œæœ‰ä¸€äº›å¯é€‰çš„æ ‡å¿—ã€‚ ç¨€ç–å›¾åƒæ˜¯å…¶ä¸­å®é™…ä¸Šä»…æŸäº›åŒºåŸŸç”±å†…å­˜æ”¯æŒçš„å›¾åƒã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå°†3Dçº¹ç†ç”¨äºä½“ç´ åœ°å½¢ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å®ƒæ¥é¿å…åˆ†é…å†…å­˜æ¥å­˜å‚¨å¤§é‡çš„â€œç©ºâ€å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º0ã€‚</p>
<h3 id="1-3-1-VkImageCreateInfo"><a href="#1-3-1-VkImageCreateInfo" class="headerlink" title="1.3.1 VkImageCreateInfo"></a>1.3.1 VkImageCreateInfo</h3><p>åˆ›å»ºå›¾åƒçš„ä¸€ç³»åˆ—å‚æ•°æ˜¯åœ¨VkImageCreateInfoä¸­æŒ‡æ˜çš„ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkImageCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType          sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*              pNext;</span><br><span class="line">    VkImageCreateFlags       flags;</span><br><span class="line">    VkImageType              imageType;</span><br><span class="line">    VkFormat                 format;</span><br><span class="line">    VkExtent3D               extent;</span><br><span class="line">    <span class="type">uint32_t</span>                 mipLevels;</span><br><span class="line">    <span class="type">uint32_t</span>                 arrayLayers;</span><br><span class="line">    VkSampleCountFlagBits    samples;</span><br><span class="line">    VkImageTiling            tiling;</span><br><span class="line">    VkImageUsageFlags        usage;</span><br><span class="line">    VkSharingMode            sharingMode;</span><br><span class="line">    <span class="type">uint32_t</span>                 queueFamilyIndexCount;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span>*          pQueueFamilyIndices;</span><br><span class="line">    VkImageLayout            initialLayout;</span><br><span class="line">&#125; VkImageCreateInfo;</span><br></pre></td></tr></table></figure>

<ol>
<li>sTypeæ˜¯æ­¤ç»“æ„çš„ç±»å‹,VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO</li>
<li>pNextæ˜¯NULLæˆ–æŒ‡å‘æ‰©å±•ç‰¹å®šç»“æ„çš„æŒ‡é’ˆ</li>
<li>flagæ˜¯VkImageCreateFlagBitsçš„ä½æ©ç ï¼Œç”¨äºæè¿°å›¾åƒçš„å…¶ä»–å‚æ•°</li>
<li>imageTypeæ˜¯VkImageTypeå€¼ï¼Œç”¨äºæŒ‡å®šå›¾åƒçš„åŸºæœ¬å°ºå¯¸ã€‚å°±å›¾åƒç±»å‹è€Œè¨€ï¼Œé˜µåˆ—çº¹ç†ä¸­çš„å›¾å±‚ä¸ç®—ä½œå°ºå¯¸<ol>
<li>VK_IMAGE_TYPE_1DæŒ‡å®šä¸€ç»´å›¾åƒ</li>
<li>VK_IMAGE_TYPE_2DæŒ‡å®šäºŒç»´å›¾åƒ</li>
<li>VK_IMAGE_TYPE_3DæŒ‡å®šä¸‰ç»´å›¾åƒ</li>
</ol>
</li>
<li>formatæ˜¯ä¸€ç§VkFormatï¼Œå®ƒæè¿°äº†å°†åŒ…å«åœ¨å›¾åƒä¸­çš„texelå—çš„æ ¼å¼å’Œç±»å‹</li>
<li>extentæ˜¯ä¸€ä¸ªVkExtent3Dï¼Œå®ƒæè¿°åŸºæœ¬çº§åˆ«çš„æ¯ä¸ªç»´åº¦ä¸­çš„æ•°æ®å…ƒç´ æ•°é‡</li>
<li>mipLevelsæè¿°å¯ç”¨äºå›¾åƒçš„æœ€å°é‡‡æ ·çš„ç»†èŠ‚çº§åˆ«çš„æ•°é‡</li>
<li>arrayLayersæ˜¯å›¾åƒä¸­çš„å±‚æ•°</li>
<li>samplesæ˜¯VkSampleCountFlagBitsï¼Œç”¨äºæŒ‡å®šæ¯ä¸ªçº¹ç†åƒç´ çš„æ ·æœ¬æ•°</li>
<li>tilingæ˜¯ä¸€ä¸ªVkImageTilingå€¼ï¼Œå®ƒæŒ‡å®šå†…å­˜ä¸­çº¹ç†å…ƒç´ å—çš„å¹³é“ºæ¨¡å¼<ol>
<li>VK_IMAGE_TILING_LINEAR: ä»¥ä¸»è¦è¡Œé¡ºåºæ’åˆ—åƒç´ </li>
<li>VK_IMAGE_TILING_OPTIMAL: æŒ‡å®šæœ€ä½³å¹³é“ºï¼ˆçº¹ç†åƒç´ ä»¥å®ç°ç›¸å…³çš„å®‰æ’è¿›è¡Œå¸ƒå±€ï¼Œä»¥å®ç°æ›´å¥½çš„å†…å­˜è®¿é—®ï¼‰</li>
<li>VK_IMAGE_TILING_DRM_FORMAT_MODIFIER_EXT: è¡¨ç¤ºå›¾ç‰‡çš„æ‹¼è´´æ˜¯ç”±Linux DRMæ ¼å¼ä¿®é¥°ç¬¦å®šä¹‰çš„</li>
</ol>
</li>
<li>usageæ˜¯VkImageUsageFlagBitsçš„ä½æ©ç ï¼Œç”¨äºæè¿°å›¾åƒçš„é¢„æœŸç”¨æ³•</li>
<li>SharingModeæ˜¯VkSharingModeå€¼ï¼Œç”¨äºæŒ‡å®šå¤šä¸ªé˜Ÿåˆ—ç³»åˆ—å°†è®¿é—®å›¾åƒæ—¶çš„å›¾åƒå…±äº«æ¨¡å¼</li>
<li>queueFamilyIndexCountæ˜¯pQueueFamilyIndiâ€‹â€‹cesæ•°ç»„ä¸­çš„æ¡ç›®æ•°</li>
<li>pQueueFamilyIndiâ€‹â€‹cesæ˜¯å°†è®¿é—®æ­¤å›¾åƒçš„é˜Ÿåˆ—ç³»åˆ—çš„åˆ—è¡¨ï¼ˆå¦‚æœsharedModeä¸æ˜¯VK_SHARING_MODE_CONCURRENTï¼Œåˆ™å°†è¢«å¿½ç•¥ï¼‰</li>
<li>initialLayoutæ˜¯ä¸€ä¸ªVkImageLayoutå€¼ï¼Œå®ƒæŒ‡å®šå›¾åƒçš„æ‰€æœ‰å›¾åƒå­èµ„æºçš„åˆå§‹VkImageLayoutã€‚è¯·å‚é˜…å›¾åƒå¸ƒå±€<ol>
<li>VK_IMAGE_LAYOUT_UNDEFINED: GPUä¸å¯ç”¨ï¼Œç¬¬ä¸€æ¬¡è½¬æ¢å°†ä¸¢å¼ƒçº¹ç†åƒç´ </li>
<li>VK_IMAGE_LAYOUT_PREINITIALIZED:GPUæ— æ³•ä½¿ç”¨ï¼Œä½†ç¬¬ä¸€ä¸ªè¿‡æ¸¡å°†ä¿ç•™çº¹ç†åƒç´ </li>
</ol>
</li>
</ol>
<h3 id="1-3-2-vkCreateImage"><a href="#1-3-2-vkCreateImage" class="headerlink" title="1.3.2 vkCreateImage"></a>1.3.2 vkCreateImage</h3><p>å›¾åƒè¡¨ç¤ºå¤šç»´ï¼ˆæœ€å¤š3ä¸ªï¼‰æ•°æ®æ•°ç»„ï¼Œå¯ç”¨äºå„ç§ç›®çš„ï¼ˆä¾‹å¦‚é™„ä»¶ã€çº¹ç†ï¼‰ï¼Œé€šè¿‡æè¿°ç¬¦é›†å°†å…¶ç»‘å®šåˆ°å›¾å½¢æˆ–è®¡ç®—ç®¡é“ï¼Œæˆ–ç›´æ¥å°†å…¶æŒ‡å®šä¸ºç‰¹å®šå‘½ä»¤çš„å‚æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateImage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkImageCreateInfo*                    pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkImage*                                    pImage)</span></span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>deviceæ˜¯åˆ›å»ºImageçš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfoæ˜¯æŒ‡å‘VkImageCreateInfoç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„åŒ…å«ç”¨äºåˆ›å»ºå›¾åƒçš„å‚æ•°</li>
<li>pAllocatorå¦‚â€œå†…å­˜åˆ†é…â€ä¸€ç« ä¸­æ‰€è¿°æ§åˆ¶ä¸»æœºå†…å­˜åˆ†é…</li>
<li>pImageæ˜¯æŒ‡å‘VkImageå¥æŸ„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥å¥æŸ„ä¸­è¿”å›ç”Ÿæˆçš„å›¾åƒå¯¹è±¡</li>
</ol>
<h3 id="1-3-3-createImage"><a href="#1-3-3-createImage" class="headerlink" title="1.3.3 createImage"></a>1.3.3 createImage</h3><p>ç°åœ¨æˆ‘ä»¬é‡æ„ä¸‹createTextureImage, å°†åˆ›å»ºVkImageçš„éƒ¨åˆ†å•ç‹¬åšä¸ªå‡½æ•°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createImage</span><span class="params">(<span class="type">uint32_t</span> width, <span class="type">uint32_t</span> height, VkFormat format,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkImageTiling tiling, VkImageUsageFlags usage,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkMemoryPropertyFlags properties, VkImage&amp; image,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDeviceMemory&amp; imageMemory)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    VkImageCreateInfo imageInfo = &#123;&#125;;</span><br><span class="line">    imageInfo.sType = VK_STRUCTURE_TYPE_IMAGE_CREATE_INFO;</span><br><span class="line">    imageInfo.imageType = VK_IMAGE_TYPE_2D; <span class="comment">//äºŒç»´å›¾åƒ</span></span><br><span class="line">    imageInfo.extent.width = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(width);</span><br><span class="line">    imageInfo.extent.height = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(height);</span><br><span class="line">    imageInfo.extent.depth = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å›¾åƒçš„æœ€å°é‡‡æ ·çš„ç»†èŠ‚çº§åˆ«</span></span><br><span class="line">    imageInfo.mipLevels = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// å›¾åƒä¸­çš„å±‚æ•°</span></span><br><span class="line">    imageInfo.arrayLayers = <span class="number">1</span>;</span><br><span class="line">    imageInfo.format = format;</span><br><span class="line">    <span class="comment">// å›¾åƒå¹³é“ºæ¨¡å¼,è¿™é‡ŒæŒ‡å®šå›¾åƒåƒç´ æœ€ä½³å†…å­˜æ‹¼æ¥å¸ƒå±€</span></span><br><span class="line">    <span class="comment">// ä¸å›¾åƒçš„å¸ƒå±€ä¸åŒï¼Œå¹³é“ºæ¨¡å¼ä¸èƒ½åœ¨ä»¥åæ›´æ”¹ã€‚å¦‚æœå¸Œæœ›èƒ½å¤Ÿç›´æ¥è®¿é—®å›¾åƒå†…å­˜ä¸­çš„texelï¼Œåˆ™å¿…é¡»ä½¿ç”¨VK_IMAGE_TILING_OPTIMAL</span></span><br><span class="line">    imageInfo.tiling = tiling;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›¾åƒçš„initialLayoutåªæœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼šVK_IMAGE_LAYOUT_UNDEFINED || VK_IMAGE_LAYOUT_PREINITIALIZED</span></span><br><span class="line">    imageInfo.initialLayout = VK_IMAGE_LAYOUT_UNDEFINED;</span><br><span class="line"></span><br><span class="line">    imageInfo.usage = usage;</span><br><span class="line">    <span class="comment">// å›¾åƒå°†ä»…ç”±ä¸€ä¸ªé˜Ÿåˆ—æ—ä½¿ç”¨, å› æ­¤ç‹¬å æ¨¡å¼</span></span><br><span class="line">    imageInfo.sharingMode = VK_SHARING_MODE_EXCLUSIVE;</span><br><span class="line">    <span class="comment">// å›¾åƒé‡‡æ ·</span></span><br><span class="line">    imageInfo.samples = VK_SAMPLE_COUNT_1_BIT;</span><br><span class="line">    imageInfo.flags = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    <span class="comment">// åˆ›å»ºå›¾åƒ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateImage</span>(device, &amp;imageInfo, <span class="literal">nullptr</span>, &amp;image) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create image!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒæ ·çš„ï¼Œéœ€è¦ç»™Imageåˆ†é…å†…å­˜ç©ºé—´</span></span><br><span class="line">    VkMemoryRequirements memRequirements;</span><br><span class="line">    <span class="built_in">vkGetImageMemoryRequirements</span>(device, image, &amp;memRequirements);</span><br><span class="line">    VkMemoryAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_MEMORY_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.allocationSize = memRequirements.size;</span><br><span class="line">    allocInfo.memoryTypeIndex =</span><br><span class="line">            <span class="built_in">findMemoryType</span>(memRequirements.memoryTypeBits, VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkAllocateMemory</span>(device, &amp;allocInfo, <span class="literal">nullptr</span>, &amp;imageMemory) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to allocate image memory!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç»‘å®šå›¾åƒå’Œå†…å­˜</span></span><br><span class="line">    <span class="built_in">vkBindImageMemory</span>(device, image, imageMemory, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createTextureImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> texWidth, texHeight, texChannels;</span><br><span class="line">    <span class="comment">// åŠ è½½texture.jpgå›¾åƒ</span></span><br><span class="line">    stbi_uc* pixels = <span class="built_in">stbi_load</span>(<span class="string">&quot;textures/texture.jpg&quot;</span>, &amp;texWidth, &amp;texHeight, &amp;texChannels, STBI_rgb_alpha);</span><br><span class="line">    <span class="comment">// æ¯ä¸ªåƒç´ 4ä¸ªå­—èŠ‚</span></span><br><span class="line">    VkDeviceSize imageSize = texWidth * texHeight * <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> (!pixels) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to load texture image!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    VkBuffer stagingBuffer;</span><br><span class="line">    VkDeviceMemory stagingBufferMemory;</span><br><span class="line">    <span class="comment">// ç¼“å†²åŒºåº”è¯¥åœ¨ä¸»æœºå¯è§å†…å­˜ä¸­ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ˜ å°„å®ƒï¼Œå¹¶ä¸”å®ƒåº”è¯¥å¯ç”¨ä½œä¼ è¾“æºï¼Œä»¥ä¾¿æˆ‘ä»¬ä»¥åå¯ä»¥å¤åˆ¶</span></span><br><span class="line">    <span class="built_in">createBuffer</span>(imageSize, VK_BUFFER_USAGE_TRANSFER_SRC_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT |</span><br><span class="line">            VK_MEMORY_PROPERTY_HOST_COHERENT_BIT, stagingBuffer,</span><br><span class="line">            stagingBufferMemory, VK_SHARING_MODE_EXCLUSIVE);</span><br><span class="line">    <span class="comment">// å†…å­˜æ˜ å°„</span></span><br><span class="line">    <span class="type">void</span>* data;</span><br><span class="line">    <span class="built_in">vkMapMemory</span>(device, stagingBufferMemory, <span class="number">0</span>, imageSize, <span class="number">0</span>, &amp;data);</span><br><span class="line">    <span class="built_in">memcpy</span>(data, pixels, <span class="built_in">static_cast</span>&lt;<span class="type">size_t</span>&gt;(imageSize));</span><br><span class="line">    <span class="built_in">vkUnmapMemory</span>(device, stagingBufferMemory);</span><br><span class="line">    <span class="comment">// æœ€åé‡Šæ”¾åŸå§‹åƒç´ æ•°æ®</span></span><br><span class="line">    <span class="built_in">stbi_image_free</span>(pixels);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">createImage</span>(texWidth, texHeight, VK_FORMAT_R8G8B8A8_UNORM, VK_IMAGE_TILING_OPTIMAL,</span><br><span class="line">            VK_IMAGE_USAGE_TRANSFER_DST_BIT | VK_IMAGE_USAGE_SAMPLED_BIT,</span><br><span class="line">            VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT, textureImage, textureImageMemory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-4-å¸ƒå±€è½¬æ¢"><a href="#1-4-å¸ƒå±€è½¬æ¢" class="headerlink" title="1.4 å¸ƒå±€è½¬æ¢"></a>1.4 å¸ƒå±€è½¬æ¢</h2><p>æˆ‘ä»¬éœ€è¦å†æ¬¡è®°å½•å’Œæ‰§è¡Œä¸€ä¸ªå‘½ä»¤ç¼“å†²åŒºä»¥å®Œæˆå¸ƒå±€è½¬æ¢åŠŸèƒ½ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å°†æ‰§è¡ŒæŒ‡ä»¤ç¼“å†²åŒºçš„éƒ¨åˆ†é€»è¾‘æŠ½ç¦»:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkCommandBuffer <span class="title">beginSingleTimeCommands</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkCommandBufferAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.level = VK_COMMAND_BUFFER_LEVEL_PRIMARY;</span><br><span class="line">    allocInfo.commandPool = commandPool;</span><br><span class="line">    allocInfo.commandBufferCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    VkCommandBuffer commandBuffer;</span><br><span class="line">    <span class="built_in">vkAllocateCommandBuffers</span>(device, &amp;allocInfo, &amp;commandBuffer);</span><br><span class="line"></span><br><span class="line">    VkCommandBufferBeginInfo beginInfo = &#123;&#125;;</span><br><span class="line">    beginInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO;</span><br><span class="line">    beginInfo.flags = VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT;</span><br><span class="line">    <span class="built_in">vkBeginCommandBuffer</span>(commandBuffer, &amp;beginInfo);</span><br><span class="line">    <span class="keyword">return</span> commandBuffer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">endSingleTimeCommands</span><span class="params">(VkCommandBuffer commandBuffer)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vkEndCommandBuffer</span>(commandBuffer);</span><br><span class="line"></span><br><span class="line">    VkSubmitInfo submitInfo = &#123;&#125;;</span><br><span class="line">    submitInfo.sType = VK_STRUCTURE_TYPE_SUBMIT_INFO;</span><br><span class="line">    submitInfo.commandBufferCount = <span class="number">1</span>;</span><br><span class="line">    submitInfo.pCommandBuffers = &amp;commandBuffer;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkQueueSubmit</span>(graphicsQueue, <span class="number">1</span>, &amp;submitInfo, VK_NULL_HANDLE);</span><br><span class="line">    <span class="built_in">vkQueueWaitIdle</span>(graphicsQueue);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkFreeCommandBuffers</span>(device, commandPool, <span class="number">1</span>, &amp;commandBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æœ‰äº†beginSingleTimeCommandså’ŒendSingleTimeCommandså‡½æ•°ï¼Œå¯ä»¥å¯¹æ‰§è¡Œå•æ¡æŒ‡ä»¤ç¼“å†²åŒºçš„å‡½æ•°è¿›è¡Œä¼˜åŒ–ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">copyBuffer</span><span class="params">(VkBuffer srcBuffer, VkBuffer dstBuffer, VkDeviceSize size)</span> </span>&#123;</span><br><span class="line">    VkCommandBuffer commandBuffer= <span class="built_in">beginSingleTimeCommands</span>();</span><br><span class="line">    <span class="comment">// ç¼“å†²æ‹·è´æŒ‡ä»¤</span></span><br><span class="line">    VkBufferCopy copyRegion = &#123;&#125;;</span><br><span class="line">    copyRegion.srcOffset = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    copyRegion.dstOffset = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    copyRegion.size = size;</span><br><span class="line">    <span class="comment">// std::cout&lt;&lt;&quot;copyBuffer vkCmdCopyBuffer&quot;&lt;&lt;std::endl;</span></span><br><span class="line">    <span class="comment">// ç¼“å†²åŒºçš„å†…å®¹ä½¿ç”¨vkCmdCopyBufferå‘½ä»¤ä¼ è¾“ã€‚</span></span><br><span class="line">    <span class="comment">// æºå’Œç›®æ ‡ç¼“å†²åŒºä»¥åŠè¦å¤åˆ¶çš„åŒºåŸŸæ•°ç»„ä½œä¸ºå‚æ•°ã€‚copyRegionç”±æºç¼“å†²åŒºåç§»é‡ã€ç›®æ ‡ç¼“å†²åŒºåç§»é‡å’Œå¤§å°ç»„æˆ</span></span><br><span class="line">    <span class="built_in">vkCmdCopyBuffer</span>(commandBuffer, srcBuffer, dstBuffer, <span class="number">1</span>, &amp;copyRegion);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">endSingleTimeCommands</span>(commandBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæˆ‘ä»¬ä»ç„¶ä½¿ç”¨ç¼“å†²åŒºï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®°å½•å¹¶æ‰§è¡ŒvkCmdCopyBufferToImageï¼Œä½†æ˜¯è¿™ä¸ªå‘½ä»¤è¦æ±‚é¦–å…ˆå°†Imageç½®äºæ­£ç¡®çš„å¸ƒå±€ä¸­ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°æ¥å¤„ç†å¸ƒå±€è½¬æ¢ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">transitionImageLayout</span><span class="params">(VkImage image, VkFormat format,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkImageLayout oldLayout, VkImageLayout newLayout)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    VkCommandBuffer commandBuffer = <span class="built_in">beginSingleTimeCommands</span>();</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å›¾åƒå†…å­˜å±éšœ,ç”¨äºåŒæ­¥èµ„æºè®¿é—®</span></span><br><span class="line">    VkImageMemoryBarrier barrier = &#123;&#125;;</span><br><span class="line">    barrier.sType = VK_STRUCTURE_TYPE_IMAGE_MEMORY_BARRIER;</span><br><span class="line">    <span class="comment">// æŒ‡å®šå¸ƒå±€è½¬æ¢ã€‚å¦‚æœä¸å…³å¿ƒå›¾åƒçš„ç°æœ‰å†…å®¹ï¼Œå¯ä»¥å°†VK_IMAGE_LAYOUT_UNDEFINEDç”¨ä½œoldLayout</span></span><br><span class="line">    barrier.oldLayout = oldLayout;</span><br><span class="line">    barrier.newLayout = newLayout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœä½¿ç”¨å±éšœæ¥ä¼ é€’é˜Ÿåˆ—æ—çš„æ‰€æœ‰æƒï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå­—æ®µåº”è¯¥æ˜¯é˜Ÿåˆ—æ—çš„ç´¢å¼•</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸è¿™æ ·åšï¼Œåˆ™å¿…é¡»å°†å®ƒä»¬è®¾ç½®ä¸ºVK_QUEUE_FAMILY_IGNORED</span></span><br><span class="line">    barrier.srcQueueFamilyIndex = VK_QUEUE_FAMILY_IGNORED;</span><br><span class="line">    barrier.dstQueueFamilyIndex = VK_QUEUE_FAMILY_IGNORED;</span><br><span class="line">    <span class="comment">// imageå’ŒsubresourceRangeæŒ‡å®šå—å½±å“çš„å›¾åƒä»¥åŠå›¾åƒçš„ç‰¹å®šéƒ¨åˆ†</span></span><br><span class="line">    barrier.image = image;</span><br><span class="line">    barrier.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬çš„å›¾åƒä¸æ˜¯æ•°ç»„ï¼Œä¹Ÿæ²¡æœ‰mipmappingçº§åˆ«ï¼Œå› æ­¤åªæŒ‡å®šäº†ä¸€ä¸ªçº§åˆ«å’Œå±‚</span></span><br><span class="line">    barrier.subresourceRange.baseMipLevel = <span class="number">0</span>;</span><br><span class="line">    barrier.subresourceRange.levelCount = <span class="number">1</span>;</span><br><span class="line">    barrier.subresourceRange.baseArrayLayer = <span class="number">0</span>;</span><br><span class="line">    barrier.subresourceRange.layerCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å±éšœä¸»è¦ç”¨äºåŒæ­¥ç›®çš„ï¼Œå› æ­¤å¿…é¡»æŒ‡å®šå“ªäº›æ¶‰åŠèµ„æºçš„æ“ä½œç±»å‹å¿…é¡»åœ¨å±éšœä¹‹å‰å‘ç”Ÿï¼Œå“ªäº›æ¶‰åŠèµ„æºçš„æ“ä½œå¿…é¡»åœ¨å±éšœä¸Šç­‰å¾…</span></span><br><span class="line">    barrier.srcAccessMask = <span class="number">0</span>; <span class="comment">// TODO</span></span><br><span class="line">    barrier.dstAccessMask = <span class="number">0</span>; <span class="comment">// TODO</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ç®¡é“ä¸Šæ‰§è¡ŒbarrieræŒ‡ä»¤, æ‰€æœ‰ç±»å‹çš„ç®¡é“å±éšœéƒ½ä½¿ç”¨ç›¸åŒçš„å‡½æ•°æäº¤</span></span><br><span class="line">    <span class="built_in">vkCmdPipelineBarrier</span>(commandBuffer,</span><br><span class="line">        <span class="number">0</span> <span class="comment">/* TODO */</span>, <span class="number">0</span> <span class="comment">/* TODO */</span>,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="literal">nullptr</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="literal">nullptr</span>,</span><br><span class="line">        <span class="number">1</span>, &amp;barrier</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="built_in">endSingleTimeCommands</span>(commandBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œå¸ƒå±€è½¬æ¢çš„æœ€å¸¸è§æ–¹æ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨å›¾åƒå†…å­˜å±éšœã€‚åƒè¿™æ ·çš„ç®¡é“å±éšœé€šå¸¸ç”¨äºåŒæ­¥å¯¹èµ„æºçš„è®¿é—®ï¼Œä¾‹å¦‚ç¡®ä¿åœ¨ä»ç¼“å†²åŒºè¯»å–ä¹‹å‰å®Œæˆå¯¹ç¼“å†²åŒºçš„å†™å…¥ï¼Œä½†æ˜¯å½“ä½¿ç”¨VK_SHARING_MODE_EXCLUSIVEæ—¶ï¼Œå®ƒä¹Ÿå¯ä»¥ç”¨äºè½¬æ¢æ˜ åƒå¸ƒå±€å’Œä¼ è¾“é˜Ÿåˆ—æ—æ‰€æœ‰æƒã€‚å¯¹äºç¼“å†²åŒºï¼Œæœ‰ä¸€ä¸ªç­‰æ•ˆçš„ç¼“å†²å­˜å‚¨å™¨å±éšœæ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p>
<h3 id="1-4-1-VkImageMemoryBarrier"><a href="#1-4-1-VkImageMemoryBarrier" class="headerlink" title="1.4.1 VkImageMemoryBarrier"></a>1.4.1 VkImageMemoryBarrier</h3><p>å›¾åƒå­˜å‚¨å™¨å±éšœä»…é€‚ç”¨äºæ¶‰åŠç‰¹å®šå›¾åƒå­èµ„æºèŒƒå›´çš„å­˜å‚¨å™¨è®¿é—®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»å›¾åƒå­˜å‚¨å™¨å±éšœå½¢æˆçš„å­˜å‚¨å™¨ä¾èµ–è¢«é™å®šä¸ºé€šè¿‡æŒ‡å®šçš„å›¾åƒå­èµ„æºèŒƒå›´è¿›è¡Œè®¿é—®ã€‚å›¾åƒå†…å­˜å±éšœè¿˜å¯ç”¨äºå®šä¹‰æŒ‡å®šå›¾åƒå­èµ„æºèŒƒå›´çš„å›¾åƒå¸ƒå±€è½¬æ¢æˆ–é˜Ÿåˆ—æ—æ‰€æœ‰æƒè½¬ç§»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkImageMemoryBarrier</span> &#123;</span><br><span class="line">    VkStructureType            sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                pNext;</span><br><span class="line">    VkAccessFlags              srcAccessMask;</span><br><span class="line">    VkAccessFlags              dstAccessMask;</span><br><span class="line">    VkImageLayout              oldLayout;</span><br><span class="line">    VkImageLayout              newLayout;</span><br><span class="line">    <span class="type">uint32_t</span>                   srcQueueFamilyIndex;</span><br><span class="line">    <span class="type">uint32_t</span>                   dstQueueFamilyIndex;</span><br><span class="line">    VkImage                    image;</span><br><span class="line">    VkImageSubresourceRange    subresourceRange;</span><br><span class="line">&#125; VkImageMemoryBarrier;</span><br></pre></td></tr></table></figure>

<ol>
<li>sTypeå°±æ˜¯è¿™ç§ç»“æ„çš„ç±»å‹, VK_STRUCTURE_TYPE_IMAGE_MEMORY_BARRIER</li>
<li>pNextä¸ºNULLæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>srccessmaskæ˜¯æŒ‡å®šæºè®¿é—®æ©ç çš„VkAccessFlagBitsçš„ä½æ©ç , æŒ‡å®šåœ¨å“ªä¸ªç®¡é“é˜¶æ®µå‘ç”Ÿæ“ä½œï¼Œè¿™äº›æ“ä½œåº”è¯¥åœ¨å±éšœä¹‹å‰å‘ç”Ÿ</li>
<li>dstAccessMaskæ˜¯æŒ‡å®šç›®æ ‡è®¿é—®æ©ç çš„VkAccessFlagBitsä½æ©ç , æŒ‡å®šæ“ä½œå°†åœ¨å…¶ä¸­ç­‰å¾…å±éšœçš„ç®¡é“é˜¶æ®µ</li>
<li>oldLayoutæ˜¯å›¾åƒå¸ƒå±€è½¬æ¢ä¸­çš„æ—§å¸ƒå±€</li>
<li>newLayoutæ˜¯å›¾åƒå¸ƒå±€è½¬æ¢ä¸­çš„æ–°å¸ƒå±€</li>
<li>srcQueueFamilyIndexæ˜¯é˜Ÿåˆ—ç³»åˆ—æ‰€æœ‰æƒè½¬ç§»çš„æºé˜Ÿåˆ—ç³»åˆ—</li>
<li>dstQueueFamilyIndexæ˜¯é˜Ÿåˆ—ç³»åˆ—æ‰€æœ‰æƒè½¬ç§»çš„ç›®æ ‡é˜Ÿåˆ—ç³»åˆ—</li>
<li>imageæ˜¯å—æ­¤å±éšœå½±å“çš„å›¾åƒ</li>
<li>subresourceRangeæè¿°å›¾åƒä¸­å—æ­¤å±éšœå½±å“çš„å›¾åƒå­èµ„æºèŒƒå›´</li>
</ol>
<h3 id="1-4-2-vkCmdPipelineBarrier"><a href="#1-4-2-vkCmdPipelineBarrier" class="headerlink" title="1.4.2 vkCmdPipelineBarrier"></a>1.4.2 vkCmdPipelineBarrier</h3><p>vkCmdPipelineBarrieræ˜¯ä¸€ä¸ªåŒæ­¥å‘½ä»¤ï¼Œå®ƒåœ¨æäº¤åˆ°åŒä¸€é˜Ÿåˆ—çš„å‘½ä»¤ä¹‹é—´æˆ–åŒä¸€å­ç±»ä¸­çš„å‘½ä»¤ä¹‹é—´æ’å…¥ä¾èµ–å…³ç³»ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdPipelineBarrier</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkPipelineStageFlags                        srcStageMask,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkPipelineStageFlags                        dstStageMask,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDependencyFlags                           dependencyFlags,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    memoryBarrierCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkMemoryBarrier*                      pMemoryBarriers,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    bufferMemoryBarrierCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkBufferMemoryBarrier*                pBufferMemoryBarriers,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    imageMemoryBarrierCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkImageMemoryBarrier*                 pImageMemoryBarriers)</span></span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>commandBufferæ˜¯å°†å‘½ä»¤è®°å½•åˆ°çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>srcStageMaskæ˜¯ä¸€ä¸ªæŒ‡å®šæºçº§æ©ç çš„VkPipelineStageFlagBitsçš„ä½æ©ç </li>
<li>dstStageMaskæ˜¯æŒ‡å®šç›®æ ‡é˜¶æ®µæ©ç çš„VkPipelineStageFlagBitsçš„ä½æ©ç </li>
<li>dependencyFlagsæ˜¯VkdePendencyFlagsçš„ä½æ©ç ï¼ŒæŒ‡å®šå¦‚ä½•å½¢æˆæ‰§è¡Œå’Œå†…å­˜ä¾èµ–å…³ç³»</li>
<li>memoryBarrierCountæ˜¯pMemoryBarriersæ•°ç»„çš„é•¿åº¦</li>
<li>pMemoryBarriersæ˜¯æŒ‡å‘VKMemorySbarrierç»“æ„æ•°ç»„çš„æŒ‡é’ˆ</li>
<li>bufferMemoryBarrierCountæ˜¯pBufferMemoryBarriersæ•°ç»„çš„é•¿åº¦</li>
<li>pBufferMemoryBarriersæ˜¯æŒ‡å‘VkBufferMemoryBarrierç»“æ„æ•°ç»„çš„æŒ‡é’ˆ</li>
<li>imageMemoryBarrierCountæ˜¯pImageMemoryBarriersæ•°ç»„çš„é•¿åº¦</li>
<li>pImageMemoryBarriersæ˜¯æŒ‡å‘VkimAgemoryBarrierç»“æ„æ•°ç»„çš„æŒ‡é’ˆ</li>
</ol>
<p>å½“vkCmdPipelineBarrieræäº¤åˆ°é˜Ÿåˆ—æ—¶ï¼Œå®ƒå®šä¹‰äº†åœ¨å®ƒä¹‹å‰æäº¤çš„å‘½ä»¤å’Œåœ¨å®ƒä¹‹åæäº¤çš„å‘½ä»¤ä¹‹é—´çš„å†…å­˜ä¾èµ–å…³ç³»ã€‚</p>
<p>å¦‚æœvkCmdPipelineBarrieræ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹å®ä¾‹å¤–éƒ¨å½•åˆ¶çš„ï¼Œåˆ™ç¬¬ä¸€ä¸ªåŒæ­¥ä½œç”¨åŸŸå°†åŒ…æ‹¬æŒ‰æäº¤é¡ºåºè¾ƒæ—©å‡ºç°çš„æ‰€æœ‰å‘½ä»¤ã€‚å¦‚æœvkCmdPipelineBarrierè®°å½•åœ¨æ¸²æŸ“è¿‡ç¨‹å®ä¾‹ä¸­ï¼Œåˆ™ç¬¬ä¸€ä¸ªåŒæ­¥ä½œç”¨åŸŸä»…åŒ…æ‹¬åœ¨åŒä¸€å­è¿‡ç¨‹ä¸­ä»¥æäº¤é¡ºåºè¾ƒæ—©å‡ºç°çš„å‘½ä»¤ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ä¸ªåŒæ­¥ä½œç”¨åŸŸä»…é™äºç”±srcStageMaskæŒ‡å®šçš„æºé˜¶æ®µæ©ç ç¡®å®šçš„ç®¡é“é˜¶æ®µä¸Šçš„æ“ä½œã€‚</p>
<p>å¦‚æœvkCmdPipelineBarrieræ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹å®ä¾‹å¤–éƒ¨å½•åˆ¶çš„ï¼Œåˆ™ç¬¬äºŒä¸ªåŒæ­¥ä½œç”¨åŸŸå°†åŒ…æ‹¬ä»¥åæŒ‰æäº¤é¡ºåºæ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ã€‚å¦‚æœvkCmdPipelineBarrierè®°å½•åœ¨æ¸²æŸ“è¿‡ç¨‹å®ä¾‹ä¸­ï¼Œåˆ™ç¬¬äºŒä¸ªåŒæ­¥ä½œç”¨åŸŸä»…åŒ…æ‹¬ç¨ååœ¨åŒä¸€å­è¿‡ç¨‹ä¸­æŒ‰æäº¤é¡ºåºå‡ºç°çš„å‘½ä»¤ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒåŒæ­¥ä½œç”¨åŸŸéƒ½é™äºç”±dstStageMaskæŒ‡å®šçš„ç›®çš„çº§æ©ç ç¡®å®šçš„ç®¡é“çº§ä¸Šçš„æ“ä½œã€‚</p>
<p>ç¬¬ä¸€ä¸ªè®¿é—®èŒƒå›´è¢«é™åˆ¶ä¸ºåœ¨ç”±srcStageMaskæŒ‡å®šçš„æºé˜¶æ®µæ©ç ç¡®å®šçš„ç®¡é“é˜¶æ®µä¸­è¿›è¡Œè®¿é—®ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€è®¿é—®ä½œç”¨åŸŸä»…åŒ…æ‹¬ç”±pMemoryBarriersã€pBufferMemoryBarrierså’ŒpImageMemoryBarriersæ•°ç»„çš„å…ƒç´ å®šä¹‰çš„ç¬¬ä¸€è®¿é—®ä½œç”¨åŸŸï¼Œæ¯ä¸ªå…ƒç´ å®šä¹‰ä¸€ç»„å†…å­˜å±éšœã€‚å¦‚æœæœªæŒ‡å®šå†…å­˜å±éšœï¼Œåˆ™ç¬¬ä¸€ä¸ªè®¿é—®ä½œç”¨åŸŸä¸åŒ…æ‹¬ä»»ä½•è®¿é—®ã€‚</p>
<p>ç¬¬äºŒè®¿é—®èŒƒå›´è¢«é™åˆ¶ä¸ºåœ¨ç”±dstStageMaskæŒ‡å®šçš„ç›®æ ‡é˜¶æ®µæ©ç ç¡®å®šçš„ç®¡é“é˜¶æ®µä¸­çš„è®¿é—®ã€‚å…¶ä¸­ï¼Œç¬¬äºŒè®¿é—®ä½œç”¨åŸŸä»…åŒ…æ‹¬ç”±pMemoryBarriersã€pBufferMemoryBarrierså’ŒpImageMemoryBarriersæ•°ç»„çš„å…ƒç´ å®šä¹‰çš„ç¬¬äºŒè®¿é—®ä½œç”¨åŸŸï¼Œå®ƒä»¬å„è‡ªå®šä¹‰äº†ä¸€ç»„å†…å­˜å±éšœã€‚å¦‚æœæœªæŒ‡å®šå†…å­˜å±éšœï¼Œåˆ™ç¬¬äºŒè®¿é—®ä½œç”¨åŸŸä¸åŒ…æ‹¬ä»»ä½•è®¿é—®ã€‚</p>
<h2 id="1-5-æ‹·è´ç¼“å­˜æ•°æ®è‡³Image"><a href="#1-5-æ‹·è´ç¼“å­˜æ•°æ®è‡³Image" class="headerlink" title="1.5 æ‹·è´ç¼“å­˜æ•°æ®è‡³Image"></a>1.5 æ‹·è´ç¼“å­˜æ•°æ®è‡³Image</h2><p>å°±åƒç¼“å†²åŒºå¤åˆ¶ä¸€æ ·ï¼Œéœ€è¦æŒ‡å®šç¼“å†²åŒºçš„å“ªä¸ªéƒ¨åˆ†å°†è¢«å¤åˆ¶åˆ°å›¾åƒçš„å“ªä¸ªéƒ¨åˆ†ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">copyBufferToImage</span><span class="params">(VkBuffer buffer, VkImage image, <span class="type">uint32_t</span> width,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">uint32_t</span> height)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    VkCommandBuffer commandBuffer = <span class="built_in">beginSingleTimeCommands</span>();</span><br><span class="line">    <span class="comment">// ä½¿ç”¨VkBufferImageCopyæŒ‡å®šç¼“å†²åŒºå¤åˆ¶è¡Œä¸º</span></span><br><span class="line">    VkBufferImageCopy region = &#123;&#125;;</span><br><span class="line">    <span class="comment">// æŒ‡å®šç¼“å†²åŒºä¸­åƒç´ å€¼å¼€å§‹çš„å­—èŠ‚åç§»é‡</span></span><br><span class="line">    region.bufferOffset = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æŒ‡å®šåƒç´ åœ¨å†…å­˜ä¸­çš„å¸ƒå±€æ–¹å¼, æŒ‡å®š0è¡¨ç¤ºåƒç´ ç´§å¯†æ‰“åŒ…</span></span><br><span class="line">    region.bufferRowLength = <span class="number">0</span>;</span><br><span class="line">    region.bufferImageHeight = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡ç¤ºè¦å°†åƒç´ å¤åˆ¶åˆ°å›¾åƒçš„å“ªä¸ªéƒ¨åˆ†</span></span><br><span class="line">    region.imageSubresource.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</span><br><span class="line">    region.imageSubresource.mipLevel = <span class="number">0</span>;</span><br><span class="line">    region.imageSubresource.baseArrayLayer = <span class="number">0</span>;</span><br><span class="line">    region.imageSubresource.layerCount = <span class="number">1</span>;</span><br><span class="line">    region.imageOffset = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    region.imageExtent = &#123;width, height, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨vkCmdCopyBufferToImageå‡½æ•°å°†ç¼“å†²åŒºåˆ°å›¾åƒçš„å¤åˆ¶æ“ä½œæ’é˜Ÿ</span></span><br><span class="line">    <span class="comment">// ç¬¬å››ä¸ªå‚æ•°æŒ‡ç¤ºå›¾åƒå½“å‰ä½¿ç”¨çš„å¸ƒå±€</span></span><br><span class="line">    <span class="built_in">vkCmdCopyBufferToImage</span>(commandBuffer, buffer, image,</span><br><span class="line">            VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL,</span><br><span class="line">            <span class="number">1</span>, &amp;region);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">endSingleTimeCommands</span>(commandBuffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-5-1-VkBufferImageCopy"><a href="#1-5-1-VkBufferImageCopy" class="headerlink" title="1.5.1 VkBufferImageCopy"></a>1.5.1 VkBufferImageCopy</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkBufferImageCopy</span> &#123;</span><br><span class="line">    VkDeviceSize                bufferOffset;</span><br><span class="line">    <span class="type">uint32_t</span>                    bufferRowLength;</span><br><span class="line">    <span class="type">uint32_t</span>                    bufferImageHeight;</span><br><span class="line">    VkImageSubresourceLayers    imageSubresource;</span><br><span class="line">    VkOffset3D                  imageOffset;</span><br><span class="line">    VkExtent3D                  imageExtent;</span><br><span class="line">&#125; VkBufferImageCopy;</span><br></pre></td></tr></table></figure>

<ol>
<li>bufferOffsetæ˜¯ä»å¤åˆ¶å›¾åƒæ•°æ®çš„ç¼“å†²åŒºå¯¹è±¡çš„èµ·å§‹å¤„å¼€å§‹çš„ä»¥å­—èŠ‚ä¸ºå•ä½çš„åç§»é‡</li>
<li>bufferRowLengthå’ŒbufferImageHeightä»¥texelä¸ºå•ä½æŒ‡å®šç¼“å†²å­˜å‚¨å™¨ä¸­è¾ƒå¤§çš„äºŒç»´æˆ–ä¸‰ç»´å›¾åƒçš„å­åŒºåŸŸï¼Œå¹¶æ§åˆ¶å¯»å€è®¡ç®—ã€‚å¦‚æœè¿™äº›å€¼ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸ºé›¶ï¼Œåˆ™æ ¹æ®imageExtentï¼Œç¼“å†²å­˜å‚¨å™¨çš„è¿™ä¸€æ–¹é¢è¢«è®¤ä¸ºæ˜¯ç´§å¯†å‹ç¼©çš„</li>
<li>imageSubresourceæ˜¯ä¸€ä¸ªVkImageSubresourceLayersï¼Œç”¨äºæŒ‡å®šç”¨äºæºæˆ–ç›®æ ‡å›¾åƒæ•°æ®çš„å›¾åƒçš„ç‰¹å®šå›¾åƒå­èµ„æº</li>
<li>imageOffseté€‰æ‹©æºæˆ–ç›®æ ‡å›¾åƒæ•°æ®å­åŒºåŸŸçš„åˆå§‹xã€yã€zåç§»ï¼ˆä»¥texelä¸ºå•ä½ï¼‰</li>
<li>imageExtentæ˜¯è¦åœ¨å®½åº¦ã€é«˜åº¦å’Œæ·±åº¦ä¸Šå¤åˆ¶çš„å›¾åƒçš„å¤§å°ï¼ˆä»¥texelä¸ºå•ä½ï¼‰</li>
</ol>
<p>å½“å¤åˆ¶åˆ°æˆ–ä»æ·±åº¦æˆ–æ¨¡å…·æ–¹é¢æ—¶ï¼Œç¼“å†²åŒºå†…å­˜ä¸­çš„æ•°æ®ä½¿ç”¨çš„å¸ƒå±€æ˜¯æ·±åº¦æˆ–æ¨¡å…·æ•°æ®çš„(å¤§éƒ¨åˆ†)ç´§å¯†å°è£…çš„è¡¨ç¤ºå½¢å¼ã€‚å…·ä½“åœ°è¯´:</p>
<ol>
<li>å¤åˆ¶åˆ°æˆ–ä»ä»»ä½•æ·±åº¦&#x2F;æ¨¡æ¿æ ¼å¼çš„æ¨¡æ¿æ–¹é¢çš„æ•°æ®éƒ½ç”¨æ¯ä¸ªtexelçš„VK_FORMAT_S8_UINTå€¼ç´§å¯†æ‰“åŒ…</li>
<li>å¤åˆ¶åˆ°æˆ–ä»VK_FORMAT_D16_UNORMæˆ–VK_FORMAT_D16_UNORM_S8_UINTæ ¼å¼çš„æ·±åº¦æ–¹é¢çš„æ•°æ®ä½¿ç”¨æ¯ä¸ªtexelçš„VK_FORMAT_D16_UNORMå€¼ç´§å¯†æ‰“åŒ…</li>
<li>å¤åˆ¶åˆ°æˆ–ä»VK_FORMAT_D32_SFLOATæˆ–VK_FORMAT_D32_SFLOAT_S8_UINTæ ¼å¼çš„æ·±åº¦æ–¹é¢çš„æ•°æ®ä½¿ç”¨æ¯ä¸ªtexelçš„ä¸€ä¸ªVK_FORMAT_D32_SFLOATå€¼ç´§å¯†æ‰“åŒ…</li>
<li>å¤åˆ¶åˆ°æˆ–ä»VK_FORMAT_X8_D24_UNORM_PACK32æˆ–VK_FORMAT_D24_UNORM_S8_UINTæ ¼å¼çš„æ·±åº¦æ–¹é¢çš„æ•°æ®è¢«æ‰“åŒ…ä¸ºæ¯ä¸ªtexelä¸€ä¸ª32ä½å•è¯ï¼Œæ¯ä¸ªå•è¯çš„lsbä¸­æœ‰D24å€¼ï¼Œ8ä¸ªmsbä¸­æœ‰æœªå®šä¹‰çš„å€¼</li>
</ol>
<p>ç”±äºå›¾åƒå‰¯æœ¬çš„æ·±åº¦æˆ–æ¨¡æ¿æ–¹é¢ç¼“å†²åŒºåœ¨æŸäº›å®ç°ä¸Šå¯èƒ½éœ€è¦æ ¼å¼è½¬æ¢ï¼Œå› æ­¤ä¸æ”¯æŒå›¾å½¢çš„é˜Ÿåˆ—ä¸æ”¯æŒæ ¼å¼è½¬æ¢ã€‚<br>å½“å¤åˆ¶åˆ°æ·±åº¦æ–¹é¢æ—¶ï¼Œå¹¶ä¸”æ²¡æœ‰å¯ç”¨VK_EXT_depth_range_unrestrictedæ‰©å±•åï¼Œç¼“å†²åŒºå†…å­˜ä¸­çš„æ•°æ®å¿…é¡»åœ¨[0,1]èŒƒå›´å†…ï¼Œå¦åˆ™ç»“æœå€¼æ˜¯æœªå®šä¹‰çš„ã€‚<br>å¤åˆ¶ä»imageSubresourceçš„å›¾åƒå›¾å±‚baseArrayLayeræˆå‘˜å¼€å§‹ä¸€å±‚ä¸€å±‚åœ°è¿›è¡Œã€‚layerCountå±‚ä»æºå›¾åƒæˆ–ç›®æ ‡å›¾åƒå¤åˆ¶ã€‚</p>
<h3 id="1-5-2-vkCmdCopyBufferToImage"><a href="#1-5-2-vkCmdCopyBufferToImage" class="headerlink" title="1.5.2 vkCmdCopyBufferToImage"></a>1.5.2 vkCmdCopyBufferToImage</h3><p>åœ¨ç¼“å†²åŒºå’Œå›¾åƒä¹‹é—´å¤åˆ¶æ•°æ®, ä»bufferå¯¹è±¡å¤åˆ¶æ•°æ®åˆ°imageå¯¹è±¡, è°ƒç”¨vkCmdCopyBufferToImage:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdCopyBufferToImage</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkBuffer                                    srcBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkImage                                     dstImage,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkImageLayout                               dstImageLayout,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    regionCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkBufferImageCopy*                    pRegions)</span></span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>commandBufferæ˜¯å‘½ä»¤å°†è¢«è®°å½•åˆ°çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>srcBufferæ˜¯æºç¼“å†²åŒº</li>
<li>dstImageæ˜¯ç›®æ ‡å›¾åƒ</li>
<li>dstImageLayoutæ˜¯å¤åˆ¶çš„ç›®æ ‡å›¾åƒå­èµ„æºçš„å¸ƒå±€</li>
<li>regionCountæ˜¯è¦å¤åˆ¶çš„åŒºåŸŸæ•°</li>
<li>pRegionsæ˜¯ä¸€ä¸ªæŒ‡å‘VkBufferImageCopyç»“æ„æ•°ç»„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æ•°ç»„æŒ‡å®šè¦å¤åˆ¶çš„åŒºåŸŸ</li>
</ol>
<p>åŒºåŸŸä¸­çš„æ¯ä¸ªåŒºåŸŸä»æºç¼“å†²åŒºçš„æŒ‡å®šåŒºåŸŸå¤åˆ¶åˆ°ç›®æ ‡å›¾åƒçš„æŒ‡å®šåŒºåŸŸã€‚</p>
<p>å¦‚æœdstImageçš„æ ¼å¼æ˜¯ä¸€ä¸ªå¤šå¹³é¢çš„å›¾åƒæ ¼å¼)ï¼Œå¿…é¡»ä½¿ç”¨VkBufferImageCopyç»“æ„çš„pRegionsæˆå‘˜å•ç‹¬æŒ‡å®šä½œä¸ºæ‹·è´ç›®æ ‡çš„æ¯ä¸ªå¹³é¢çš„åŒºåŸŸã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒimageSubresourceçš„aspectMaskå¿…é¡»ä¸ºVK_IMAGE_ASPECT_PLANE_0_BITã€VK_IMAGE_ASPECT_PLANE_1_BITæˆ–VK_IMAGE_ASPECT_PLANE_2_BITã€‚å¯¹äºvkCmdCopyBufferToImageæ¥è¯´ï¼Œå¤šå¹³é¢å›¾åƒçš„æ¯ä¸ªå¹³é¢éƒ½è¢«è§†ä¸ºå…·æœ‰ç”±ç›¸åº”å­èµ„æºçš„aspectMaskæ ‡è¯†çš„å¹³é¢çš„å¤šå¹³é¢æ ¼å¼çš„å…¼å®¹å¹³é¢æ ¼å¼ä¸­åˆ—å‡ºçš„æ ¼å¼ã€‚è¿™æ—¢é€‚ç”¨äºVkFormatï¼Œä¹Ÿé€‚ç”¨äºå¤åˆ¶ä¸­ä½¿ç”¨çš„åæ ‡ï¼Œå®ƒå¯¹åº”äºå¹³é¢ä¸­çš„texelï¼Œè€Œä¸æ˜¯è¿™äº›texelå¦‚ä½•æ˜ å°„åˆ°æ•´ä¸ªå›¾åƒä¸­çš„åæ ‡ã€‚</p>
<h2 id="1-6-å‡†å¤‡çº¹ç†å›¾åƒ"><a href="#1-6-å‡†å¤‡çº¹ç†å›¾åƒ" class="headerlink" title="1.6 å‡†å¤‡çº¹ç†å›¾åƒ"></a>1.6 å‡†å¤‡çº¹ç†å›¾åƒ</h2><p>å›åˆ°createTextureImageå‡½æ•°ã€‚æˆ‘ä»¬åœ¨é‚£é‡Œåšçš„æœ€åä¸€ä»¶äº‹æ˜¯åˆ›å»ºçº¹ç†å›¾åƒã€‚ä¸‹ä¸€æ­¥æ˜¯å°†æš‚å­˜ç¼“å†²åŒºå¤åˆ¶åˆ°çº¹ç†å›¾åƒã€‚è¿™åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤:</p>
<ol>
<li>è½¬æ¢çº¹ç†å›¾åƒåˆ°VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL</li>
<li>æ‰§è¡Œç¼“å†²åŒºåˆ°å›¾åƒå¤åˆ¶æ“ä½œ</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¯¥å›¾åƒæ˜¯ä½¿ç”¨VK_IMAGE_LAYOUT_UNDEFINEDå¸ƒå±€åˆ›å»ºçš„ï¼Œå› æ­¤åœ¨è½¬æ¢textureImageæ—¶åº”å°†oldLayoutæŒ‡å®šä¸ºVK_IMAGE_LAYOUT_UNDEFINED</span></span><br><span class="line"><span class="comment">// åœ¨æ‰§è¡Œå¤åˆ¶æ“ä½œä¹‹å‰ï¼Œä¸å…³å¿ƒå›¾åƒå†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·åš</span></span><br><span class="line"><span class="built_in">transitionImageLayout</span>(textureImage, VK_FORMAT_R8G8B8A8_UNORM,</span><br><span class="line">        VK_IMAGE_LAYOUT_UNDEFINED,</span><br><span class="line">        VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹·è´stagingBufferä¸­ç¼“å­˜çš„å›¾åƒæ•°æ®è‡³Imageï¼ˆGPUå¯è§å†…å­˜ï¼‰</span></span><br><span class="line"><span class="built_in">copyBufferToImage</span>(stagingBuffer, textureImage,</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(texWidth), <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(texHeight));</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸ºäº†èƒ½å¤Ÿä»ç€è‰²å™¨ä¸­çš„çº¹ç†å›¾åƒå¼€å§‹é‡‡æ ·ï¼Œæˆ‘ä»¬éœ€è¦æœ€åä¸€ä¸ªè¿‡æ¸¡æ¥å‡†å¤‡ç€è‰²å™¨è®¿é—®(ç”¨äºåŒæ­¥å¯¹èµ„æºçš„è®¿é—®)ï¼š</span></span><br><span class="line"><span class="built_in">transitionImageLayout</span>(textureImage, VK_FORMAT_R8G8B8A8_UNORM,</span><br><span class="line">        VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL,</span><br><span class="line">        VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="1-7-è½¬æ¢å±éšœçš„å«ä¹‰-VkAccessFlags"><a href="#1-7-è½¬æ¢å±éšœçš„å«ä¹‰-VkAccessFlags" class="headerlink" title="1.7 è½¬æ¢å±éšœçš„å«ä¹‰ VkAccessFlags"></a>1.7 è½¬æ¢å±éšœçš„å«ä¹‰ VkAccessFlags</h2><p>ç°åœ¨åœ¨å¯ç”¨éªŒè¯å±‚çš„æƒ…å†µä¸‹è¿è¡Œåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå°†çœ‹åˆ°transitionImageLayoutä¸­çš„è®¿é—®æ©ç å’Œç®¡é“é˜¶æ®µæ— æ•ˆã€‚</p>
<p>æˆ‘ä»¬éœ€è¦æ ¹æ®è¿‡æ¸¡ä¸­çš„å¸ƒå±€æ¥è®¾ç½®å®ƒä»¬ï¼Œæ‹·è´å‰åçš„ä¸¤ç§è½¬æ¢éƒ½éœ€è¦è®¾ç½®ï¼š</p>
<ol>
<li>VK_IMAGE_LAYOUT_UNDEFINED-&gt;VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL: ä¸éœ€è¦ç­‰å¾…ä»»ä½•å†…å®¹çš„ä¼ è¾“å†™å…¥</li>
<li>VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL-&gt; VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL: shader readsåº”è¯¥ç­‰å¾…Transfer writesï¼Œç‰¹åˆ«æ˜¯shaderåœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è¯»å–ï¼Œå› ä¸ºè¿™å°±æ˜¯æˆ‘ä»¬è¦ä½¿ç”¨çº¹ç†çš„åœ°æ–¹</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineStageFlags sourceStage;</span><br><span class="line">VkPipelineStageFlags destinationStage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (oldLayout == VK_IMAGE_LAYOUT_UNDEFINED</span><br><span class="line">        &amp;&amp; newLayout == VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL) &#123;</span><br><span class="line">    barrier.srcAccessMask = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// Imageæˆ–ç¼“å†²åŒºåœ¨æ¸…é™¤æˆ–å¤åˆ¶æ“ä½œä¸­çš„å†™è®¿é—®</span></span><br><span class="line">    barrier.dstAccessMask = VK_ACCESS_TRANSFER_WRITE_BIT;</span><br><span class="line">    <span class="comment">// æŒ‡å®šé˜Ÿåˆ—æœ€åˆæ¥æ”¶åˆ°ä»»ä½•å‘½ä»¤çš„ç®¡é“é˜¶æ®µ</span></span><br><span class="line">    sourceStage = VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ‰€æœ‰å¤åˆ¶å‘½ä»¤å’Œæ¸…é™¤å‘½ä»¤ç®¡é“é˜¶æ®µ</span></span><br><span class="line">    destinationStage = VK_PIPELINE_STAGE_TRANSFER_BIT;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldLayout == VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL</span><br><span class="line">        &amp;&amp; newLayout == VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL) &#123;</span><br><span class="line">    <span class="comment">// Imageæˆ–ç¼“å†²åŒºåœ¨æ¸…é™¤æˆ–å¤åˆ¶æ“ä½œä¸­çš„å†™è®¿é—®</span></span><br><span class="line">    barrier.srcAccessMask = VK_ACCESS_TRANSFER_WRITE_BIT;</span><br><span class="line">    <span class="comment">// æŒ‡å®šå¯¹å­˜å‚¨ç¼“å†²åŒºã€ç‰©ç†å­˜å‚¨ç¼“å†²åŒºã€ç»Ÿä¸€texelç¼“å†²åŒºã€å­˜å‚¨texelç¼“å†²åŒºã€é‡‡æ ·å›¾åƒæˆ–å­˜å‚¨å›¾åƒçš„è¯»è®¿é—®</span></span><br><span class="line">    barrier.dstAccessMask = VK_ACCESS_SHADER_READ_BIT;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ‰€æœ‰å¤åˆ¶å‘½ä»¤å’Œæ¸…é™¤å‘½ä»¤ç®¡é“é˜¶æ®µ</span></span><br><span class="line">    sourceStage = VK_PIPELINE_STAGE_TRANSFER_BIT;</span><br><span class="line">    <span class="comment">// æŒ‡å®šç‰‡æ®µç€è‰²å™¨é˜¶æ®µ</span></span><br><span class="line">    destinationStage = VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;unsupported layout transition!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vkCmdPipelineBarrier</span>(commandBuffer, sourceStage, destinationStage,</span><br><span class="line">        <span class="number">0</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="literal">nullptr</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="literal">nullptr</span>,</span><br><span class="line">        <span class="number">1</span>, &amp;barrier);</span><br></pre></td></tr></table></figure>

<p>ä¼ è¾“å†™å…¥å¿…é¡»åœ¨ç®¡é“ä¼ è¾“é˜¶æ®µè¿›è¡Œã€‚å› ä¸ºå†™æ“ä½œä¸éœ€è¦ç­‰å¾…ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ä¸ºé¢„barrieræ“ä½œæŒ‡å®šä¸€ä¸ªç©ºçš„è®¿é—®æ©ç å’Œå°½å¯èƒ½æ—©çš„ç®¡é“é˜¶æ®µVK_PIPELINE_STAGE_TOP_OF_PIPE_BITã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒVK_PIPELINE_STAGE_TRANSFER_BITå¹¶ä¸æ˜¯å›¾å½¢å’Œè®¡ç®—ç®¡é“ä¸­çš„ä¸€ä¸ªçœŸæ­£çš„é˜¶æ®µã€‚å®ƒæ›´å¤šçš„æ˜¯ä¸€ä¸ªå‘ç”Ÿè½¬ç§»çš„ä¼ªé˜¶æ®µã€‚</p>
<p>å›¾åƒå°†åœ¨ç›¸åŒçš„ç®¡é“é˜¶æ®µè¢«å†™å…¥ï¼Œç„¶åè¢«ç‰‡æ®µç€è‰²å™¨è¯»å–ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ç‰‡æ®µç€è‰²å™¨ç®¡é“é˜¶æ®µæŒ‡å®šç€è‰²å™¨è¯»å–è®¿é—®ã€‚éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå‘½ä»¤ç¼“å†²åŒºæäº¤åœ¨å¼€å§‹æ—¶ä¼šå¯¼è‡´éšå¼çš„VK_ACCESS_HOST_WRITE_BITåŒæ­¥ã€‚ç”±äºtransitionImageLayoutå‡½æ•°åªä½¿ç”¨ä¸€ä¸ªå‘½ä»¤æ¥æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ç¼“å†²åŒºï¼Œæ‰€ä»¥å¦‚æœåœ¨å¸ƒå±€è½¬æ¢ä¸­éœ€è¦VK_ACCESS_HOST_WRITE_BITä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªéšå¼åŒæ­¥å¹¶å°†srcAccessMaskè®¾ç½®ä¸º0ã€‚</p>
<p>å®é™…ä¸Šï¼Œæœ‰ä¸€ç§ç‰¹æ®Šçš„å›¾åƒå¸ƒå±€ç±»å‹å¯ä»¥æ”¯æŒæ‰€æœ‰æ“ä½œâ€“VK_IMAGE_LAYOUT_GENERALã€‚å½“ç„¶ï¼Œå®ƒçš„é—®é¢˜åœ¨äºï¼Œå®ƒä¸ä¸€å®šèƒ½ä¸ºä»»ä½•æ“ä½œæä¾›æœ€ä½³æ€§èƒ½ã€‚åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œä¾‹å¦‚ä½¿ç”¨å›¾åƒä½œä¸ºè¾“å…¥å’Œè¾“å‡ºï¼Œæˆ–è€…åœ¨ç¦»å¼€é¢„åˆå§‹åŒ–çš„å¸ƒå±€åè¯»å–å›¾åƒã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰æäº¤å‘½ä»¤çš„å¸®åŠ©ç¨‹åºåŠŸèƒ½éƒ½å·²è®¾ç½®ä¸ºé€šè¿‡ç­‰å¾…é˜Ÿåˆ—å˜ä¸ºç©ºé—²çŠ¶æ€è€ŒåŒæ­¥æ‰§è¡Œã€‚å¯¹äºå®é™…åº”ç”¨ï¼Œå»ºè®®å°†è¿™äº›æ“ä½œç»„åˆåœ¨å•ä¸ªå‘½ä»¤ç¼“å†²åŒºä¸­ï¼Œå¹¶å¼‚æ­¥æ‰§è¡Œå®ƒä»¬ä»¥æé«˜ååé‡ï¼Œå°¤å…¶æ˜¯createTextureImageå‡½æ•°ä¸­çš„è¿‡æ¸¡å’Œå¤åˆ¶ã€‚é€šè¿‡åˆ›å»ºä¸€ä¸ªhelperå‡½æ•°å°†å‘½ä»¤è®°å½•åˆ°å…¶ä¸­çš„setupCommandBufferå¹¶å°è¯•æ·»åŠ ä¸€ä¸ªflushSetupCommandsæ¥æ‰§è¡Œåˆ°ç›®å‰ä¸ºæ­¢å·²è®°å½•çš„å‘½ä»¤ï¼Œæ¥å°è¯•è¿›è¡Œæ­¤æ“ä½œã€‚æœ€å¥½åœ¨çº¹ç†è´´å›¾å·¥ä½œåæ‰§è¡Œæ­¤æ“ä½œï¼Œä»¥æ£€æŸ¥çº¹ç†èµ„æºæ˜¯å¦ä»æ­£ç¡®è®¾ç½®ã€‚</p>
<h3 id="1-7-1-VkAccessFlagBits"><a href="#1-7-1-VkAccessFlagBits" class="headerlink" title="1.7.1 VkAccessFlagBits"></a>1.7.1 VkAccessFlagBits</h3><p>Vulkanä¸­çš„å†…å­˜å¯ä»¥é€šè¿‡shaderè°ƒç”¨å’Œç®¡é“ä¸­çš„ä¸€äº›å›ºå®šå‡½æ•°æ¥è®¿é—®ã€‚è®¿é—®ç±»å‹æ˜¯æ‰€ä½¿ç”¨çš„æè¿°ç¬¦ç±»å‹çš„å‡½æ•°ï¼Œæˆ–è€…å›ºå®šå‡½æ•°é˜¶æ®µå¦‚ä½•è®¿é—®å†…å­˜ã€‚æ¯ä¸ªè®¿é—®ç±»å‹å¯¹åº”äºVkAccessFlagBitsä¸­çš„ä¸€ä¸ªä½æ ‡å¿—ã€‚</p>
<p>ä¸€äº›åŒæ­¥å‘½ä»¤ä»¥è®¿é—®ç±»å‹é›†ä½œä¸ºå‚æ•°æ¥å®šä¹‰å†…å­˜ä¾èµ–é¡¹çš„è®¿é—®èŒƒå›´ã€‚å¦‚æœåŒæ­¥å‘½ä»¤åŒ…å«æºè®¿é—®æ©ç ï¼Œåˆ™å…¶ç¬¬ä¸€ä¸ªè®¿é—®ä½œç”¨åŸŸä»…åŒ…æ‹¬é€šè¿‡è¯¥æ©ç ä¸­æŒ‡å®šçš„è®¿é—®ç±»å‹è¿›è¡Œçš„è®¿é—®ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœåŒæ­¥å‘½ä»¤åŒ…å«ç›®æ ‡è®¿é—®æ©ç ï¼Œåˆ™å…¶ç¬¬äºŒä¸ªè®¿é—®ä½œç”¨åŸŸä»…åŒ…æ‹¬é€šè¿‡è¯¥æ©ç ä¸­æŒ‡å®šçš„è®¿é—®ç±»å‹è¿›è¡Œçš„è®¿é—®ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkAccessFlagBits</span> &#123;</span><br><span class="line">    VK_ACCESS_INDIRECT_COMMAND_READ_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_ACCESS_INDEX_READ_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_ACCESS_VERTEX_ATTRIBUTE_READ_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_ACCESS_UNIFORM_READ_BIT = <span class="number">0x00000008</span>,</span><br><span class="line">    VK_ACCESS_INPUT_ATTACHMENT_READ_BIT = <span class="number">0x00000010</span>,</span><br><span class="line">    VK_ACCESS_SHADER_READ_BIT = <span class="number">0x00000020</span>,</span><br><span class="line">    VK_ACCESS_SHADER_WRITE_BIT = <span class="number">0x00000040</span>,</span><br><span class="line">    VK_ACCESS_COLOR_ATTACHMENT_READ_BIT = <span class="number">0x00000080</span>,</span><br><span class="line">    VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT = <span class="number">0x00000100</span>,</span><br><span class="line">    VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READ_BIT = <span class="number">0x00000200</span>,</span><br><span class="line">    VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT = <span class="number">0x00000400</span>,</span><br><span class="line">    VK_ACCESS_TRANSFER_READ_BIT = <span class="number">0x00000800</span>,</span><br><span class="line">    VK_ACCESS_TRANSFER_WRITE_BIT = <span class="number">0x00001000</span>,</span><br><span class="line">    VK_ACCESS_HOST_READ_BIT = <span class="number">0x00002000</span>,</span><br><span class="line">    VK_ACCESS_HOST_WRITE_BIT = <span class="number">0x00004000</span>,</span><br><span class="line">    VK_ACCESS_MEMORY_READ_BIT = <span class="number">0x00008000</span>,</span><br><span class="line">    VK_ACCESS_MEMORY_WRITE_BIT = <span class="number">0x00010000</span>,</span><br><span class="line">    VK_ACCESS_TRANSFORM_FEEDBACK_WRITE_BIT_EXT = <span class="number">0x02000000</span>,</span><br><span class="line">    VK_ACCESS_TRANSFORM_FEEDBACK_COUNTER_READ_BIT_EXT = <span class="number">0x04000000</span>,</span><br><span class="line">    VK_ACCESS_TRANSFORM_FEEDBACK_COUNTER_WRITE_BIT_EXT = <span class="number">0x08000000</span>,</span><br><span class="line">    VK_ACCESS_CONDITIONAL_RENDERING_READ_BIT_EXT = <span class="number">0x00100000</span>,</span><br><span class="line">    VK_ACCESS_COMMAND_PROCESS_READ_BIT_NVX = <span class="number">0x00020000</span>,</span><br><span class="line">    VK_ACCESS_COMMAND_PROCESS_WRITE_BIT_NVX = <span class="number">0x00040000</span>,</span><br><span class="line">    VK_ACCESS_COLOR_ATTACHMENT_READ_NONCOHERENT_BIT_EXT = <span class="number">0x00080000</span>,</span><br><span class="line">    VK_ACCESS_SHADING_RATE_IMAGE_READ_BIT_NV = <span class="number">0x00800000</span>,</span><br><span class="line">    VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_NV = <span class="number">0x00200000</span>,</span><br><span class="line">    VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_NV = <span class="number">0x00400000</span>,</span><br><span class="line">    VK_ACCESS_FRAGMENT_DENSITY_MAP_READ_BIT_EXT = <span class="number">0x01000000</span>,</span><br><span class="line">    VK_ACCESS_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkAccessFlagBits;</span><br></pre></td></tr></table></figure>

<ol>
<li>VK_ACCESS_INDIRECT_COMMAND_READ_BITæŒ‡å®šå¯¹ä½œä¸ºé—´æ¥ç»˜å›¾æˆ–è°ƒåº¦å‘½ä»¤ä¸€éƒ¨åˆ†çš„é—´æ¥å‘½ä»¤æ•°æ®çš„è¯»è®¿é—®</li>
<li>VK_ACCESS_INDEX_READ_BITæŒ‡å®šå¯¹ç´¢å¼•ç¼“å†²åŒºçš„è¯»è®¿é—®ï¼Œä½œä¸ºç´¢å¼•ç»˜å›¾å‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œç”±vkCmdBindIndexBufferç»‘å®š</li>
<li>VK_ACCESS_VERTEX_ATTRIBUTE_READ_BITæŒ‡å®šå¯¹é¡¶ç‚¹ç¼“å†²åŒºçš„è¯»è®¿é—®ï¼Œä½œä¸ºç»˜å›¾å‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œç”±vkCmdBindVertexBuffersç»‘å®š</li>
<li>VK_ACCESS_UNIFORM_READ_BITç»Ÿä¸€ç¼“å†²åŒºè¯»è®¿é—®æƒé™</li>
<li>VK_ACCESS_INPUT_ATTACHMENT_READ_BITæŒ‡å®šåœ¨ç‰‡æ®µç€è‰²æœŸé—´æ¸²æŸ“é€šé“å†…å¯¹è¾“å…¥é™„ä»¶çš„è¯»è®¿é—®</li>
<li>VK_ACCESS_SHADER_READ_BITæŒ‡å®šå¯¹å­˜å‚¨ç¼“å†²åŒºã€ç‰©ç†å­˜å‚¨ç¼“å†²åŒºã€ç»Ÿä¸€texelç¼“å†²åŒºã€å­˜å‚¨texelç¼“å†²åŒºã€é‡‡æ ·å›¾åƒæˆ–å­˜å‚¨å›¾åƒçš„è¯»è®¿é—®</li>
<li>VK_ACCESS_SHADER_WRITE_BITå­˜å‚¨ç¼“å†²åŒºã€ç‰©ç†å­˜å‚¨ç¼“å†²åŒºã€å­˜å‚¨texelç¼“å†²åŒºæˆ–å­˜å‚¨æ˜ åƒçš„å†™è®¿é—®</li>
<li>VK_ACCESS_COLOR_ATTACHMENT_READ_BITæŒ‡å®šå¯¹é¢œè‰²é™„ä»¶çš„è¯»è®¿é—®ï¼Œä¾‹å¦‚é€šè¿‡æ··åˆã€é€»è¾‘æ“ä½œæˆ–é€šè¿‡æŸäº›subpassåŠ è½½æ“ä½œã€‚å®ƒä¸åŒ…æ‹¬é«˜çº§æ··åˆæ“ä½œ</li>
<li>VK_ACCESS_COLOR_ATTACHMENT_WRITE_BITæŒ‡å®šåœ¨æ¸²æŸ“é€šé“æœŸé—´æˆ–é€šè¿‡æŸäº›å­é€šé“åŠ è½½å’Œå­˜å‚¨æ“ä½œå¯¹é¢œè‰²ã€è§£ææˆ–æ·±åº¦&#x2F;æ¨¡æ¿è§£æé™„ä»¶çš„å†™è®¿é—®</li>
<li>VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READ_BITæŒ‡å®šå¯¹æ·±åº¦&#x2F;æ¨¡æ¿é™„ä»¶çš„è¯»è®¿é—®ï¼Œé€šè¿‡æ·±åº¦æˆ–æ¨¡æ¿æ“ä½œï¼Œæˆ–é€šè¿‡æŸäº›å­ä¼ é€’åŠ è½½æ“ä½œ</li>
<li>VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BITæŒ‡å®šå¯¹æ·±åº¦&#x2F;æ¨¡æ¿é™„ä»¶çš„å†™è®¿é—®ï¼Œé€šè¿‡æ·±åº¦æˆ–æ¨¡æ¿æ“ä½œï¼Œæˆ–è€…é€šè¿‡æŸäº›å­ä¼ é€’åŠ è½½å’Œå­˜å‚¨æ“ä½œ</li>
<li>VK_ACCESS_TRANSFER_READ_BITæ‹·è´æ“ä½œä¸­å¯¹é•œåƒæˆ–ç¼“å†²åŒºçš„è¯»è®¿é—®</li>
<li>VK_ACCESS_TRANSFER_WRITE_BITæ˜ åƒæˆ–ç¼“å†²åŒºåœ¨æ¸…é™¤æˆ–å¤åˆ¶æ“ä½œä¸­çš„å†™è®¿é—®</li>
<li>VK_ACCESS_HOST_READ_BITä¸»æœºæ“ä½œè¯»è®¿é—®ã€‚è¿™ç§ç±»å‹çš„è®¿é—®ä¸æ˜¯é€šè¿‡èµ„æºæ‰§è¡Œçš„ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†…å­˜ä¸Šæ‰§è¡Œçš„</li>
<li>VK_ACCESS_HOST_WRITE_BITä¸»æœºæ“ä½œå†™è®¿é—®ã€‚è¿™ç§ç±»å‹çš„è®¿é—®ä¸æ˜¯é€šè¿‡èµ„æºæ‰§è¡Œçš„ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†…å­˜ä¸Šæ‰§è¡Œçš„</li>
<li>VK_ACCESS_MEMORY_READ_BITæ‰€æœ‰è¯»è®¿é—®ã€‚å®ƒåœ¨ä»»ä½•è®¿é—®æ©ç ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶è¢«è§†ä¸ºç­‰åŒäºè®¾ç½®æ‰€æœ‰åœ¨ä½¿ç”¨å®ƒæ—¶æœ‰æ•ˆçš„è¯»è®¿é—®æ ‡å¿—</li>
<li>VK_ACCESS_MEMORY_WRITE_BITæ‰€æœ‰å†™è®¿é—®ã€‚å®ƒåœ¨ä»»ä½•è®¿é—®æ©ç ä¸­éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå¹¶è¢«è§†ä¸ºç­‰åŒäºè®¾ç½®æ‰€æœ‰åœ¨ä½¿ç”¨å®ƒæ—¶æœ‰æ•ˆçš„å†™è®¿é—®æ ‡å¿—</li>
<li>VK_ACCESS_CONDITIONAL_RENDERING_READ_BIT_EXTæŒ‡å®šå¯¹è°“è¯çš„è¯»è®¿é—®ï¼Œä½œä¸ºæ¡ä»¶å‘ˆç°çš„ä¸€éƒ¨åˆ†</li>
<li>VK_ACCESS_TRANSFORM_FEEDBACK_WRITE_BIT_EXTæŒ‡å®šåœ¨è½¬æ¢åé¦ˆæ¿€æ´»æ—¶å¯¹è½¬æ¢åé¦ˆç¼“å†²åŒºçš„å†™è®¿é—®</li>
<li>VK_ACCESS_TRANSFORM_FEEDBACK_COUNTER_READ_BIT_EXTæŒ‡å®šå¯¹è½¬æ¢åé¦ˆè®¡æ•°å™¨ç¼“å†²åŒºçš„è¯»è®¿é—®ï¼Œå½“vkCmdBeginTransformFeedbackEXTæ‰§è¡Œæ—¶è¯»å–è¯¥ç¼“å†²åŒº</li>
<li>VK_ACCESS_TRANSFORM_FEEDBACK_COUNTER_WRITE_BIT_EXTæŒ‡å®šå¯¹è½¬æ¢åé¦ˆè®¡æ•°å™¨ç¼“å†²åŒºçš„å†™è®¿é—®ï¼Œè¯¥ç¼“å†²åŒºåœ¨vkCmdEndTransformFeedbackEXTæ‰§è¡Œæ—¶å†™å…¥</li>
<li>VK_ACCESS_COMMAND_PROCESS_READ_BIT_NVXæŒ‡å®šä»VkBufferè¾“å…¥è¯»å–vkCmdProcessCommandsNVX</li>
<li>VK_ACCESS_COMMAND_PROCESS_WRITE_BIT_NVXæŒ‡å®šå†™åˆ°vkCmdProcessCommandsNVXçš„ç›®æ ‡å‘½ä»¤ç¼“å†²åŒº</li>
<li>VK_ACCESS_COLOR_ATTACHMENT_READ_NONCOHERENT_BIT_EXTç±»ä¼¼äºVK_ACCESS_COLOR_ATTACHMENT_READ_BITï¼Œä½†æ˜¯ä¹ŸåŒ…æ‹¬é«˜çº§çš„æ··åˆæ“ä½œ</li>
<li>VK_ACCESS_SHADING_RATE_IMAGE_READ_BIT_NVæŒ‡å®šå¯¹ç€è‰²ç‡å›¾åƒçš„è¯»å–è®¿é—®ï¼Œä½œä¸ºç»˜å›¾å‘½ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œç”±vkcmdbindshadingraemimagenvç»‘å®š</li>
<li>VK_ACCESS_ACCELERATION_STRUCTURE_READ_BIT_NVæŒ‡å®šå¯¹åŠ é€Ÿç»“æ„çš„è¯»è®¿é—®ï¼Œä½œä¸ºè·Ÿè¸ªæˆ–æ„å»ºå‘½ä»¤çš„ä¸€éƒ¨åˆ†</li>
<li>VK_ACCESS_ACCELERATION_STRUCTURE_WRITE_BIT_NVæŒ‡å®šå¯¹åŠ é€Ÿç»“æ„çš„å†™è®¿é—®ï¼Œä½œä¸ºæ„å»ºå‘½ä»¤çš„ä¸€éƒ¨åˆ†</li>
<li>VK_ACCESS_FRAGMENT_DENSITY_MAP_READ_BIT_EXTåŠ¨æ€ç¢ç‰‡å¯†åº¦å›¾æ“ä½œæ—¶å¯¹ç¢ç‰‡å¯†åº¦å›¾é™„ä»¶çš„è¯»è®¿é—®</li>
</ol>
<h3 id="1-7-2-VkPipelineStageFlags-ç®¡é“é˜¶æ®µ"><a href="#1-7-2-VkPipelineStageFlags-ç®¡é“é˜¶æ®µ" class="headerlink" title="1.7.2 VkPipelineStageFlags ç®¡é“é˜¶æ®µ"></a>1.7.2 VkPipelineStageFlags ç®¡é“é˜¶æ®µ</h3><p>æ“ä½œæˆ–åŒæ­¥å‘½ä»¤æ‰§è¡Œçš„å·¥ä½œç”±å¤šä¸ªæ“ä½œç»„æˆï¼Œè¿™äº›æ“ä½œä½œä¸ºé€»è¾‘ä¸Šç‹¬ç«‹çš„æ­¥éª¤åºåˆ—æ‰§è¡Œï¼Œç§°ä¸ºç®¡é“é˜¶æ®µã€‚æ‰§è¡Œçš„ç¡®åˆ‡ç®¡é“é˜¶æ®µå–å†³äºæ‰€ä½¿ç”¨çš„ç‰¹å®šå‘½ä»¤ï¼Œä»¥åŠè®°å½•å‘½ä»¤æ—¶çš„å½“å‰å‘½ä»¤ç¼“å†²åŒºçŠ¶æ€ã€‚ç»˜åˆ¶å‘½ä»¤ã€åˆ†æ´¾å‘½ä»¤ã€å¤åˆ¶å‘½ä»¤ã€æ¸…é™¤å‘½ä»¤å’ŒåŒæ­¥å‘½ä»¤éƒ½åœ¨ç®¡é“é˜¶æ®µçš„ä¸åŒé›†åˆä¸­æ‰§è¡Œã€‚åŒæ­¥å‘½ä»¤ä¸ä¼šåœ¨å·²å®šä¹‰çš„ç®¡é“ä¸­æ‰§è¡Œï¼Œä½†ä¼šæ‰§è¡ŒVK_PIPELINE_STAGE_TOP_OF_PIPE_BITå’ŒVK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BITã€‚</p>
<p>æ³¨æ„åŒæ­¥å‘½ä»¤æ‰§è¡Œçš„æ“ä½œ(ä¾‹å¦‚å¯ç”¨æ€§å’Œå¯è§æ€§æ“ä½œ)ä¸æ˜¯ç”±å®šä¹‰çš„ç®¡é“é˜¶æ®µæ‰§è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå…¶ä»–å‘½ä»¤ä»ç„¶å¯ä»¥é€šè¿‡VK_PIPELINE_STAGE_TOP_OF_PIPE_BITå’ŒVK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BITç®¡é“é˜¶æ®µä¸å®ƒä»¬åŒæ­¥ã€‚</p>
<p>è·¨ç®¡é“é˜¶æ®µæ‰§è¡Œæ“ä½œå¿…é¡»éµå¾ªéšå¼æ’åºä¿è¯ï¼Œç‰¹åˆ«æ˜¯åŒ…æ‹¬ç®¡é“é˜¶æ®µé¡ºåºã€‚å¦åˆ™ï¼Œä¸å…¶ä»–é˜¶æ®µç›¸æ¯”ï¼Œè·¨ç®¡é“é˜¶æ®µçš„æ‰§è¡Œå¯èƒ½ä¼šé‡å æˆ–æ— åºæ‰§è¡Œï¼Œé™¤éæ‰§è¡Œä¾èµ–é¡¹å¼ºåˆ¶æ‰§è¡Œã€‚</p>
<p>ä¸€äº›åŒæ­¥å‘½ä»¤åŒ…æ‹¬ç®¡é“é˜¶æ®µå‚æ•°ï¼Œå°†è¯¥å‘½ä»¤çš„åŒæ­¥èŒƒå›´é™åˆ¶åœ¨è¿™äº›é˜¶æ®µã€‚è¿™å…è®¸å¯¹ç²¾ç¡®çš„æ‰§è¡Œä¾èµ–å…³ç³»å’Œæ“ä½œå‘½ä»¤æ‰§è¡Œçš„è®¿é—®è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚å®ç°åº”è¯¥ä½¿ç”¨è¿™äº›ç®¡é“é˜¶æ®µæ¥é¿å…ä¸å¿…è¦çš„åœé¡¿æˆ–ç¼“å­˜åˆ·æ–°ã€‚</p>
<p>å¯ä»¥è®¾ç½®æŒ‡å®šç®¡é“é˜¶æ®µé€šè¿‡VkPipelineStageFlags:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkPipelineStageFlagBits</span> &#123;</span><br><span class="line">    VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_VERTEX_INPUT_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_VERTEX_SHADER_BIT = <span class="number">0x00000008</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT = <span class="number">0x00000010</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT = <span class="number">0x00000020</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT = <span class="number">0x00000040</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT = <span class="number">0x00000080</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT = <span class="number">0x00000100</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT = <span class="number">0x00000200</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT = <span class="number">0x00000400</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_COMPUTE_SHADER_BIT = <span class="number">0x00000800</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_TRANSFER_BIT = <span class="number">0x00001000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT = <span class="number">0x00002000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_HOST_BIT = <span class="number">0x00004000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_ALL_GRAPHICS_BIT = <span class="number">0x00008000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_ALL_COMMANDS_BIT = <span class="number">0x00010000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_TRANSFORM_FEEDBACK_BIT_EXT = <span class="number">0x01000000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_CONDITIONAL_RENDERING_BIT_EXT = <span class="number">0x00040000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_COMMAND_PROCESS_BIT_NVX = <span class="number">0x00020000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_SHADING_RATE_IMAGE_BIT_NV = <span class="number">0x00400000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_RAY_TRACING_SHADER_BIT_NV = <span class="number">0x00200000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_NV = <span class="number">0x02000000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_TASK_SHADER_BIT_NV = <span class="number">0x00080000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_MESH_SHADER_BIT_NV = <span class="number">0x00100000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_FRAGMENT_DENSITY_PROCESS_BIT_EXT = <span class="number">0x00800000</span>,</span><br><span class="line">    VK_PIPELINE_STAGE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkPipelineStageFlagBits;</span><br></pre></td></tr></table></figure>

<ol>
<li>VK_PIPELINE_STAGE_TOP_OF_PIPE_BITæŒ‡å®šé˜Ÿåˆ—æœ€åˆæ¥æ”¶åˆ°ä»»ä½•å‘½ä»¤çš„ç®¡é“é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_DRAW_INDIRECT_BITæŒ‡å®šä½¿ç”¨Draw&#x2F;DispatchIndirectæ•°æ®ç»“æ„çš„ç®¡é“é˜¶æ®µã€‚è¿™ä¸ªé˜¶æ®µè¿˜åŒ…æ‹¬è¯»å–vkCmdProcessCommandsNVXå†™çš„å‘½ä»¤</li>
<li>VK_PIPELINE_STAGE_TASK_SHADER_BIT_NVæŒ‡å®šä»»åŠ¡ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_MESH_SHADER_BIT_NVæŒ‡å®šç½‘æ ¼ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_VERTEX_INPUT_BITæŒ‡å®šæ¶ˆè€—é¡¶ç‚¹å’Œç´¢å¼•ç¼“å†²åŒºçš„æµæ°´çº¿é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_VERTEX_SHADER_BITæŒ‡å®šé¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BITæŒ‡å®šé•¶åµŒæ§åˆ¶ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BITæŒ‡å®šé•¶åµŒè¯„ä¼°ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BITæŒ‡å®šå‡ ä½•ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BITæŒ‡å®šç‰‡æ®µç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BITæŒ‡å®šæ‰§è¡Œæ—©æœŸç‰‡æ®µæµ‹è¯•ï¼ˆç‰‡æ®µç€è‰²ä¹‹å‰çš„æ·±åº¦å’Œæ¨¡æ¿æµ‹è¯•ï¼‰çš„ç®¡é“é˜¶æ®µã€‚æ­¤é˜¶æ®µè¿˜åŒ…æ‹¬é’ˆå¯¹å…·æœ‰æ·±åº¦&#x2F;æ¨¡æ¿æ ¼å¼çš„å¸§ç¼“å†²åŒºé™„ä»¶çš„å­ä¼ é€’åŠ è½½æ“ä½œ</li>
<li>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BITæŒ‡å®šæ‰§è¡ŒåæœŸç‰‡æ®µæµ‹è¯•ï¼ˆç‰‡æ®µç€è‰²åçš„æ·±åº¦å’Œæ¨¡æ¿æµ‹è¯•ï¼‰çš„ç®¡é“é˜¶æ®µã€‚æ­¤é˜¶æ®µè¿˜åŒ…æ‹¬ç”¨äºå…·æœ‰æ·±åº¦&#x2F;æ¨¡æ¿æ ¼å¼çš„å¸§ç¼“å†²åŒºé™„ä»¶çš„å­ä¼ é€’å­˜å‚¨æ“ä½œ</li>
<li>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BITæŒ‡å®šæ··åˆåç®¡é“çš„é˜¶æ®µï¼Œä»ç®¡é“è¾“å‡ºæœ€ç»ˆé¢œè‰²å€¼ã€‚æ­¤é˜¶æ®µè¿˜åŒ…æ‹¬å­é€šé“åŠ è½½å’Œå­˜å‚¨æ“ä½œä»¥åŠå…·æœ‰é¢œè‰²æˆ–æ·±åº¦&#x2F;æ¨¡æ¿æ ¼å¼çš„å¸§ç¼“å†²åŒºé™„ä»¶çš„å¤šæ ·æœ¬è§£ææ“ä½œ</li>
<li>VK_PIPELINE_STAGE_COMPUTE_SHADER_BITæŒ‡å®šæ‰§è¡Œè®¡ç®—ç€è‰²å™¨</li>
<li>VK_PIPELINE_STAGE_TRANSFER_BITæŒ‡å®šä»¥ä¸‹å‘½ä»¤ï¼š<ol>
<li>æ‰€æœ‰å¤åˆ¶å‘½ä»¤ï¼ŒåŒ…æ‹¬vkCmdCopyQueryPoolResultsï¼ŒvkCmdBlitImageï¼ŒvkCmdResolveImage</li>
<li>æ‰€æœ‰æ¸…é™¤å‘½ä»¤ï¼Œä½†vkCmdClearAttachmentsé™¤å¤–</li>
</ol>
</li>
<li>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BITæŒ‡å®šç®¡é“ä¸­ç”±æ‰€æœ‰å‘½ä»¤ç”Ÿæˆçš„æ“ä½œå®Œæˆæ‰§è¡Œçš„æœ€åé˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_HOST_BITæŒ‡å®šä¸€ä¸ªä¼ªé˜¶æ®µï¼ŒæŒ‡ç¤ºåœ¨ä¸»æœºä¸Šæ‰§è¡Œè®¾å¤‡å­˜å‚¨å™¨çš„è¯»&#x2F;å†™æ“ä½œã€‚è®°å½•åœ¨å‘½ä»¤ç¼“å†²åŒºä¸­çš„ä»»ä½•å‘½ä»¤éƒ½ä¸ä¼šè°ƒç”¨æ­¤é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_RAY_TRACING_SHADER_BIT_NVæŒ‡å®šå…‰çº¿è·Ÿè¸ªç€è‰²å™¨é˜¶æ®µçš„æ‰§è¡Œ</li>
<li>VK_PIPELINE_STAGE_ACCELERATION_STRUCTURE_BUILD_BIT_NVæŒ‡å®švkCmdBuildAccelerationStructureNVï¼ŒvkCmdCopyAccelerationStructureNVå’ŒvkCmdWriteAccelerationStructuresPropertiesNVçš„æ‰§è¡Œ</li>
<li>VK_PIPELINE_STAGE_ALL_GRAPHICS_BITæŒ‡å®šæ‰€æœ‰å›¾å½¢ç®¡çº¿é˜¶æ®µçš„æ‰§è¡Œï¼Œå¹¶ä¸”ç­‰æ•ˆäºï¼š<ol>
<li>VK_PIPELINE_STAGE_TOP_OF_PIPE_BIT</li>
<li>VK_PIPELINE_STAGE_DRAW_INDIRECT_BIT</li>
<li>VK_PIPELINE_STAGE_TASK_SHADER_BIT_NV</li>
<li>VK_PIPELINE_STAGE_MESH_SHADER_BIT_NV</li>
<li>VK_PIPELINE_STAGE_VERTEX_INPUT_BIT</li>
<li>VK_PIPELINE_STAGE_VERTEX_SHADER_BIT</li>
<li>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BIT</li>
<li>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BIT</li>
<li>VK_PIPELINE_STAGE_GEOMETRY_SHADER_BIT</li>
<li>VK_PIPELINE_STAGE_FRAGMENT_SHADER_BIT</li>
<li>VK_PIPELINE_STAGE_EARLY_FRAGMENT_TESTS_BIT</li>
<li>VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT</li>
<li>VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT</li>
<li>VK_PIPELINE_STAGE_BOTTOM_OF_PIPE_BIT</li>
<li>VK_PIPELINE_STAGE_CONDITIONAL_RENDERING_BIT_EXT</li>
<li>VK_PIPELINE_STAGE_TRANSFORM_FEEDBACK_BIT_EXT</li>
<li>VK_PIPELINE_STAGE_SHADING_RATE_IMAGE_BIT_NV</li>
<li>VK_PIPELINE_STAGE_FRAGMENT_DENSITY_PROCESS_BIT_EXT</li>
</ol>
</li>
<li>VK_PIPELINE_STAGE_ALL_COMMANDS_BITç­‰æ•ˆäºä¸å…¶ä¸€èµ·ä½¿ç”¨çš„é˜Ÿåˆ—ä¸Šæ”¯æŒçš„æ‰€æœ‰å…¶ä»–ç®¡é“é˜¶æ®µæ ‡å¿—çš„é€»è¾‘æˆ–</li>
<li>VK_PIPELINE_STAGE_CONDITIONAL_RENDERING_BIT_EXTæŒ‡å®šä½¿ç”¨æ¡ä»¶æ¸²æŸ“è°“è¯çš„ç®¡é“é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_TRANSFORM_FEEDBACK_BIT_EXTæŒ‡å®šå°†é¡¶ç‚¹å±æ€§è¾“å‡ºå€¼å†™å…¥è½¬æ¢åé¦ˆç¼“å†²åŒºçš„ç®¡çº¿é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_COMMAND_PROCESS_BIT_NVXæŒ‡å®šäº†å¤„ç†é€šè¿‡vkCmdProcessCommandsNVXåœ¨è®¾å¤‡ç«¯ç”Ÿæˆå‘½ä»¤çš„ç®¡é“é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_SHADING_RATE_IMAGE_BIT_NVæŒ‡å®šç®¡é“çš„é˜¶æ®µï¼Œåœ¨è¯¥é˜¶æ®µä¸­è¯»å–é˜´å½±ç‡å›¾åƒï¼Œä»¥ç¡®å®šæ …æ ¼åŒ–å›¾å…ƒå„éƒ¨åˆ†çš„é˜´å½±ç‡</li>
<li>VK_PIPELINE_STAGE_FRAGMENT_DENSITY_PROCESS_BIT_EXTæŒ‡å®šè¯»å–ç‰‡æ®µå¯†åº¦å›¾ä»¥ç”Ÿæˆç‰‡æ®µåŒºåŸŸçš„ç®¡çº¿é˜¶æ®µ</li>
</ol>
<h2 id="1-8-æ¸…ç†"><a href="#1-8-æ¸…ç†" class="headerlink" title="1.8 æ¸…ç†"></a>1.8 æ¸…ç†</h2><p>åˆ›å»ºçº¹ç†è´´å›¾åï¼Œä¸èƒ½å¿˜è®°åœ¨å¿…è¦çš„æ—¶å€™å°†å†…å­˜é‡Šæ”¾å‡ºæ¥ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createTextureImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// é€šè¿‡æ¸…é™¤è¿‡æ¸¡ç¼“å†²åŒºåŠå…¶æœ«å°¾çš„å†…å­˜æ¥å®ŒæˆcreateTextureImageå‡½æ•°ï¼š</span></span><br><span class="line">    <span class="built_in">transitionImageLayout</span>(textureImage, VK_FORMAT_R8G8B8A8_UNORM,</span><br><span class="line">            VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL,</span><br><span class="line">            VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkDestroyBuffer</span>(device, stagingBuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, stagingBufferMemory, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkDestroyImage</span>(device, textureImage, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, textureImageMemory, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-9-æ€»ç»“"><a href="#1-9-æ€»ç»“" class="headerlink" title="1.9 æ€»ç»“"></a>1.9 æ€»ç»“</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»è®¾å¤‡ç‰©ç†å­˜å‚¨ä¸Šè¯»å–äº†å›¾ç‰‡å†…å®¹ï¼Œå°†å…¶è½¬æˆä¸´æ—¶ç¼“å­˜ååˆå°†å…¶å­˜å‚¨åœ¨å¯¹åº”GPUå¯è§çš„å†…å­˜ä¸­ä»¥åŠç”Ÿæˆå¯¹åº”VkImageçº¹ç†è´´å›¾å¯¹è±¡ï¼Œæ¥ä¸‹æ¥éœ€è¦å°†å…¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šè¿˜éœ€è¦æŠŠè¿™ä¸ªå¯¹è±¡æ”¾å…¥å›¾å½¢ç®¡é“ä¸­ã€‚</p>
<p>åœ¨å›é¡¾ä¸‹æœ¬ç« ä¸­çš„è¯»å–å›¾åƒçš„æ­¥éª¤:</p>
<ol>
<li>é¦–å…ˆåˆ©ç”¨stb-imageåº“è¯»å–å›¾ç‰‡ï¼Œå°†å…¶å†…å®¹å­˜å‚¨åœ¨ä¸´æ—¶ç¼“å­˜åŒºVkBufferä¸­ï¼Œæ³¨æ„éœ€è¦å¼€è¾ŸGPUå¯è§å†…å­˜</li>
<li>é€šè¿‡VkImageCreateInfoç»“æ„æŒ‡æ˜å›¾åƒæ ¼å¼å¹¶é€šè¿‡vkCreateImageåˆ›å»ºVkImageå¯¹è±¡</li>
<li>ç”¨VkBufferå›¾åƒæ–‡ä»¶ä¸­çš„åƒç´ å¡«å……åˆ›å»ºçš„VkImageå›¾åƒå¯¹è±¡<ol>
<li>å¡«å……å›¾åƒå¯¹è±¡éœ€è¦ä½¿ç”¨VkImageMemoryBarrier</li>
<li>ä½¿ç”¨vkCmdPipelineBarrierä½¿å¾—å›¾åƒå¡«å……Barrierç”Ÿæ•ˆ</li>
<li>é€šè¿‡vkCmdCopyBufferToImageå®Œæˆå›¾åƒåƒç´ ä»VkBufferåˆ°VkImageçš„æ‹·è´(å¡«å……)</li>
<li>å†é€šè¿‡VkImageMemoryBarrieræŒ‡å®šå›¾åƒæ˜¯èƒ½å¤Ÿä»ç€è‰²å™¨ä¸­çš„çº¹ç†å›¾åƒå¼€å§‹é‡‡æ ·</li>
</ol>
</li>
<li>åˆ›å»ºå›¾åƒè§†å›¾å’Œå›¾åƒé‡‡æ ·å™¨(åç»­ä¸‹ä¸€ç« å¼€å§‹å¤„ç†)</li>
<li>æ·»åŠ ä¸€ä¸ªç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦æ¥ä»çº¹ç†ä¸­é‡‡æ ·é¢œè‰²</li>
</ol>
<p>ä¸Šé¢æ­¥éª¤ä¸­ï¼Œ4å’Œ5æ˜¯ä¸‹ä¸€ç« çš„å†…å®¹ã€‚</p>
<h2 id="1-10-Windowsä¸Šçš„CMakefileLists-txtå†™æ³•"><a href="#1-10-Windowsä¸Šçš„CMakefileLists-txtå†™æ³•" class="headerlink" title="1.10 Windowsä¸Šçš„CMakefileLists.txtå†™æ³•"></a>1.10 Windowsä¸Šçš„CMakefileLists.txtå†™æ³•</h2><p>windowså¹³å°ä¸Šç¼–è¯‘å½“å‰é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨cmake, CMakefileLists.txtæ–‡ä»¶å¦‚ä¸‹(æ³¨æ„å…ˆå®‰è£…Vulkan sdk)ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">cmake_minimum_required (VERSION 3.7) #æœ€ä½è¦æ±‚çš„CMakeç‰ˆæœ¬</span><br><span class="line">project(MyVulkan) # é¡¹ç›®åç§°</span><br><span class="line">set(VERSION 0.0.1)</span><br><span class="line">set(CMAKE_BUILD_TYPE &quot;Debug&quot;)</span><br><span class="line">set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++17 -g -Wall -Wno-unused-variable -pthread&quot;)</span><br><span class="line"></span><br><span class="line">message(STATUS &quot;This is &quot; $&#123;PROJECT_NAME&#125; &quot; version &quot; $&#123;VERSION&#125;)</span><br><span class="line">message(STATUS &quot;This is for windows platform&quot;)</span><br><span class="line">message(&quot;Build Type:&quot; $&#123;CMAKE_BUILD_TYPE&#125; $&#123;CMAKE_CXX_FLAGS&#125;)</span><br><span class="line"></span><br><span class="line"># Use FindVulkan module added with CMAKE 3.7</span><br><span class="line">if (NOT CMAKE_VERSION VERSION_LESS 3.7.0)</span><br><span class="line">    message(STATUS &quot;Using module to find Vulkan&quot;)</span><br><span class="line">    find_package(Vulkan)</span><br><span class="line">endif()</span><br><span class="line"></span><br><span class="line">find_library(Vulkan_LIBRARY NAMES vulkan-1 vulkan PATHS $&#123;CMAKE_SOURCE_DIR&#125;/libs/vulkan)</span><br><span class="line">IF (Vulkan_LIBRARY)</span><br><span class="line">    set(Vulkan_FOUND ON)</span><br><span class="line">    MESSAGE(&quot;Using bundled Vulkan library version&quot;)</span><br><span class="line">ENDIF()</span><br><span class="line"></span><br><span class="line">message(STATUS &quot;Using Vulkan lib: &quot; $&#123;Vulkan_LIBRARY&#125;)</span><br><span class="line"></span><br><span class="line"># CMAKE_SOURCE_DIR ä»£è¡¨å·¥ç¨‹æ ¹ç›®å½•CMakeLists.txtæ–‡ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="line">set(ROOT_DIR $&#123;CMAKE_SOURCE_DIR&#125;)</span><br><span class="line"></span><br><span class="line">### GLFW3</span><br><span class="line">set(GLFW_LIB_DIR $&#123;ROOT_DIR&#125;/lib/glfw3)</span><br><span class="line">set(GLFW_LIBS $&#123;GLFW_LIB_DIR&#125;/glfw3dll.lib)</span><br><span class="line">### GLM</span><br><span class="line">set(GLM_INCLUDE_DIRS  $&#123;ROOT_DIR&#125;/include/glm)</span><br><span class="line">### stb-image</span><br><span class="line">set(STB_IMAGE_DIRS  $&#123;ROOT_DIR&#125;/include/stb-image)</span><br><span class="line"></span><br><span class="line">message(STATUS &quot;Lib path: &quot;)</span><br><span class="line">message(STATUS &quot;  GLFW3: &quot; $&#123;GLFW_LIBS&#125;)</span><br><span class="line">message(STATUS &quot;  GLM  : &quot; $&#123;GLM_INCLUDE_DIRS&#125;)</span><br><span class="line">message(STATUS &quot;  STB_IMAGE: &quot; $&#123;STB_IMAGE_DIRS&#125;)</span><br><span class="line"></span><br><span class="line"># å®šä¹‰å¤´æ–‡ä»¶æœç´¢è·¯å¾„</span><br><span class="line">include_directories($&#123;ROOT_DIR&#125;/inlcude</span><br><span class="line">                    $&#123;GLM_INCLUDE_DIRS&#125;)</span><br><span class="line"></span><br><span class="line">#aux_source_directory(./ SOURCE_DIR)</span><br><span class="line">aux_source_directory($&#123;ROOT_DIR&#125;/inlcude SOURCE_DIR)</span><br><span class="line">aux_source_directory($&#123;ROOT_DIR&#125;/src SOURCE_DIR)</span><br><span class="line"></span><br><span class="line"># Target</span><br><span class="line">add_executable(MyVulkan $&#123;SOURCE_DIR&#125;)</span><br><span class="line"></span><br><span class="line">####Vulkan</span><br><span class="line">find_package(Vulkan REQUIRED)</span><br><span class="line"># GLFW3 is dynamic link</span><br><span class="line">target_link_libraries($&#123;PROJECT_NAME&#125; Vulkan::Vulkan $&#123;GLFW_LIBS&#125;)</span><br></pre></td></tr></table></figure>

<p>é¡¹ç›®æ–‡ä»¶ç›®å½•:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-14-VkImage%E5%9B%BE%E5%83%8F%E7%9A%84%E5%88%9B%E5%BB%BA/Vulkan_14_1.png" alt="å›¾åƒ14-1"></p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(15)-å›¾åƒè§†å›¾å’Œé‡‡æ ·å™¨</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-15-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>å›é¡¾ä¸Šä¸€ç¯‡ç« ä¸­çš„è¯»å–å›¾åƒçš„æ­¥éª¤:</p>
<ol>
<li>é¦–å…ˆåˆ©ç”¨stb-imageåº“è¯»å–å›¾ç‰‡ï¼Œå°†å…¶å†…å®¹å­˜å‚¨åœ¨ä¸´æ—¶ç¼“å­˜åŒºVkBufferä¸­ï¼Œæ³¨æ„éœ€è¦å¼€è¾ŸGPUå¯è§å†…å­˜</li>
<li>é€šè¿‡VkImageCreateInfoç»“æ„æŒ‡æ˜å›¾åƒæ ¼å¼å¹¶é€šè¿‡vkCreateImageåˆ›å»ºVkImageå¯¹è±¡</li>
<li>ç”¨VkBufferå›¾åƒæ–‡ä»¶ä¸­çš„åƒç´ å¡«å……åˆ›å»ºçš„VkImageå›¾åƒå¯¹è±¡<ol>
<li>å¡«å……å›¾åƒå¯¹è±¡éœ€è¦ä½¿ç”¨VkImageMemoryBarrier</li>
<li>ä½¿ç”¨vkCmdPipelineBarrierä½¿å¾—å›¾åƒå¡«å……Barrierç”Ÿæ•ˆ</li>
<li>é€šè¿‡vkCmdCopyBufferToImageå®Œæˆå›¾åƒåƒç´ ä»VkBufferåˆ°VkImageçš„æ‹·è´(å¡«å……)</li>
<li>å†é€šè¿‡VkImageMemoryBarrieræŒ‡å®šå›¾åƒæ˜¯èƒ½å¤Ÿä»ç€è‰²å™¨ä¸­çš„çº¹ç†å›¾åƒå¼€å§‹é‡‡æ ·</li>
</ol>
</li>
<li>åˆ›å»ºå›¾åƒè§†å›¾å’Œå›¾åƒé‡‡æ ·å™¨</li>
<li>æ·»åŠ ä¸€ä¸ªç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦æ¥ä»çº¹ç†ä¸­é‡‡æ ·é¢œè‰²</li>
</ol>
<p>åœ¨å›¾åƒé‡‡æ ·å™¨åˆ›å»ºä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹çœ‹çº¹ç†å›¾åƒè§†å›¾ï¼Œè¿™ä¸ªæ˜¯åœ¨æˆ‘ä»¬åˆ›å»ºäº¤æ¢é“¾çš„æ—¶å€™è§è¿‡:</p>
<span id="more"></span>

<h1 id="ä¸€-çº¹ç†å›¾åƒè§†å›¾-Texture-Image-View"><a href="#ä¸€-çº¹ç†å›¾åƒè§†å›¾-Texture-Image-View" class="headerlink" title="ä¸€. çº¹ç†å›¾åƒè§†å›¾ Texture Image View"></a>ä¸€. çº¹ç†å›¾åƒè§†å›¾ Texture Image View</h1><p>é€šè¿‡VkImageViewç±»æ¥å­˜å‚¨çº¹ç†å›¾åƒè§†å›¾, å®ƒæè¿°äº†å¦‚ä½•è®¿é—®å›¾åƒä»¥åŠè¦è®¿é—®çš„å›¾åƒéƒ¨åˆ†ï¼Œåˆ›å»ºVkImageViewçš„æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªç»“æ„ä½“ï¼šVkImageViewCreateInfo, æ¥æŒ‡æ˜ç»†èŠ‚. è¿™éƒ¨åˆ†æˆ‘ä»¬åœ¨ä¹‹å‰çš„äº¤æ¢é“¾åˆ›å»ºå›¾åƒè§†å›¾ä¸­æœ‰è¿‡æ¥è§¦ï¼Œå¦‚æœå¿˜è®°äº†çš„è¯å¯ä»¥å›é¡¾ä¸€ä¸‹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkImageView textureImageView;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createTextureImage</span>();</span><br><span class="line">    <span class="built_in">createTextureImageView</span>();</span><br><span class="line">    <span class="built_in">createVertexBuffer</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">VkImageView <span class="title">createImageView</span><span class="params">(VkImage image, VkFormat format)</span> </span>&#123;</span><br><span class="line">    VkImageView imageView;</span><br><span class="line">    VkImageViewCreateInfo viewInfo = &#123;&#125;;</span><br><span class="line">    viewInfo.sType = VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO;</span><br><span class="line">    viewInfo.image = image; <span class="comment">// ç»‘å®š VkImage</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// viewTypeå’Œformatå­—æ®µæŒ‡å®šåº”å¦‚ä½•è§£é‡Šå›¾åƒæ•°æ®</span></span><br><span class="line">    <span class="comment">// viewTypeå‚æ•°æŒ‡å®šå›¾åƒä¸ºä¸€ç»´çº¹ç†ï¼ŒäºŒç»´çº¹ç†ï¼Œä¸‰ç»´çº¹ç†æˆ–ç«‹æ–¹ä½“è´´å›¾</span></span><br><span class="line">    viewInfo.viewType = VK_IMAGE_VIEW_TYPE_2D;</span><br><span class="line">    <span class="comment">// å›¾åƒæ ¼å¼</span></span><br><span class="line">    viewInfo.format = format;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// subresourceRangeå­—æ®µæè¿°äº†å›¾åƒçš„ç›®çš„æ˜¯ä»€ä¹ˆä»¥åŠåº”è¯¥è®¿é—®å›¾åƒçš„å“ªä¸ªéƒ¨åˆ†ã€‚</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œå›¾åƒå°†ç”¨ä½œé¢œè‰²ç›®æ ‡ï¼Œæ²¡æœ‰ä»»ä½•mipmappingçº§åˆ«æˆ–å¤šä¸ªå±‚ã€‚</span></span><br><span class="line">    viewInfo.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</span><br><span class="line">    viewInfo.subresourceRange.baseMipLevel = <span class="number">0</span>;</span><br><span class="line">    viewInfo.subresourceRange.levelCount = <span class="number">1</span>;</span><br><span class="line">    viewInfo.subresourceRange.baseArrayLayer = <span class="number">0</span>;</span><br><span class="line">    viewInfo.subresourceRange.layerCount = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œé€šè¿‡vkCreateXXXåˆ›å»ºçš„å¯¹è±¡ï¼Œä¸éœ€è¦æ—¶è¦ä¸»åŠ¨å»é‡Šæ”¾</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateImageView</span>(device, &amp;viewInfo, <span class="literal">nullptr</span>, &amp;imageView) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create image views!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> imageView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createImageViews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®é›†åˆå¤§å°</span></span><br><span class="line">    swapChainImageViews.<span class="built_in">resize</span>(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; swapChainImageViews.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        swapChainImageViews[i] = <span class="built_in">createImageView</span>(swapChainImages[i],</span><br><span class="line">                                        swapChainImageFormat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createTextureImageView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    textureImageView = <span class="built_in">createImageView</span>(textureImage,</span><br><span class="line">                                VK_FORMAT_R8G8B8A8_UNORM);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ vulkan ä¸­æ¨èåœ¨åˆ›å»ºçš„èµ„æºä¸éœ€è¦åä¸»åŠ¨é‡Šæ”¾</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¸…ç†äº¤æ¢é“¾å…³è”èµ„æº</span></span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line">    <span class="comment">// æ¸…ç†çº¹ç†è´´å›¾</span></span><br><span class="line">    <span class="built_in">vkDestroyImageView</span>(device, textureImageView, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkDestroyImage</span>(device, textureImage, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkFreeMemory</span>(device, textureImageMemory, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šï¼Œçº¹ç†å›¾åƒçš„è§†å›¾åˆ›å»ºæˆåŠŸäº†ï¼Œå¾ˆç®€å•ã€‚æ¥ä¸‹æ¥å°±æ˜¯é‡‡æ ·å™¨çš„åˆ›å»ºäº†ã€‚</p>
<h1 id="äºŒ-é‡‡æ ·å™¨"><a href="#äºŒ-é‡‡æ ·å™¨" class="headerlink" title="äºŒ. é‡‡æ ·å™¨"></a>äºŒ. é‡‡æ ·å™¨</h1><p>ç€è‰²å™¨å¯ä»¥ç›´æ¥ä»å›¾åƒè¯»å–çº¹ç†åƒç´ ï¼Œä½†æ˜¯å½“å°†å…¶ç”¨ä½œçº¹ç†æ—¶ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥è¯»å–ã€‚ é€šå¸¸é€šè¿‡é‡‡æ ·å™¨è®¿é—®çº¹ç†ï¼Œé‡‡æ ·å™¨å°†åº”ç”¨è¿‡æ»¤å’Œè½¬æ¢ä»¥è®¡ç®—æœ€ç»ˆè·å–çš„é¢œè‰²ã€‚</p>
<p>è¿™äº›è¿‡æ»¤å™¨æœ‰åŠ©äºå¤„ç†è¿‡é‡‡æ ·ç­‰é—®é¢˜ã€‚ è€ƒè™‘ä¸€ä¸ªæ˜ å°„åˆ°å‡ ä½•å›¾å½¢çš„çº¹ç†ï¼Œè¯¥çº¹ç†çš„ç¢ç‰‡å¤šäºçº¹ç†åƒç´ ã€‚</p>
<p>å¦‚æœåªæ˜¯åœ¨æ¯ä¸ªç‰‡æ®µä¸­ä½¿ç”¨æœ€æ¥è¿‘çš„çº¹ç†åƒç´ ä½œä¸ºçº¹ç†åæ ‡ï¼Œé‚£ä¹ˆå°†è·å¾—ä¸‹å›¾å·¦è¾¹å›¾åƒçš„ç»“æœï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-15-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/Vulkan_15_1.png" alt="å›¾åƒ15-1"></p>
<p>è€Œé€šè¿‡çº¿æ€§æ’å€¼æ³•å°†4ä¸ªæœ€æ¥è¿‘çš„çº¹ç†åƒç´ ç»„åˆåœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆå°†è·å¾—å¦‚ä¸Šå³å›¾æ‰€ç¤ºçš„æ›´å¹³æ»‘çš„ç»“æœã€‚ å½“ç„¶ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯èƒ½å…·æœ‰æ›´é€‚åˆå·¦ä¾§é£æ ¼çš„è‰ºæœ¯é£æ ¼è¦æ±‚ï¼ˆæ¯”å¦‚Minecraftï¼Œå“ˆå“ˆï¼‰ï¼Œä½†æ˜¯åœ¨å¸¸è§„å›¾å½¢åº”ç”¨ç¨‹åºä¸­ï¼Œå³ä¾§é£æ ¼æ˜¯é¦–é€‰ï¼Œå›¾åƒè¶Šç²¾ç»†è¶Šå¥½ã€‚ ä»çº¹ç†è¯»å–é¢œè‰²æ—¶ï¼Œé‡‡æ ·å™¨å¯¹è±¡ä¼šè‡ªåŠ¨ä¸ºæ‚¨åº”ç”¨æ­¤è¿‡æ»¤ã€‚</p>
<p>æŠ½æ ·ä¸è¶³(æ¬ é‡‡æ ·)åˆ™æ˜¯ç›¸åçš„é—®é¢˜ï¼Œæ¯”å¦‚çº¹ç†åƒç´ å¤šäºç‰‡æ®µã€‚è¿™å°†å¯¼è‡´åœ¨ä»¥é”è§’é‡‡æ ·é«˜é¢‘å›¾æ¡ˆ(å¦‚æ£‹ç›˜çº¹ç†)æ—¶äº§ç”Ÿä¼ªå½±:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-15-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/Vulkan_15_2.png" alt="å›¾åƒ15-2"></p>
<p>å¦‚å·¦å›¾æ‰€ç¤ºï¼Œçº¹ç†åœ¨è¿œå¤„å˜å¾—æ¨¡ç³Šæ··ä¹±ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯å„å‘å¼‚æ€§æ»¤æ³¢ï¼Œå®ƒä¹Ÿå¯ä»¥ç”±é‡‡æ ·å™¨è‡ªåŠ¨åº”ç”¨ã€‚</p>
<p>é™¤äº†è¿™äº›è¿‡æ»¤å™¨ï¼Œé‡‡æ ·å™¨è¿˜å¯ä»¥å¤„ç†è½¬æ¢ã€‚å®ƒå†³å®šå½“ä½ è¯•å›¾é€šè¿‡å®ƒçš„å¯»å€æ¨¡å¼è¯»å–å›¾åƒå¤–çš„texelæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä¸‹é¢çš„å›¾ç‰‡æ˜¾ç¤ºäº†ä¸€äº›å¯èƒ½æ€§:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-15-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/Vulkan_15_3.png" alt="å›¾åƒ15-3"></p>
<h2 id="2-1-createTextureSampler"><a href="#2-1-createTextureSampler" class="headerlink" title="2.1 createTextureSampler"></a>2.1 createTextureSampler</h2><p>ç°åœ¨åˆ›å»ºä¸€ä¸ªå‡½æ•°createTextureSampleræ¥è®¾ç½®è¿™æ ·çš„é‡‡æ ·å¯¹è±¡ã€‚ç¨åæˆ‘ä»¬å°†åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨é‡‡æ ·å™¨ä»çº¹ç†ä¸­è¯»å–é¢œè‰²:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkImageView textureImageView;</span><br><span class="line">VkSampler textureSampler;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createTextureImage</span>();</span><br><span class="line">    <span class="built_in">createTextureImageView</span>();</span><br><span class="line">    <span class="built_in">createTextureSampler</span>();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createTextureSampler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é‡‡æ ·å™¨é€šè¿‡VkSamplerCreateInfoç»“æ„è¿›è¡Œé…ç½®ï¼Œè¯¥ç»“æ„æŒ‡å®šäº†åº”åº”ç”¨çš„æ‰€æœ‰è¿‡æ»¤å™¨å’Œè½¬æ¢ã€‚ </span></span><br><span class="line">    VkSamplerCreateInfo samplerInfo = &#123;&#125;;</span><br><span class="line">    samplerInfo.sType = VK_STRUCTURE_TYPE_SAMPLER_CREATE_INFO;</span><br><span class="line">    <span class="comment">// magFilterå’ŒminFilterå­—æ®µæŒ‡å®šå¦‚ä½•å¯¹æ”¾å¤§æˆ–ç¼©å°çš„çº¹ç†åƒç´ è¿›è¡Œæ’å€¼ã€‚</span></span><br><span class="line">    <span class="comment">// æ”¾å¤§å€æ•°ä¸ä¸Šé¢æè¿°çš„è¿‡é‡‡æ ·é—®é¢˜æœ‰å…³ï¼Œè€Œç¼©å°å€æ•°ä¸æ¬ é‡‡æ ·æœ‰å…³ã€‚</span></span><br><span class="line">    <span class="comment">// æŒ‡å®šè¦åº”ç”¨äºæŸ¥æ‰¾çš„æ”¾å¤§æ»¤é•œä¸ºçº¿æ€§è¿‡æ»¤</span></span><br><span class="line">    samplerInfo.magFilter = VK_FILTER_LINEAR;</span><br><span class="line">    <span class="comment">// æŒ‡å®šè¦åº”ç”¨äºæŸ¥æ‰¾çš„ç¼©å°è¿‡æ»¤å™¨ä¸ºçº¿æ€§è¿‡æ»¤</span></span><br><span class="line">    samplerInfo.minFilter = VK_FILTER_LINEAR;</span><br><span class="line">    <span class="comment">// æŒ‡å®šUã€Vã€Wåæ ‡çš„[0..1]èŒƒå›´ä¹‹å¤–çš„å¯»å€æ¨¡å¼, æŒ‡å®šå½“è¶…å‡ºå›¾åƒå°ºå¯¸æ—¶ï¼Œé‡å¤çº¹ç†</span></span><br><span class="line">    <span class="comment">// æ³¨æ„ï¼Œè½´ç§°ä¸ºUï¼ŒVå’ŒWï¼Œè€Œä¸æ˜¯Xï¼ŒYå’ŒZã€‚è¿™æ˜¯çº¹ç†ç©ºé—´åæ ‡çš„çº¦å®š</span></span><br><span class="line">    samplerInfo.addressModeU = VK_SAMPLER_ADDRESS_MODE_REPEAT;</span><br><span class="line">    samplerInfo.addressModeV = VK_SAMPLER_ADDRESS_MODE_REPEAT;</span><br><span class="line">    samplerInfo.addressModeW = VK_SAMPLER_ADDRESS_MODE_REPEAT;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// anisotropyEnableä¸ºtrue, é‡‡æ ·å™¨ä½¿ç”¨ä½¿ç”¨å„å‘å¼‚æ€§è¿‡æ»¤</span></span><br><span class="line">    samplerInfo.anisotropyEnable = VK_TRUE;</span><br><span class="line">    samplerInfo.maxAnisotropy = <span class="number">16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// borderColorå­—æ®µæŒ‡å®šåœ¨ä½¿ç”¨è¾¹ç•Œå¯»å€æ¨¡å¼å¯¹å›¾åƒè¿›è¡Œé‡‡æ ·ä»¥å¤–æ—¶è¿”å›çš„é¢œè‰²ã€‚ </span></span><br><span class="line">    <span class="comment">// å¯ä»¥ä»¥floatæˆ–intæ ¼å¼è¿”å›é»‘è‰²ï¼Œç™½è‰²æˆ–é€æ˜ã€‚</span></span><br><span class="line">    samplerInfo.borderColor = VK_BORDER_COLOR_INT_OPAQUE_BLACK;</span><br><span class="line">    <span class="comment">// æŒ‡å®šè¦ç”¨äºå¤„ç†å›¾åƒä¸­çº¹ç†åƒç´ çš„åæ ‡ç³»</span></span><br><span class="line">    <span class="comment">// ä¸ºVK_FALSEï¼Œåˆ™å°†ä½¿ç”¨æ‰€æœ‰è½´ä¸Šçš„[0ï¼Œ1ï¼‰èŒƒå›´å¯¹çº¹ç†åƒç´ è¿›è¡Œå¯»å€</span></span><br><span class="line">    samplerInfo.unnormalizedCoordinates = VK_FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå¯ç”¨äº†æ¯”è¾ƒåŠŸèƒ½ï¼Œåˆ™å°†é¦–å…ˆå°†çº¹ç†åƒç´ ä¸ä¸€ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä¸”è¯¥æ¯”è¾ƒçš„ç»“æœå°†ç”¨äºè¿‡æ»¤æ“ä½œä¸­ã€‚ ä¸»è¦ç”¨äºé˜´å½±è´´å›¾ä¸Šçš„ç™¾åˆ†æ¯”å°é—­å™¨è¿‡æ»¤ã€‚</span></span><br><span class="line">    samplerInfo.compareEnable = VK_FALSE;</span><br><span class="line">    samplerInfo.compareOp = VK_COMPARE_OP_ALWAYS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰€æœ‰è¿™äº›å­—æ®µéƒ½é€‚ç”¨äºmipmappingã€‚ä»¥åè®¨è®ºmipmapping</span></span><br><span class="line">    samplerInfo.mipmapMode = VK_SAMPLER_MIPMAP_MODE_LINEAR;</span><br><span class="line">    samplerInfo.mipLodBias = <span class="number">0.0f</span>;</span><br><span class="line">    samplerInfo.minLod = <span class="number">0.0f</span>;</span><br><span class="line">    samplerInfo.maxLod = <span class="number">0.0f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºé‡‡æ ·å™¨ï¼Œæ³¨æ„æ¸…ç†</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateSampler</span>(device, &amp;samplerInfo, <span class="literal">nullptr</span>, &amp;textureSampler) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create texture sampler!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cleanupSwapChain</span>();</span><br><span class="line">    <span class="comment">// æ¸…ç†é‡‡æ ·å™¨</span></span><br><span class="line">    <span class="built_in">vkDestroySampler</span>(device, textureSampler, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>samplerInfoä¸­çš„anisotropyEnableå’ŒmaxAnisotropyè¿™ä¸¤ä¸ªå­—æ®µæŒ‡å®šæ˜¯å¦åº”è¯¥ä½¿ç”¨å„å‘å¼‚æ€§è¿‡æ»¤ã€‚æœ€å¤§å„å‘å¼‚æ€§å­—æ®µé™åˆ¶äº†å¯ä»¥ç”¨æ¥è®¡ç®—æœ€ç»ˆé¢œè‰²çš„texelæ ·æœ¬çš„æ•°é‡ã€‚æ•°å€¼è¶Šä½ï¼Œæ€§èƒ½è¶Šå¥½ï¼Œä½†è´¨é‡è¶Šä½ã€‚ç›®å‰æ²¡æœ‰ä»»ä½•å›¾å½¢ç¡¬ä»¶å¯ä»¥ä½¿ç”¨è¶…è¿‡16ä¸ªæ ·æœ¬ï¼Œå› ä¸ºè¶…è¿‡è¿™ä¸ªå€¼çš„å·®å¼‚å°±å¯ä»¥å¿½ç•¥ä¸è®¡äº†ã€‚</p>
<p>unnormalizedCoordinateså­—æ®µæŒ‡å®šè¦ç”¨äºå¤„ç†å›¾åƒä¸­çº¹ç†åƒç´ çš„åæ ‡ç³»ã€‚ å¦‚æœæ­¤å­—æ®µä¸ºVK_TRUEï¼Œåˆ™å¯ä»¥ç®€å•åœ°ä½¿ç”¨[0ï¼ŒtexWidthï¼‰å’Œ[0ï¼ŒtexHeightï¼‰èŒƒå›´å†…çš„åæ ‡ã€‚ å¦‚æœä¸ºVK_FALSEï¼Œåˆ™å°†ä½¿ç”¨æ‰€æœ‰è½´ä¸Šçš„[0ï¼Œ1ï¼‰èŒƒå›´å¯¹çº¹ç†åƒç´ è¿›è¡Œå¯»å€ã€‚ å®é™…åº”ç”¨ä¸­å‡ ä¹æ€»æ˜¯ä½¿ç”¨å½’ä¸€åŒ–çš„åæ ‡ï¼Œå› ä¸ºè¿™æ ·ä¸€æ¥ï¼Œä¾¿å¯ä»¥ä½¿ç”¨åˆ†è¾¨ç‡å®Œå…¨ç›¸åŒçš„ä¸åŒåˆ†è¾¨ç‡çš„çº¹ç†ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œé‡‡æ ·å™¨æœªåœ¨ä»»ä½•åœ°æ–¹å¼•ç”¨VkImageã€‚ é‡‡æ ·å™¨æ˜¯ä¸€ä¸ªç‹¬ç‰¹çš„å¯¹è±¡ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªæ¥å£æ¥ä»çº¹ç†ä¸­æå–é¢œè‰²ã€‚ å®ƒå¯ä»¥åº”ç”¨äºæ‰€éœ€çš„ä»»ä½•å›¾åƒï¼Œæ— è®ºæ˜¯1Dï¼Œ2Dè¿˜æ˜¯3Dã€‚ è¿™ä¸è®¸å¤šè¾ƒæ—©çš„APIä¸åŒï¼Œåè€…å°†çº¹ç†å›¾åƒå’Œè¿‡æ»¤åˆå¹¶ä¸ºä¸€ä¸ªçŠ¶æ€ã€‚</p>
<h2 id="2-2-VkSamplerCreateInfo"><a href="#2-2-VkSamplerCreateInfo" class="headerlink" title="2.2 VkSamplerCreateInfo"></a>2.2 VkSamplerCreateInfo</h2><p>VkSamplerCreateInfoç»“æ„ä½“æŒ‡å®šäº†é‡‡æ ·å™¨å¯¹è±¡çš„çŠ¶æ€ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkSamplerCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType         sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*             pNext;</span><br><span class="line">    VkSamplerCreateFlags    flags;</span><br><span class="line">    VkFilter                magFilter;</span><br><span class="line">    VkFilter                minFilter;</span><br><span class="line">    VkSamplerMipmapMode     mipmapMode;</span><br><span class="line">    VkSamplerAddressMode    addressModeU;</span><br><span class="line">    VkSamplerAddressMode    addressModeV;</span><br><span class="line">    VkSamplerAddressMode    addressModeW;</span><br><span class="line">    <span class="type">float</span>                   mipLodBias;</span><br><span class="line">    VkBool32                anisotropyEnable;</span><br><span class="line">    <span class="type">float</span>                   maxAnisotropy;</span><br><span class="line">    VkBool32                compareEnable;</span><br><span class="line">    VkCompareOp             compareOp;</span><br><span class="line">    <span class="type">float</span>                   minLod;</span><br><span class="line">    <span class="type">float</span>                   maxLod;</span><br><span class="line">    VkBorderColor           borderColor;</span><br><span class="line">    VkBool32                unnormalizedCoordinates;</span><br><span class="line">&#125; VkSamplerCreateInfo;</span><br></pre></td></tr></table></figure>

<ol>
<li>sTypeæ˜¯æ­¤ç»“æ„çš„ç±»å‹ï¼Œ VK_STRUCTURE_TYPE_SAMPLER_CREATE_INFO</li>
<li>pNextæ˜¯NULLæˆ–æŒ‡å‘æ‰©å±•ç‰¹å®šç»“æ„çš„æŒ‡é’ˆ</li>
<li>flagæ˜¯VkSamplerCreateFlagBitsçš„ä½æ©ç ï¼Œæè¿°äº†é‡‡æ ·å™¨çš„å…¶ä»–å‚æ•°</li>
<li>magFilteræ˜¯VkFilterå€¼ï¼Œç”¨äºæŒ‡å®šè¦åº”ç”¨äºæŸ¥æ‰¾çš„æ”¾å¤§æ»¤é•œ<ol>
<li>VK_FILTER_NEAREST æŒ‡å®šæœ€è¿‘çš„è¿‡æ»¤</li>
<li>VK_FILTER_LINEAR æŒ‡å®šçº¿æ€§è¿‡æ»¤</li>
<li>VK_FILTER_CUBIC_EXT æŒ‡å®šä¸‰æ¬¡è¿‡æ»¤</li>
<li>VK_FILTER_CUBIC_IMG æŒ‡å®šä¸‰æ¬¡è¿‡æ»¤ï¼ŒåŒVK_FILTER_CUBIC_EXT</li>
</ol>
</li>
<li>minFilteræ˜¯ä¸€ä¸ªVkFilterå€¼ï¼Œç”¨äºæŒ‡å®šè¦åº”ç”¨äºæŸ¥æ‰¾çš„ç¼©å°è¿‡æ»¤å™¨</li>
<li>mipmapModeæ˜¯VkSamplerMipmapModeå€¼ï¼ŒæŒ‡å®šè¦åº”ç”¨äºæŸ¥æ‰¾çš„mipmapè¿‡æ»¤å™¨</li>
<li>addressModeUæ˜¯VkSamplerAddressModeå€¼ï¼Œç”¨äºä¸ºUåæ ‡æŒ‡å®š[0..1]èŒƒå›´ä¹‹å¤–çš„å¯»å€æ¨¡å¼<ol>
<li>VK_SAMPLER_ADDRESS_MODE_REPEAT å½“è¶…å‡ºå›¾åƒå°ºå¯¸æ—¶ï¼Œé‡å¤çº¹ç†</li>
<li>VK_SAMPLER_ADDRESS_MODE_MIRRORED_REPEAT ç±»ä¼¼äºé‡å¤ï¼Œä½†æ˜¯å½“è¶…å‡ºå°ºå¯¸æ—¶ä¼šåè½¬åæ ‡ä»¥é•œåƒå›¾åƒ</li>
<li>VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE åœ¨å›¾åƒå°ºå¯¸ä¹‹å¤–ï¼Œè·å–æœ€é è¿‘åæ ‡çš„è¾¹ç¼˜çš„é¢œè‰²</li>
<li>VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_BORDER å½“é‡‡æ ·è¶…å‡ºå›¾åƒå°ºå¯¸æ—¶ï¼Œè¿”å›çº¯è‰²</li>
<li>VK_SAMPLER_ADDRESS_MODE_MIRROR_CLAMP_TO_EDGE ç±»ä¼¼CLAMP_TO_EDGEï¼Œä½†ä½¿ç”¨ä¸æœ€è¿‘è¾¹ç¼˜ç›¸åçš„è¾¹ç¼˜,ä»…åœ¨å¯ç”¨samplerMirrorClampToEdgeæˆ–å¯ç”¨[VK_KHR_sampler_mirror_clamp_to_edge]æ‰©å±•ååæ‰æœ‰æ•ˆ</li>
</ol>
</li>
<li>addressModeVæ˜¯VkSamplerAddressModeå€¼ï¼Œç”¨äºæŒ‡å®šVåæ ‡çš„[0..1]èŒƒå›´ä¹‹å¤–çš„å¯»å€æ¨¡å¼</li>
<li>addressModeWæ˜¯VkSamplerAddressModeå€¼ï¼Œå®ƒä¸ºWåæ ‡æŒ‡å®š[0..1]èŒƒå›´ä¹‹å¤–çš„å¯»å€æ¨¡å¼</li>
<li>mipLodBiasæ˜¯è¦æ·»åŠ åˆ°mipmap LODï¼ˆè¯¦ç»†ç¨‹åº¦ï¼‰è®¡ç®—ä¸­çš„åå·®ï¼Œä»¥åŠç”±SPIR-Vä¸­çš„å›¾åƒé‡‡æ ·åŠŸèƒ½æä¾›çš„åå·®</li>
<li>anisotropyEnableä¸ºVK_TRUEä»¥å¯ç”¨å„å‘å¼‚æ€§è¿‡æ»¤ï¼Œå¦‚â€œ Texelå„å‘å¼‚æ€§è¿‡æ»¤â€éƒ¨åˆ†æ‰€è¿°ï¼Œå¦åˆ™ä¸ºVK_FALSE</li>
<li>maxAnisotropyæ˜¯anisotropyEnableä¸ºVK_TRUEæ—¶é‡‡æ ·å™¨ä½¿ç”¨çš„å„å‘å¼‚æ€§å€¼é’³ä½ã€‚å¦‚æœanisotropyEnableä¸ºVK_FALSEï¼Œåˆ™maxAnisotropyè¢«å¿½ç•¥</li>
<li>compareEnableä¸ºVK_TRUEï¼Œä»¥å…è®¸åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­ä¸å‚è€ƒå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦åˆ™ä¸ºVK_FALSE<ol>
<li>æ³¨æ„ï¼šå¦‚æœæ­¤æˆå‘˜ä¸åŒ¹é…ï¼Œåˆ™æŸäº›å®ç°å°†é»˜è®¤ä¸ºç€è‰²å™¨çŠ¶æ€</li>
</ol>
</li>
<li>compareOpæ˜¯ä¸€ä¸ªVkCompareOpå€¼ï¼Œå®ƒæŒ‡å®šæ¯”è¾ƒåŠŸèƒ½ï¼Œä»¥æŒ‰â€œæ·±åº¦æ¯”è¾ƒæ“ä½œâ€éƒ¨åˆ†æ‰€è¿°åœ¨è¿‡æ»¤ä¹‹å‰å°†å…¶åº”ç”¨äºè·å–çš„æ•°æ®</li>
<li>minLodå’ŒmaxLodæ˜¯ç”¨äºé’³ä½è®¡ç®—çš„LODå€¼çš„å€¼</li>
<li>borderColoræ˜¯VkBorderColorå€¼ï¼Œç”¨äºæŒ‡å®šè¦ä½¿ç”¨çš„é¢„å®šä¹‰è¾¹æ¡†é¢œè‰²</li>
<li>unnormalizedCoordinatesæŒ‡å®šè¦ç”¨äºå¤„ç†å›¾åƒä¸­çº¹ç†åƒç´ çš„åæ ‡ç³»ã€‚è®¾ç½®ä¸ºVK_TRUEæ—¶ï¼Œç”¨äºæŸ¥æ‰¾çº¹ç†åƒç´ çš„å›¾åƒåæ ‡çš„èŒƒå›´åœ¨0åˆ°xï¼Œyå’Œzçš„å›¾åƒå°ºå¯¸çš„èŒƒå›´å†…ã€‚è®¾ç½®ä¸ºVK_FALSEæ—¶ï¼Œå›¾åƒåæ ‡èŒƒå›´ä¸ºé›¶åˆ°ä¸€ã€‚<ol>
<li>å½“unnormalizedCoordinatesä¸ºVK_TRUEæ—¶ï¼Œåœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨é‡‡æ ·å™¨çš„å›¾åƒå…·æœ‰ä»¥ä¸‹è¦æ±‚ï¼š<ol>
<li>viewTypeå¿…é¡»ä¸ºVK_IMAGE_VIEW_TYPE_1Dæˆ–VK_IMAGE_VIEW_TYPE_2D</li>
<li>å›¾åƒè§†å›¾å¿…é¡»å…·æœ‰å•ä¸ªå›¾å±‚å’Œå•ä¸ªmipçº§åˆ«</li>
</ol>
</li>
<li>å½“unnormalizedCoordinatesä¸ºVK_TRUEæ—¶ï¼Œä½¿ç”¨é‡‡æ ·å™¨çš„ç€è‰²å™¨ä¸­çš„å›¾åƒå†…ç½®å‡½æ•°å…·æœ‰ä»¥ä¸‹è¦æ±‚ï¼š<ol>
<li>è¿™äº›åŠŸèƒ½ä¸å¾—ä½¿ç”¨æŠ•å½±</li>
<li>è¿™äº›å‡½æ•°ä¸å¾—ä½¿ç”¨åç§»é‡</li>
</ol>
</li>
</ol>
</li>
</ol>
<h2 id="2-3-vkCreateSampler"><a href="#2-3-vkCreateSampler" class="headerlink" title="2.3 vkCreateSampler"></a>2.3 vkCreateSampler</h2><p>VkSamplerå¯¹è±¡è¡¨ç¤ºå›¾åƒé‡‡æ ·å™¨çš„çŠ¶æ€ï¼Œå®ç°å¯ä½¿ç”¨è¯¥å¯¹è±¡è¯»å–å›¾åƒæ•°æ®å¹¶ä¸ºç€è‰²å™¨åº”ç”¨è¿‡æ»¤å’Œå…¶ä»–è½¬æ¢ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateSampler</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkSamplerCreateInfo*                  pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkSampler*                                  pSampler)</span></span>;</span><br></pre></td></tr></table></figure>

<ol>
<li>deviceæ˜¯åˆ›å»ºé‡‡æ ·å™¨çš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfoæ˜¯æŒ‡å‘VkSamplerCreateInfoç»“æ„çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æŒ‡å®šé‡‡æ ·å™¨å¯¹è±¡çš„çŠ¶æ€</li>
<li>pAllocatoræ§åˆ¶ä¸»æœºå†…å­˜åˆ†é…</li>
<li>pSampleræ˜¯æŒ‡å‘VkSamplerå¥æŸ„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥å¥æŸ„ä¸­è¿”å›ç”Ÿæˆçš„é‡‡æ ·å™¨å¯¹è±¡</li>
</ol>
<h2 id="2-4-è®¾å¤‡åŠŸèƒ½ä¹‹å„å‘å¼‚æ€§è¿‡æ»¤"><a href="#2-4-è®¾å¤‡åŠŸèƒ½ä¹‹å„å‘å¼‚æ€§è¿‡æ»¤" class="headerlink" title="2.4 è®¾å¤‡åŠŸèƒ½ä¹‹å„å‘å¼‚æ€§è¿‡æ»¤"></a>2.4 è®¾å¤‡åŠŸèƒ½ä¹‹å„å‘å¼‚æ€§è¿‡æ»¤</h2><p>å¦‚æœç°åœ¨è¿è¡Œç¨‹åºï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„éªŒè¯å±‚æ¶ˆæ¯ï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-15-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/Vulkan_15_4.png" alt="å›¾ç‰‡15-4"></p>
<p>è¿™æ˜¯å› ä¸ºå„å‘å¼‚æ€§è¿‡æ»¤å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯é€‰çš„è®¾å¤‡ç‰¹æ€§ã€‚æˆ‘ä»¬éœ€è¦æ›´æ–°createLogicalDeviceå‡½æ•°æ¥è¯·æ±‚å®ƒ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPhysicalDeviceFeatures deviceFeatures = &#123;&#125;;</span><br><span class="line">deviceFeatures.samplerAnisotropy = VK_TRUE;</span><br></pre></td></tr></table></figure>

<p>å³ä½¿ç°åœ¨çš„æ˜¾å¡ä¸æ”¯æŒå®ƒçš„å¯èƒ½æ€§å¾ˆå°ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æ›´æ–°isDeviceSuitableæ¥æ£€æŸ¥å®ƒæ˜¯å¦å¯ç”¨:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isDeviceSuitable</span><span class="params">(VkPhysicalDevice device)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    VkPhysicalDeviceFeatures supportedFeatures;</span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceFeatures</span>(device, &amp;supportedFeatures);</span><br><span class="line">    <span class="keyword">return</span> indices.<span class="built_in">isComplete</span>() &amp;&amp; extensionsSupported &amp;&amp;</span><br><span class="line">            swapChainAdequate &amp;&amp; supportedFeatures.samplerAnisotropy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vkGetPhysicalDeviceFeaturesé‡æ–°è°ƒæ•´VkPhysicalDeviceFeaturesç»“æ„çš„ç”¨é€”ï¼Œé€šè¿‡è®¾ç½®å¸ƒå°”å€¼æ¥æŒ‡ç¤ºæ”¯æŒå“ªäº›åŠŸèƒ½ï¼Œè€Œä¸æ˜¯è¯·æ±‚å“ªäº›åŠŸèƒ½ã€‚</p>
<p>é™¤äº†å¼ºåˆ¶å„å‘å¼‚æ€§è¿‡æ»¤çš„å¯ç”¨æ€§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ¡ä»¶è®¾ç½®ä¸ä½¿ç”¨å®ƒ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">samplerInfo.anisotropyEnable = VK_FALSE;</span><br><span class="line">samplerInfo.maxAnisotropy = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="2-5-å°ç»“"><a href="#2-5-å°ç»“" class="headerlink" title="2.5 å°ç»“"></a>2.5 å°ç»“</h2><p>ç°åœ¨å›¾åƒæœ‰äº†ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å‘ç€è‰²å™¨å…¬å¼€å›¾åƒå’Œé‡‡æ ·å™¨å¯¹è±¡ï¼Œä»¥ä¾¿å°†çº¹ç†ç»˜åˆ¶åˆ°æ­£æ–¹å½¢ä¸Šå¹¶å‘ˆç°å‡ºæ¥ã€‚</p>
<h1 id="ä¸‰-ç»„åˆå›¾åƒé‡‡æ ·å™¨"><a href="#ä¸‰-ç»„åˆå›¾åƒé‡‡æ ·å™¨" class="headerlink" title="ä¸‰. ç»„åˆå›¾åƒé‡‡æ ·å™¨"></a>ä¸‰. ç»„åˆå›¾åƒé‡‡æ ·å™¨</h1><p>æˆ‘ä»¬åœ¨ç»Ÿä¸€ç¼“å†²åŒºéƒ¨åˆ†ä¸­äº†è§£äº†æè¿°ç¬¦ã€‚ ç°åœ¨æˆ‘ä»¬çœ‹ä¸€ç§æ–°å‹çš„æè¿°ç¬¦ï¼šç»„åˆå›¾åƒé‡‡æ ·å™¨ã€‚ è¯¥æè¿°ç¬¦ä½¿ç€è‰²å™¨å¯ä»¥é€šè¿‡é‡‡æ ·å™¨å¯¹è±¡è®¿é—®å›¾åƒèµ„æºã€‚</p>
<p>æˆ‘ä»¬å°†ä»ä¿®æ”¹æè¿°ç¬¦å¸ƒå±€ï¼Œæè¿°ç¬¦æ± å’Œæè¿°ç¬¦é›†å¼€å§‹ï¼Œä»¥åŒ…æ‹¬æ­¤ç±»ç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦ã€‚ ä¹‹åï¼Œæˆ‘ä»¬å°†å‘é¡¶ç‚¹æ·»åŠ çº¹ç†åæ ‡ï¼Œå¹¶ä¿®æ”¹ç‰‡æ®µç€è‰²å™¨ä»¥ä»çº¹ç†è¯»å–é¢œè‰²ï¼Œè€Œä¸ä»…ä»…æ˜¯æ’å…¥é¡¶ç‚¹é¢œè‰²ã€‚</p>
<h2 id="3-1-æ›´æ–°æè¿°ç¬¦"><a href="#3-1-æ›´æ–°æè¿°ç¬¦" class="headerlink" title="3.1 æ›´æ–°æè¿°ç¬¦"></a>3.1 æ›´æ–°æè¿°ç¬¦</h2><p>å›åˆ°createDescriptorSetLayoutå‡½æ•°ï¼Œä¸ºç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦æ·»åŠ VkDescriptorSetLayoutBindingã€‚ å°†å…¶æ”¾åœ¨ç»Ÿä¸€ç¼“å†²åŒºä¹‹åçš„ç»‘å®šä¸­ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createDescriptorSetLayout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDescriptorSetLayoutBinding uboLayoutBinding = &#123;&#125;;</span><br><span class="line">    <span class="comment">// æŒ‡å®šåœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çš„ç»‘å®š</span></span><br><span class="line">    uboLayoutBinding.binding = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// æè¿°ç¬¦çš„ç±»å‹</span></span><br><span class="line">    uboLayoutBinding.descriptorType = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">    uboLayoutBinding.descriptorCount = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæè¿°ç¬¦å°†åœ¨é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µè¢«å¼•ç”¨</span></span><br><span class="line">    uboLayoutBinding.stageFlags = VK_SHADER_STAGE_VERTEX_BIT;</span><br><span class="line">    <span class="comment">// pImmutableSamplersä»…ä¸å›¾åƒé‡‡æ ·æè¿°ç¬¦æœ‰å…³</span></span><br><span class="line">    uboLayoutBinding.pImmutableSamplers = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºé‡‡æ ·å™¨æè¿°ç¬¦</span></span><br><span class="line">    VkDescriptorSetLayoutBinding samplerLayoutBinding = &#123;&#125;;</span><br><span class="line">    samplerLayoutBinding.binding = <span class="number">1</span>;</span><br><span class="line">    samplerLayoutBinding.descriptorCount = <span class="number">1</span>;</span><br><span class="line">    samplerLayoutBinding.descriptorType = VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER;</span><br><span class="line">    samplerLayoutBinding.pImmutableSamplers = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="comment">// æŒ‡æ˜ç‰‡æ®µç€è‰²å™¨é˜¶æ®µå¯ä»¥ä½¿ç”¨ç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦, é‚£å°±æ˜¯ç‰‡æ®µé¢œè‰²ç¡®å®šçš„åœ°æ–¹ã€‚</span></span><br><span class="line">    <span class="comment">// å¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä½¿ç”¨çº¹ç†é‡‡æ ·ï¼Œä¾‹å¦‚é€šè¿‡é«˜åº¦å›¾ä½¿é¡¶ç‚¹ç½‘æ ¼åŠ¨æ€å˜å½¢ã€‚</span></span><br><span class="line">    samplerLayoutBinding.stageFlags = VK_SHADER_STAGE_FRAGMENT_BIT;</span><br><span class="line"></span><br><span class="line">    std::array&lt;VkDescriptorSetLayoutBinding, 2&gt; bindings = &#123;uboLayoutBinding, samplerLayoutBinding&#125;;</span><br><span class="line"></span><br><span class="line">    VkDescriptorSetLayoutCreateInfo layoutInfo = &#123;&#125;;</span><br><span class="line">    layoutInfo.sType = VK_STRUCTURE_TYPE_DESCRIPTOR_SET_LAYOUT_CREATE_INFO;</span><br><span class="line">    layoutInfo.bindingCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(bindings.<span class="built_in">size</span>());</span><br><span class="line">    layoutInfo.pBindings = bindings.<span class="built_in">data</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæè¿°ç¬¦é›†å¸ƒå±€</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateDescriptorSetLayout</span>(device, &amp;layoutInfo, <span class="literal">nullptr</span>, &amp;descriptorSetLayout) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create descriptor set layout!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ‚¨ç°åœ¨è¿è¡Œå¸¦æœ‰éªŒè¯å±‚çš„åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆä¼šå‘ç°æè¿°ç¬¦æ± æ— æ³•ä½¿ç”¨æ­¤å¸ƒå±€åˆ†é…æè¿°ç¬¦é›†ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä»»ä½•ç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦ã€‚</p>
<p>è½¬åˆ°createDescriptorPoolå‡½æ•°å¹¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä»¥åŒ…æ‹¬æ­¤æè¿°ç¬¦çš„VkDescriptorPoolSizeï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createDescriptorPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkDescriptorPoolSize poolSize = &#123;&#125;;</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬åˆ›å»ºçš„æ˜¯ç»Ÿä¸€ç¼“å†²çš„æè¿°ç¬¦</span></span><br><span class="line">    poolSize.type = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">    poolSize.descriptorCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    std::array&lt;VkDescriptorPoolSize, 2&gt; poolSizes = &#123;&#125;;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªæ˜¯ç»Ÿä¸€ç¼“å†²åŒºæè¿°ç¬¦</span></span><br><span class="line">    poolSizes[<span class="number">0</span>].type = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">    poolSizes[<span class="number">0</span>].descriptorCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line">    <span class="comment">// ç¬¬äºŒä¸ªæ˜¯çº¹ç†å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦</span></span><br><span class="line">    poolSizes[<span class="number">1</span>].type = VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER;</span><br><span class="line">    poolSizes[<span class="number">1</span>].descriptorCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    VkDescriptorPoolCreateInfo poolInfo = &#123;&#125;;</span><br><span class="line">    poolInfo.sType = VK_STRUCTURE_TYPE_DESCRIPTOR_POOL_CREATE_INFO;</span><br><span class="line">    poolInfo.poolSizeCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(poolSizes.<span class="built_in">size</span>());</span><br><span class="line">    poolInfo.pPoolSizes = poolSizes.<span class="built_in">data</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™¤äº†å¯ç”¨çš„å•ä¸ªæè¿°ç¬¦çš„æœ€å¤§æ•°é‡å¤–ï¼Œè¿˜éœ€è¦æŒ‡å®šå¯ä»¥åˆ†é…çš„æœ€å¤§æè¿°ç¬¦é›†æ•°é‡ï¼šä¸äº¤æ¢é“¾å›¾åƒæ•°é‡ä¸€è‡´</span></span><br><span class="line">    poolInfo.maxSets = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line">    <span class="comment">// åˆ›å»ºæè¿°ç¬¦æ± </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateDescriptorPool</span>(device, &amp;poolInfo, <span class="literal">nullptr</span>, &amp;descriptorPool) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create descriptor pool!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åä¸€æ­¥æ˜¯å°†å®é™…å›¾åƒå’Œé‡‡æ ·å™¨èµ„æºç»‘å®šåˆ°æè¿°ç¬¦é›†ä¸­çš„æè¿°ç¬¦ã€‚ è½¬åˆ°createDescriptorSetså‡½æ•°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createDescriptorSets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®æè¿°ç¬¦</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; descriptorSets.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»‘å®šå›¾åƒè§†å›¾å’Œé‡‡æ ·å™¨åˆ°æè¿°ç¬¦ä¸­</span></span><br><span class="line">        VkDescriptorImageInfo imageInfo = &#123;&#125;;</span><br><span class="line">        imageInfo.imageLayout = VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¿…é¡»åœ¨VkDescriptorImageInfoç»“æ„ä¸­æŒ‡å®šç”¨äºç»„åˆå›¾åƒé‡‡æ ·å™¨ç»“æ„çš„èµ„æº</span></span><br><span class="line">        imageInfo.imageView = textureImageView;</span><br><span class="line">        imageInfo.sampler = textureSampler;</span><br><span class="line"></span><br><span class="line">        std::array&lt;VkWriteDescriptorSet, 2&gt; descriptorWrites = &#123;&#125;;</span><br><span class="line">        descriptorWrites[<span class="number">0</span>].sType = VK_STRUCTURE_TYPE_WRITE_DESCRIPTOR_SET;</span><br><span class="line">        descriptorWrites[<span class="number">0</span>].dstSet = descriptorSets[i];</span><br><span class="line">        descriptorWrites[<span class="number">0</span>].dstBinding = <span class="number">0</span>;</span><br><span class="line">        descriptorWrites[<span class="number">0</span>].dstArrayElement = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ç»‘å®šç»Ÿä¸€ç¼“å†²åŒºè‡³æè¿°ç¬¦</span></span><br><span class="line">        descriptorWrites[<span class="number">0</span>].descriptorType = VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER;</span><br><span class="line">        descriptorWrites[<span class="number">0</span>].descriptorCount = <span class="number">1</span>;</span><br><span class="line">        descriptorWrites[<span class="number">0</span>].pBufferInfo = &amp;bufferInfo;</span><br><span class="line"></span><br><span class="line">        descriptorWrites[<span class="number">1</span>].sType = VK_STRUCTURE_TYPE_WRITE_DESCRIPTOR_SET;</span><br><span class="line">        descriptorWrites[<span class="number">1</span>].dstSet = descriptorSets[i];</span><br><span class="line">        descriptorWrites[<span class="number">1</span>].dstBinding = <span class="number">1</span>;</span><br><span class="line">        descriptorWrites[<span class="number">1</span>].dstArrayElement = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ç»‘å®šå›¾åƒè§†å›¾å’Œç›¸åº”çš„é‡‡æ ·å™¨è‡³æè¿°ç¬¦</span></span><br><span class="line">        descriptorWrites[<span class="number">1</span>].descriptorType = VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER;</span><br><span class="line">        descriptorWrites[<span class="number">1</span>].descriptorCount = <span class="number">1</span>;</span><br><span class="line">        descriptorWrites[<span class="number">1</span>].pImageInfo = &amp;imageInfo;</span><br><span class="line">        <span class="comment">// åº”ç”¨æè¿°ç¬¦é›†æ›´æ–°</span></span><br><span class="line">        <span class="built_in">vkUpdateDescriptorSets</span>(device,</span><br><span class="line">            <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(descriptorWrites.<span class="built_in">size</span>()),</span><br><span class="line">            descriptorWrites.<span class="built_in">data</span>(), <span class="number">0</span>, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¿…é¡»åœ¨VkDescriptorImageInfoç»“æ„ä¸­æŒ‡å®šç”¨äºç»„åˆå›¾åƒé‡‡æ ·å™¨ç»“æ„çš„èµ„æºï¼Œå°±åƒåœ¨VkDescriptorBufferInfoç»“æ„ä¸­æŒ‡å®šç”¨äºç»Ÿä¸€ç¼“å†²åŒºæè¿°ç¬¦çš„ç¼“å†²åŒºèµ„æºä¸€æ ·ã€‚</p>
<h2 id="3-2-çº¹ç†åæ ‡"><a href="#3-2-çº¹ç†åæ ‡" class="headerlink" title="3.2 çº¹ç†åæ ‡"></a>3.2 çº¹ç†åæ ‡</h2><p>çº¹ç†æ˜ å°„è¿˜æœ‰ä¸€ä¸ªé‡è¦è¦ç´ å°±æ˜¯æ¯ä¸ªé¡¶ç‚¹çš„å®é™…åæ ‡ã€‚ åæ ‡å†³å®šäº†å›¾åƒå¦‚ä½•å®é™…æ˜ å°„åˆ°å‡ ä½•ä½“:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Vertex</span> &#123;</span><br><span class="line">    glm::vec2 pos;</span><br><span class="line">    glm::vec3 color;</span><br><span class="line">    glm::vec2 texCoord;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> VkVertexInputBindingDescription <span class="title">getBindingDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        VkVertexInputBindingDescription bindingDescription = &#123;&#125;;</span><br><span class="line">        bindingDescription.binding = <span class="number">0</span>;</span><br><span class="line">        bindingDescription.stride = <span class="built_in">sizeof</span>(Vertex);</span><br><span class="line">        bindingDescription.inputRate = VK_VERTEX_INPUT_RATE_VERTEX;</span><br><span class="line">        <span class="keyword">return</span> bindingDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> std::array&lt;VkVertexInputAttributeDescription, 3&gt; <span class="title">getAttributeDescriptions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::array&lt;VkVertexInputAttributeDescription, 3&gt; attributeDescriptions = &#123;&#125;;</span><br><span class="line">        <span class="comment">// position é¡¶ç‚¹è¾“å…¥ä½ç½®å±æ€§æè¿°ç¬¦</span></span><br><span class="line">        attributeDescriptions[<span class="number">0</span>].binding = <span class="number">0</span>;</span><br><span class="line">        attributeDescriptions[<span class="number">0</span>].location = <span class="number">0</span>;</span><br><span class="line">        attributeDescriptions[<span class="number">0</span>].format = VK_FORMAT_R32G32_SFLOAT;</span><br><span class="line">        attributeDescriptions[<span class="number">0</span>].offset = <span class="built_in">offsetof</span>(Vertex, pos);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// color é¡¶ç‚¹è¾“å…¥é¢œè‰²å±æ€§æè¿°ç¬¦</span></span><br><span class="line">        attributeDescriptions[<span class="number">1</span>].binding = <span class="number">0</span>;</span><br><span class="line">        attributeDescriptions[<span class="number">1</span>].location = <span class="number">1</span>;</span><br><span class="line">        attributeDescriptions[<span class="number">1</span>].format = VK_FORMAT_R32G32B32_SFLOAT;</span><br><span class="line">        attributeDescriptions[<span class="number">1</span>].offset = <span class="built_in">offsetof</span>(Vertex, color);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// coordinates é¡¶ç‚¹è¾“å…¥åæ ‡å±æ€§æè¿°ç¬¦</span></span><br><span class="line">        attributeDescriptions[<span class="number">2</span>].binding = <span class="number">0</span>;</span><br><span class="line">        attributeDescriptions[<span class="number">2</span>].location = <span class="number">2</span>;</span><br><span class="line">        attributeDescriptions[<span class="number">2</span>].format = VK_FORMAT_R32G32_SFLOAT;</span><br><span class="line">        attributeDescriptions[<span class="number">2</span>].offset = <span class="built_in">offsetof</span>(Vertex, texCoord);</span><br><span class="line">        <span class="keyword">return</span> attributeDescriptions;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹â€œé¡¶ç‚¹â€ç»“æ„ï¼Œä½¿å…¶åŒ…å«ç”¨äºçº¹ç†åæ ‡çš„vec2ï¼ˆtexCoordï¼‰ã€‚ ç¡®ä¿è¿˜æ·»åŠ äº†VkVertexInputAttributeDescriptionï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†è®¿é—®çº¹ç†åæ ‡ç”¨ä½œé¡¶ç‚¹ç€è‰²å™¨ä¸­çš„è¾“å…¥ã€‚ è¦å°†å®ƒä»¬ä¼ é€’åˆ°ç‰‡æ®µç€è‰²å™¨ä»¥ä¾¿åœ¨æ­£æ–¹å½¢è¡¨é¢ä¸Šè¿›è¡Œæ’å€¼ï¼Œè¿™æ˜¯å¿…è¦çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> std::vector&lt;Vertex&gt; vertices = &#123;</span><br><span class="line">    &#123;&#123;<span class="number">-0.5f</span>, <span class="number">-0.5f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.5f</span>, <span class="number">-0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">1.0f</span>, <span class="number">0.0f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;, &#123;<span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;&#125;,</span><br><span class="line">    &#123;&#123;<span class="number">-0.5f</span>, <span class="number">0.5f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>&#125;, &#123;<span class="number">1.0f</span>, <span class="number">1.0f</span>&#125;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å…ˆä½¿ç”¨ä»å·¦ä¸Šè§’çš„0ã€0åˆ°å³ä¸‹è§’çš„1ã€1çš„åæ ‡ç®€å•åœ°ç”¨çº¹ç†å¡«å……æ­£æ–¹å½¢ã€‚ éšæ„å°è¯•ä½¿ç”¨ä¸åŒçš„åæ ‡ã€‚ ç¨åæˆ‘ä»¬çœ‹çœ‹ä½äº0æˆ–é«˜äº1çš„åæ ‡ä¸‹çš„å®é™…çš„å¯»å€æ¨¡å¼ï¼</p>
<h2 id="3-3-ç€è‰²å™¨"><a href="#3-3-ç€è‰²å™¨" class="headerlink" title="3.3 ç€è‰²å™¨"></a>3.3 ç€è‰²å™¨</h2><p>æœ€åä¸€æ­¥æ˜¯ä¿®æ”¹ç€è‰²å™¨ï¼Œä»¥ä»çº¹ç†ä¸­é‡‡æ ·é¢œè‰²ã€‚ æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¿®æ”¹é¡¶ç‚¹ç€è‰²å™¨ï¼Œä»¥å°†çº¹ç†åæ ‡ä¼ é€’åˆ°ç‰‡æ®µç€è‰²å™¨ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec2</span> inPosition;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec3</span> inColor;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">2</span>) <span class="keyword">in</span> <span class="type">vec2</span> inTexCoord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">out</span> <span class="type">vec2</span> fragTexCoord;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = ubo.proj * ubo.view * ubo.model * <span class="type">vec4</span>(inPosition, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    fragColor = inColor;</span><br><span class="line">    fragTexCoord = inTexCoord;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±åƒæ¯ä¸ªé¡¶ç‚¹çš„é¢œè‰²ä¸€æ ·ï¼Œæ …æ ¼åŒ–å™¨ä¼šå°†fragTexCoordå€¼å¹³æ»‘åœ°æ’å…¥åˆ°æ­£æ–¹å½¢åŒºåŸŸä¸­ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç‰‡æ®µç€è‰²å™¨å°†çº¹ç†åæ ‡è¾“å‡ºä¸ºé¢œè‰²æ¥å½¢è±¡åŒ–ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"><span class="meta">#extension GL_ARB_separate_shader_objects : enable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">1</span>) <span class="keyword">in</span> <span class="type">vec2</span> fragTexCoord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec4</span> outColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    outColor = <span class="type">vec4</span>(fragTexCoord, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬ç¼–è¯‘ä¸‹ç€è‰²å™¨ï¼Œç„¶åè¿è¡Œä¸‹ç¨‹åº:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-15-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/Vulkan_15_5.png" alt="å›¾ç‰‡15-5"></p>
<h3 id="3-3-1-ç‰‡æ®µç€è‰²å™¨ä¸­çš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦"><a href="#3-3-1-ç‰‡æ®µç€è‰²å™¨ä¸­çš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦" class="headerlink" title="3.3.1 ç‰‡æ®µç€è‰²å™¨ä¸­çš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦"></a>3.3.1 ç‰‡æ®µç€è‰²å™¨ä¸­çš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦</h3><p>ç»„åˆçš„å›¾åƒé‡‡æ ·å™¨æè¿°ç¬¦åœ¨GLSLä¸­ç”±é‡‡æ ·å™¨ç»Ÿä¸€è¡¨ç¤ºã€‚ åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­æ·»åŠ å¯¹å®ƒçš„å¼•ç”¨ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta"># å¯¹äºå…¶ä»–ç±»å‹çš„å›¾åƒï¼Œå­˜åœ¨ç­‰æ•ˆçš„sampler1Då’Œsampler3Dç±»å‹ã€‚ ç¡®ä¿åœ¨æ­¤å¤„ä½¿ç”¨æ­£ç¡®çš„ç»‘å®šã€‚ </span></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">binding</span> = <span class="number">1</span>) <span class="keyword">uniform</span> <span class="type">sampler2D</span> texSampler;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    outColor = <span class="built_in">texture</span>(texSampler, fragTexCoord);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘ä¸€ä¸‹shaderç„¶åè¿è¡Œç¨‹åº:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-15-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%92%8C%E9%87%87%E6%A0%B7%E5%99%A8/Vulkan_15_6.png" alt="å›¾åƒ15-6"></p>
<p>å“’å“’ï¼Œä¸€ä¸ªæ—‹è½¬çš„è´´å›¾å‡ºç°äº†ï¼</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(2)-åˆ›å»ºVulkanç¤ºä¾‹åŠéªŒè¯å±‚</title>
    <url>/2022/02/26/Vulkan%E5%85%A5%E9%97%A8-2-%E5%88%9B%E5%BB%BAVulkan%E7%A4%BA%E4%BE%8B%E5%8F%8A%E9%AA%8C%E8%AF%81%E5%B1%82/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡ä¸»è¦æ˜¯å®ç°Vulkan Tutorial.pdfæ–‡æ¡£ä¸­çš„Base Code, Instanceå’ŒValidation Layerséƒ¨åˆ†ã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li><a href="https://github.com/KhronosGroup/Vulkan-Docs">https://github.com/KhronosGroup/Vulkan-Docs</a></li>
<li><a href="https://www.khronos.org/registry/vulkan/specs/1.1-extensions/html/vkspec.html#vkCreateInstance">https://www.khronos.org/registry/vulkan/specs/1.1-extensions/html/vkspec.html#vkCreateInstance</a></li>
<li><a href="https://github.com/SaschaWillems/Vulkan/blob/master/base/vulkanexamplebase.h">https://github.com/SaschaWillems/Vulkan/blob/master/base/vulkanexamplebase.h</a></li>
</ol>
<h1 id="ä¸€-åˆ›å»º-vulkan-å®ä¾‹"><a href="#ä¸€-åˆ›å»º-vulkan-å®ä¾‹" class="headerlink" title="ä¸€. åˆ›å»º vulkan å®ä¾‹"></a>ä¸€. åˆ›å»º vulkan å®ä¾‹</h1><h2 id="1-1-åˆ›å»º-Window-å®ä¾‹"><a href="#1-1-åˆ›å»º-Window-å®ä¾‹" class="headerlink" title="1.1 åˆ›å»º Window å®ä¾‹"></a>1.1 åˆ›å»º Window å®ä¾‹</h2><p>å…ˆåˆ›å»ºä¸ª window çª—å£</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ­¥ä¸€å®šæ˜¯å…ˆåˆå§‹åŒ–GLFWåº“.</span></span><br><span class="line">    <span class="built_in">glfwInit</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸ºGLFWæœ€åˆæ˜¯ä¸ºåˆ›å»ºOpenGLä¸Šä¸‹æ–‡è€Œè®¾è®¡çš„ï¼Œ</span></span><br><span class="line">    <span class="comment">// æ‰€ä»¥æˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒä¸è¦é€šè¿‡åç»­è°ƒç”¨åˆ›å»ºOpenGLä¸Šä¸‹æ–‡ï¼šGLFW_NO_API</span></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å› ä¸ºå¤„ç†å¤§å°å¯å˜çš„çª—å£æ¯”è¾ƒå¤æ‚ï¼Œæš‚æ—¶å…ˆè®©çª—å£ä¸å¯å˜</span></span><br><span class="line">    <span class="built_in">glfwWindowHint</span>(GLFW_RESIZABLE, GLFW_FALSE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºçª—å£</span></span><br><span class="line">    <span class="comment">// GLFWwindow *glfwCreateWindow(int width, int height, const char *title, GLFWmonitor *monitor, GLFWwindow *share)</span></span><br><span class="line">    window = <span class="built_in">glfwCreateWindow</span>(WIDTH, HEIGHT, WINDOW_TITLE, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-åˆ›å»º-Vulkan-å®ä¾‹"><a href="#1-2-åˆ›å»º-Vulkan-å®ä¾‹" class="headerlink" title="1.2 åˆ›å»º Vulkan å®ä¾‹"></a>1.2 åˆ›å»º Vulkan å®ä¾‹</h2><ol>
<li>åˆ›å»º VkApplicationInfo ç»“æ„ä½“å˜é‡ï¼Œå‚æ•°å¯é€‰</li>
<li>åˆ›å»º VkInstanceCreateInfo ç»“æ„ä½“å˜é‡ï¼Œå¿…é¡»æŒ‡æ˜<ol>
<li>ä½¿ç”¨ GLFW (glfwGetRequiredInstanceExtensions) åˆ›å»º glfwExtensions, ä»¥ä¾¿ä¸ºGLFWçª—å£åˆ›å»ºVulkan surface</li>
</ol>
</li>
<li>è°ƒç”¨ vkCreateInstance, åˆ›å»º vulkan å®ä¾‹</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå®ä¾‹é¦–å…ˆå¿…é¡»å¡«å†™ä¸€ä¸ªåŒ…å«æœ‰å…³æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ä¿¡æ¯çš„ç»“æ„: VkApplicationInfo</span></span><br><span class="line">    <span class="comment">// è¿™äº›æ•°æ®åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯é€‰çš„ï¼Œä½†å®ƒå¯ä»¥ä¸ºé©±åŠ¨ç¨‹åºæä¾›ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä»¥ä¾¿é’ˆå¯¹æˆ‘ä»¬çš„ç‰¹å®šåº”ç”¨è¿›è¡Œä¼˜åŒ–</span></span><br><span class="line">    VkApplicationInfo appInfo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Vulkanä¸­çš„è®¸å¤šç»“æ„è¦æ±‚åœ¨sTypeæˆå‘˜ä¸­æ˜ç¡®æŒ‡å®šç±»å‹ã€‚ </span></span><br><span class="line">    <span class="comment">// è¿™ä¹Ÿæ˜¯å…·æœ‰pNextæˆå‘˜çš„è®¸å¤šç»“æ„ä¸­çš„ä¸€ä¸ªï¼Œè¯¥æˆå‘˜å¯ä»¥åœ¨å°†æ¥æŒ‡å‘æ‰©å±•ä¿¡æ¯ã€‚</span></span><br><span class="line">    appInfo.sType = VK_STRUCTURE_TYPE_APPLICATION_INFO;</span><br><span class="line"></span><br><span class="line">    appInfo.pApplicationName = <span class="string">&quot;Hello Triangle&quot;</span>;</span><br><span class="line">    appInfo.applicationVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    appInfo.pEngineName = <span class="string">&quot;No Engine&quot;</span>;</span><br><span class="line">    appInfo.engineVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    appInfo.apiVersion = VK_API_VERSION_1_1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Vulkanä¸­çš„å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯é€šè¿‡ç»“æ„è€Œä¸æ˜¯å‡½æ•°å‚æ•°ä¼ é€’çš„ï¼Œ</span></span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¿…é¡»å†å¡«å……ä¸€ä¸ªç»“æ„ä½“ VkInstanceCreateInfo æ¥ä¸ºåˆ›å»ºå®ä¾‹æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="comment">// VkInstanceCreateInfoç»“æ„æ˜¯å¿…é¡»æŒ‡æ˜çš„ï¼Œå®ƒå‘Šè¯‰Vulkané©±åŠ¨ç¨‹åºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨å“ªäº›å…¨å±€æ‰©å±•å’ŒéªŒè¯å±‚ã€‚ </span></span><br><span class="line">    VkInstanceCreateInfo createInfo = &#123;&#125;;</span><br><span class="line">    createInfo.sType = VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO;</span><br><span class="line">    createInfo.pNext = <span class="literal">nullptr</span>;</span><br><span class="line">    createInfo.pApplicationInfo = &amp;appInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰ä¸¤ä¸ªå‚æ•°å¾ˆç®€å•ã€‚ </span></span><br><span class="line">    <span class="comment">// Vulkanæ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œè¿™æ„å‘³ç€éœ€è¦ä¸€ä¸ªä¸çª—å£ç³»ç»Ÿæ¥å£çš„æ‰©å±•ã€‚</span></span><br><span class="line">    <span class="comment">// GLFWæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„å†…ç½®å‡½æ•°ï¼Œå®ƒè¿”å›å®ƒéœ€è¦åšçš„æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ç»™ç»“æ„ä½“ï¼šVkInstanceCreateInfo</span></span><br><span class="line">    <span class="type">uint32_t</span> glfwExtensionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>** glfwExtensions;</span><br><span class="line">    <span class="comment">// è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•ã€‚</span></span><br><span class="line">    <span class="comment">// æ­¤å‡½æ•°è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•åçš„æ•°ç»„ï¼Œä»¥ä¾¿ä¸ºGLFWçª—å£åˆ›å»ºVulkan surfaceã€‚ </span></span><br><span class="line">    <span class="comment">// å¦‚æœæˆåŠŸï¼Œåˆ—è¡¨å°†å§‹ç»ˆåŒ…å«`VK_KHR_surface`ï¼Œå› æ­¤å¦‚æœæ‚¨ä¸éœ€è¦ä»»ä½•å…¶ä»–æ‰©å±•ï¼Œåˆ™å¯ä»¥å°†æ­¤åˆ—è¡¨ç›´æ¥ä¼ é€’ç»™`VkInstanceCreateInfo`ç»“æ„ã€‚</span></span><br><span class="line">    <span class="comment">// å¦‚æœæœºå™¨ä¸Šæ²¡æœ‰Vulkanï¼Œåˆ™æ­¤å‡½æ•°è¿”å›â€œNULLâ€å¹¶ç”Ÿæˆ GLFW_API_UNAVAILABLEé”™è¯¯ã€‚</span></span><br><span class="line">    glfwExtensions = <span class="built_in">glfwGetRequiredInstanceExtensions</span>(&amp;glfwExtensionCount);</span><br><span class="line"></span><br><span class="line">    createInfo.enabledExtensionCount = glfwExtensionCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// createInfo.ppEnabledLayerNames = glfwExtensions;</span></span><br><span class="line">    <span class="comment">// ç¬”è€…æ›¾åœ¨è¿™é‡Œæ ½äº†ä¸ªè·Ÿå¤´ï¼Œå†™é”™äº†ã€‚å¦‚ä¸Šå†™ï¼Œç¼–è¯‘ä¸å‡ºé—®é¢˜ï¼Œä½†è¿è¡Œæ—¶ä¼šæŠ¥ Segmentation fault (core dumped)</span></span><br><span class="line">    <span class="comment">// æ‰“å°å †æ ˆï¼Œçœ‹äº†åŠå¤©ï¼Œæ‰å‘ç°çš„ï¼Œå¼•ä»¥ä¸ºæˆ’ï¼Œä¸è¿‡è¿™ä¸¤å˜é‡åå­—å¾ˆåƒã€‚</span></span><br><span class="line">    createInfo.ppEnabledExtensionNames = glfwExtensions;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»“æ„ä½“çš„æœ€åä¸¤ä¸ªæˆå‘˜ç¡®å®šè¦å¯ç”¨çš„å…¨å±€éªŒè¯å±‚ã€‚</span></span><br><span class="line">    createInfo.enabledLayerCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// VkResult vkCreateInstance(const VkInstanceCreateInfo *pCreateInfo, const VkAllocationCallbacks *pAllocator, VkInstance *pInstance)</span></span><br><span class="line">    VkResult res = <span class="built_in">vkCreateInstance</span>(&amp;createInfo, <span class="literal">nullptr</span>, &amp;instance);</span><br><span class="line">    <span class="keyword">if</span> (res != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create instance!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="äºŒ-éªŒè¯å±‚-Validation-layers"><a href="#äºŒ-éªŒè¯å±‚-Validation-layers" class="headerlink" title="äºŒ. éªŒè¯å±‚(Validation layers)"></a>äºŒ. éªŒè¯å±‚(Validation layers)</h1><h2 id="2-1-ä»€ä¹ˆæ˜¯-Validation-layersï¼Ÿ"><a href="#2-1-ä»€ä¹ˆæ˜¯-Validation-layersï¼Ÿ" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯ Validation layersï¼Ÿ"></a>2.1 ä»€ä¹ˆæ˜¯ Validation layersï¼Ÿ</h2><p>Vulkan APIå›´ç»•æœ€å°é©±åŠ¨ç¨‹åºå¼€é”€çš„æƒ³æ³•è€Œè®¾è®¡ï¼Œè¯¥ç›®æ ‡çš„ä¸€ä¸ªè¡¨ç°å½¢å¼æ˜¯é»˜è®¤æƒ…å†µä¸‹APIä¸­çš„é”™è¯¯æ£€æŸ¥éå¸¸æœ‰é™ã€‚<br>å³ä½¿æ˜¯å°†æšä¸¾è®¾ç½®ä¸ºä¸æ­£ç¡®çš„å€¼æˆ–å°†ç©ºæŒ‡é’ˆä¼ é€’ç»™æ‰€éœ€å‚æ•°è¿™æ ·ç®€å•çš„é”™è¯¯é€šå¸¸ä¹Ÿä¸ä¼šè¢«æ˜¾å¼å¤„ç†ï¼Œåªä¼šå¯¼è‡´å´©æºƒæˆ–æœªå®šä¹‰çš„è¡Œä¸ºã€‚<br>è¿™ä¸€ç‚¹ï¼Œç¬”è€…å·²ç»æ·±åˆ»ä½“ä¼šåˆ°äº†ï¼Œ(â•¯ï¹â•°)<br>å› ä¸ºVulkanè¦æ±‚ä½ å¯¹ä½ æ‰€åšçš„ä¸€åˆ‡éƒ½éå¸¸æ˜ç¡®ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“çŠ¯å¾ˆå¤šå°é”™è¯¯ï¼Œä¾‹å¦‚ä½¿ç”¨æ–°çš„GPUåŠŸèƒ½è€Œå¿˜è®°åœ¨é€»è¾‘è®¾å¤‡åˆ›å»ºæ—¶è¯·æ±‚å®ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ— æ³•å°†è¿™äº›æ£€æŸ¥æ·»åŠ åˆ°APIä¸­ã€‚<br>Vulkanä¸ºè¿™ç§ç§°ä¸ºéªŒè¯å±‚çš„ç³»ç»Ÿå¼•å…¥äº†ä¸€ä¸ªä¼˜é›…çš„ç³»ç»Ÿ: Validation layers.<br>éªŒè¯å±‚æ˜¯å¯é€‰ç»„ä»¶ï¼Œå®ƒæŒ‚æ¥åˆ°Vulkanå‡½æ•°è°ƒç”¨ä»¥åº”ç”¨å…¶ä»–æ“ä½œã€‚ </p>
<p>éªŒè¯å±‚ä¸­çš„å¸¸è§æ“ä½œæ˜¯ï¼š</p>
<ol>
<li>æ ¹æ®è§„èŒƒæ£€æŸ¥å‚æ•°å€¼ä»¥æ£€æµ‹è¯¯ç”¨</li>
<li>è·Ÿè¸ªå¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ä»¥æŸ¥æ‰¾èµ„æºæ³„æ¼</li>
<li>é€šè¿‡è·Ÿè¸ªè°ƒç”¨çš„çº¿ç¨‹æ¥æ£€æŸ¥çº¿ç¨‹å®‰å…¨æ€§</li>
<li>å°†æ¯ä¸ªè°ƒç”¨åŠå…¶å‚æ•°è®°å½•åˆ°æ ‡å‡†è¾“å‡ºæ–¹ä¾¿è°ƒè¯•</li>
<li>è·Ÿè¸ªVulkanè¦æ±‚è¿›è¡Œæ€§èƒ½åˆ†æå’Œé‡æ”¾</li>
</ol>
<h2 id="2-2-Validation-layersç¤ºä¾‹"><a href="#2-2-Validation-layersç¤ºä¾‹" class="headerlink" title="2.2 Validation layersç¤ºä¾‹"></a>2.2 Validation layersç¤ºä¾‹</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateInstance</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkInstanceCreateInfo* pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks* pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkInstance* instance)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pCreateInfo == <span class="literal">nullptr</span> || instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="built_in">log</span>(<span class="string">&quot;Null pointer passed to required parameter!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> VK_ERROR_INITIALIZATION_FAILED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">real_vkCreateInstance</span>(pCreateInfo, pAllocator, instance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚ä¸Šé¢çš„vkCreateInstanceä¸­çš„ifè¯­å¥ã€‚å®˜æ–¹æ–‡æ¡£ä¸Šå¦‚æ­¤è¯´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿™äº›éªŒè¯å±‚å¯ä»¥è‡ªç”±å †å ï¼Œä»¥åŒ…å«æ‚¨æ„Ÿå…´è¶£çš„æ‰€æœ‰è°ƒè¯•åŠŸèƒ½ã€‚</span><br><span class="line">æ‚¨å¯ä»¥ç®€å•åœ°ä¸ºè°ƒè¯•ç‰ˆæœ¬å¯ç”¨éªŒè¯å±‚ï¼Œå¹¶ä¸ºå‘å¸ƒç‰ˆæœ¬å®Œå…¨ç¦ç”¨å®ƒä»¬ï¼Œè¿™å°†ä¸ºæ‚¨æä¾›ä¸¤å…¨å…¶ç¾çš„ä¼˜åŠ¿ï¼</span><br><span class="line">Vulkanæ²¡æœ‰å†…ç½®ä»»ä½•éªŒè¯å±‚ï¼Œä½†LunarG Vulkan SDKæä¾›äº†ä¸€ç»„å¾ˆå¥½çš„å±‚æ¥æ£€æŸ¥å¸¸è§é”™è¯¯ã€‚</span><br><span class="line">å®ƒä»¬ä¹Ÿæ˜¯å®Œå…¨å¼€æºçš„ï¼Œå› æ­¤æ‚¨å¯ä»¥æ£€æŸ¥å®ƒä»¬æ£€æŸ¥å’Œè´¡çŒ®çš„é”™è¯¯ç±»å‹ã€‚</span><br><span class="line">ä½¿ç”¨éªŒè¯å±‚æ˜¯é¿å…åº”ç”¨ç¨‹åºå› æ„å¤–ä¾èµ–æœªå®šä¹‰è¡Œä¸ºè€Œç ´åä¸åŒé©±åŠ¨ç¨‹åºçš„æœ€ä½³æ–¹æ³•ã€‚</span><br><span class="line">éªŒè¯å±‚åªæœ‰åœ¨å·²å®‰è£…åˆ°ç³»ç»Ÿä¸Šæ—¶æ‰èƒ½ä½¿ç”¨ã€‚</span><br><span class="line">ä¾‹å¦‚ï¼ŒLunarGéªŒè¯å±‚ä»…é€‚ç”¨äºå®‰è£…äº†Vulkan SDKçš„PCã€‚</span><br><span class="line">Vulkanä¸­ä»¥å‰æœ‰ä¸¤ç§ä¸åŒç±»å‹çš„éªŒè¯å±‚ï¼šå®ä¾‹å’Œè®¾å¤‡ç‰¹å®šã€‚</span><br><span class="line">æˆ‘ä»¬çš„æƒ³æ³•æ˜¯ï¼Œå®ä¾‹å±‚åªä¼šæ£€æŸ¥ä¸å…¨å±€Vulkanå¯¹è±¡ï¼ˆå¦‚å®ä¾‹ï¼‰ç›¸å…³çš„è°ƒç”¨ï¼Œè€Œè®¾å¤‡ç‰¹å®šå±‚åªä¼šæ£€æŸ¥ä¸ç‰¹å®šGPUç›¸å…³çš„è°ƒç”¨ã€‚</span><br><span class="line">ç°åœ¨å·²å¼ƒç”¨ç‰¹å®šäºè®¾å¤‡çš„å±‚ï¼Œè¿™æ„å‘³ç€å®ä¾‹éªŒè¯å±‚é€‚ç”¨äºæ‰€æœ‰Vulkanè°ƒç”¨ã€‚</span><br><span class="line">è§„èŒƒæ–‡æ¡£ä»å»ºè®®æ‚¨åœ¨è®¾å¤‡çº§åˆ«å¯ç”¨éªŒè¯å±‚ä»¥åŠå…¼å®¹æ€§ï¼Œè¿™æ˜¯æŸäº›å®ç°æ‰€éœ€çš„ã€‚</span><br></pre></td></tr></table></figure>

<h2 id="2-3-å¯ç”¨éªŒè¯å±‚"><a href="#2-3-å¯ç”¨éªŒè¯å±‚" class="headerlink" title="2.3 å¯ç”¨éªŒè¯å±‚"></a>2.3 å¯ç”¨éªŒè¯å±‚</h2><p>å¦‚ä½•å¯ç”¨Vulkan SDKæä¾›çš„æ ‡å‡†è¯Šæ–­å±‚? å°±åƒæ‰©å±•ä¸€æ ·ï¼Œéœ€è¦é€šè¿‡æŒ‡å®šå…¶åç§°æ¥å¯ç”¨éªŒè¯å±‚ã€‚<br>æ‰€æœ‰æœ‰ç”¨çš„æ ‡å‡†éªŒè¯éƒ½æ†ç»‘åœ¨SDKä¸­åŒ…å«çš„å±‚ä¸­ï¼Œç§°ä¸ºVK_LAYER_KHRONOS_validationã€‚<br>è®©æˆ‘ä»¬é¦–å…ˆå‘ç¨‹åºæ·»åŠ ä¸¤ä¸ªé…ç½®å˜é‡ï¼Œä»¥æŒ‡å®šè¦å¯ç”¨çš„å±‚ä»¥åŠæ˜¯å¦å¯ç”¨å®ƒä»¬ã€‚ æˆ‘å·²ç»é€‰æ‹©å°†è¯¥å€¼ä½œä¸ºç¨‹åºæ˜¯å¦åœ¨è°ƒè¯•æ¨¡å¼ä¸‹ç¼–è¯‘ã€‚<br>NDEBUGå®æ˜¯C ++æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œæ„å‘³ç€â€œä¸è°ƒè¯•â€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; validationLayers = &#123;</span><br><span class="line">    <span class="string">&quot;VK_LAYER_KHRONOS_validation&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> NDEBUG</span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">false</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">true</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-æ¶ˆæ¯å›è°ƒ"><a href="#2-4-æ¶ˆæ¯å›è°ƒ" class="headerlink" title="2.4 æ¶ˆæ¯å›è°ƒ"></a>2.4 æ¶ˆæ¯å›è°ƒ</h2><p>ä»…å¯ç”¨è¿™äº›å±‚å¹¶æ²¡æœ‰å¤šå¤§å¸®åŠ©ï¼Œå› ä¸ºå®ƒä»¬ç›®å‰æ— æ³•å°†è°ƒè¯•æ¶ˆæ¯ä¸­ç»§å›æˆ‘ä»¬çš„ç¨‹åºã€‚<br>è¦æ¥æ”¶è¿™äº›æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¿…é¡»è®¾ç½®ä¸€ä¸ªå¸¦å›è°ƒçš„è°ƒè¯•ä¿¡ä½¿ï¼Œè¿™éœ€è¦VK_EXT_debug_utilsæ‰©å±•ã€‚<br>æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªgetRequiredExtensionså‡½æ•°ï¼Œæ ¹æ®æ˜¯å¦å¯ç”¨éªŒè¯å±‚è¿”å›æ‰€éœ€çš„æ‰©å±•ååˆ—è¡¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">getRequiredExtensions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> glfwExtensionCount = <span class="number">0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>** glfwExtensions;</span><br><span class="line">    glfwExtensions = <span class="built_in">glfwGetRequiredInstanceExtensions</span>(&amp;glfwExtensionCount);</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">extensions</span><span class="params">(glfwExtensions, glfwExtensions + glfwExtensionCount)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">        extensions.<span class="built_in">push_back</span>(VK_EXT_DEBUG_UTILS_EXTENSION_NAME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> extensions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GLFWæŒ‡å®šçš„æ‰©å±•å§‹ç»ˆæ˜¯å¿…éœ€çš„ï¼Œä½†æœ‰æ¡ä»¶åœ°æ·»åŠ äº†è°ƒè¯•ä¿¡ä½¿æ‰©å±•(VK_EXT_debug_utils)ã€‚<br>è¯·æ³¨æ„ï¼Œåœ¨è¿™é‡Œä½¿ç”¨äº†VK_EXT_DEBUG_UTILS_EXTENSION_NAMEå®ï¼Œå®ƒç­‰äºæ–‡å­—å­—ç¬¦ä¸²â€œVK_EXT_debug_utilsâ€ã€‚ ä½¿ç”¨æ­¤å®å¯ä»¥é¿å…æ‹¼å†™é”™è¯¯ã€‚<br>æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨createInstanceä¸­ä½¿ç”¨æ­¤å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> extensions = <span class="built_in">getRequiredExtensions</span>();</span><br><span class="line">createInfo.enabledExtensionCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(extensions.<span class="built_in">size</span>());</span><br><span class="line">createInfo.ppEnabledExtensionNames = extensions.<span class="built_in">data</span>();</span><br></pre></td></tr></table></figure>

<h3 id="2-4-1-è°ƒè¯•å›è°ƒå‡½æ•°-debugCallback"><a href="#2-4-1-è°ƒè¯•å›è°ƒå‡½æ•°-debugCallback" class="headerlink" title="2.4.1 è°ƒè¯•å›è°ƒå‡½æ•° debugCallback"></a>2.4.1 è°ƒè¯•å›è°ƒå‡½æ•° debugCallback</h3><p>ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è°ƒè¯•å›è°ƒå‡½æ•°çš„æ ·å­ã€‚<br>ä½¿ç”¨PFN_vkDebugUtilsMessengerCallbackEXTåŸå‹æ·»åŠ ä¸€ä¸ªåä¸ºdebugCallbackçš„æ–°é™æ€æˆå‘˜å‡½æ•°ã€‚<br>VKAPI_ATTRå’ŒVKAPI_CALLç¡®ä¿è¯¥å‡½æ•°å…·æœ‰Vulkanè°ƒç”¨å®ƒçš„æ­£ç¡®ç­¾åã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">static</span> VKAPI_ATTR VkBool32 VKAPI_CALL <span class="title">debugCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessageSeverityFlagBitsEXT messageSeverity,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessageTypeFlagsEXT messageType,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkDebugUtilsMessengerCallbackDataEXT* pCallbackData,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">void</span>* pUserData)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;validation layer: &quot;</span> &lt;&lt; pCallbackData-&gt;pMessage&lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> VK_FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>ç¬¬ä¸€ä¸ªå‚æ•°: VkDebugUtilsMessageSeverityFlagBitsEXT æŒ‡æ˜äº†æ¶ˆæ¯çš„ä¸¥é‡ç¨‹åº¦<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXTï¼šè¯Šæ–­æ¶ˆæ¯<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXTï¼šä¿¡æ¯æ€§æ¶ˆæ¯ï¼Œå¦‚åˆ›å»ºèµ„æº<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXTï¼šæœ‰å…³è¡Œä¸ºçš„æ¶ˆæ¯ä¸ä¸€å®šæ˜¯é”™è¯¯ï¼Œä½†å¾ˆå¯èƒ½æ˜¯åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯<br>â€¢VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXTï¼šæœ‰å…³æ— æ•ˆè¡Œä¸ºçš„æ¶ˆæ¯ï¼Œå¯èƒ½å¯¼è‡´å´©æºƒ<br>å¯ä»¥æ ¹æ®è¿™ä¸ªå‚æ•°è¿‡æ»¤æ‰€éœ€çš„ä¿¡æ¯ã€‚</li>
<li>ç¬¬äºŒä¸ªå‚æ•°: VkDebugUtilsMessageTypeFlagsEXT æŒ‡æ˜äº†æ¶ˆæ¯çš„ç±»å‹<br>â€¢VK_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXTï¼šå‘ç”Ÿäº†ä¸è§„èŒƒæˆ–æ€§èƒ½æ— å…³çš„æŸäº›äº‹ä»¶<br>â€¢VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXTï¼šå‘ç”Ÿäº†è¿åè§„èŒƒæˆ–è¡¨æ˜å¯èƒ½å­˜åœ¨é”™è¯¯çš„äº‹æƒ…<br>â€¢VK_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXTï¼šæ½œåœ¨çš„éæœ€ä½³ä½¿ç”¨Vulkan</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°: VkDebugUtilsMessengerCallbackDataEXT è¿™ä¸ªç»“æ„ä½“åŒ…å«äº†æ¶ˆæ¯æ›´å¤šçš„ç»†èŠ‚å†…å®¹<br>â€¢pMessageï¼šè°ƒè¯•æ¶ˆæ¯ä¸ºä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦ä¸²<br>â€¢pObjectsï¼šä¸æ¶ˆæ¯ç›¸å…³çš„Vulkanå¯¹è±¡å¥æŸ„æ•°ç»„<br>â€¢object Countï¼šæ•°ç»„ä¸­çš„å¯¹è±¡æ•°</li>
<li>ç¬¬å››ä¸ªå‚æ•°: pUserData åŒ…å«åœ¨å›è°ƒè®¾ç½®æœŸé—´æŒ‡å®šçš„æŒ‡é’ˆï¼Œå¹¶å…è®¸æ‚¨å°†è‡ªå·±çš„æ•°æ®ä¼ é€’ç»™å®ƒã€‚</li>
</ol>
<p>å›è°ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦åº”è¯¥ä¸­æ­¢è§¦å‘éªŒè¯å±‚æ¶ˆæ¯çš„Vulkanè°ƒç”¨ã€‚<br>å¦‚æœå›è°ƒè¿”å›trueï¼Œåˆ™è°ƒç”¨å°†å› VK_ERROR_VALIDATION_FAILED_EXTé”™è¯¯è€Œä¸­æ­¢ã€‚<br>è¿™é€šå¸¸ä»…ç”¨äºæµ‹è¯•éªŒè¯å±‚æœ¬èº«ï¼Œå› æ­¤åº”å§‹ç»ˆè¿”å›VK_FALSEã€‚</p>
<h3 id="2-4-2-æ³¨å†Œè°ƒè¯•å›è°ƒ"><a href="#2-4-2-æ³¨å†Œè°ƒè¯•å›è°ƒ" class="headerlink" title="2.4.2 æ³¨å†Œè°ƒè¯•å›è°ƒ"></a>2.4.2 æ³¨å†Œè°ƒè¯•å›è°ƒ</h3><p>åœ¨Vulkanä¸­, è°ƒè¯•å›è°ƒä¹Ÿæ˜¯é€šè¿‡éœ€è¦æ˜¾å¼åˆ›å»ºå’Œé”€æ¯çš„å¥æŸ„æ¥ç®¡ç†çš„ã€‚ è¿™æ ·çš„å›è°ƒæ˜¯debug messageçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®å°½å¯èƒ½å¤šçš„å›è°ƒã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨æˆå‘˜å˜é‡ä¸­æ·»åŠ ï¼šVkDebugUtilsMessengerEXT</span></span><br><span class="line">VkDebugUtilsMessengerEXT debugMessenger;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">createInstance</span>();</span><br><span class="line">    <span class="built_in">setupDebugMessenger</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupDebugMessenger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!enableValidationLayers) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    VkDebugUtilsMessengerCreateInfoEXT createInfo = &#123;&#125;;</span><br><span class="line">    createInfo.sType = VK_STRUCTURE_TYPE_DEBUG_UTILS_MESSENGER_CREATE_INFO_EXT;</span><br><span class="line">    createInfo.messageSeverity =</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT;</span><br><span class="line">    createInfo.messageType =</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT |</span><br><span class="line">        VK_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXT;</span><br><span class="line">    <span class="comment">// æŒ‡å®šæ¶ˆæ¯å›è°ƒå‡½æ•°</span></span><br><span class="line">    createInfo.pfnUserCallback = debugCallback;</span><br><span class="line">    createInfo.pUserData = <span class="literal">nullptr</span>; <span class="comment">// å¯é€‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>messageSeverityå­—æ®µå…è®¸æŒ‡å®šè¦ä¸ºå…¶è°ƒç”¨å›è°ƒçš„æ‰€æœ‰ç±»å‹çš„ä¸¥é‡æ€§ã€‚<br>åœ¨è¿™é‡ŒæŒ‡å®šäº†é™¤VK_DEBUG_UTILS_MESSAGE_SEVERITY_INFO_BIT_EXTä¹‹å¤–çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥æ¥æ”¶æœ‰å…³å¯èƒ½é—®é¢˜çš„é€šçŸ¥ï¼ŒåŒæ—¶çœç•¥è¯¦ç»†çš„ä¸€èˆ¬è°ƒè¯•ä¿¡æ¯ã€‚<br>ç±»ä¼¼åœ°ï¼ŒmessageTypeå­—æ®µå¯ä»¥è¿‡æ»¤é€šçŸ¥å›è°ƒçš„æ¶ˆæ¯ç±»å‹ã€‚ åœ¨è¿™é‡Œå¯ç”¨äº†æ‰€æœ‰ç±»å‹ã€‚<br>æœ€åï¼ŒpfnUserCallbackå­—æ®µæŒ‡å®šå›è°ƒå‡½æ•°çš„æŒ‡é’ˆã€‚å¯ä»¥é€‰æ‹©å°†æŒ‡é’ˆä¼ é€’ç»™pUserDataå­—æ®µï¼Œè¯¥å­—æ®µå°†é€šè¿‡pUserDataå‚æ•°ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚<br>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ¥ä¼ é€’æŒ‡å‘HelloTriangleApplicationç±»çš„æŒ‡é’ˆã€‚</p>
<p>åº”è¯¥å°†ç»“æ„ä½“ VkDebugUtilsMessengerEXT ä¼ é€’ç»™vkCreateDebugUtilsMessengerEXTå‡½æ•°ä»¥åˆ›å»ºVkDebugUtilsMessengerEXTå¯¹è±¡ã€‚<br>ç„¶è€Œå› ä¸ºè¿™ä¸ªfunctionæ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨åŠ è½½ã€‚<br>å¿…é¡»ä½¿ç”¨vkGetInstanceProcAddræŸ¥æ‰¾å…¶åœ°å€ã€‚ åˆ›å»ºä»£ç†å‡½æ•°ï¼Œç„¶ååœ¨å¤„ç†å®ƒï¼Œå¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">CreateDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessengerCreateInfoEXT* pCreateInfo, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">    VkAllocationCallbacks* pAllocator, VkDebugUtilsMessengerEXT*</span></span></span><br><span class="line"><span class="params"><span class="function">    pDebugMessenger)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> func = (PFN_vkCreateDebugUtilsMessengerEXT)</span><br><span class="line">    <span class="built_in">vkGetInstanceProcAddr</span>(instance,<span class="string">&quot;vkCreateDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">func</span>(instance, pCreateInfo, pAllocator, pDebugMessenger);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> VK_ERROR_EXTENSION_NOT_PRESENT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ setupDebugMessenger ä¸­è°ƒç”¨æ­¤å‡½æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">setupDebugMessenger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!enableValidationLayers) <span class="keyword">return</span>;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–DebugUtilsMessengerEXT</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">CreateDebugUtilsMessengerEXT</span>(instance, &amp;createInfo, <span class="literal">nullptr</span>,</span><br><span class="line">        &amp;debugMessenger) != VK_SUCCESS) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to set up debug messenger!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åæ³¨æ„ï¼Œæ—¢ç„¶æœ‰ vkCreateXXX, å°±éœ€è¦æ˜¾ç¤ºè°ƒç”¨ vkDestroyXXX å“¦ï¼</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">DestroyDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDebugUtilsMessengerEXT debugMessenger, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">    VkAllocationCallbacks* pAllocator)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> func = (PFN_vkDestroyDebugUtilsMessengerEXT)</span><br><span class="line">    <span class="built_in">vkGetInstanceProcAddr</span>(instance, <span class="string">&quot;vkDestroyDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="built_in">func</span>(instance, debugMessenger, pAllocator);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ å¿˜äº†è°ƒç”¨DestroyDebugUtilsMessengerEXTå»é”€æ¯debugMessengerï¼Œåœ¨å…³é—­çª—å£çš„æ—¶å€™å°±ä¼šæ‰“å°å¦‚ä¸‹ä¿¡æ¯:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-2-%E5%88%9B%E5%BB%BAVulkan%E7%A4%BA%E4%BE%8B%E5%8F%8A%E9%AA%8C%E8%AF%81%E5%B1%82/Vulkan_2_1.png" alt="å›¾ç‰‡"></p>
<h1 id="ä¸‰-ä»£ç "><a href="#ä¸‰-ä»£ç " class="headerlink" title="ä¸‰. ä»£ç "></a>ä¸‰. ä»£ç </h1><h2 id="3-1-Makefile"><a href="#3-1-Makefile" class="headerlink" title="3.1 Makefile"></a>3.1 Makefile</h2><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">VULKAN_SDK_PATH = /home/jh/Program/vulkan/1.1.160.0/x86_64</span><br><span class="line"></span><br><span class="line">CFLAGS = -std=c++17 -I<span class="variable">$(VULKAN_SDK_PATH)</span>/<span class="keyword">include</span></span><br><span class="line">LDFLAGS = -L<span class="variable">$(VULKAN_SDK_PATH)</span>/lib -lvulkan `pkg-config --static --libs glfw3`</span><br><span class="line">LDFLAGS += -ldl</span><br><span class="line"></span><br><span class="line"><span class="section">HelloTriangleApplication: main.cpp</span></span><br><span class="line">	g++ <span class="variable">$(CFLAGS)</span> -o HelloTriangleApplication main.cpp <span class="variable">$(LDFLAGS)</span></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: test clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">test: HelloTriangleApplication</span></span><br><span class="line">    LD_LIBRARY_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/lib</span><br><span class="line">        VK_LAYER_PATH=<span class="variable">$(VULKAN_SDK_PATH)</span>/etc/explicit_layer.d ./HelloTriangleApplication</span><br><span class="line"></span><br><span class="line"><span class="section">clean:rm -f HelloTriangleApplication</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-main-cpp"><a href="#3-2-main-cpp" class="headerlink" title="3.2 main.cpp"></a>3.2 main.cpp</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * #include &lt;vulkan/vulkan.h&gt; // vulkan å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ä¸‹é¢ä¸¤è¡Œæ›¿æ¢ vulkanå¤´æ–‡ä»¶</span></span><br><span class="line"><span class="comment"> *   #define GLFW_INCLUDE_VULKAN</span></span><br><span class="line"><span class="comment"> *   #include &lt;GLFW/glfw3.h&gt;</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *  GLFW ä¼šè‡ªåŠ¨åŠ è½½ vulkan å¤´æ–‡ä»¶çš„ã€‚</span></span><br><span class="line"><span class="comment"> * GLFWæ˜¯ä¸€ä¸ªå¼€æºï¼Œå¤šå¹³å°çš„åº“ï¼Œç”¨äºæ¡Œé¢ä¸Šçš„OpenGLï¼ŒOpenGL ESå’ŒVulkanå¼€å‘ã€‚ </span></span><br><span class="line"><span class="comment"> * å®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„APIï¼Œç”¨äºåˆ›å»ºçª—å£ï¼Œä¸Šä¸‹æ–‡å’Œæ›²é¢ï¼Œæ¥æ”¶è¾“å…¥å’Œäº‹ä»¶ã€‚</span></span><br><span class="line"><span class="comment"> * GLFWæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œå¹¶ä¸”ä½¿ç”¨X Windowç³»ç»Ÿï¼ˆä¾‹å¦‚Linuxå’ŒFreeBSDï¼‰å¯¹Windowsï¼ŒmacOSå’Œè®¸å¤šç±»Unixç³»ç»Ÿæä¾›åŸç”Ÿæ”¯æŒã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> GLFW_INCLUDE_VULKAN</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GLFW/glfw3.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span> <span class="comment">// åŒ…å«ç”¨äºæŠ¥å‘Šé”™è¯¯çš„å¤´æ–‡ä»¶</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span> <span class="comment">// ç”¨äºèµ„æºç®¡ç†éƒ¨åˆ†ä¸­çš„lambdaå‡½æ•°</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span> <span class="comment">// cstdlib: EXIT_FAILURE, EXIT_SUCCESS</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> NDEBUG</span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">false</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> enableValidationLayers = <span class="literal">true</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloTriangleApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">initWindow</span>();</span><br><span class="line">        <span class="built_in">initVulkan</span>();</span><br><span class="line">        <span class="built_in">mainLoop</span>();</span><br><span class="line">        <span class="built_in">cleanup</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> WIDTH = <span class="number">800</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> HEIGHT = <span class="number">600</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span> * WINDOW_TITLE = <span class="string">&quot;Vulkan&quot;</span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ç¬¬ä¸€æ­¥ä¸€å®šæ˜¯å…ˆåˆå§‹åŒ–GLFWåº“.</span></span><br><span class="line">        <span class="built_in">glfwInit</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å› ä¸ºGLFWæœ€åˆæ˜¯ä¸ºåˆ›å»ºOpenGLä¸Šä¸‹æ–‡è€Œè®¾è®¡çš„ï¼Œ</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥æˆ‘ä»¬éœ€è¦å‘Šè¯‰å®ƒä¸è¦é€šè¿‡åç»­è°ƒç”¨åˆ›å»ºOpenGLä¸Šä¸‹æ–‡ï¼šGLFW_NO_API</span></span><br><span class="line">        <span class="built_in">glfwWindowHint</span>(GLFW_CLIENT_API, GLFW_NO_API);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å› ä¸ºå¤„ç†å¤§å°å¯å˜çš„çª—å£æ¯”è¾ƒå¤æ‚ï¼Œæš‚æ—¶å…ˆè®©çª—å£ä¸å¯å˜</span></span><br><span class="line">        <span class="built_in">glfwWindowHint</span>(GLFW_RESIZABLE, GLFW_FALSE);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºçª—å£</span></span><br><span class="line">        <span class="comment">// GLFWwindow *glfwCreateWindow(int width, int height, const char *title, GLFWmonitor *monitor, GLFWwindow *share)</span></span><br><span class="line">        window = <span class="built_in">glfwCreateWindow</span>(WIDTH, HEIGHT, WINDOW_TITLE, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">checkAvailableExtensions</span>();</span><br><span class="line">        <span class="built_in">createInstance</span>();</span><br><span class="line">        <span class="comment">// åˆ›å»ºDEBUGæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">        <span class="built_in">setupDebugMessenger</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setupDebugMessenger</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!enableValidationLayers) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        VkDebugUtilsMessengerCreateInfoEXT createInfo = &#123;&#125;;</span><br><span class="line">        createInfo.sType = VK_STRUCTURE_TYPE_DEBUG_UTILS_MESSENGER_CREATE_INFO_EXT;</span><br><span class="line">        createInfo.messageSeverity =</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_SEVERITY_VERBOSE_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_SEVERITY_ERROR_BIT_EXT;</span><br><span class="line">        createInfo.messageType =</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_TYPE_GENERAL_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_TYPE_VALIDATION_BIT_EXT |</span><br><span class="line">            VK_DEBUG_UTILS_MESSAGE_TYPE_PERFORMANCE_BIT_EXT;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆæ¯å›è°ƒå‡½æ•°</span></span><br><span class="line">        createInfo.pfnUserCallback = debugCallback;</span><br><span class="line">        createInfo.pUserData = <span class="literal">nullptr</span>; <span class="comment">// å¯é€‰</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®ä¾‹åŒ–DebugUtilsMessengerEXT</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">CreateDebugUtilsMessengerEXT</span>(instance, &amp;createInfo, <span class="literal">nullptr</span>,</span><br><span class="line">                &amp;debugMessenger) != VK_SUCCESS) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to set up debug messenger!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">checkAvailableExtensions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> extensionCount = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceExtensionProperties</span>(<span class="literal">nullptr</span>, &amp;extensionCount, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="function">std::vector&lt;VkExtensionProperties&gt; <span class="title">extensions</span><span class="params">(extensionCount)</span></span>;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceExtensionProperties</span>(<span class="literal">nullptr</span>, &amp;extensionCount, extensions.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;available extensions:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; extension : extensions) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;\t&quot;</span> &lt;&lt; extension.extensionName &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkValidationLayerSupport</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> layerCount;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceLayerProperties</span>(&amp;layerCount, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="function">std::vector&lt;VkLayerProperties&gt; <span class="title">availableLayers</span><span class="params">(layerCount)</span></span>;</span><br><span class="line">        <span class="built_in">vkEnumerateInstanceLayerProperties</span>(&amp;layerCount, availableLayers.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="type">char</span>* layerName : validationLayers) &#123;</span><br><span class="line">            <span class="comment">//bool layerFound = false;</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; layerProperties : availableLayers) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(layerName, layerProperties.layerName) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">//layerFound = true;</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">createInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// éªŒè¯å±‚ï¼Œæ£€éªŒVK_LAYER_KHRONOS_validation</span></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers &amp;&amp; !<span class="built_in">checkValidationLayerSupport</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;validation layers requested, but not available!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªå®ä¾‹é¦–å…ˆå¿…é¡»å¡«å†™ä¸€ä¸ªåŒ…å«æœ‰å…³æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ä¿¡æ¯çš„ç»“æ„: VkApplicationInfo</span></span><br><span class="line">        <span class="comment">// è¿™äº›æ•°æ®åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯é€‰çš„ï¼Œä½†å®ƒå¯ä»¥ä¸ºé©±åŠ¨ç¨‹åºæä¾›ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä»¥ä¾¿é’ˆå¯¹æˆ‘ä»¬çš„ç‰¹å®šåº”ç”¨è¿›è¡Œä¼˜åŒ–</span></span><br><span class="line">        VkApplicationInfo appInfo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Vulkanä¸­çš„è®¸å¤šç»“æ„è¦æ±‚åœ¨sTypeæˆå‘˜ä¸­æ˜ç¡®æŒ‡å®šç±»å‹ã€‚ </span></span><br><span class="line">        <span class="comment">// è¿™ä¹Ÿæ˜¯å…·æœ‰pNextæˆå‘˜çš„è®¸å¤šç»“æ„ä¸­çš„ä¸€ä¸ªï¼Œè¯¥æˆå‘˜å¯ä»¥åœ¨å°†æ¥æŒ‡å‘æ‰©å±•ä¿¡æ¯ã€‚</span></span><br><span class="line">        appInfo.sType = VK_STRUCTURE_TYPE_APPLICATION_INFO;</span><br><span class="line"></span><br><span class="line">        appInfo.pApplicationName = <span class="string">&quot;Hello Triangle&quot;</span>;</span><br><span class="line">        appInfo.applicationVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        appInfo.pEngineName = <span class="string">&quot;No Engine&quot;</span>;</span><br><span class="line">        appInfo.engineVersion = <span class="built_in">VK_MAKE_VERSION</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">        appInfo.apiVersion = VK_API_VERSION_1_1;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Vulkanä¸­çš„å¾ˆå¤šä¿¡æ¯éƒ½æ˜¯é€šè¿‡ç»“æ„è€Œä¸æ˜¯å‡½æ•°å‚æ•°ä¼ é€’çš„ï¼Œ</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬å¿…é¡»å†å¡«å……ä¸€ä¸ªç»“æ„ä½“ VkInstanceCreateInfo æ¥ä¸ºåˆ›å»ºå®ä¾‹æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ã€‚</span></span><br><span class="line">        <span class="comment">// VkInstanceCreateInfoç»“æ„æ˜¯å¿…é¡»æŒ‡æ˜çš„ï¼Œå®ƒå‘Šè¯‰Vulkané©±åŠ¨ç¨‹åºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨å“ªäº›å…¨å±€æ‰©å±•å’ŒéªŒè¯å±‚ã€‚ </span></span><br><span class="line">        VkInstanceCreateInfo createInfo = &#123;&#125;;</span><br><span class="line">        createInfo.sType = VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO;</span><br><span class="line">        createInfo.pNext = <span class="literal">nullptr</span>;</span><br><span class="line">        createInfo.pApplicationInfo = &amp;appInfo;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        // å‰ä¸¤ä¸ªå‚æ•°å¾ˆç®€å•ã€‚ </span></span><br><span class="line"><span class="comment">        // Vulkanæ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œè¿™æ„å‘³ç€éœ€è¦ä¸€ä¸ªä¸çª—å£ç³»ç»Ÿæ¥å£çš„æ‰©å±•ã€‚</span></span><br><span class="line"><span class="comment">        // GLFWæœ‰ä¸€ä¸ªæ–¹ä¾¿çš„å†…ç½®å‡½æ•°ï¼Œå®ƒè¿”å›å®ƒéœ€è¦åšçš„æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ç»™ç»“æ„ä½“ï¼šVkInstanceCreateInfo</span></span><br><span class="line"><span class="comment">        uint32_t glfwExtensionCount = 0;</span></span><br><span class="line"><span class="comment">        const char** glfwExtensions;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">        // è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•ã€‚</span></span><br><span class="line"><span class="comment">        // æ­¤å‡½æ•°è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•åçš„æ•°ç»„ï¼Œä»¥ä¾¿ä¸ºGLFWçª—å£åˆ›å»ºVulkan surfaceã€‚ </span></span><br><span class="line"><span class="comment">        // å¦‚æœæˆåŠŸï¼Œåˆ—è¡¨å°†å§‹ç»ˆåŒ…å«`VK_KHR_surface`ï¼Œå› æ­¤å¦‚æœæ‚¨ä¸éœ€è¦ä»»ä½•å…¶ä»–æ‰©å±•ï¼Œåˆ™å¯ä»¥å°†æ­¤åˆ—è¡¨ç›´æ¥ä¼ é€’ç»™`VkInstanceCreateInfo`ç»“æ„ã€‚</span></span><br><span class="line"><span class="comment">        // å¦‚æœæœºå™¨ä¸Šæ²¡æœ‰Vulkanï¼Œåˆ™æ­¤å‡½æ•°è¿”å›â€œNULLâ€å¹¶ç”Ÿæˆ GLFW_API_UNAVAILABLEé”™è¯¯ã€‚</span></span><br><span class="line"><span class="comment">        glfwExtensions = glfwGetRequiredInstanceExtensions(&amp;glfwExtensionCount);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        // ç¬”è€…æ›¾åœ¨è¿™é‡Œæ ½äº†ä¸ªè·Ÿå¤´ï¼Œå†™é”™äº†ã€‚å¦‚ä¸Šå†™ï¼Œç¼–è¯‘ä¸å‡ºé—®é¢˜ï¼Œä½†è¿è¡Œæ—¶ä¼šæŠ¥ Segmentation fault (core dumped)</span></span><br><span class="line"><span class="comment">        // æ‰“å°å †æ ˆï¼Œçœ‹äº†åŠå¤©ï¼Œæ‰å‘ç°çš„ï¼Œå¼•ä»¥ä¸ºæˆ’ï¼Œä¸è¿‡è¿™ä¸¤å˜é‡åå­—å¾ˆåƒã€‚</span></span><br><span class="line"><span class="comment">        createInfo.ppEnabledLayerNames = glfwExtensions;</span></span><br><span class="line"><span class="comment">        createInfo.ppEnabledExtensionNames = glfwExtensions;</span></span><br><span class="line"><span class="comment">        createInfo.enabledExtensionCount = glfwExtensionCount;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="comment">// è¿”å›GLFWæ‰€éœ€çš„Vulkanå®ä¾‹æ‰©å±•, æ”¯æŒæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">        <span class="keyword">auto</span> extensions = <span class="built_in">getRequiredExtensions</span>();</span><br><span class="line">        createInfo.enabledExtensionCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(extensions.<span class="built_in">size</span>());</span><br><span class="line">        createInfo.ppEnabledExtensionNames = extensions.<span class="built_in">data</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç»“æ„ä½“çš„æœ€åä¸¤ä¸ªæˆå‘˜ç¡®å®šè¦å¯ç”¨çš„å…¨å±€éªŒè¯å±‚ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">            createInfo.enabledLayerCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(validationLayers.<span class="built_in">size</span>());</span><br><span class="line">            createInfo.ppEnabledLayerNames = validationLayers.<span class="built_in">data</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            createInfo.enabledLayerCount = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// VkResult vkCreateInstance(const VkInstanceCreateInfo *pCreateInfo, const VkAllocationCallbacks *pAllocator, VkInstance *pInstance)</span></span><br><span class="line">        VkResult res = <span class="built_in">vkCreateInstance</span>(&amp;createInfo, <span class="literal">nullptr</span>, &amp;instance);</span><br><span class="line">        <span class="keyword">if</span> (res != VK_SUCCESS) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create instance!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mainLoop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¾ªç¯, ä½¿åº”ç”¨ç¨‹åºä¿æŒè¿è¡Œç›´åˆ°å‘ç”Ÿé”™è¯¯æˆ–çª—å£å…³é—­</span></span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window)) &#123;</span><br><span class="line">            <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨ vulkan ä¸­æ¨èåœ¨åˆ›å»ºçš„èµ„æºä¸éœ€è¦åä¸»åŠ¨é‡Šæ”¾</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// é‡Šæ”¾debugMessenger(VkDebugUtilsMessengerEXT, ç”¨äºæ‰“å°è°ƒè¯•ä¿¡æ¯)</span></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">            <span class="built_in">DestroyDebugUtilsMessengerEXT</span>(instance, debugMessenger, <span class="literal">nullptr</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åœ¨ vulkan ä¸­èµ„æºä¸€èˆ¬éƒ½æ˜¯ vkCreateXXX åˆ›å»ºï¼Œç”± vkDestroyXXX æˆ– vkFreeXXX é‡Šæ”¾.</span></span><br><span class="line">        <span class="built_in">vkDestroyInstance</span>(instance, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤å‡½æ•°ä¼šç ´åæŒ‡å®šçš„çª—å£åŠå…¶ä¸Šä¸‹æ–‡ã€‚ åœ¨è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œä¸ä¼šä¸ºè¯¥çª—å£è°ƒç”¨å…¶ä»–å›è°ƒã€‚</span></span><br><span class="line">        <span class="comment">// å¦‚æœæŒ‡å®šçª—å£çš„ä¸Šä¸‹æ–‡åœ¨ä¸»çº¿ç¨‹ä¸Šæ˜¯æœ€æ–°çš„ï¼Œåˆ™åœ¨é”€æ¯ä¹‹å‰å°†å…¶åˆ†ç¦»ã€‚</span></span><br><span class="line">        <span class="built_in">glfwDestroyWindow</span>(window);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤åŠŸèƒ½ä¼šé‡Šæ”¾æ‰€æœ‰å‰©ä½™çš„çª—å£å’Œå…‰æ ‡å¹¶é‡Šæ”¾ä»»ä½•å…¶ä»–å·²åˆ†é…çš„èµ„æºã€‚ </span></span><br><span class="line">        <span class="comment">// è°ƒç”¨æ­¤å‡½æ•°åï¼Œå¿…é¡»å†æ¬¡æˆåŠŸè°ƒç”¨@ref glfwInitï¼Œç„¶åæ‰èƒ½ä½¿ç”¨å¤§å¤šæ•°GLFWå‡½æ•°ã€‚</span></span><br><span class="line">        <span class="built_in">glfwTerminate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºæ¶ˆæ¯å›è°ƒMessage Callback</span></span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">getRequiredExtensions</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">uint32_t</span> glfwExtensionCount = <span class="number">0</span>;</span><br><span class="line">        <span class="type">const</span> <span class="type">char</span>** glfwExtensions;</span><br><span class="line">        glfwExtensions = <span class="built_in">glfwGetRequiredInstanceExtensions</span>(&amp;glfwExtensionCount);</span><br><span class="line"></span><br><span class="line">        <span class="function">std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; <span class="title">extensions</span><span class="params">(glfwExtensions, glfwExtensions + glfwExtensionCount)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">            extensions.<span class="built_in">push_back</span>(VK_EXT_DEBUG_UTILS_EXTENSION_NAME);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> extensions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°debugä¿¡æ¯</span></span><br><span class="line">    <span class="function"><span class="type">static</span> VKAPI_ATTR VkBool32 VKAPI_CALL <span class="title">debugCallback</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessageSeverityFlagBitsEXT messageSeverity,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessageTypeFlagsEXT messageType,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">const</span> VkDebugUtilsMessengerCallbackDataEXT* pCallbackData,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">void</span>* pUserData)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;validation layer: &quot;</span> &lt;&lt; pCallbackData-&gt;pMessage&lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> VK_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»º VkDebugUtilsMessengerEXT å¯¹è±¡debugMessenger</span></span><br><span class="line">    <span class="function">VkResult <span class="title">CreateDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessengerCreateInfoEXT* pCreateInfo, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">        VkAllocationCallbacks* pAllocator, VkDebugUtilsMessengerEXT*</span></span></span><br><span class="line"><span class="params"><span class="function">        pDebugMessenger)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†ç»“æ„ä½“ VkDebugUtilsMessengerEXT ä¼ é€’ç»™vkCreateDebugUtilsMessengerEXTå‡½æ•°ä»¥åˆ›å»ºVkDebugUtilsMessengerEXTå¯¹è±¡ã€‚ </span></span><br><span class="line">        <span class="comment">// ç„¶è€Œå› ä¸ºè¿™ä¸ªfunctionæ˜¯ä¸€ä¸ªæ‰©å±•å‡½æ•°ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨åŠ è½½ã€‚</span></span><br><span class="line">        <span class="comment">// å¿…é¡»ä½¿ç”¨vkGetInstanceProcAddræŸ¥æ‰¾å…¶åœ°å€ã€‚</span></span><br><span class="line">        <span class="keyword">auto</span> func = (PFN_vkCreateDebugUtilsMessengerEXT)</span><br><span class="line">        <span class="built_in">vkGetInstanceProcAddr</span>(instance,<span class="string">&quot;vkCreateDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">func</span>(instance, pCreateInfo, pAllocator, pDebugMessenger);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> VK_ERROR_EXTENSION_NOT_PRESENT;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é”€æ¯VkDebugUtilsMessengerEXT</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">DestroyDebugUtilsMessengerEXT</span><span class="params">(VkInstance instance,</span></span></span><br><span class="line"><span class="params"><span class="function">        VkDebugUtilsMessengerEXT debugMessenger, <span class="type">const</span></span></span></span><br><span class="line"><span class="params"><span class="function">        VkAllocationCallbacks* pAllocator)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> func = (PFN_vkDestroyDebugUtilsMessengerEXT)</span><br><span class="line">        <span class="built_in">vkGetInstanceProcAddr</span>(instance, <span class="string">&quot;vkDestroyDebugUtilsMessengerEXT&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (func != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="built_in">func</span>(instance, debugMessenger, pAllocator);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Windowå®ä¾‹</span></span><br><span class="line">    GLFWwindow* window;</span><br><span class="line">    <span class="comment">// Vulkanå®ä¾‹</span></span><br><span class="line">    VkInstance instance;</span><br><span class="line">    <span class="comment">// DEBUGæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">    VkDebugUtilsMessengerEXT debugMessenger;</span><br><span class="line">    <span class="comment">// éªŒè¯å±‚</span></span><br><span class="line">    <span class="type">const</span> std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; validationLayers = &#123;</span><br><span class="line">        <span class="string">&quot;VK_LAYER_KHRONOS_validation&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HelloTriangleApplication app;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        app.<span class="built_in">run</span>();</span><br><span class="line">    &#125; <span class="built_in">catch</span> (<span class="type">const</span> std::exception&amp; e) &#123;</span><br><span class="line">        std::cerr &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(3)-è®¾ç½®ç‰©ç†è®¾å¤‡å’Œé€»è¾‘è®¾å¤‡</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-3-%E8%AE%BE%E7%BD%AE%E7%89%A9%E7%90%86%E8%AE%BE%E5%A4%87%E5%92%8C%E9%80%BB%E8%BE%91%E8%AE%BE%E5%A4%87/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡ä¸»è¦æ˜¯å­¦ä¹ Vulkan Tutorial.pdfæ–‡æ¡£ä¸­çš„Physical devices and queue families(ç‰©ç†è®¾å¤‡å’Œé˜Ÿåˆ—ç³»åˆ—)éƒ¨åˆ†ä»¥åŠLogical device and queues(é€»è¾‘è®¾å¤‡ä¸é˜Ÿåˆ—)éƒ¨åˆ†ã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li>[Vulkan-æ–‡æ¡£]<a href="https://github.com/KhronosGroup/Vulkan-Docs">https://github.com/KhronosGroup/Vulkan-Docs</a></li>
<li>[Vulkan-featureæŸ¥è¯¢]<a href="https://vulkan.lunarg.com/doc/view/1.0.26.0/linux/vkspec.chunked/ch31s01.html">https://vulkan.lunarg.com/doc/view/1.0.26.0/linux/vkspec.chunked/ch31s01.html</a></li>
</ol>
<h1 id="ä¸€-Physical-devices-and-queue-families-ç‰©ç†è®¾å¤‡å’Œé˜Ÿåˆ—ç³»åˆ—"><a href="#ä¸€-Physical-devices-and-queue-families-ç‰©ç†è®¾å¤‡å’Œé˜Ÿåˆ—ç³»åˆ—" class="headerlink" title="ä¸€. Physical devices and queue families(ç‰©ç†è®¾å¤‡å’Œé˜Ÿåˆ—ç³»åˆ—)"></a>ä¸€. Physical devices and queue families(ç‰©ç†è®¾å¤‡å’Œé˜Ÿåˆ—ç³»åˆ—)</h1><h2 id="1-1-é€‰æ‹©ç‰©ç†æ˜¾å¡GPU"><a href="#1-1-é€‰æ‹©ç‰©ç†æ˜¾å¡GPU" class="headerlink" title="1.1 é€‰æ‹©ç‰©ç†æ˜¾å¡GPU"></a>1.1 é€‰æ‹©ç‰©ç†æ˜¾å¡GPU</h2><p>åœ¨é€šè¿‡VkInstanceåˆå§‹åŒ–Vulkanåº“ä¹‹åï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­æŸ¥æ‰¾å¹¶é€‰æ‹©æ”¯æŒæˆ‘ä»¬æ‰€éœ€åŠŸèƒ½çš„å›¾å½¢æ˜¾å¡ã€‚<br>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»æ„æ•°é‡çš„æ˜¾å¡å¹¶åŒæ—¶ä½¿ç”¨ã€‚ä½†åœ¨è¿™é‡Œï¼Œåªä½¿ç”¨ç¬¬ä¸€ä¸ªé€‚åˆæˆ‘ä»¬éœ€æ±‚çš„æ˜¾å¡ã€‚<br>æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªå‡½æ•°pickPhysicalDeviceå¹¶åœ¨initVulkanå‡½æ•°ä¸­æ·»åŠ å¯¹å®ƒçš„è°ƒç”¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">checkAvailableExtensions</span>();</span><br><span class="line">    <span class="built_in">createInstance</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºDEBUGæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">    <span class="built_in">setupDebugMessenger</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€‰æ‹©ç‰©ç†è®¾å¤‡</span></span><br><span class="line">    <span class="built_in">pickPhysicalDevice</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pickPhysicalDevice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆé€‰æ‹©çš„å›¾å½¢å¡å°†å­˜å‚¨åœ¨VkPhysicalDeviceå¥æŸ„ä¸­ï¼Œè¯¥å¥æŸ„ä½œä¸ºæ–°çš„ç±»æˆå‘˜æ·»åŠ ã€‚å½“VkInstanceè¢«é”€æ¯æ—¶ï¼Œè¯¥å¯¹è±¡å°†è¢«éšå¼é”€æ¯ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦åœ¨æ¸…ç†å‡½æ•°ä¸­åšä»»ä½•æ–°çš„æ“ä½œã€‚</p>
<ol>
<li>VkPhysicalDeviceå¯¹è±¡ä¸èƒ½è¢«æ˜¾å¼é”€æ¯ã€‚ç›¸åï¼Œå½“æ£€ç´¢åˆ°å®ƒä»¬çš„VkInstanceå¯¹è±¡è¢«æ’¤é”€æ—¶ï¼Œå®ƒä»¬å°†éšå¼æ’¤é”€ã€‚</li>
<li>ä¸€æ—¦æ‰€æœ‰ç”±VkPhysicalDeviceå¯¹è±¡åˆ›å»ºçš„VkDeviceå¯¹è±¡éƒ½è¢«é”€æ¯ï¼ŒVkInstanceå¯¹è±¡å°±å¯ä»¥è¢«é”€æ¯ã€‚</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPhysicalDevice physicalDevice = VK_NULL_HANDLE;</span><br></pre></td></tr></table></figure>

<p>åˆ—å‡ºç‰©ç†æ˜¾å¡çš„è¿‡ç¨‹å’Œåˆ—å‡ºvulkanæ‰©å±•çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œé¦–å…ˆæ˜¯è·å–æœ¬æœºç‰©ç†æ˜¾å¡çš„æ•°é‡ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">pickPhysicalDevice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> deviceCount = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// é¦–å…ˆè·å–æœ¬æœºç‰©ç†æ˜¾å¡æ•°é‡</span></span><br><span class="line">    <span class="built_in">vkEnumeratePhysicalDevices</span>(instance, &amp;deviceCount, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“ç„¶æ²¡æœ‰GPUæ—¶ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (deviceCount == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to find GPUs with Vulkan support!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;VkPhysicalDevice&gt; <span class="title">devices</span><span class="params">(deviceCount)</span></span>;</span><br><span class="line">    <span class="built_in">vkEnumeratePhysicalDevices</span>(instance, &amp;deviceCount, devices.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éå†æ‰€æœ‰GPU, é€‰æ‹©åˆé€‚çš„ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; device : devices) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">isDeviceSuitable</span>(device)) &#123;</span><br><span class="line">            physicalDevice = device;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isDeviceSuitable</span><span class="params">(VkPhysicalDevice device)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æš‚æ—¶æ²¡ä»€ä¹ˆå¯ä»¥æŒ‘å‰”çš„ï¼Œéƒ½å¯ä»¥å§</span></span><br><span class="line">    <span class="comment">// å…¶å®å¤§éƒ¨åˆ†çš„æœºå™¨åªä¼šæœ‰ä¸€ä¸ªæ˜¾å¡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-2-åŸºç¡€è®¾å¤‡é€‚é…æ€§æ£€æŸ¥"><a href="#1-2-åŸºç¡€è®¾å¤‡é€‚é…æ€§æ£€æŸ¥" class="headerlink" title="1.2 åŸºç¡€è®¾å¤‡é€‚é…æ€§æ£€æŸ¥"></a>1.2 åŸºç¡€è®¾å¤‡é€‚é…æ€§æ£€æŸ¥</h2><p>é€šè¿‡æŸ¥è¯¢ç»†èŠ‚æ¥è¯„ä¼°è®¾å¤‡çš„é€‚ç”¨æ€§ã€‚<br>å¯ä»¥ä½¿ç”¨<strong>vkGetPhysicalDeviceProperties</strong>æŸ¥è¯¢åŸºæœ¬è®¾å¤‡å±æ€§ï¼Œå¦‚åç§°ï¼Œç±»å‹å’Œæ”¯æŒçš„Vulkanç‰ˆæœ¬ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPhysicalDeviceProperties deviceProperties;</span><br><span class="line"><span class="built_in">vkGetPhysicalDeviceProperties</span>(device, &amp;deviceProperties);</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨<strong>vkGetPhysicalDeviceFeatures</strong>æŸ¥è¯¢å¯¹çº¹ç†å‹ç¼©ï¼Œ64ä½æµ®ç‚¹å’Œå¤šè§†å£æ¸²æŸ“ï¼ˆå¯¹VRæœ‰ç”¨ï¼‰ç­‰å¯é€‰åŠŸèƒ½çš„æ”¯æŒï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPhysicalDeviceFeatures deviceFeatures;</span><br><span class="line"><span class="built_in">vkGetPhysicalDeviceFeatures</span>(device, &amp;deviceFeatures);</span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬æ“ä½œå°±æ˜¯ï¼š</p>
<ol>
<li>é€šè¿‡vkGetPhysicalDevicePropertiesè·å–æœ¬æœºè®¾å¤‡çš„å±æ€§</li>
<li>æŸ¥è¯¢vkGetPhysicalDeviceFeaturesä¸­å¯ä»¥è¢«æ”¯æŒçš„feature</li>
</ol>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä»…é€‚ç”¨äºæ”¯æŒå‡ ä½•ç€è‰²å™¨çš„ä¸“ç”¨æ˜¾å¡ã€‚ é‚£ä¹ˆisDeviceSuitableå‡½æ•°å°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isDeviceSuitable</span><span class="params">(VkPhysicalDevice device)</span> </span>&#123;</span><br><span class="line">    VkPhysicalDeviceProperties deviceProperties;</span><br><span class="line">    VkPhysicalDeviceFeatures deviceFeatures;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceProperties</span>(device, &amp;deviceProperties);</span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceFeatures</span>(device, &amp;deviceFeatures);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ((deviceProperties.deviceType == VK_PHYSICAL_DEVICE_TYPE_DISCRETE_GPU)</span><br><span class="line">            &amp;&amp; deviceFeatures.geometryShader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰å¯æ”¯æŒçš„featureè§é™„å½•ã€‚<br>æ ¹æ®Vulkan Tutorialæ–‡æ¡£ï¼Œæœ‰æ¨èä½¿ç”¨è¯„åˆ†æœºåˆ¶æ¥é€‰æ‹©æœ€åˆé€‚çš„GPUï¼Œè¿™ä¸ªå°±è§ä»è§æ™ºï¼Œçœ‹ä¸ªäººå–œå¥½ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>
<h2 id="1-3-Queue-families"><a href="#1-3-Queue-families" class="headerlink" title="1.3 Queue families"></a>1.3 Queue families</h2><p>å‡ ä¹æ‰€æœ‰Vulkanä¸­çš„æ“ä½œï¼Œä»ç»˜å›¾åˆ°ä¸Šä¼ çº¹ç†ï¼Œéƒ½éœ€è¦å°†å‘½ä»¤æäº¤åˆ°é˜Ÿåˆ—ä¸­(è¿™ä¸€ç‚¹ç ”ç©¶è¿‡hwuiçš„ç«¥é‹è‚¯å®šæ·±æœ‰ä½“ä¼š)ã€‚<br>å­˜åœ¨æ¥è‡ªä¸åŒé˜Ÿåˆ—ç³»åˆ—çš„ä¸åŒç±»å‹çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸”æ¯ä¸ªé˜Ÿåˆ—æ—ä»…å…è®¸å‘½ä»¤çš„å­é›†ã€‚<br>ä¾‹å¦‚ï¼Œå¯èƒ½å­˜åœ¨ä»…å…è®¸å¤„ç†è®¡ç®—å‘½ä»¤çš„é˜Ÿåˆ—ç³»åˆ—æˆ–ä»…å…è®¸ä¸å­˜å‚¨å™¨ä¼ è¾“ç›¸å…³çš„å‘½ä»¤çš„é˜Ÿåˆ—ç³»åˆ—ã€‚</p>
<p>æ‰€æœ‰æˆ‘ä»¬éœ€è¦æ£€æŸ¥æœ¬æœºè®¾å¤‡æ”¯æŒå“ªäº›é˜Ÿåˆ—ç³»åˆ—ï¼Œä»¥åŠå“ªä¸€ä¸ªæ”¯æŒæˆ‘ä»¬è¦ä½¿ç”¨çš„å‘½ä»¤ã€‚<br>æ·»åŠ ä¸€ä¸ªæ–°å‡½æ•°findQueueFamiliesï¼Œç”¨äºæŸ¥æ‰¾æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰é˜Ÿåˆ—ç³»åˆ—ã€‚<br>æ¯”å¦‚æŸ¥æ‰¾æ”¯æŒå›¾å½¢å‘½ä»¤çš„é˜Ÿåˆ—ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">QueueFamilyIndices</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ«å¿˜äº†æ·»åŠ å¤´æ–‡ä»¶ï¼šincluding &lt;optional&gt;</span></span><br><span class="line">    <span class="comment">// optionalç”¨é€”å¦‚å…¶åï¼Œå®ƒå¯ä»¥å®¹çº³ä¸€ä¸ªå¯¹è±¡å€¼æˆ–æ˜¯ä¸ºç©ºã€‚</span></span><br><span class="line">    <span class="comment">// å…¸å‹çš„åº”ç”¨æƒ…æ™¯æ˜¯å‡½æ•°è°ƒç”¨æ—¶ï¼Œå¦‚éœ€æ ¹æ®æ¡ä»¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆæœ‰æ•ˆï¼‰æˆ–é»˜è®¤å¯¹è±¡ï¼ˆæ— æ•ˆï¼‰</span></span><br><span class="line">    <span class="comment">// è‹¥è¯¥å¯¹è±¡æ„é€ æˆæœ¬å¾ˆé«˜ï¼ˆèµ„æºåˆ†é…ç­‰ï¼‰ï¼Œå¯ç”¨optionalè¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæé«˜æ•ˆç‡ã€‚</span></span><br><span class="line">    std::optional&lt;<span class="type">uint32_t</span>&gt; graphicsFamily;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> graphicsFamily.<span class="built_in">has_value</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">QueueFamilyIndices <span class="title">findQueueFamilies</span><span class="params">(VkPhysicalDevice device)</span> </span>&#123;</span><br><span class="line">    QueueFamilyIndices indices;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…ˆæ£€æŸ¥æ•°é‡</span></span><br><span class="line">    <span class="type">uint32_t</span> queueFamilyCount = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ vkGetPhysicalDeviceQueueFamilyProperties æ£€ç´¢é˜Ÿåˆ—ç³»åˆ—æ˜¯å¦æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼š</span></span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceQueueFamilyProperties</span>(device, &amp;queueFamilyCount, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// VkQueueFamilyPropertiesç»“æ„åŒ…å«æœ‰å…³é˜Ÿåˆ—ç³»åˆ—çš„ä¸€äº›è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// åŒ…æ‹¬æ”¯æŒçš„æ“ä½œç±»å‹ä»¥åŠå¯åŸºäºè¯¥ç³»åˆ—åˆ›å»ºçš„é˜Ÿåˆ—æ•°</span></span><br><span class="line">    <span class="function">std::vector&lt;VkQueueFamilyProperties&gt; <span class="title">queueFamilies</span><span class="params">(queueFamilyCount)</span></span>;</span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceQueueFamilyProperties</span>(device, &amp;queueFamilyCount, queueFamilies.<span class="built_in">data</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¯”å¦‚æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªæ”¯æŒVK_QUEUE_GRAPHICS_BITçš„é˜Ÿåˆ—ç³»åˆ—</span></span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; queueFamily : queueFamilies) &#123;</span><br><span class="line">        <span class="keyword">if</span> (queueFamily.queueCount &gt; <span class="number">0</span> &amp;&amp; </span><br><span class="line">            queueFamily.queueFlags &amp; VK_QUEUE_GRAPHICS_BIT) &#123;</span><br><span class="line"></span><br><span class="line">            indices.graphicsFamily = i;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (indices.<span class="built_in">isComplete</span>()) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> indices;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠŠè¿™ä¸ªæ£€æŸ¥åŠ å…¥isDeviceSuitableå‡½æ•°ã€‚<br>ç°åœ¨å·²ç»æ‰¾åˆ°åˆé€‚çš„ç‰©ç†è®¾å¤‡äº†ï¼Œ ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªä¸ä¹‹é€‚é…çš„é€»è¾‘è®¾å¤‡ã€‚</p>
<h1 id="äºŒ-Logical-device-and-queues"><a href="#äºŒ-Logical-device-and-queues" class="headerlink" title="äºŒ. Logical device and queues"></a>äºŒ. Logical device and queues</h1><p>é€‰æ‹©è¦ä½¿ç”¨çš„ç‰©ç†è®¾å¤‡åï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸ä¹‹é€‚é…çš„é€»è¾‘è®¾å¤‡ã€‚<br>é€»è¾‘è®¾å¤‡åˆ›å»ºè¿‡ç¨‹ç±»ä¼¼äºå®ä¾‹åˆ›å»ºè¿‡ç¨‹ï¼Œè¿˜éœ€è¦æŒ‡å®šç°åœ¨è¦åˆ›å»ºçš„é˜Ÿåˆ—ï¼ˆå·²ç»æŸ¥è¯¢äº†å“ªäº›é˜Ÿåˆ—ç³»åˆ—å¯ç”¨ï¼‰ã€‚<br>å¹¶ä¸”ä»åŒä¸€ç‰©ç†è®¾å¤‡å¯ä»¥åˆ›å»ºå¤šä¸ªé€»è¾‘è®¾å¤‡ã€‚</p>
<p>å­˜å‚¨é€»è¾‘è®¾å¤‡ç±»ä¼¼ç‰©ç†è®¾å¤‡ï¼Œä¹Ÿæ˜¯ä½¿ç”¨å¥æŸ„ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkDevice device;</span><br></pre></td></tr></table></figure>
<h2 id="2-1-æŒ‡å®šè¦åˆ›å»ºçš„é˜Ÿåˆ—"><a href="#2-1-æŒ‡å®šè¦åˆ›å»ºçš„é˜Ÿåˆ—" class="headerlink" title="2.1 æŒ‡å®šè¦åˆ›å»ºçš„é˜Ÿåˆ—"></a>2.1 æŒ‡å®šè¦åˆ›å»ºçš„é˜Ÿåˆ—</h2><p>åˆ›å»ºé€»è¾‘è®¾å¤‡ä¹Ÿæ˜¯åœ¨ç»“æ„ä½“ä¸­æŒ‡å®šä¸€å †ç»†èŠ‚ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ˜¯VkDeviceQueueCreateInfoã€‚<br>æ­¤ç»“æ„æè¿°äº†æˆ‘ä»¬ä¸ºå•ä¸ªé˜Ÿåˆ—ç³»åˆ—æ‰€éœ€çš„é˜Ÿåˆ—æ•°ã€‚<br>æ¯”å¦‚åˆ›å»ºå…·æœ‰å›¾å½¢åŠŸèƒ½çš„é˜Ÿåˆ—ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">QueueFamilyIndices indices = <span class="built_in">findQueueFamilies</span>(physicalDevice);</span><br><span class="line"></span><br><span class="line">VkDeviceQueueCreateInfo queueCreateInfo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">queueCreateInfo.sType = VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO;</span><br><span class="line">queueCreateInfo.queueFamilyIndex = indices.graphicsFamily.<span class="built_in">value</span>();</span><br><span class="line">queueCreateInfo.queueCount = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>å½“å‰å¯ç”¨çš„é©±åŠ¨ç¨‹åºåªå…è®¸ä¸ºæ¯ä¸ªé˜Ÿåˆ—ç³»åˆ—åˆ›å»ºå°‘é‡é˜Ÿåˆ—ï¼Œå®é™…ä¸Šä¹Ÿä¸éœ€è¦å¤šä¸ªé˜Ÿåˆ—ã€‚<br>å› ä¸ºå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¸Šåˆ›å»ºæ‰€æœ‰å‘½ä»¤ç¼“å†²åŒºï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªä½å¼€é”€è°ƒç”¨åœ¨ä¸»çº¿ç¨‹ä¸Šä¸€æ¬¡æ€§æäº¤ã€‚</p>
<p>Vulkanå…è®¸ä¸ºé˜Ÿåˆ—åˆ†é…ä¼˜å…ˆçº§ï¼Œä»¥ä½¿ç”¨ä»‹äº0.0å’Œ1.0ä¹‹é—´çš„æµ®ç‚¹æ•°æ¥å½±å“å‘½ä»¤ç¼“å†²åŒºæ‰§è¡Œçš„è°ƒåº¦ã€‚<br><strong>å³ä½¿åªæœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼Œä¹Ÿæ˜¯å¿…éœ€çš„</strong>ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">float</span> queuePriority = <span class="number">1.0f</span>;</span><br><span class="line">queueCreateInfo.pQueuePriorities = &amp;queuePriority;</span><br></pre></td></tr></table></figure>
<h2 id="2-2-æŒ‡å®šä½¿ç”¨çš„è®¾å¤‡åŠŸèƒ½-feature"><a href="#2-2-æŒ‡å®šä½¿ç”¨çš„è®¾å¤‡åŠŸèƒ½-feature" class="headerlink" title="2.2 æŒ‡å®šä½¿ç”¨çš„è®¾å¤‡åŠŸèƒ½(feature)"></a>2.2 æŒ‡å®šä½¿ç”¨çš„è®¾å¤‡åŠŸèƒ½(feature)</h2><p>è¦æŒ‡å®šçš„ä¸‹ä¸€ä¸ªä¿¡æ¯æ˜¯æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„ä¸€ç»„è®¾å¤‡featureã€‚<br>è¿™äº›æ˜¯åœ¨[1.2]ä¸­ä½¿ç”¨vkGetPhysicalDeviceFeaturesæŸ¥è¯¢æ”¯æŒçš„åŠŸèƒ½ï¼Œä¾‹å¦‚å‡ ä½•ç€è‰²å™¨ã€‚<br>å¦‚æœä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„ä¸œè¥¿ï¼Œå¯ä»¥ç®€å•åœ°å®šä¹‰å®ƒå¹¶é»˜è®¤ä¸ºVK_FALSEã€‚<br>ä½†ä¸€æ—¦å³å°†å¼€å§‹ç”¨Vulkanåšæ›´å¤šæœ‰è¶£çš„äº‹æƒ…ï¼Œå°±éœ€è¦è®¾å®šè¿™ä¸ªç»“æ„äº†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPhysicalDeviceFeatures deviceFeatures = &#123;&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="2-3-åˆ›å»ºé€»è¾‘è®¾å¤‡"><a href="#2-3-åˆ›å»ºé€»è¾‘è®¾å¤‡" class="headerlink" title="2.3 åˆ›å»ºé€»è¾‘è®¾å¤‡"></a>2.3 åˆ›å»ºé€»è¾‘è®¾å¤‡</h2><p>åœ¨VkDeviceQueueCreateInfoå’ŒVkPhysicalDeviceFeaturesåˆ›å»ºå®Œæ¯•åï¼Œå°±å¯ä»¥æ ¹æ®è¿™ä¸ªåˆ›å»ºé€»è¾‘è®¾å¤‡å®ä¾‹äº†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkDeviceCreateInfo createInfo = &#123;&#125;;</span><br><span class="line">createInfo.sType = VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¦–å…ˆæŒ‡å®šVkDeviceQueueCreateInfo</span></span><br><span class="line">createInfo.pQueueCreateInfos = &amp;queueCreateInfo;</span><br><span class="line">createInfo.queueCreateInfoCount = <span class="number">1</span>;</span><br><span class="line"><span class="comment">// æŒ‡å®šVkPhysicalDeviceFeatures</span></span><br><span class="line">createInfo.pEnabledFeatures = &amp;deviceFeatures;</span><br></pre></td></tr></table></figure>
<p>å…¶ä½™ä¿¡æ¯ä¸VkInstanceCreateInfoç»“æ„ç›¸ä¼¼ï¼Œå¹¶è¦æ±‚æŒ‡å®šæ‰©å±•(Extensions)å’ŒéªŒè¯å±‚(Validation Layers)ã€‚ä¸åŒä¹‹å¤„åœ¨äºè¿™æ¬¡æ˜¯é€»è¾‘è®¾å¤‡çš„ã€‚<br>è®¾å¤‡ç‰¹å®šæ‰©å±•çš„å…¶ä¸­ä¹‹ä¸€æ˜¯VK_KHR_swapchainï¼Œå®ƒå…è®¸æ‚¨å°†è¯¥è®¾å¤‡çš„æ¸²æŸ“å›¾åƒå‘ˆç°ç»™çª—å£ã€‚<br>ç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨ç¼ºä¹æ­¤åŠŸèƒ½çš„Vulkanè®¾å¤‡ï¼Œæ¯”å¦‚å› ä¸ºå®ƒä»¬ä»…æ”¯æŒè®¡ç®—æ“ä½œã€‚</p>
<p>Vulkançš„å…ˆå‰å®ç°åŒºåˆ†äº†å®ä¾‹å’Œè®¾å¤‡ç‰¹å®šçš„éªŒè¯å±‚ï¼Œä½†ç°åœ¨ä¸åšåŒºåˆ†äº†ã€‚<br>ä¹Ÿå°±æ˜¯è¯´VkDeviceCreateInfoçš„enabledLayerCountå’ŒppEnabledLayerNameså­—æ®µåœ¨æœ€æ–°å®ç°ä¸­å¯ä»¥å¿½ç•¥ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">createInfo.enabledExtensionCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (enableValidationLayers) &#123;</span><br><span class="line">    createInfo.enabledLayerCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(validationLayers.<span class="built_in">size</span>());</span><br><span class="line">    createInfo.ppEnabledLayerNames = validationLayers.<span class="built_in">data</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    createInfo.enabledLayerCount = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼åˆ›å»ºvulkanå®ä¾‹ï¼Œè¿™é‡Œä½¿ç”¨ vkCreateDevice å‡½æ•°åˆ›å»ºé€»è¾‘è®¾å¤‡ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è°ƒç”¨ vkCreateDevice åˆ›å»ºé€»è¾‘è®¾å¤‡ï¼Œåˆ«å¿˜äº†åœ¨cleanupå‡½æ•°ä¸­é”€æ¯</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">vkCreateDevice</span>(physicalDevice, &amp;createInfo, <span class="literal">nullptr</span>, &amp;device) != VK_SUCCESS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create logical device!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-4-æ£€ç´¢é˜Ÿåˆ—å¥æŸ„"><a href="#2-4-æ£€ç´¢é˜Ÿåˆ—å¥æŸ„" class="headerlink" title="2.4 æ£€ç´¢é˜Ÿåˆ—å¥æŸ„"></a>2.4 æ£€ç´¢é˜Ÿåˆ—å¥æŸ„</h2><p>é˜Ÿåˆ—æ˜¯ä¸é€»è¾‘è®¾å¤‡ä¸€èµ·è‡ªåŠ¨åˆ›å»ºçš„ï¼Œç°åœ¨åˆ›å»ºä¸å®ƒä»¬æ¥å£çš„å¥æŸ„ã€‚<br>ä½¿ç”¨ <strong>VkQueue</strong> æ¥å­˜å‚¨é˜Ÿåˆ—çš„å¥æŸ„ï¼Œå¦‚å­˜å‚¨å›¾å½¢é˜Ÿåˆ—çš„å¥æŸ„ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkQueue graphicsQueue;</span><br></pre></td></tr></table></figure>
<p>å½“è®¾å¤‡è¢«é”€æ¯æ—¶ï¼Œä¼šéšå¼æ¸…é™¤è®¾å¤‡é˜Ÿåˆ—ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦åœ¨æ¸…ç†ä¸­æ‰§è¡Œä»»ä½•æ“ä½œ(vkCreateXXXæ‰éœ€è¦ä¸»åŠ¨é‡Šæ”¾å“¦)ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨vkGetDeviceQueueå‡½æ•°æ¥æ£€ç´¢æ¯ä¸ªé˜Ÿåˆ—ç³»åˆ—çš„é˜Ÿåˆ—å¥æŸ„ã€‚<br>å‚æ•°æ˜¯é€»è¾‘è®¾å¤‡ï¼Œé˜Ÿåˆ—ç³»åˆ—ï¼Œé˜Ÿåˆ—ç´¢å¼•å’ŒæŒ‡å‘å­˜å‚¨é˜Ÿåˆ—å¥æŸ„çš„å˜é‡çš„æŒ‡é’ˆã€‚<br>å› ä¸ºæˆ‘ä»¬åªæ˜¯ä»è¿™ä¸ªç³»åˆ—åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªä½¿ç”¨ç´¢å¼•0ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">vkGetDeviceQueue</span>(device, indices.graphicsFamily.<span class="built_in">value</span>(), <span class="number">0</span>, &amp;graphicsQueue);</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†é€»è¾‘è®¾å¤‡å’Œé˜Ÿåˆ—å¥æŸ„ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¼€å§‹ä½¿ç”¨æ˜¾å¡æ¥åšäº‹äº†ï¼<br>å‡†å¤‡å·¥ä½œåŸºæœ¬å®Œæˆï¼Œåç»­æˆ‘ä»¬å¯ä»¥è®¾ç½®èµ„æºå¹¶ç”¨çª—å£æ˜¾ç¤ºç»“æœï¼<br>è¿™æ¬¡å°±ä¸è´´ä»£ç äº†ã€‚</p>
<h1 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h1><h2 id="vulkan-feature"><a href="#vulkan-feature" class="headerlink" title="vulkan feature"></a>vulkan feature</h2><details>
<summary>vulkan feature</summary>
<pre><code>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰åœ¨ vulkan_core.h æ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkPhysicalDeviceFeatures</span> &#123;</span><br><span class="line">    VkBool32    robustBufferAccess;</span><br><span class="line">    VkBool32    fullDrawIndexUint32;</span><br><span class="line">    VkBool32    imageCubeArray;</span><br><span class="line">    VkBool32    independentBlend;</span><br><span class="line">    VkBool32    geometryShader;</span><br><span class="line">    VkBool32    tessellationShader;</span><br><span class="line">    VkBool32    sampleRateShading;</span><br><span class="line">    VkBool32    dualSrcBlend;</span><br><span class="line">    VkBool32    logicOp;</span><br><span class="line">    VkBool32    multiDrawIndirect;</span><br><span class="line">    VkBool32    drawIndirectFirstInstance;</span><br><span class="line">    VkBool32    depthClamp;</span><br><span class="line">    VkBool32    depthBiasClamp;</span><br><span class="line">    VkBool32    fillModeNonSolid;</span><br><span class="line">    VkBool32    depthBounds;</span><br><span class="line">    VkBool32    wideLines;</span><br><span class="line">    VkBool32    largePoints;</span><br><span class="line">    VkBool32    alphaToOne;</span><br><span class="line">    VkBool32    multiViewport;</span><br><span class="line">    VkBool32    samplerAnisotropy;</span><br><span class="line">    VkBool32    textureCompressionETC2;</span><br><span class="line">    VkBool32    textureCompressionASTC_LDR;</span><br><span class="line">    VkBool32    textureCompressionBC;</span><br><span class="line">    VkBool32    occlusionQueryPrecise;</span><br><span class="line">    VkBool32    pipelineStatisticsQuery;</span><br><span class="line">    VkBool32    vertexPipelineStoresAndAtomics;</span><br><span class="line">    VkBool32    fragmentStoresAndAtomics;</span><br><span class="line">    VkBool32    shaderTessellationAndGeometryPointSize;</span><br><span class="line">    VkBool32    shaderImageGatherExtended;</span><br><span class="line">    VkBool32    shaderStorageImageExtendedFormats;</span><br><span class="line">    VkBool32    shaderStorageImageMultisample;</span><br><span class="line">    VkBool32    shaderStorageImageReadWithoutFormat;</span><br><span class="line">    VkBool32    shaderStorageImageWriteWithoutFormat;</span><br><span class="line">    VkBool32    shaderUniformBufferArrayDynamicIndexing;</span><br><span class="line">    VkBool32    shaderSampledImageArrayDynamicIndexing;</span><br><span class="line">    VkBool32    shaderStorageBufferArrayDynamicIndexing;</span><br><span class="line">    VkBool32    shaderStorageImageArrayDynamicIndexing;</span><br><span class="line">    VkBool32    shaderClipDistance;</span><br><span class="line">    VkBool32    shaderCullDistance;</span><br><span class="line">    VkBool32    shaderFloat64;</span><br><span class="line">    VkBool32    shaderInt64;</span><br><span class="line">    VkBool32    shaderInt16;</span><br><span class="line">    VkBool32    shaderResourceResidency;</span><br><span class="line">    VkBool32    shaderResourceMinLod;</span><br><span class="line">    VkBool32    sparseBinding;</span><br><span class="line">    VkBool32    sparseResidencyBuffer;</span><br><span class="line">    VkBool32    sparseResidencyImage2D;</span><br><span class="line">    VkBool32    sparseResidencyImage3D;</span><br><span class="line">    VkBool32    sparseResidency2Samples;</span><br><span class="line">    VkBool32    sparseResidency4Samples;</span><br><span class="line">    VkBool32    sparseResidency8Samples;</span><br><span class="line">    VkBool32    sparseResidency16Samples;</span><br><span class="line">    VkBool32    sparseResidencyAliased;</span><br><span class="line">    VkBool32    variableMultisampleRate;</span><br><span class="line">    VkBool32    inheritedQueries;</span><br><span class="line">&#125; VkPhysicalDeviceFeatures;</span><br></pre></td></tr></table></figure>

<h3 id="1-robustBufferAccess"><a href="#1-robustBufferAccess" class="headerlink" title="1. robustBufferAccess"></a>1. robustBufferAccess</h3><p>æŒ‡å®šå¯¹ç¼“å†²åŒºçš„è®¿é—®æ˜¯æ ¹æ®ç¼“å†²åŒºæè¿°ç¬¦çš„èŒƒå›´è¿›è¡Œè¾¹ç•Œæ£€æŸ¥çš„(ç”±VkDescriptorBufferInfo::rangeï¼ŒVkBufferViewCreateInfo::rangeæˆ–ç¼“å†²åŒºçš„å¤§å°ç¡®å®šï¼‰ã€‚<br>è¶…å‡ºèŒƒå›´è®¿é—®ä¸å¾—å¯¼è‡´åº”ç”¨ç¨‹åºç»ˆæ­¢ï¼Œå¹¶ä¸”ç€è‰²å™¨åŠ è½½ï¼Œå­˜å‚¨å’ŒåŸå­çš„æ•ˆæœå¿…é¡»ç¬¦åˆä¸å¦‚ä¸‹ç›¸å…³çš„è¡Œä¸ºï¼š</p>
<ul>
<li>å¦‚æœæ»¡è¶³ä»¥ä¸‹ä»»ä½•æ¡ä»¶ï¼Œåˆ™è®¤ä¸ºç¼“å†²åŒºè®¿é—®è¶…å‡ºèŒƒå›´ï¼š   <ul>
<li>æŒ‡é’ˆç”±OpImageTexelPointerå½¢æˆï¼Œåæ ‡å°äºé›¶æˆ–å¤§äºæˆ–ç­‰äºç»‘å®šèŒƒå›´å†…çš„æ•´ä¸ªå…ƒç´ çš„æ•°é‡ã€‚</li>
<li>æŒ‡é’ˆä¸æ˜¯ç”±OpImageTexelPointerå½¢æˆçš„ï¼Œå¹¶ä¸”æŒ‡å‘çš„å¯¹è±¡å¹¶ä¸å®Œå…¨åŒ…å«åœ¨ç»‘å®šèŒƒå›´å†…ã€‚è¿™åŒ…æ‹¬é€šè¿‡å˜é‡æŒ‡é’ˆæ‰§è¡Œçš„è®¿é—®ï¼Œå…¶ä¸­ä¸èƒ½é™æ€åœ°ç¡®å®šè¢«è®¿é—®çš„ç¼“å†²åŒºæè¿°ç¬¦ã€‚æœªåˆå§‹åŒ–çš„æŒ‡é’ˆå’ŒæŒ‡å‘OpConstantNullçš„æŒ‡é’ˆè¢«è§†ä¸ºæŒ‡å‘é›¶å¤§å°çš„å¯¹è±¡ï¼Œå› æ­¤é€šè¿‡è¿™äº›æŒ‡é’ˆçš„æ‰€æœ‰è®¿é—®éƒ½è¢«è§†ä¸ºè¶…å‡ºèŒƒå›´ã€‚<ul>
<li>æ³¨æ„ï¼šå¦‚æœSPIR-V OpLoadæŒ‡ä»¤åŠ è½½ç»“æ„å¹¶ä¸”ç»“æ„çš„å°¾ç«¯è¶…å‡ºè¾¹ç•Œï¼Œåˆ™ç»“æ„çš„æ‰€æœ‰æˆå‘˜éƒ½è¢«è§†ä¸ºè¶…å‡ºè¾¹ç•Œï¼Œå³ä½¿æœ€ç»ˆçš„æˆå‘˜æœªè¢«é™æ€ä½¿ç”¨ã€‚</li>
</ul>
</li>
<li>å¦‚æœç¡®å®šç»™å®šSPIR-Vå—ä¸­çš„ä»»ä½•ç¼“å†²åŒºè®¿é—®è¶…å‡ºèŒƒå›´ï¼Œåˆ™åœ¨åŒä¸€SPIR-Vå—ä¸­è®¿é—®å°äº16å­—èŠ‚çš„åœ°å€çš„ä»»ä½•å…¶ä»–ç›¸åŒç±»å‹ï¼ˆåŠ è½½ï¼Œå­˜å‚¨æˆ–åŸå­ï¼‰è®¿é—® è¿œç¦»ç•Œå¤–åœ°å€ä¹Ÿå¯èƒ½è¢«è®¤ä¸ºæ˜¯è¶…å‡ºç•Œé™ã€‚</li>
</ul>
</li>
<li>è¶…å‡ºèŒƒå›´çš„ç¼“å†²åŒºåŠ è½½å°†è¿”å›ä»¥ä¸‹ä»»ä½•å€¼ï¼š<ul>
<li>ä»ç»‘å®šåˆ°ç¼“å†²åŒºçš„å†…å­˜èŒƒå›´å†…çš„ä»»ä½•ä½ç½®å¼€å§‹çš„å€¼ï¼ˆå¯èƒ½åŒ…æ‹¬è¶…å‡ºç¼“å†²åŒºæœ«å°¾çš„å†…å­˜å­—èŠ‚ï¼Œç›´åˆ°ç»‘å®šèŒƒå›´çš„æœ«å°¾ï¼‰ã€‚</li>
<li>å‘é‡è¯»å–çš„é›¶å€¼æˆ–ï¼ˆ0,0,0ï¼Œxï¼‰å‘é‡ï¼Œå…¶ä¸­xæ˜¯å‘é‡ç»„ä»¶ç±»å‹ä¸­è¡¨ç¤ºçš„æœ‰æ•ˆå€¼ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹ä»»æ„ä¸€ç§ï¼š<ul>
<li>æœ‰ç¬¦å·æˆ–æ— ç¬¦å·æ•´æ•°åˆ†é‡çš„0,1æˆ–æœ€å¤§å¯è¡¨ç¤ºæ­£æ•´æ•°å€¼</li>
<li>0.0æˆ–1.0ï¼Œç”¨äºæµ®ç‚¹ç»„ä»¶</li>
</ul>
</li>
</ul>
</li>
<li>è¶Šç•Œå†™å…¥å¯ä»¥ä¿®æ”¹ç»‘å®šåˆ°ç¼“å†²åŒºçš„å†…å­˜èŒƒå›´å†…çš„å€¼ï¼Œä½†ä¸èƒ½ä¿®æ”¹ä»»ä½•å…¶ä»–å†…å­˜ã€‚</li>
<li>è¶Šç•ŒåŸå­å¯ä»¥ä¿®æ”¹ç»‘å®šåˆ°ç¼“å†²åŒºçš„å†…å­˜èŒƒå›´å†…çš„å€¼ï¼Œä½†ä¸èƒ½ä¿®æ”¹ä»»ä½•å…¶ä»–å†…å­˜ï¼Œå¹¶è¿”å›æœªå®šä¹‰çš„å€¼ã€‚</li>
<li>å¦‚æœç»‘å®šé¡¶ç‚¹ç¼“å†²åŒºèŒƒå›´ä¸­å±æ€§çš„åç§»é‡åŠ ä¸Šå±æ€§çš„å¤§å°å¤§äºä»¥ä¸‹å€¼ï¼Œåˆ™é¡¶ç‚¹è¾“å…¥å±æ€§è¢«è§†ä¸ºè¶…å‡ºè¾¹ç•Œã€‚<ul>
<li><ol>
<li>vertexBufferRangeSize, if bindingStride &#x3D;&#x3D; 0; æˆ–è€…</li>
</ol>
</li>
<li><ol start="2">
<li>(vertexBufferRangeSize - (vertexBufferRangeSize % bindingStride))</li>
</ol>
</li>
<li>å…¶ä¸­vertexBufferRangeSizeæ˜¯ç»‘å®šåˆ°é¡¶ç‚¹ç¼“å†²åŒºç»‘å®šçš„å†…å­˜èŒƒå›´çš„å­—èŠ‚å¤§å°ï¼ŒbindingStrideæ˜¯ç›¸åº”é¡¶ç‚¹è¾“å…¥ç»‘å®šçš„å­—èŠ‚è·¨åº¦ã€‚æ­¤å¤–ï¼Œå¦‚æœä½¿ç”¨ç‰¹å®šé¡¶ç‚¹è¾“å…¥ç»‘å®šçš„ä»»ä½•é¡¶ç‚¹è¾“å…¥å±æ€§è¶…å‡ºè¾¹ç•Œï¼Œåˆ™ä½¿ç”¨è¯¥é¡¶ç‚¹ç€è‰²å™¨è°ƒç”¨çš„é¡¶ç‚¹è¾“å…¥ç»‘å®šçš„æ‰€æœ‰é¡¶ç‚¹è¾“å…¥å±æ€§è¢«è§†ä¸ºè¶…å‡ºè¾¹ç•Œã€‚</li>
<li>ä¸€æ—¦é¡¶ç‚¹è¾“å…¥å±æ€§è¶…å‡ºèŒƒå›´ï¼Œå°†ä¸ºå…¶åˆ†é…ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š<ul>
<li>æ¥è‡ªç»‘å®šåˆ°ç¼“å†²åŒºçš„å†…å­˜èŒƒå›´å†…ä»»ä½•ä½ç½®çš„å€¼ï¼Œæ ¹æ®å±æ€§çš„æ ¼å¼è¿›è¡Œè½¬æ¢ã€‚</li>
<li>é›¶å€¼ï¼Œæˆ–ï¼ˆ0,0,0ï¼Œxï¼‰å‘é‡ï¼Œæ ¼å¼æ ¹æ®å±æ€§çš„æ ¼å¼è½¬æ¢ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>å¦‚æœæœªå¯ç”¨robustBufferAccessï¼Œåˆ™åº”ç”¨ç¨‹åºä¸å¾—æ‰§è¡Œè¶Šç•Œè®¿é—®ã€‚è€Œä¸€èˆ¬æ¥è®²ï¼ŒrobustBufferAccesséƒ½æ˜¯éœ€è¦å¼€å¯çš„ã€‚</li>
</ul>
<h3 id="2-fullDrawIndexUint32"><a href="#2-fullDrawIndexUint32" class="headerlink" title="2. fullDrawIndexUint32"></a>2. fullDrawIndexUint32</h3><p>æŒ‡å®šå½“ä½¿ç”¨VKIndexTypeä¸ºVK_INDEX_TYPE_UINT32æ—¶ï¼Œç´¢å¼•ç»˜åˆ¶è°ƒç”¨æ”¯æŒå®Œæ•´çš„32ä½ç´¢å¼•èŒƒå›´ã€‚<br>maxDrawIndexedIndexValueæ˜¯å¯ä»¥ä½¿ç”¨çš„æœ€å¤§ç´¢å¼•å€¼ï¼ˆé™¤äº†åŸå§‹é‡å¯ç´¢å¼•ï¼Œå½“VkIndexTypeæ˜¯VK_INDEX_TYPE_UINT32æ—¶ï¼Œå®ƒæ€»æ˜¯2^32-1ï¼‰ã€‚<br>å¦‚æœæ”¯æŒæ­¤åŠŸèƒ½ï¼Œåˆ™maxDrawIndexedIndexValueå¿…é¡»ä¸º2^32-1; å¦åˆ™å®ƒå¿…é¡»ä¸å°äº2^24-1ã€‚</p>
<h3 id="3-imageCubeArray"><a href="#3-imageCubeArray" class="headerlink" title="3. imageCubeArray"></a>3. imageCubeArray</h3><p>æŒ‡å®šæ˜¯å¦å¯ä»¥åˆ›å»ºVkImageViewTypeä¸ºVK_IMAGE_VIEW_TYPE_CUBE_ARRAYçš„å›¾åƒè§†å›¾ï¼Œä»¥åŠæ˜¯å¦å¯ä»¥åœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨ç›¸åº”çš„SampledCubeArrayå’ŒImageCubeArray SPIR-VåŠŸèƒ½ã€‚</p>
<h3 id="4-independentBlend"><a href="#4-independentBlend" class="headerlink" title="4. independentBlend"></a>4. independentBlend</h3><p>æŒ‡å®šæ˜¯å¦æ¯ä¸ªé™„ä»¶ç‹¬ç«‹æ§åˆ¶VkPipelineColorBlendAttachmentStateè®¾ç½®ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™æ‰€æœ‰é¢œè‰²é™„ä»¶çš„VkPipelineColorBlendAttachmentStateè®¾ç½®å¿…é¡»ç›¸åŒã€‚<br>å¦‚æœå¯ç”¨ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªç»‘å®šçš„é¢œè‰²é™„ä»¶æä¾›ä¸åŒçš„VkPipelineColorBlendAttachmentStateã€‚</p>
<h3 id="5-geometryShader"><a href="#5-geometryShader" class="headerlink" title="5. geometryShader"></a>5. geometryShader</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒå‡ ä½•ç€è‰²å™¨ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨VK_SHADER_STAGE_GEOMETRY_BITå’ŒVK_PIPELINE_STAGE_GEOMETRY_SHADER_BITæšä¸¾å€¼ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜å‡ ä½•åŠŸèƒ½ã€‚</p>
<h3 id="6-tessellationShader"><a href="#6-tessellationShader" class="headerlink" title="6. tessellationShader"></a>6. tessellationShader</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ›²é¢ç»†åˆ†æ§åˆ¶å’Œè¯„ä¼°ç€è‰²å™¨ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨ï¼š</p>
<ul>
<li>VK_SHADER_STAGE_TESSELLATION_CONTROL_BITï¼šæŒ‡å®šæ›²é¢ç»†åˆ†æ§åˆ¶é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_TESSELLATION_EVALUATION_BITï¼šæŒ‡å®šæ›²é¢ç»†åˆ†è¯„ä¼°é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_TESSELLATION_CONTROL_SHADER_BITï¼šæŒ‡å®šæ›²é¢ç»†åˆ†æ§åˆ¶ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_PIPELINE_STAGE_TESSELLATION_EVALUATION_SHADER_BITï¼šæŒ‡å®šæ›²é¢ç»†åˆ†è¯„ä¼°ç€è‰²å™¨é˜¶æ®µ</li>
<li>VK_STRUCTURE_TYPE_PIPELINE_TESSELLATION_STATE_CREATE_INFO</li>
</ul>
<p>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜TessellationåŠŸèƒ½ã€‚</p>
<h3 id="7-sampleRateShading"><a href="#7-sampleRateShading" class="headerlink" title="7. sampleRateShading"></a>7. sampleRateShading</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ ·æœ¬ç€è‰²å’Œå¤šé‡é‡‡æ ·æ’å€¼ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å°†VkPipelineMultisampleStateCreateInfoç»“æ„çš„sampleShadingEnableæˆå‘˜è®¾ç½®ä¸ºVK_FALSEï¼Œå¹¶å¿½ç•¥minSampleShadingæˆå‘˜ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜SampleRateShadingåŠŸèƒ½ã€‚</p>
<h3 id="8-dualSrcBlend"><a href="#8-dualSrcBlend" class="headerlink" title="8. dualSrcBlend"></a>8. dualSrcBlend</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒé‡‡ç”¨ä¸¤ä¸ªæºçš„æ··åˆæ“ä½œã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—å°†ï¼š</p>
<ul>
<li>VK_BLEND_FACTOR_SRC1_COLORï¼š</li>
<li>VK_BLEND_FACTOR_ONE_MINUS_SRC1_COLOR</li>
<li>VK_BLEND_FACTOR_SRC1_ALPHA</li>
<li>VK_BLEND_FACTOR_ONE_MINUS_SRC1_ALPHA</li>
</ul>
<p>ä»¥ä¸Šæšä¸¾å€¼ç”¨ä½œæºæˆ–ç›®æ ‡æ··åˆå› å­ã€‚è¯¦ç»†ä¿¡æ¯å‚é˜… vkspec.html: 26.1.2. Dual-Source Blending</p>
<h3 id="9-logicOp"><a href="#9-logicOp" class="headerlink" title="9. logicOp"></a>9. logicOp</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒé€»è¾‘è¿ç®—ã€‚ å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å°†VkPipelineColorBlendStateCreateInfoç»“æ„çš„logicOpEnableæˆå‘˜è®¾ç½®ä¸ºVK_FALSEï¼Œå¹¶å¿½ç•¥logicOpæˆå‘˜ã€‚</p>
<h3 id="10-multiDrawIndirect"><a href="#10-multiDrawIndirect" class="headerlink" title="10. multiDrawIndirect"></a>10. multiDrawIndirect</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒå¤šä¸ªdrawé—´æ¥ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™vkCmdDrawIndirectå’ŒvkCmdDrawIndexedIndirectå‘½ä»¤çš„drawCountå‚æ•°å¿…é¡»ä¸º0æˆ–1.<br>å¦‚æœä¸æ”¯æŒæ­¤åŠŸèƒ½ï¼Œåˆ™VkPhysicalDeviceLimitsç»“æ„çš„maxDrawIndirectCount(é—´æ¥ç»˜åˆ¶è°ƒç”¨æ”¯æŒçš„æœ€å¤§ç»˜åˆ¶è®¡æ•°)æˆå‘˜ä¹Ÿå¿…é¡»ä¸º1ã€‚ </p>
<h3 id="11-drawIndirectFirstInstance"><a href="#11-drawIndirectFirstInstance" class="headerlink" title="11. drawIndirectFirstInstance"></a>11. drawIndirectFirstInstance</h3><p>æŒ‡å®šé—´æ¥ç»˜åˆ¶è°ƒç”¨æ˜¯å¦æ”¯æŒfirstInstanceå‚æ•°ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™æä¾›ç»™vkCmdDrawIndirectå’ŒvkCmdDrawIndexedIndirectå‘½ä»¤çš„æ‰€æœ‰VkDrawIndirectCommandå’ŒVkDrawIndexedIndirectCommandç»“æ„çš„firstInstanceæˆå‘˜å¿…é¡»ä¸º0ã€‚</p>
<h3 id="12-depthClamp"><a href="#12-depthClamp" class="headerlink" title="12. depthClamp"></a>12. depthClamp</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ·±åº¦Clampã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å°†VkPipelineRasterizationStateCreateInfoç»“æ„çš„depthClampEnableæˆå‘˜è®¾ç½®ä¸ºVK_FALSEã€‚<br>å¦‚æœå¯ç”¨ï¼Œå°†depthClampEnableè®¾ç½®ä¸ºVK_TRUEå°†å¯ç”¨æ·±åº¦Clampã€‚</p>
<h3 id="13-depthBiasClamp"><a href="#13-depthBiasClamp" class="headerlink" title="13. depthBiasClamp"></a>13. depthBiasClamp</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ·±åº¦åç½®Clampã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å°†VkPipelineRasterizationStateCreateInfoç»“æ„çš„depthBiasClampæˆå‘˜è®¾ç½®ä¸º0.0ï¼Œé™¤éå¯ç”¨VK_DYNAMIC_STATE_DEPTH_BIASåŠ¨æ€çŠ¶æ€ï¼Œå¹¶ä¸”å¿…é¡»å°†vkCmdSetDepthBiasçš„depthBiasClampå‚æ•°è®¾ç½®ä¸º0.0ã€‚</p>
<h3 id="14-fillModeNonSolid"><a href="#14-fillModeNonSolid" class="headerlink" title="14. fillModeNonSolid"></a>14. fillModeNonSolid</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒç‚¹å’Œçº¿æ¡†å¡«å……æ¨¡å¼ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™VkPipelineRasterizationStateCreateInfo::polygonModeä¸å¾—ä½¿ç”¨:</p>
<ul>
<li>VK_POLYGON_MODE_POINT:æŒ‡å®šå°†å¤šè¾¹å½¢é¡¶ç‚¹ç»˜åˆ¶ä¸ºç‚¹</li>
<li>VK_POLYGON_MODE_LINE:æŒ‡å®šå°†å¤šè¾¹å½¢çš„è¾¹ç»˜åˆ¶ä¸ºç‚¹</li>
</ul>
<h3 id="15-depthBounds"><a href="#15-depthBounds" class="headerlink" title="15. depthBounds"></a>15. depthBounds</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ·±åº¦è¾¹ç•Œæµ‹è¯•ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å°†VkPipelineDepthStencilStateCreateInfoç»“æ„çš„depthBoundsTestEnableæˆå‘˜è®¾ç½®ä¸ºVK_FALSEã€‚ å½“depthBoundsTestEnableè®¾ç½®ä¸ºVK_FALSEæ—¶ï¼Œå°†å¿½ç•¥VkPipelineDepthStencilStateCreateInfoç»“æ„çš„minDepthBoundså’ŒmaxDepthBoundsæˆå‘˜ã€‚</p>
<h3 id="16-wideLines"><a href="#16-wideLines" class="headerlink" title="16. wideLines"></a>16. wideLines</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒå®½åº¦ä¸æ˜¯1.0çš„è¡Œã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å°†VkPipelineRasterizationStateCreateInfoç»“æ„çš„lineWidthæˆå‘˜è®¾ç½®ä¸º1.0ï¼Œé™¤éå¯ç”¨VK_DYNAMIC_STATE_LINE_WIDTHåŠ¨æ€çŠ¶æ€ï¼Œå¹¶ä¸”å¿…é¡»å°†vWCmdSetLineWidthçš„lineWidthå‚æ•°è®¾ç½®ä¸º1.0ã€‚<br>æ”¯æŒæ­¤åŠŸèƒ½æ—¶ï¼Œæ”¯æŒçš„çº¿å®½çš„èŒƒå›´å’Œç²’åº¦åˆ†åˆ«ç”±VkPhysicalDeviceLimitsç»“æ„çš„lineWidthRangeå’ŒlineWidthGranularityæˆå‘˜æŒ‡ç¤ºã€‚</p>
<h3 id="17-largePoints"><a href="#17-largePoints" class="headerlink" title="17. largePoints"></a>17. largePoints</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒå¤§å°å¤§äº1.0çš„ç‚¹ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä»…æ”¯æŒç€è‰²å™¨å†™å…¥çš„ç‚¹å¤§å°1.0ã€‚ æ”¯æŒçš„ç‚¹å¤§å°çš„èŒƒå›´å’Œç²’åº¦åˆ†åˆ«ç”±VkPhysicalDeviceLimitsç»“æ„çš„pointSizeRangeå’ŒpointSizeGranularityæˆå‘˜æŒ‡ç¤ºã€‚</p>
<h3 id="18-alphaToOne"><a href="#18-alphaToOne" class="headerlink" title="18. alphaToOne"></a>18. alphaToOne</h3><p>æŒ‡å®šå®ç°æ˜¯å¦èƒ½å¤Ÿä½¿ç”¨å®šç‚¹é¢œè‰²çš„æœ€å¤§å¯è¡¨ç¤ºalphaå€¼æˆ–æµ®ç‚¹é¢œè‰²çš„1.0æ›¿æ¢ç‰‡æ®µç€è‰²å™¨ä¸­è¾“å‡ºçš„é¢œè‰²ç‰‡æ®µçš„alphaå€¼ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»å°†VkPipelineMultisampleStateCreateInfoç»“æ„çš„alphaToOneEnableæˆå‘˜è®¾ç½®ä¸ºVK_FALSEã€‚<br>å¦åˆ™ï¼Œå°†alphaToOneEnableè®¾ç½®ä¸ºVK_TRUEå°†å¯ç”¨alpha-to-oneè¡Œä¸ºã€‚</p>
<h3 id="19-multiViewport"><a href="#19-multiViewport" class="headerlink" title="19. multiViewport"></a>19. multiViewport</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒå¤šä¸ªViewportã€‚ å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼š</p>
<ul>
<li>å¿…é¡»å°†VkPipelineViewportStateCreateInfoç»“æ„çš„viewportCountå’ŒscissorCountæˆå‘˜è®¾ç½®ä¸º1ã€‚</li>
<li>vkCmdSetViewportå‘½ä»¤çš„firstViewportå’ŒviewportCountå‚æ•°å¿…é¡»åˆ†åˆ«è®¾ç½®ä¸º0å’Œ1ã€‚</li>
<li>vkCmdSetScissorå‘½ä»¤çš„firstScissorå’ŒscissorCountå‚æ•°å¿…é¡»åˆ†åˆ«è®¾ç½®ä¸º0å’Œ1ã€‚</li>
</ul>
<h3 id="20-samplerAnisotropy"><a href="#20-samplerAnisotropy" class="headerlink" title="20. samplerAnisotropy"></a>20. samplerAnisotropy</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒå„å‘å¼‚æ€§è¿‡æ»¤ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™VkSamplerCreateInfoç»“æ„çš„anisotropyEnableæˆå‘˜å¿…é¡»ä¸ºVK_FALSEã€‚</p>
<h3 id="21-textureCompressionETC2"><a href="#21-textureCompressionETC2" class="headerlink" title="21. textureCompressionETC2"></a>21. textureCompressionETC2</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ‰€æœ‰ETC2å’ŒEACå‹ç¼©çº¹ç†æ ¼å¼ã€‚<br>å¦‚æœå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™OptimalTilingFeaturesä¸­å¿…é¡»æ”¯æŒ:</p>
<ul>
<li><p>VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT:æŒ‡å®šå¯ä»¥ä»ä¸­é‡‡æ ·å›¾åƒè§†å›¾</p>
</li>
<li><p>VK_FORMAT_FEATURE_BLIT_SRC_BIT:æŒ‡å®šå›¾åƒå¯ç”¨ä½œvkCmdBlitImageå‘½ä»¤çš„srcImage</p>
</li>
<li><p>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BITï¼šå›¾åƒè§†å›¾å¯ä»¥ä¸é‡‡æ ·å™¨ä¸€èµ·ä½¿ç”¨(è¯¦ç»†ä¿¡æ¯ vkspec.html:VkFormatFeatureFlagBits)</p>
<p>  ä»¥ä¸Šæ ¼å¼çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>VK_FORMAT_ETC2_R8G8B8_UNORM_BLOCK</li>
<li>VK_FORMAT_ETC2_R8G8B8_SRGB_BLOCK</li>
<li>VK_FORMAT_ETC2_R8G8B8A1_UNORM_BLOCK</li>
<li>VK_FORMAT_ETC2_R8G8B8A1_SRGB_BLOCK</li>
<li>VK_FORMAT_ETC2_R8G8B8A8_UNORM_BLOCK</li>
<li>VK_FORMAT_ETC2_R8G8B8A8_SRGB_BLOCK</li>
<li>VK_FORMAT_EAC_R11_UNORM_BLOCK</li>
<li>VK_FORMAT_EAC_R11_SNORM_BLOCK</li>
<li>VK_FORMAT_EAC_R11G11_UNORM_BLOCK</li>
<li>VK_FORMAT_EAC_R11G11_SNORM_BLOCK</li>
</ul>
</li>
</ul>
<p>è¦æŸ¥è¯¢å…¶ä»–å±æ€§ï¼Œæˆ–è€…æœªå¯ç”¨è¯¥åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨vkGetPhysicalDeviceFormatPropertieså’ŒvkGetPhysicalDeviceImageFormatPropertiesæ¥æ£€æŸ¥å„ä¸ªæ ¼å¼çš„æ”¯æŒå±æ€§ã€‚</p>
<h3 id="22-textureCompressionASTC-LDR"><a href="#22-textureCompressionASTC-LDR" class="headerlink" title="22. textureCompressionASTC_LDR"></a>22. textureCompressionASTC_LDR</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ‰€æœ‰ASTC LDRå‹ç¼©çº¹ç†æ ¼å¼ã€‚<br>å¦‚æœå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™OptimalTilingFeaturesä¸­å¿…é¡»æ”¯æŒ:</p>
<ul>
<li><p>VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT</p>
</li>
<li><p>VK_FORMAT_FEATURE_BLIT_SRC_BITå’ŒVK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</p>
<p>  ä»¥ä¸Šæ ¼å¼çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>VK_FORMAT_ASTC_4x4_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_4x4_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_5x4_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_5x4_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_5x5_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_5x5_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_6x5_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_6x5_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_6x6_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_6x6_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_8x5_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_8x5_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_8x6_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_8x6_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_8x8_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_8x8_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_10x5_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_10x5_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_10x6_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_10x6_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_10x8_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_10x8_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_10x10_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_10x10_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_12x10_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_12x10_SRGB_BLOCK</li>
<li>VK_FORMAT_ASTC_12x12_UNORM_BLOCK</li>
<li>VK_FORMAT_ASTC_12x12_SRGB_BLOCK</li>
</ul>
</li>
</ul>
<p>è¦æŸ¥è¯¢å…¶ä»–å±æ€§ï¼Œæˆ–è€…æœªå¯ç”¨è¯¥åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨vkGetPhysicalDeviceFormatPropertieså’ŒvkGetPhysicalDeviceImageFormatPropertiesæ¥æ£€æŸ¥å„ä¸ªæ ¼å¼çš„æ”¯æŒå±æ€§ã€‚</p>
<h3 id="23-textureCompressionBC"><a href="#23-textureCompressionBC" class="headerlink" title="23. textureCompressionBC"></a>23. textureCompressionBC</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒæ‰€æœ‰BCå‹ç¼©çº¹ç†æ ¼å¼ã€‚<br>å¦‚æœå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™OptimalTilingFeaturesä¸­å¿…é¡»æ”¯æŒï¼š</p>
<ul>
<li><p>VK_FORMAT_FEATURE_SAMPLED_IMAGE_BIT</p>
</li>
<li><p>VK_FORMAT_FEATURE_BLIT_SRC_BIT</p>
</li>
<li><p>VK_FORMAT_FEATURE_SAMPLED_IMAGE_FILTER_LINEAR_BIT</p>
<p>  ä»¥ä¸Šæ ¼å¼çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>VK_FORMAT_BC1_RGB_UNORM_BLOCK</li>
<li>VK_FORMAT_BC1_RGB_SRGB_BLOCK</li>
<li>VK_FORMAT_BC1_RGBA_UNORM_BLOCK</li>
<li>VK_FORMAT_BC1_RGBA_SRGB_BLOCK</li>
<li>VK_FORMAT_BC2_UNORM_BLOCK</li>
<li>VK_FORMAT_BC2_SRGB_BLOCK</li>
<li>VK_FORMAT_BC3_UNORM_BLOCK</li>
<li>VK_FORMAT_BC3_SRGB_BLOCK</li>
<li>VK_FORMAT_BC4_UNORM_BLOCK</li>
<li>VK_FORMAT_BC4_SNORM_BLOCK</li>
<li>VK_FORMAT_BC5_UNORM_BLOCK</li>
<li>VK_FORMAT_BC5_SNORM_BLOCK</li>
<li>VK_FORMAT_BC6H_UFLOAT_BLOCK</li>
<li>VK_FORMAT_BC6H_SFLOAT_BLOCK</li>
<li>VK_FORMAT_BC7_UNORM_BLOCK</li>
<li>VK_FORMAT_BC7_SRGB_BLOCK</li>
</ul>
</li>
</ul>
<p>è¦æŸ¥è¯¢å…¶ä»–å±æ€§ï¼Œæˆ–è€…æœªå¯ç”¨è¯¥åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨vkGetPhysicalDeviceFormatPropertieså’ŒvkGetPhysicalDeviceImageFormatPropertiesæ¥æ£€æŸ¥å„ä¸ªæ ¼å¼çš„æ”¯æŒå±æ€§ã€‚</p>
<h3 id="24-occlusionQueryPrecise"><a href="#24-occlusionQueryPrecise" class="headerlink" title="24. occlusionQueryPrecise"></a>24. occlusionQueryPrecise</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒè¿”å›å®é™…æ ·æœ¬è®¡æ•°çš„é®æŒ¡æŸ¥è¯¢ã€‚<br>é€šè¿‡åœ¨VkQueryPoolCreateInfoç»“æ„ä¸­æŒ‡å®šVK_QUERY_TYPE_OCCLUSIONçš„queryTypeå¹¶å°†å…¶ä¼ é€’ç»™vkCreateQueryPoolï¼Œå¯ä»¥åœ¨VkQueryPoolä¸­åˆ›å»ºé®æŒ¡æŸ¥è¯¢ã€‚<br>å¦‚æœå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™æ­¤ç±»æŸ¥è¯¢å¯ä»¥å°†flagså‚æ•°ä¸­çš„VK_QUERY_CONTROL_PRECISE_BITå¯ç”¨ä¸ºvkCmdBeginQueryã€‚<br>å¦‚æœä¸æ”¯æŒæ­¤åŠŸèƒ½ï¼Œåˆ™å®ç°ä»…æ”¯æŒå¸ƒå°”é®æŒ¡æŸ¥è¯¢ã€‚ä¼ é€’ä»»ä½•æ ·æœ¬æ—¶ï¼Œå¸ƒå°”æŸ¥è¯¢å°†è¿”å›éé›¶ç»“æœå€¼ï¼Œå¦åˆ™è¿”å›ç»“æœå€¼ä¸ºé›¶ã€‚<br>å¯ç”¨æ­¤åŠŸèƒ½å¹¶è®¾ç½®VK_QUERY_CONTROL_PRECISE_BITåï¼Œé®æŒ¡æŸ¥è¯¢å°†æŠ¥å‘Šä¼ é€’çš„å®é™…æ ·æœ¬æ•°ã€‚</p>
<h3 id="25-pipelineStatisticsQuery"><a href="#25-pipelineStatisticsQuery" class="headerlink" title="25. pipelineStatisticsQuery"></a>25. pipelineStatisticsQuery</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒç®¡é“ç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™æ— æ³•åˆ›å»ºç±»å‹ä¸ºVK_QUERY_TYPE_PIPELINE_STATISTICSçš„æŸ¥è¯¢ï¼Œå¹¶ä¸”æ— æ³•åœ¨VkQueryPoolCreateInfoç»“æ„çš„pipelineStatisticsæˆå‘˜ä¸­è®¾ç½®ä»»ä½•VkQueryPipelineStatisticFlagBitsä½ã€‚</p>
<h3 id="26-vertexPipelineStoresAndAtomics"><a href="#26-vertexPipelineStoresAndAtomics" class="headerlink" title="26. vertexPipelineStoresAndAtomics"></a>26. vertexPipelineStoresAndAtomics</h3><p>æŒ‡å®šå­˜å‚¨ç¼“å†²åŒºå’Œå›¾åƒæ˜¯å¦æ”¯æŒé¡¶ç‚¹ï¼Œæ›²é¢ç»†åˆ†å’Œå‡ ä½•ç€è‰²å™¨é˜¶æ®µä¸­çš„å­˜å‚¨å’ŒåŸå­æ“ä½œã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ç€è‰²å™¨æ¨¡å—ä¸­è¿™äº›é˜¶æ®µä½¿ç”¨çš„æ‰€æœ‰å­˜å‚¨å™¨æ˜ åƒï¼Œå­˜å‚¨çº¹ç†ç¼“å†²åŒºç¼“å†²åŒºå’Œå­˜å‚¨ç¼“å†²åŒºå˜é‡å¿…é¡»ä½¿ç”¨NonWritableä¿®é¥°ï¼ˆæˆ–GLSLä¸­çš„åªè¯»å†…å­˜é™å®šç¬¦ï¼‰è¿›è¡Œä¿®é¥°ã€‚</p>
<h3 id="27-fragmentStoresAndAtomics"><a href="#27-fragmentStoresAndAtomics" class="headerlink" title="27. fragmentStoresAndAtomics"></a>27. fragmentStoresAndAtomics</h3><p>æŒ‡å®šå­˜å‚¨ç¼“å†²åŒºå’Œå›¾åƒæ˜¯å¦æ”¯æŒç‰‡æ®µç€è‰²å™¨é˜¶æ®µä¸­çš„å­˜å‚¨å’ŒåŸå­æ“ä½œã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ç€è‰²å™¨æ¨¡å—ä¸­ç‰‡æ®µé˜¶æ®µä½¿ç”¨çš„æ‰€æœ‰å­˜å‚¨å™¨æ˜ åƒï¼Œå­˜å‚¨çº¹ç†ç¼“å†²åŒºç¼“å†²åŒºå’Œå­˜å‚¨ç¼“å†²åŒºå˜é‡å¿…é¡»ä½¿ç”¨NonWritableä¿®é¥°ï¼ˆæˆ–GLSLä¸­çš„åªè¯»å†…å­˜é™å®šç¬¦ï¼‰è¿›è¡Œä¿®é¥°ã€‚</p>
<h3 id="28-shaderTessellationAndGeometryPointSize"><a href="#28-shaderTessellationAndGeometryPointSize" class="headerlink" title="28. shaderTessellationAndGeometryPointSize"></a>28. shaderTessellationAndGeometryPointSize</h3><p>æŒ‡å®šæ›²é¢ç»†åˆ†æ§ä»¶ï¼Œæ›²é¢ç»†åˆ†è¯„ä¼°å’Œå‡ ä½•ç€è‰²å™¨é˜¶æ®µä¸­æ˜¯å¦æä¾›PointSizeå†…ç½®ä¿®é¥°ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—è¯»å–æˆ–å†™å…¥ä½¿ç”¨PointSizeå†…ç½®ä¿®é¥°çš„æˆå‘˜ï¼Œå¹¶ä¸”ä»æ›²é¢ç»†åˆ†æˆ–å‡ ä½•ç€è‰²å™¨å†™å…¥çš„æ‰€æœ‰ç‚¹çš„å¤§å°å‡ä¸º1.0ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥ä¸ºæ›²é¢ç»†åˆ†æ§åˆ¶å’Œè¯„ä¼°ç€è‰²å™¨å£°æ˜TessellationPointSizeåŠŸèƒ½ï¼Œæˆ–è€…ç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥ä¸ºå‡ ä½•ç€è‰²å™¨å£°æ˜GeometryPointSizeåŠŸèƒ½ã€‚<br><strong>æ”¯æŒæ­¤åŠŸèƒ½çš„å®ç°è¿˜å¿…é¡»æ”¯æŒtessellationShaderæˆ–geometryShaderåŠŸèƒ½ä¸­çš„ä¸€ä¸ªæˆ–ä¸¤ä¸ª</strong>ã€‚</p>
<h3 id="29-shaderImageGatherExtended"><a href="#29-shaderImageGatherExtended" class="headerlink" title="29. shaderImageGatherExtended"></a>29. shaderImageGatherExtended</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦å¯ä»¥ä½¿ç”¨æ‰©å±•çš„å›¾åƒæ”¶é›†æŒ‡ä»¤é›†ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™OpImage * GatheræŒ‡ä»¤ä¸æ”¯æŒOffsetå’ŒConstOffsetsæ“ä½œæ•°ã€‚ è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜ImageGatherExtendedåŠŸèƒ½ã€‚</p>
<h3 id="30-shaderStorageImageExtendedFormats"><a href="#30-shaderStorageImageExtendedFormats" class="headerlink" title="30. shaderStorageImageExtendedFormats"></a>30. shaderStorageImageExtendedFormats</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦æ‰€æœ‰æ‰©å±•å­˜å‚¨å™¨å›¾åƒæ ¼å¼éƒ½å¯ç”¨ã€‚<br>å¦‚æœå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»åœ¨æ‰€æœ‰æ‰©å±•æ ¼å¼çš„optimalTilingFeaturesä¸­æ”¯æŒVK_FORMAT_FEATURE_STORAGE_IMAGE_BITåŠŸèƒ½ã€‚<br>è¦æŸ¥è¯¢å…¶ä»–å±æ€§ï¼Œæˆ–è€…æœªå¯ç”¨è¯¥åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨vkGetPhysicalDeviceFormatPropertieså’ŒvkGetPhysicalDeviceImageFormatPropertiesæ¥æ£€æŸ¥å„ä¸ªæ ¼å¼çš„æ”¯æŒå±æ€§ã€‚</p>
<h3 id="31-shaderStorageImageMultisample"><a href="#31-shaderStorageImageMultisample" class="headerlink" title="31. shaderStorageImageMultisample"></a>31. shaderStorageImageMultisample</h3><p>æŒ‡å®šæ˜¯å¦æ”¯æŒå¤šé‡é‡‡æ ·å­˜å‚¨æ˜ åƒã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç­‰äºVK_SAMPLE_COUNT_1_BITçš„æ ·æœ¬åˆ›å»ºä½¿ç”¨åŒ…å«VK_IMAGE_USAGE_STORAGE_BITçš„ç”¨æ³•åˆ›å»ºçš„å›¾åƒã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜StorageImageMultisampleåŠŸèƒ½ã€‚</p>
<h3 id="32-shaderStorageImageReadWithoutFormat"><a href="#32-shaderStorageImageReadWithoutFormat" class="headerlink" title="32. shaderStorageImageReadWithoutFormat"></a>32. shaderStorageImageReadWithoutFormat</h3><p>æŒ‡å®šå­˜å‚¨å›¾åƒæ˜¯å¦éœ€è¦åœ¨ä»å­˜å‚¨å™¨æ˜ åƒ<strong>è¯»å–</strong>æ—¶æŒ‡å®šæ ¼å¼é™å®šç¬¦ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™OpImageReadæŒ‡ä»¤çš„OpTypeImageä¸å¾—ä¸ºUnknownã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜StorageImageReadWithoutFormatåŠŸèƒ½ã€‚</p>
<h3 id="33-shaderStorageImageWriteWithoutFormat"><a href="#33-shaderStorageImageWriteWithoutFormat" class="headerlink" title="33. shaderStorageImageWriteWithoutFormat"></a>33. shaderStorageImageWriteWithoutFormat</h3><p>æŒ‡å®šå­˜å‚¨å›¾åƒæ˜¯å¦éœ€è¦åœ¨<strong>å†™å…¥</strong>å­˜å‚¨å›¾åƒæ—¶æŒ‡å®šæ ¼å¼é™å®šç¬¦ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™OpImageWriteæŒ‡ä»¤çš„OpTypeImageä¸å¾—ä¸ºUnknownã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜StorageImageWriteWithoutFormatåŠŸèƒ½ã€‚</p>
<h3 id="34-shaderUniformBufferArrayDynamicIndexing"><a href="#34-shaderUniformBufferArrayDynamicIndexing" class="headerlink" title="34. shaderUniformBufferArrayDynamicIndexing"></a>34. shaderUniformBufferArrayDynamicIndexing</h3><p>æŒ‡å®šæ˜¯å¦å¯ä»¥é€šè¿‡ç€è‰²å™¨ä»£ç ä¸­çš„åŠ¨æ€ç»Ÿä¸€æ•´æ•°è¡¨è¾¾å¼å¯¹ç»Ÿä¸€ç¼“å†²åŒºçš„æ•°ç»„å»ºç«‹ç´¢å¼•ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™åœ¨ç€è‰²å™¨ä»£ç ä¸­èšåˆåˆ°æ•°ç»„ä¸­æ—¶ï¼Œæè¿°ç¬¦ç±»å‹ä¸ºVK_DESCRIPTOR_TYPE_UNIFORM_BUFFERæˆ–VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER_DYNAMICçš„èµ„æºå¿…é¡»ä»…ç”±å¸¸é‡æ•´æ•°è¡¨è¾¾å¼ç¼–åˆ¶ç´¢å¼•ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜UniformBufferArrayDynamicIndexingåŠŸèƒ½ã€‚</p>
<h3 id="35-shaderSampledImageArrayDynamicIndexing"><a href="#35-shaderSampledImageArrayDynamicIndexing" class="headerlink" title="35. shaderSampledImageArrayDynamicIndexing"></a>35. shaderSampledImageArrayDynamicIndexing</h3><p>æŒ‡å®šé‡‡æ ·å™¨é˜µåˆ—æˆ–é‡‡æ ·å›¾åƒæ˜¯å¦å¯ä»¥é€šè¿‡ç€è‰²å™¨ä»£ç ä¸­çš„åŠ¨æ€ç»Ÿä¸€æ•´æ•°è¡¨è¾¾å¼è¿›è¡Œç´¢å¼•ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™åœ¨ç€è‰²å™¨ä»£ç ä¸­èšåˆåˆ°æ•°ç»„ä¸­æ—¶ï¼Œæè¿°ç¬¦ç±»å‹ä¸ºVK_DESCRIPTOR_TYPE_SAMPLERï¼ŒVK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLERæˆ–VK_DESCRIPTOR_TYPE_SAMPLED_IMAGEçš„èµ„æºå¿…é¡»ä»…ç”±å¸¸é‡æ•´æ•°è¡¨è¾¾å¼ç¼–åˆ¶ç´¢å¼•ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜SampledImageArrayDynamicIndexingåŠŸèƒ½ã€‚</p>
<h3 id="36-shaderStorageBufferArrayDynamicIndexing"><a href="#36-shaderStorageBufferArrayDynamicIndexing" class="headerlink" title="36. shaderStorageBufferArrayDynamicIndexing"></a>36. shaderStorageBufferArrayDynamicIndexing</h3><p>æŒ‡å®šæ˜¯å¦å¯ä»¥é€šè¿‡ç€è‰²å™¨ä»£ç ä¸­çš„åŠ¨æ€ç»Ÿä¸€æ•´æ•°è¡¨è¾¾å¼ç´¢å¼•å­˜å‚¨ç¼“å†²åŒºçš„æ•°ç»„ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™åœ¨ç€è‰²å™¨ä»£ç ä¸­èšåˆåˆ°æ•°ç»„ä¸­æ—¶ï¼Œæè¿°ç¬¦ç±»å‹ä¸ºVK_DESCRIPTOR_TYPE_STORAGE_BUFFERæˆ–VK_DESCRIPTOR_TYPE_STORAGE_BUFFER_DYNAMICçš„èµ„æºå¿…é¡»ä»…ç”±å¸¸é‡æ•´æ•°è¡¨è¾¾å¼ç¼–åˆ¶ç´¢å¼•ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜StorageBufferArrayDynamicIndexingåŠŸèƒ½ã€‚</p>
<h3 id="37-shaderStorageImageArrayDynamicIndexing"><a href="#37-shaderStorageImageArrayDynamicIndexing" class="headerlink" title="37. shaderStorageImageArrayDynamicIndexing"></a>37. shaderStorageImageArrayDynamicIndexing</h3><p>æŒ‡å®šæ˜¯å¦å¯ä»¥é€šè¿‡ç€è‰²å™¨ä»£ç ä¸­çš„åŠ¨æ€ç»Ÿä¸€æ•´æ•°è¡¨è¾¾å¼ç´¢å¼•å­˜å‚¨å™¨å›¾åƒæ•°ç»„ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™åœ¨ç€è‰²å™¨ä»£ç ä¸­èšåˆåˆ°æ•°ç»„ä¸­æ—¶ï¼Œæè¿°ç¬¦ç±»å‹ä¸ºVK_DESCRIPTOR_TYPE_STORAGE_IMAGEçš„èµ„æºå¿…é¡»ä»…é€šè¿‡å¸¸é‡æ•´æ•°è¡¨è¾¾å¼ç¼–åˆ¶ç´¢å¼•ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜StorageImageArrayDynamicIndexingåŠŸèƒ½ã€‚</p>
<h3 id="38-shaderClipDistance"><a href="#38-shaderClipDistance" class="headerlink" title="38. shaderClipDistance"></a>38. shaderClipDistance</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦æ”¯æŒClipDistanceã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åœ¨ç€è‰²å™¨æ¨¡å—ä¸­è¯»å–æˆ–å†™å…¥ä½¿ç”¨ClipDistanceå†…ç½®è£…é¥°çš„ä»»ä½•æˆå‘˜ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜ClipDistanceåŠŸèƒ½ã€‚</p>
<h3 id="39-shaderCullDistance"><a href="#39-shaderCullDistance" class="headerlink" title="39. shaderCullDistance"></a>39. shaderCullDistance</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦æ”¯æŒCullDistanceã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åœ¨ç€è‰²å™¨æ¨¡å—ä¸­è¯»å–æˆ–å†™å…¥ä½¿ç”¨CullDistanceå†…ç½®è£…é¥°çš„ä»»ä½•æˆå‘˜ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜CullDistanceåŠŸèƒ½ã€‚</p>
<h3 id="40-shaderFloat64"><a href="#40-shaderFloat64" class="headerlink" title="40. shaderFloat64"></a>40. shaderFloat64</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦æ”¯æŒ64ä½æµ®ç‚¹ï¼ˆåŒç²¾åº¦ï¼‰ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨64ä½æµ®ç‚¹ç±»å‹ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜Float64åŠŸèƒ½ã€‚</p>
<h3 id="41-shaderInt64"><a href="#41-shaderInt64" class="headerlink" title="41. shaderInt64"></a>41. shaderInt64</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦æ”¯æŒ64ä½æ•´æ•°ï¼ˆæœ‰ç¬¦å·å’Œæ— ç¬¦å·ï¼‰ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨64ä½æ•´æ•°ç±»å‹ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜Int64åŠŸèƒ½ã€‚</p>
<h3 id="42-shaderInt16"><a href="#42-shaderInt16" class="headerlink" title="42. shaderInt16"></a>42. shaderInt16</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦æ”¯æŒ16ä½æ•´æ•°ï¼ˆæœ‰ç¬¦å·å’Œæ— ç¬¦å·ï¼‰ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨16ä½æ•´æ•°ç±»å‹ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜Int16åŠŸèƒ½ã€‚</p>
<h3 id="43-shaderResourceResidency"><a href="#43-shaderResourceResidency" class="headerlink" title="43. shaderResourceResidency"></a>43. shaderResourceResidency</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç æ˜¯å¦æ”¯æŒè¿”å›èµ„æºé©»ç•™ä¿¡æ¯çš„å›¾åƒæ“ä½œã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨OpImageSparse *æŒ‡ä»¤ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜SparseResidencyåŠŸèƒ½ã€‚<br>è¯¥åŠŸèƒ½è‡³å°‘éœ€è¦æ”¯æŒä¸€ä¸ªsparseResidency *åŠŸèƒ½ã€‚</p>
<h3 id="44-shaderResourceMinLod"><a href="#44-shaderResourceMinLod" class="headerlink" title="44. shaderResourceMinLod"></a>44. shaderResourceMinLod</h3><p>æŒ‡å®šç€è‰²å™¨ä»£ç ä¸­æ˜¯å¦æ”¯æŒæŒ‡å®šæœ€å°èµ„æºLODçš„å›¾åƒæ“ä½œã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨MinLodå›¾åƒæ“ä½œæ•°ã€‚<br>è¿™è¿˜æŒ‡å®šç€è‰²å™¨æ¨¡å—æ˜¯å¦å¯ä»¥å£°æ˜MinLodåŠŸèƒ½ã€‚</p>
<h3 id="45-sparseBinding"><a href="#45-sparseBinding" class="headerlink" title="45. sparseBinding"></a>45. sparseBinding</h3><p>æŒ‡å®šæ˜¯å¦å¯ä»¥åœ¨ä¸é€æ˜çš„ç¨€ç–å—çº§åˆ«è€Œä¸æ˜¯åœ¨å¯¹è±¡çº§åˆ«ç®¡ç†èµ„æºå†…å­˜ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™å¿…é¡»ä½¿ç”¨vkBindBufferMemoryå’ŒvkBindImageMemoryå‘½ä»¤ä»…åŸºäºæ¯ä¸ªå¯¹è±¡ç»‘å®šèµ„æºå†…å­˜ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸èƒ½åˆ†åˆ«ä½¿ç”¨VkBufferCreateInfoå’ŒVkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_BUFFER_CREATE_SPARSE_BINDING_BITå’ŒVK_IMAGE_CREATE_SPARSE_BINDING_BITåˆ›å»ºç¼“å†²åŒºå’Œæ˜ åƒã€‚ å¦åˆ™ï¼Œå¯ä»¥æŒ‰ç¨€ç–èµ„æºç‰¹å¾ä¸­çš„æè¿°ç®¡ç†èµ„æºå­˜å‚¨å™¨ã€‚</p>
<h3 id="46-sparseResidencyBuffer"><a href="#46-sparseResidencyBuffer" class="headerlink" title="46. sparseResidencyBuffer"></a>46. sparseResidencyBuffer</h3><p>æŒ‡å®šè®¾å¤‡æ˜¯å¦å¯ä»¥è®¿é—®éƒ¨åˆ†é©»ç•™ç¼“å†²åŒºã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨VkBufferCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_BUFFER_CREATE_SPARSE_RESIDENCY_BITåˆ›å»ºç¼“å†²åŒºã€‚</p>
<h3 id="47-sparseResidencyImage2D"><a href="#47-sparseResidencyImage2D" class="headerlink" title="47. sparseResidencyImage2D"></a>47. sparseResidencyImage2D</h3><p>æŒ‡å®šè®¾å¤‡æ˜¯å¦å¯ä»¥è®¿é—®æ¯ä¸ªåƒç´ 1ä¸ªæ ·æœ¬çš„éƒ¨åˆ†é©»ç•™çš„2Då›¾åƒã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨VkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_IMAGE_CREATE_SPARSE_RESIDENCY_BITåˆ›å»ºimageTypeä¸ºVK_IMAGE_TYPE_2Dä¸”æ ·æœ¬è®¾ç½®ä¸ºVK_SAMPLE_COUNT_1_BITçš„å›¾åƒã€‚</p>
<h3 id="48-sparseResidencyImage3D"><a href="#48-sparseResidencyImage3D" class="headerlink" title="48. sparseResidencyImage3D"></a>48. sparseResidencyImage3D</h3><p>æŒ‡å®šè®¾å¤‡æ˜¯å¦å¯ä»¥è®¿é—®éƒ¨åˆ†é©»ç•™çš„3Då›¾åƒã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨VkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_IMAGE_CREATE_SPARSE_RESIDENCY_BITåˆ›å»ºimageTypeä¸ºVK_IMAGE_TYPE_3Dçš„æ˜ åƒã€‚</p>
<h3 id="49-sparseResidency2Samples"><a href="#49-sparseResidency2Samples" class="headerlink" title="49. sparseResidency2Samples"></a>49. sparseResidency2Samples</h3><p>æŒ‡å®šç‰©ç†è®¾å¤‡æ˜¯å¦å¯ä»¥è®¿é—®å…·æœ‰æ¯åƒç´ 2ä¸ªæ ·æœ¬çš„éƒ¨åˆ†é©»ç•™çš„2Då›¾åƒã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨VkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_IMAGE_CREATE_SPARSE_RESIDENCY_BITåˆ›å»ºimageTypeä¸ºVK_IMAGE_TYPE_2Dä¸”æ ·æœ¬è®¾ç½®ä¸ºVK_SAMPLE_COUNT_2_BITçš„å›¾åƒã€‚</p>
<h3 id="50-sparseResidency4Samples"><a href="#50-sparseResidency4Samples" class="headerlink" title="50. sparseResidency4Samples"></a>50. sparseResidency4Samples</h3><p>æŒ‡å®šç‰©ç†è®¾å¤‡æ˜¯å¦å¯ä»¥è®¿é—®æ¯ä¸ªåƒç´ æœ‰4ä¸ªæ ·æœ¬çš„éƒ¨åˆ†é©»ç•™çš„2Då›¾åƒã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨VkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_IMAGE_CREATE_SPARSE_RESIDENCY_BITåˆ›å»ºimageTypeä¸ºVK_IMAGE_TYPE_2Dä¸”æ ·æœ¬è®¾ç½®ä¸ºVK_SAMPLE_COUNT_4_BITçš„å›¾åƒã€‚</p>
<h3 id="51-sparseResidency8Samples"><a href="#51-sparseResidency8Samples" class="headerlink" title="51. sparseResidency8Samples"></a>51. sparseResidency8Samples</h3><p>æŒ‡å®šç‰©ç†è®¾å¤‡æ˜¯å¦å¯ä»¥è®¿é—®å…·æœ‰æ¯åƒç´ 8ä¸ªæ ·æœ¬çš„éƒ¨åˆ†é©»ç•™çš„2Då›¾åƒã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨VkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_IMAGE_CREATE_SPARSE_RESIDENCY_BITåˆ›å»ºimageTypeä¸ºVK_IMAGE_TYPE_2Dä¸”æ ·æœ¬è®¾ç½®ä¸ºVK_SAMPLE_COUNT_8_BITçš„å›¾åƒã€‚</p>
<h3 id="52-sparseResidency16Samples"><a href="#52-sparseResidency16Samples" class="headerlink" title="52. sparseResidency16Samples"></a>52. sparseResidency16Samples</h3><p>æŒ‡å®šç‰©ç†è®¾å¤‡æ˜¯å¦å¯ä»¥è®¿é—®æ¯ä¸ªåƒç´ 16ä¸ªæ ·æœ¬çš„éƒ¨åˆ†é©»ç•™çš„2Då›¾åƒã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—ä½¿ç”¨VkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­è®¾ç½®çš„VK_IMAGE_CREATE_SPARSE_RESIDENCY_BITåˆ›å»ºimageTypeä¸ºVK_IMAGE_TYPE_2Dä¸”æ ·æœ¬è®¾ç½®ä¸ºVK_SAMPLE_COUNT_16_BITçš„å›¾åƒã€‚</p>
<h3 id="53-sparseResidencyAliased"><a href="#53-sparseResidencyAliased" class="headerlink" title="53. sparseResidencyAliased"></a>53. sparseResidencyAliased</h3><p>æŒ‡å®šç‰©ç†è®¾å¤‡æ˜¯å¦å¯ä»¥æ­£ç¡®è®¿é—®åˆ«ååˆ°å¤šä¸ªä½ç½®çš„æ•°æ®ã€‚<br>å¦‚æœæœªå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™ä¸å¾—åˆ†åˆ«åœ¨VkBufferCreateInfoå’ŒVkImageCreateInfoç»“æ„çš„flagsæˆå‘˜ä¸­ä½¿ç”¨VK_BUFFER_CREATE_SPARSE_ALIASED_BITå’ŒVK_IMAGE_CREATE_SPARSE_ALIASED_BITæšä¸¾å€¼ã€‚</p>
<h3 id="54-variableMultisampleRate"><a href="#54-variableMultisampleRate" class="headerlink" title="54. variableMultisampleRate"></a>54. variableMultisampleRate</h3><p>æŒ‡å®šåœ¨æ²¡æœ‰é™„ä»¶çš„å­é€šè¡ŒæœŸé—´å°†ç»‘å®šåˆ°å‘½ä»¤ç¼“å†²åŒºçš„æ‰€æœ‰ç®¡é“æ˜¯å¦å¿…é¡»å…·æœ‰VkPipelineMultisampleStateCreateInfo::rasterizationSamplesçš„ç›¸åŒå€¼ã€‚<br>å¦‚æœè®¾ç½®ä¸ºVK_TRUEï¼Œåˆ™å®ç°æ”¯æŒä¸å¸¦é™„ä»¶çš„å­é€šé“ä¸­çš„å¯å˜å¤šé‡é‡‡æ ·ç‡ã€‚<br>å¦‚æœè®¾ç½®ä¸ºVK_FALSEï¼Œåˆ™ç»‘å®šåœ¨æ­¤å­é€šé“ä¸­çš„æ‰€æœ‰ç®¡é“å¿…é¡»å…·æœ‰ç›¸åŒçš„å¤šé‡‡æ ·ç‡ã€‚ ä½†è¿™åœ¨å­é€šé“ä½¿ç”¨ä»»ä½•é™„ä»¶çš„æƒ…å†µä¸‹æ— æ•ˆã€‚</p>
<h3 id="55-inheritedQueries"><a href="#55-inheritedQueries" class="headerlink" title="55. inheritedQueries"></a>55. inheritedQueries</h3><p>æŒ‡å®šåœ¨æŸ¥è¯¢å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æ˜¯å¦å¯ä»¥æ‰§è¡Œè¾…åŠ©å‘½ä»¤ç¼“å†²åŒºã€‚</p>
<p></p></code></pre><p></p>
</details>


<p>è¯´æ˜ï¼švkspec.htmlï¼ˆ2019&#x2F;05&#x2F;03ï¼‰æ˜¯ä»å®˜æ–¹æ–‡æ¡£ <a href="https://github.com/KhronosGroup/Vulkan-Docs/">https://github.com/KhronosGroup/Vulkan-Docs/</a> ä¸­åˆ¶ä½œç”Ÿæˆçš„ã€‚å¯ä»¥è‡ªè¡Œä¸‹è½½æœ€æ–°ä»£ç åˆ¶ä½œï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ï¼š</p>
<ol>
<li>csdnï¼ˆéœ€è¦5ç§¯åˆ†ï¼Œä¸çŸ¥é“æ€ä¹ˆå»æ‰è¿™ä¸ªï¼‰ï¼š<a href="https://download.csdn.net/download/u014535072/11158246">https://download.csdn.net/download/u014535072/11158246</a></li>
<li>ç™¾åº¦ç½‘ç›˜ï¼šé“¾æ¥: <a href="https://pan.baidu.com/s/1IyPnb-2ti1SjU0puFKwYUQ">https://pan.baidu.com/s/1IyPnb-2ti1SjU0puFKwYUQ</a> æå–ç : f2c2</li>
</ol>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(4)-Surfaceå’Œäº¤æ¢é“¾</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-4-Surface%E5%92%8C%E4%BA%A4%E6%8D%A2%E9%93%BE/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡ä¸»è¦æ˜¯å­¦ä¹ Vulkan Tutorial.pdfæ–‡æ¡£ä¸­çš„Window Surfaceå’ŒSwap Chainçš„éƒ¨åˆ†ã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li>[Vulkan-æ–‡æ¡£]<a href="https://github.com/KhronosGroup/Vulkan-Docs">https://github.com/KhronosGroup/Vulkan-Docs</a></li>
</ol>
<h1 id="ä¸€-Window-Surface"><a href="#ä¸€-Window-Surface" class="headerlink" title="ä¸€. Window Surface"></a>ä¸€. Window Surface</h1><p>ç”±äºVulkanæ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œå› æ­¤æ— æ³•ç›´æ¥ä¸çª—å£ç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚<br>è¦åœ¨Vulkanå’Œçª—å£ç³»ç»Ÿä¹‹é—´å»ºç«‹è¿æ¥ä»¥å‘å±å¹•æ˜¾ç¤ºç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨WSIï¼ˆçª—å£ç³»ç»Ÿé›†æˆï¼‰æ‰©å±•ã€‚<br>è¿™å°±éœ€è¦ä½¿ç”¨åˆ°VK_KHR_surfaceï¼Œå®ƒå…¬å¼€äº†ä¸€ä¸ªVkSurfaceKHRå¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªæŠ½è±¡ç±»å‹çš„Surfaceï¼Œä»¥å‘ˆç°æ¸²æŸ“å›¾åƒã€‚<br>æˆ‘ä»¬ç¨‹åºä¸­çš„Surfaceå°†ç”±æˆ‘ä»¬å·²ç»ä½¿ç”¨GLFWæ‰“å¼€çš„çª—å£æ”¯æŒã€‚VK_KHR_surfaceæ‰©å±•æ˜¯ä¸€ä¸ªå®ä¾‹çº§æ‰©å±•ï¼Œæˆ‘ä»¬å®é™…ä¸Šå·²ç»å¯ç”¨å®ƒï¼Œå› ä¸ºå®ƒåŒ…å«åœ¨glfwGetRequiredInstanceExtensionsè¿”å›çš„åˆ—è¡¨ä¸­ã€‚</p>
<p>ä¸€èˆ¬éœ€è¦åœ¨åˆ›å»ºå®ä¾‹åç«‹å³åˆ›å»ºçª—å£Surfaceï¼Œå› ä¸ºå®ƒå®é™…ä¸Šå¯ä»¥å½±å“ç‰©ç†è®¾å¤‡é€‰æ‹©ã€‚<br>ä½†å¦‚æœä½ åªéœ€è¦ç¦»å±æ¸²æŸ“ï¼Œçª—å£Surfaceæ˜¯Vulkanä¸­å®Œå…¨å¯é€‰çš„ç»„ä»¶ã€‚ Vulkanå…è®¸è¿™æ ·åšï¼Œè€Œä¸æ˜¯åƒOpenGLä¸€æ ·å¿…é¡»åˆ›å»ºä¸€ä¸ªä¸å¯è§çš„çª—å£ã€‚</p>
<h2 id="1-1-åˆ›å»ºçª—å£Surface"><a href="#1-1-åˆ›å»ºçª—å£Surface" class="headerlink" title="1.1 åˆ›å»ºçª—å£Surface"></a>1.1 åˆ›å»ºçª—å£Surface</h2><p>åœ¨Vulkanä¸­ä½¿ç”¨VkSurfaceKHRè¡¨ç¤ºçª—å£Surfaceï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkSurfaceKHR surface;</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶VkSurfaceKHRå¯¹è±¡åŠå…¶ç”¨æ³•ä¸å¹³å°æ— å…³ï¼Œä½†å®ƒçš„åˆ›å»ºå¹¶ä¸æ˜¯å› ä¸ºå®ƒå–å†³äºçª—å£ç³»ç»Ÿçš„ç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œå®ƒéœ€è¦Windowsä¸Šçš„HWNDå’ŒHMODULEå¥æŸ„ã€‚å› æ­¤ï¼Œæ‰©å±•ä¸­æœ‰ä¸€ä¸ªç‰¹å®šäºå¹³å°çš„æ·»åŠ ï¼Œåœ¨Windowsä¸Šç§°ä¸ºVK_KHR_win32_surfaceï¼Œå¹¶ä¸”è¿˜è‡ªåŠ¨åŒ…å«åœ¨glfwGetRequiredInstanceExtensionsçš„åˆ—è¡¨ä¸­ã€‚<br>ä½†ä½¿ç”¨åƒGLFWè¿™æ ·çš„åº“ç„¶åç»§ç»­ä½¿ç”¨ç‰¹å®šäºå¹³å°çš„ä»£ç æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚<br>GLFWå®é™…ä¸Šæœ‰glfwCreateWindowSurfaceæ¥å¸®æˆ‘ä»¬å¤„ç†å¹³å°çš„å·®å¼‚ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"> <span class="comment">// ä½¿ç”¨glfwåˆ›å»ºWindowSurface</span></span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">createWindowSurface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (<span class="built_in">glfwCreateWindowSurface</span>(instance, window, <span class="literal">nullptr</span>, &amp;surface) != VK_SUCCESS) &#123;</span><br><span class="line">         <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create window surface!&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// è®°å¾—é‡Šæ”¾</span></span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="comment">// é‡Šæ”¾WindowSurface</span></span><br><span class="line">     <span class="built_in">vkDestroySurfaceKHR</span>(instance, surface, <span class="literal">nullptr</span>);</span><br><span class="line">     ......    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="äºŒ-Swap-Chain-äº¤æ¢é“¾"><a href="#äºŒ-Swap-Chain-äº¤æ¢é“¾" class="headerlink" title="äºŒ. Swap Chain-äº¤æ¢é“¾"></a>äºŒ. Swap Chain-äº¤æ¢é“¾</h1><p>Vulkanæ²¡æœ‰â€œé»˜è®¤å¸§ç¼“å†²åŒºâ€çš„æ¦‚å¿µï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åä¸º â€œswap chainâ€ å³äº¤æ¢é“¾ï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“çš„ç¼“å†²åŒºï¼Œå¿…é¡»åœ¨Vulkanä¸­æ˜ç¡®åˆ›å»ºã€‚<br>äº¤æ¢é“¾æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç­‰å¾…å‘ˆç°ç»™å±å¹•çš„å›¾åƒé˜Ÿåˆ—ã€‚åº”ç”¨ç¨‹åºå°†è·å–è¿™æ ·çš„å›¾åƒä»¥ç»˜åˆ¶å®ƒï¼Œç„¶åå°†å…¶è¿”å›åˆ°é˜Ÿåˆ—ä¸­ã€‚<br>é˜Ÿåˆ—çš„å·¥ä½œåŸç†ä»¥åŠä»é˜Ÿåˆ—ä¸­æ˜¾ç¤ºå›¾åƒçš„æ¡ä»¶å–å†³äºäº¤æ¢é“¾çš„è®¾ç½®æ–¹å¼ï¼Œä½†äº¤æ¢é“¾çš„ä¸€èˆ¬ç”¨é€”æ˜¯å°†å›¾åƒçš„æ˜¾ç¤ºä¸å±å¹•çš„åˆ·æ–°ç‡åŒæ­¥ã€‚</p>
<h2 id="2-1-æ£€æŸ¥GPUæ˜¯å¦æ”¯æŒäº¤æ¢é“¾"><a href="#2-1-æ£€æŸ¥GPUæ˜¯å¦æ”¯æŒäº¤æ¢é“¾" class="headerlink" title="2.1 æ£€æŸ¥GPUæ˜¯å¦æ”¯æŒäº¤æ¢é“¾"></a>2.1 æ£€æŸ¥GPUæ˜¯å¦æ”¯æŒäº¤æ¢é“¾</h2><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„GPUéƒ½æ”¯æŒå›¾åƒæ˜¾ç¤º(æ¯”å¦‚ä¸“ä¸ºæœåŠ¡å™¨è®¾è®¡çš„)ï¼Œå…¶æ¬¡ï¼Œç”±äºå›¾åƒæ˜¾ç¤ºä¸¥é‡ä¾èµ–äºçª—å£ç³»ç»Ÿå’Œä¸çª—å£ç›¸å…³çš„Surfaceï¼Œå› æ­¤å®ƒå®é™…ä¸Šä¸æ˜¯Vulkanæ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ã€‚<br>æ‰€ä»¥å¿…é¡»åœ¨æŸ¥è¯¢å…¶æ”¯æŒåæ‰èƒ½å¯ç”¨K_KHR_swapchainè®¾å¤‡æ‰©å±•ã€‚</p>
<p>å¯ä»¥æ‰©å±•isDeviceSuitableå‡½æ•°ä»¥æ£€æŸ¥æ˜¯å¦æ”¯æŒæ­¤æ‰©å±•ã€‚<br>ä¹‹å‰å·²ç»å®ç°è¿‡å¦‚ä½•åˆ—å‡ºVkPhysicalDeviceæ”¯æŒçš„æ‰©å±•ï¼Œè¿™æ ·åšæ³•å…¶å®ä¸€æ ·ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒVulkanå¤´æ–‡ä»¶æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„å®VK_KHR_SWAPCHAIN_EXTENSION_NAMEï¼Œå®šä¹‰ä¸ºVK_KHR_swapchainã€‚<br>ä½¿ç”¨æ­¤å®çš„ä¼˜ç‚¹æ˜¯ç¼–è¯‘å™¨å°†æ•è·æ‹¼å†™é”™è¯¯ã€‚é¦–å…ˆå£°æ˜æ‰€éœ€è®¾å¤‡æ‰©å±•çš„åˆ—è¡¨ï¼Œç±»ä¼¼äºè¦å¯ç”¨çš„éªŒè¯å±‚åˆ—è¡¨ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> std::vector&lt;<span class="type">const</span> <span class="type">char</span>*&gt; deviceExtensions = &#123;</span><br><span class="line">    VK_KHR_SWAPCHAIN_EXTENSION_NAME</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isDeviceSuitable</span><span class="params">(VkPhysicalDevice device)</span> </span>&#123;</span><br><span class="line">    QueueFamilyIndices indices = <span class="built_in">findQueueFamilies</span>(device);</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> extensionsSupported = <span class="built_in">checkDeviceExtensionSupport</span>(device);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> indices.<span class="built_in">isComplete</span>() &amp;&amp; extensionsSupported;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">checkDeviceExtensionSupport</span><span class="params">(VkPhysicalDevice device)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> extensionCount;</span><br><span class="line">    <span class="built_in">vkEnumerateDeviceExtensionProperties</span>(device, <span class="literal">nullptr</span>, &amp;extensionCount, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function">std::vector&lt;VkExtensionProperties&gt; <span class="title">availableExtensions</span><span class="params">(extensionCount)</span></span>;</span><br><span class="line">    <span class="built_in">vkEnumerateDeviceExtensionProperties</span>(device, <span class="literal">nullptr</span>, &amp;extensionCount, availableExtensions.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">    <span class="function">std::set&lt;std::string&gt; <span class="title">requiredExtensions</span><span class="params">(deviceExtensions.begin(), deviceExtensions.end())</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†å½“å‰æ‰€æœ‰å¯æ”¯æŒçš„æ‰©å±•ï¼Œå¹¶é€æ­¥ç§»é™¤ä¹Ÿå­˜åœ¨äºdeviceExtensionsä¸­çš„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; extension : availableExtensions) &#123;</span><br><span class="line">        requiredExtensions.<span class="built_in">erase</span>(extension.extensionName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ºemptyæ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰deviceExtensionsä¸­çš„æ‰©å±•å‡æ”¯æŒ</span></span><br><span class="line">    <span class="keyword">return</span> requiredExtensions.<span class="built_in">empty</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-ä½¿èƒ½è®¾å¤‡æ‰©å±•"><a href="#2-2-ä½¿èƒ½è®¾å¤‡æ‰©å±•" class="headerlink" title="2.2 ä½¿èƒ½è®¾å¤‡æ‰©å±•"></a>2.2 ä½¿èƒ½è®¾å¤‡æ‰©å±•</h2><p>ä½¿ç”¨äº¤æ¢é“¾éœ€è¦é¦–å…ˆä½¿èƒ½VK_KHR_swapchainæ‰©å±•ã€‚<br>æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨åˆ›å»ºé€»è¾‘è®¾å¤‡çš„æ—¶å€™å£°æ˜ä¸€ä¸‹å³å¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">createInfo.enabledExtensionCount = <span class="built_in">static_cast</span>&lt;<span class="type">uint32_t</span>&gt;(deviceExtensions.<span class="built_in">size</span>());</span><br><span class="line">createInfo.ppEnabledExtensionNames = deviceExtensions.<span class="built_in">data</span>();</span><br></pre></td></tr></table></figure>

<h2 id="2-3-è·å–å…³äºswap-chainæ›´å¤šæ”¯æŒç»†èŠ‚"><a href="#2-3-è·å–å…³äºswap-chainæ›´å¤šæ”¯æŒç»†èŠ‚" class="headerlink" title="2.3 è·å–å…³äºswap chainæ›´å¤šæ”¯æŒç»†èŠ‚"></a>2.3 è·å–å…³äºswap chainæ›´å¤šæ”¯æŒç»†èŠ‚</h2><p>åªæ£€æŸ¥äº¤æ¢é“¾æ˜¯å¦å¯ç”¨æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå®ƒå®é™…ä¸Šå¯èƒ½ä¸æˆ‘ä»¬åˆ›å»ºçš„çª—å£Surfaceä¸å…¼å®¹ï¼ˆæœ‰ç‚¹å‘ï¼‰ã€‚<br>åˆ›å»ºäº¤æ¢é“¾è¿˜æ¶‰åŠæ¯”vulkanå®ä¾‹å’Œè®¾å¤‡åˆ›å»ºæ—¶æ›´å¤šçš„è®¾ç½®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨èƒ½å¤Ÿç»§ç»­ä¹‹å‰æŸ¥æ˜æ›´å¤šçš„ç»†èŠ‚ã€‚<br>éœ€è¦æ£€æŸ¥çš„åŸºæœ¬ä¸Šæœ‰ä»¥ä¸‹ä¸‰ç§å±æ€§ï¼š</p>
<ul>
<li>åŸºæœ¬SurfaceåŠŸèƒ½ï¼ˆäº¤æ¢é“¾ä¸­çš„æœ€å°&#x2F;æœ€å¤§å›¾åƒæ•°ï¼Œå›¾åƒçš„æœ€å°&#x2F;æœ€å¤§å®½åº¦å’Œé«˜åº¦ï¼‰</li>
<li>Surfaceçš„æ ¼å¼ï¼ˆåƒç´ æ ¼å¼ï¼Œè‰²å½©ç©ºé—´ï¼‰</li>
<li>å¯ç”¨çš„å‘ˆç°æ¨¡å¼</li>
</ul>
<p>ä¸åˆ›å»ºé˜Ÿåˆ—ç±»ä¼¼ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç»“æ„ä½“æ¥å­˜å‚¨ä¼ é€’è¿™äº›ç»†èŠ‚éƒ¨åˆ†ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">SwapChainSupportDetails</span> &#123;</span><br><span class="line">    VkSurfaceCapabilitiesKHR capabilities; <span class="comment">// åŸºæœ¬SurfaceåŠŸèƒ½</span></span><br><span class="line">    std::vector&lt;VkSurfaceFormatKHR&gt; formats; <span class="comment">// Surfaceæ ¼å¼</span></span><br><span class="line">    std::vector&lt;VkPresentModeKHR&gt; presentModes; <span class="comment">// å¯ç”¨çš„å‘ˆç°æ¨¡å¼(presentation modes)</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ¥æ¥ä¸‹æ˜¯æŸ¥è¯¢ç»†èŠ‚éƒ¨åˆ†ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">SwapChainSupportDetails <span class="title">querySwapChainSupport</span><span class="params">(VkPhysicalDevice device)</span> </span>&#123;</span><br><span class="line">    SwapChainSupportDetails details;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. æŸ¥è¯¢åŸºæœ¬SurfaceåŠŸèƒ½</span></span><br><span class="line">    <span class="comment">// éœ€è¦ä½¿ç”¨åˆ°æœ¬æœºç‰©ç†è®¾å¤‡(GPU), ä»¥åŠåˆ›å»ºçš„é€»è¾‘è®¾å¤‡å¯¹åº”çš„Surfaceï¼Œç»“æœä¿å­˜åœ¨VkSurfaceCapabilitiesKHRç»“æ„ä½“ä¸­</span></span><br><span class="line">    <span class="comment">// VkResult vkGetPhysicalDeviceSurfaceCapabilitiesKHR(VkPhysicalDevice physicalDevice, VkSurfaceKHR surface, VkSurfaceCapabilitiesKHR *pSurfaceCapabilities)</span></span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceSurfaceCapabilitiesKHR</span>(device, surface, &amp;details.capabilities);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æŸ¥è¯¢å¯æ”¯æŒçš„Surfaceæ ¼å¼</span></span><br><span class="line">    <span class="comment">// ç±»ä¼¼æ‰©å±•ï¼ŒæŒ‰ä¾‹å…ˆæŸ¥è¯¢ä¸€ä¸‹æ•°é‡ï¼Œç„¶åæ›´æ–°ç»†èŠ‚åˆ°VkSurfaceFormatKHRçš„é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    <span class="type">uint32_t</span> formatCount;</span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceSurfaceFormatsKHR</span>(device, surface, &amp;formatCount, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (formatCount != <span class="number">0</span>) &#123;</span><br><span class="line">        details.formats.<span class="built_in">resize</span>(formatCount);</span><br><span class="line">        <span class="built_in">vkGetPhysicalDeviceSurfaceFormatsKHR</span>(device, surface, &amp;formatCount, details.formats.<span class="built_in">data</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æŸ¥è¯¢å¯ç”¨çš„å‘ˆç°æ¨¡å¼(presentation modes)</span></span><br><span class="line">    <span class="type">uint32_t</span> presentModeCount;</span><br><span class="line">    <span class="built_in">vkGetPhysicalDeviceSurfacePresentModesKHR</span>(device, surface, &amp;presentModeCount, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span> (presentModeCount != <span class="number">0</span>) &#123;</span><br><span class="line">        details.presentModes.<span class="built_in">resize</span>(presentModeCount);</span><br><span class="line">        <span class="built_in">vkGetPhysicalDeviceSurfacePresentModesKHR</span>(device, surface, &amp;presentModeCount, details.presentModes.<span class="built_in">data</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> details;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-ä¸ºswap-chain-äº¤æ¢é“¾é€‰æ‹©åˆé€‚çš„è®¾ç½®"><a href="#2-4-ä¸ºswap-chain-äº¤æ¢é“¾é€‰æ‹©åˆé€‚çš„è®¾ç½®" class="headerlink" title="2.4 ä¸ºswap chain-äº¤æ¢é“¾é€‰æ‹©åˆé€‚çš„è®¾ç½®"></a>2.4 ä¸ºswap chain-äº¤æ¢é“¾é€‰æ‹©åˆé€‚çš„è®¾ç½®</h2><p>æ»¡è¶³äº†swapChainAnequateæ¡ä»¶ï¼Œé‚£ä¹ˆç‰©ç†è®¾å¤‡è‚¯å®šæ˜¯æ”¯æŒæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„ï¼Œä½†è¿˜å¯ä»¥æœ‰è®¸å¤šä¸åŒçš„æœ€ä¼˜æ€§æ¨¡å¼ã€‚<br>æœ‰ä¸‰ç§ç±»å‹çš„è®¾ç½®å¯ä»¥é€‰æ‹©ï¼š</p>
<ul>
<li>Surfaceæ ¼å¼ï¼ˆé¢œè‰²æ·±åº¦ï¼‰</li>
<li>å‘ˆç°æ¨¡å¼ï¼ˆå°†å›¾åƒâ€œäº¤æ¢â€åˆ°å±å¹•çš„æ¡ä»¶ï¼‰</li>
<li>äº¤æ¢èŒƒå›´ï¼ˆäº¤æ¢é“¾ä¸­å›¾åƒçš„åˆ†è¾¨ç‡ï¼‰</li>
</ul>
<h3 id="2-4-1-Surfaceæ ¼å¼"><a href="#2-4-1-Surfaceæ ¼å¼" class="headerlink" title="2.4.1 Surfaceæ ¼å¼"></a>2.4.1 Surfaceæ ¼å¼</h3><p>åœ¨Vulkanä¸­ï¼ŒSurfaceæ ¼å¼ä½¿ç”¨ç»“æ„ä½“ VkSurfaceFormatKHR æ¥è¡¨ç¤º:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkSurfaceFormatKHR</span> &#123;</span><br><span class="line">    VkFormat           format; <span class="comment">// æ ¼å¼</span></span><br><span class="line">    VkColorSpaceKHR    colorSpace; <span class="comment">// è‰²å½©ç©ºé—´</span></span><br><span class="line">&#125; VkSurfaceFormatKHR;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ¯ä¸ªVkSurfaceFormatKHRæ¡ç›®éƒ½åŒ…å«ä¸€ä¸ªæ ¼å¼å’Œä¸€ä¸ªcolorSpaceæˆå‘˜ã€‚</p>
<ol>
<li>æ ¼å¼æˆå‘˜æŒ‡å®šé¢œè‰²é€šé“å’Œç±»å‹ã€‚ä¾‹å¦‚ï¼ŒVK_FORMAT_B8G8R8A8_UNORMæ„å‘³ç€æˆ‘ä»¬ä»¥8ä½æ— ç¬¦å·æ•´æ•°çš„é¡ºåºå­˜å‚¨Bï¼ŒGï¼ŒRå’Œalphaé€šé“ï¼Œæ¯ä¸ªåƒç´ æ€»å…±32ä½ã€‚</li>
<li>colorSpaceæˆå‘˜ä½¿ç”¨VK_COLOR_SPACE_SRGB_NONLINEAR_KHRæ ‡å¿—æŒ‡ç¤ºæ˜¯å¦æ”¯æŒSRGBè‰²å½©ç©ºé—´ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„è§„èŒƒä¸­ï¼Œæ­¤æ ‡å¿—æ›¾è¢«ç§°ä¸ºVK_COLORSPACE_SRGB_NONLINEAR_KHRã€‚å¯¹äºè‰²å½©ç©ºé—´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨SRGBï¼ˆå¦‚æœå¯ç”¨ï¼‰ï¼Œå› ä¸ºå®ƒä¼šäº§ç”Ÿæ›´å‡†ç¡®çš„æ„ŸçŸ¥è‰²å½©ã€‚ç›´æ¥ä½¿ç”¨SRGBé¢œè‰²æœ‰ç‚¹æŒ‘æˆ˜ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡†RGBä½œä¸ºé¢œè‰²æ ¼å¼ï¼Œå…¶ä¸­æœ€å¸¸è§çš„ä¸€ç§æ˜¯VK_FORMAT_B8G8R8A8_UNORMã€‚</li>
</ol>
<p>æœ€å¥½çš„æƒ…å†µæ˜¯ Surface æ²¡æœ‰é¦–é€‰æ ¼å¼ï¼ŒVulkanåªé€šè¿‡è¿”å›ä¸€ä¸ªæ ¼å¼æˆå‘˜è®¾ç½®ä¸ºVK_FORMAT_UNDEFINEDçš„VkSurfaceFormatKHRæ¡ç›®æ¥æŒ‡ç¤ºã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€‰æ‹©åˆé€‚äº¤æ¢é“¾å’ŒSurfaceçš„æ ¼å¼</span></span><br><span class="line"><span class="function">VkSurfaceFormatKHR <span class="title">chooseSwapSurfaceFormat</span><span class="params">(<span class="type">const</span> std::vector&lt;VkSurfaceFormatKHR&gt;&amp; availableFormats)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (availableFormats.<span class="built_in">size</span>() == <span class="number">1</span> &amp;&amp; availableFormats[<span class="number">0</span>].format == VK_FORMAT_UNDEFINED) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;VK_FORMAT_B8G8R8A8_UNORM, VK_COLOR_SPACE_SRGB_NONLINEAR_KHR&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; availableFormat : availableFormats) &#123;</span><br><span class="line">        <span class="keyword">if</span> (availableFormat.format == VK_FORMAT_B8G8R8A8_UNORM &amp;&amp;</span><br><span class="line">            availableFormat.colorSpace == VK_COLOR_SPACE_SRGB_NONLINEAR_KHR) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> availableFormat;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ï¼Œä¿é™©èµ·è§ï¼Œç›´æ¥ä½¿ç”¨ç¬¬ä¸€ä¸ªå°±å¥½äº†</span></span><br><span class="line">    <span class="keyword">return</span> availableFormats[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-å‘ˆç°æ¨¡å¼-Presentation-Mode"><a href="#2-4-2-å‘ˆç°æ¨¡å¼-Presentation-Mode" class="headerlink" title="2.4.2 å‘ˆç°æ¨¡å¼(Presentation Mode)"></a>2.4.2 å‘ˆç°æ¨¡å¼(Presentation Mode)</h3><p>å‘ˆç°æ¨¡å¼å¯ä»¥è¯´æ˜¯äº¤æ¢é“¾ä¸­æœ€é‡è¦çš„è®¾ç½®ï¼Œå› ä¸ºå®ƒä»£è¡¨äº†å‘å±å¹•æ˜¾ç¤ºå›¾åƒçš„å®é™…æ¡ä»¶ã€‚<br>Vulkanæœ‰å››ç§å¯ç”¨çš„æ¨¡å¼ï¼š</p>
<ul>
<li>VK_PRESENT_MODE_IMMEDIATE_KHRï¼šåº”ç”¨ç¨‹åºæäº¤çš„å›¾åƒä¼šç«‹å³ä¼ è¾“åˆ°å±å¹•ä¸Šï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ’•è£‚ç°è±¡(ä¸Šä¸‹æˆ–è€…å·¦å³å›¾åƒä¸åŒ¹é…ï¼Œå‰åä¸¤å¸§åˆæˆ)ã€‚</li>
<li>VK_PRESENT_MODE_FIFO_KHRï¼šäº¤æ¢é“¾æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå½“åˆ·æ–°æ˜¾ç¤ºå¹¶ä¸”ç¨‹åºåœ¨é˜Ÿåˆ—çš„åé¢æ’å…¥æ¸²æŸ“å›¾åƒæ—¶ï¼Œæ˜¾ç¤ºä»é˜Ÿåˆ—å‰é¢è·å–å›¾åƒã€‚å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™ç¨‹åºå¿…é¡»ç­‰å¾…ã€‚è¿™ä¸ç°ä»£æ¸¸æˆä¸­çš„å‚ç›´åŒæ­¥æœ€ç›¸ä¼¼ã€‚åˆ·æ–°æ˜¾ç¤ºçš„é‚£ä¸€åˆ»è¢«ç§°ä¸ºâ€œå‚ç›´ç©ºç™½â€ã€‚</li>
<li>VK_PRESENT_MODE_FIFO_RELAXED_KHRï¼šå¦‚æœåº”ç”¨ç¨‹åºå»¶è¿Ÿä¸”é˜Ÿåˆ—åœ¨æœ€åä¸€ä¸ªå‚ç›´ç©ºç™½å¤„ä¸ºç©ºï¼Œåˆ™æ­¤æ¨¡å¼ä»…ä¸å‰ä¸€ä¸ªæ¨¡å¼ä¸åŒã€‚è€Œä¸æ˜¯ç­‰å¾…ä¸‹ä¸€ä¸ªå‚ç›´ç©ºç™½ï¼Œå›¾åƒæœ€ç»ˆåˆ°è¾¾æ—¶ç«‹å³ä¼ è¾“ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ˜æ˜¾çš„æ’•è£‚ã€‚</li>
<li>VK_PRESENT_MODE_MAILBOX_KHRï¼šè¿™æ˜¯ç¬¬äºŒç§æ¨¡å¼çš„å¦ä¸€ç§å˜ä½“ã€‚å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œå·²æ’é˜Ÿçš„å›¾åƒå°†è¢«æ›¿æ¢ä¸ºè¾ƒæ–°çš„å›¾åƒï¼Œè€Œä¸æ˜¯é˜»å¡åº”ç”¨ç¨‹åºã€‚æ­¤æ¨¡å¼å¯ç”¨äºå®ç°ä¸‰é‡ç¼“å†²ï¼Œä¸ä½¿ç”¨åŒç¼“å†²çš„æ ‡å‡†å‚ç›´åŒæ­¥ç›¸æ¯”ï¼Œå¯ä»¥é¿å…ä½¿ç”¨æ˜æ˜¾æ›´å°‘çš„å»¶è¿Ÿé—®é¢˜è¿›è¡Œæ’•è£‚ã€‚</li>
</ul>
<p>æ¯”å¦‚æˆ‘ä»¬è¯•è¯•æœºå™¨æ˜¯å¦æ”¯æŒä¸‰é‡ç¼“å†², å³å…è®¸æˆ‘ä»¬é€šè¿‡æ¸²æŸ“å°½å¯èƒ½æœ€æ–°çš„æ–°å›¾åƒç›´åˆ°å‚ç›´ç©ºç™½æ¥é¿å…æ’•è£‚ï¼ŒåŒæ—¶ä»ä¿æŒç›¸å½“ä½çš„å»¶è¿Ÿ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkPresentModeKHR <span class="title">chooseSwapPresentMode</span><span class="params">(<span class="type">const</span> std::vector&lt;VkPresentModeKHR&gt;&amp; availablePresentModes)</span> </span>&#123;</span><br><span class="line">    VkPresentModeKHR bestMode = VK_PRESENT_MODE_FIFO_KHR;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; availablePresentMode : availablePresentModes) &#123;</span><br><span class="line">        <span class="keyword">if</span> (availablePresentMode == VK_PRESENT_MODE_MAILBOX_KHR) &#123;</span><br><span class="line">            <span class="keyword">return</span> availablePresentMode;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (availablePresentMode == VK_PRESENT_MODE_IMMEDIATE_KHR) &#123;</span><br><span class="line">            bestMode = availablePresentMode;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bestMode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-äº¤æ¢èŒƒå›´-Swap-extent"><a href="#2-4-3-äº¤æ¢èŒƒå›´-Swap-extent" class="headerlink" title="2.4.3 äº¤æ¢èŒƒå›´(Swap extent)"></a>2.4.3 äº¤æ¢èŒƒå›´(Swap extent)</h3><p>äº¤æ¢èŒƒå›´æ˜¯äº¤æ¢é“¾å›¾åƒçš„åˆ†è¾¨ç‡ï¼Œå®ƒå‡ ä¹æ€»æ˜¯å®Œå…¨ç­‰äºç»˜åˆ¶çš„çª—å£çš„åˆ†è¾¨ç‡ã€‚<br>å¯èƒ½çš„åˆ†è¾¨ç‡èŒƒå›´åœ¨ VkSurfaceCapabilitiesKHR ç»“æ„ä¸­å®šä¹‰ã€‚</p>
<p>Vulkané€šè¿‡åœ¨currentExtentæˆå‘˜ä¸­è®¾ç½®å®½åº¦å’Œé«˜åº¦æ¥åŒ¹é…çª—å£çš„åˆ†è¾¨ç‡ã€‚<br>ä½†æ˜¯ï¼Œä¸€äº›çª—å£ç®¡ç†å™¨å…è®¸åœ¨è¿™é‡Œæœ‰æ‰€ä¸åŒ, é€šè¿‡å°†currentExtentä¸­çš„å®½åº¦å’Œé«˜åº¦è®¾ç½®ä¸ºç‰¹æ®Šå€¼æ¥è¡¨ç¤ºï¼šuint32_tçš„æœ€å¤§å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦é€‰æ‹©ä¸minImageExtentå’ŒmaxImageExtentèŒƒå›´å†…çš„çª—å£æœ€åŒ¹é…çš„åˆ†è¾¨ç‡ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é€‰æ‹©äº¤æ¢é“¾åˆ†è¾¨ç‡</span></span><br><span class="line"><span class="function">VkExtent2D <span class="title">chooseSwapExtent</span><span class="params">(<span class="type">const</span> VkSurfaceCapabilitiesKHR&amp; capabilities)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (capabilities.currentExtent.width != std::numeric_limits&lt;<span class="type">uint32_t</span>&gt;::<span class="built_in">max</span>()) &#123;</span><br><span class="line">        <span class="keyword">return</span> capabilities.currentExtent;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        VkExtent2D actualExtent = &#123;WIDTH, HEIGHT&#125;;</span><br><span class="line">        actualExtent.width = std::<span class="built_in">max</span>(capabilities.minImageExtent.width, std::<span class="built_in">min</span>(capabilities.maxImageExtent.width, actualExtent.width));</span><br><span class="line">        actualExtent.height = std::<span class="built_in">max</span>(capabilities.minImageExtent.height, std::<span class="built_in">min</span>(capabilities.maxImageExtent.height, actualExtent.height));</span><br><span class="line">        <span class="keyword">return</span> actualExtent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-5-åˆ›å»ºäº¤æ¢é“¾"><a href="#2-5-åˆ›å»ºäº¤æ¢é“¾" class="headerlink" title="2.5 åˆ›å»ºäº¤æ¢é“¾"></a>2.5 åˆ›å»ºäº¤æ¢é“¾</h2><p>ä¸Šè¿°æ­¥éª¤å·²ç»æŠŠåˆ›å»ºäº¤æ¢é“¾çš„ä¸‰ä¸ªä¸»è¦å±æ€§è®¾ç½®äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºäº¤æ¢é“¾å¯¹è±¡ï¼šVkSwapchainKHR swapChain;<br>é™¤äº†ä¸Šè¿°çš„ä¸‰ä¸ªä¸»è¦å±æ€§ï¼Œå…¶å®è¿˜éœ€è¦åšçš„æ˜¯ï¼š</p>
<ul>
<li>ç»‘å®šçª—å£Surface</li>
<li>è®¾ç½®äº¤æ¢é“¾å›¾åƒç»†èŠ‚ï¼ŒåŒ…æ‹¬æœ€å°å›¾åƒæ•°é‡ã€å›¾åƒå›¾å±‚æ•°é‡</li>
<li>å¤„ç†å°†åœ¨å¤šä¸ªé˜Ÿåˆ—ç³»åˆ—ä¸­ä½¿ç”¨çš„äº¤æ¢é“¾å›¾åƒã€‚å¦‚æœå›¾å½¢é˜Ÿåˆ—ç³»åˆ—ä¸å‘ˆç°é˜Ÿåˆ—ä¸åŒï¼Œéœ€è¦ä»å›¾å½¢é˜Ÿåˆ—ä¸­ç»˜åˆ¶äº¤æ¢é“¾ä¸­çš„å›¾åƒï¼Œç„¶ååœ¨å‘ˆç°é˜Ÿåˆ—ä¸­æäº¤å®ƒä»¬ã€‚ æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å¤„ç†ä»å¤šä¸ªé˜Ÿåˆ—è®¿é—®çš„å›¾åƒï¼š<ul>
<li>VK_SHARING_MODE_EXCLUSIVEï¼šæ˜ åƒä¸€æ¬¡ç”±ä¸€ä¸ªé˜Ÿåˆ—ç³»åˆ—æ‹¥æœ‰ï¼Œå¹¶ä¸”å¿…é¡»åœ¨å°†å…¶ç”¨äºå¦ä¸€ä¸ªé˜Ÿåˆ—ç³»åˆ—ä¹‹å‰æ˜¾å¼è½¬ç§»æ‰€æœ‰æƒã€‚ æ­¤é€‰é¡¹æä¾›æœ€ä½³æ€§èƒ½ã€‚</li>
<li>VK_SHARING_MODE_CONCURRENTï¼šå¯ä»¥è·¨å¤šä¸ªé˜Ÿåˆ—ç³»åˆ—ä½¿ç”¨æ˜ åƒï¼Œè€Œæ— éœ€æ˜¾å¼æ‰€æœ‰æƒä¼ è¾“ã€‚</li>
</ul>
</li>
</ul>
<p>ç±»ä¼¼åˆ›å»ºå…¶ä»–å¯¹è±¡ï¼Œäº¤æ¢é“¾çš„åˆ›å»ºä¾èµ–ç»“æ„ä½“ï¼šVkSwapchainCreateInfoKHR</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createSwapChain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è·å–ç‰©ç†è®¾å¤‡å¯æ”¯æŒçš„äº¤æ¢é“¾ç»†èŠ‚éƒ¨åˆ†</span></span><br><span class="line">    SwapChainSupportDetails swapChainSupport = <span class="built_in">querySwapChainSupport</span>(physicalDevice);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€‰æ‹©åˆé€‚çš„Surfaceæ ¼å¼</span></span><br><span class="line">    VkSurfaceFormatKHR surfaceFormat = <span class="built_in">chooseSwapSurfaceFormat</span>(swapChainSupport.formats);</span><br><span class="line">    <span class="comment">// é€‰æ‹©åˆé€‚çš„å‘ˆç°æ¨¡å¼</span></span><br><span class="line">    VkPresentModeKHR presentMode = <span class="built_in">chooseSwapPresentMode</span>(swapChainSupport.presentModes);</span><br><span class="line">    <span class="comment">// é€‰æ‹©åˆé€‚çš„åˆ†è¾¨ç‡</span></span><br><span class="line">    VkExtent2D extent = <span class="built_in">chooseSwapExtent</span>(swapChainSupport.capabilities);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿…é¡»è®¾ç½®äº¤æ¢é“¾è¿è¡Œæ‰€éœ€çš„æœ€å°å›¾åƒæ•°é‡ï¼š</span></span><br><span class="line">    <span class="comment">// æœ‰æ—¶å¯èƒ½å¿…é¡»ç­‰å¾…é©±åŠ¨ç¨‹åºå®Œæˆå†…éƒ¨æ“ä½œæ‰èƒ½è·å–å¦ä¸€ä¸ªè¦æ¸²æŸ“çš„å›¾åƒã€‚ å› æ­¤ï¼Œå»ºè®®æœ€å°å€¼åŠ 1ï¼š</span></span><br><span class="line">    <span class="type">uint32_t</span> imageCount = swapChainSupport.capabilities.minImageCount + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// è¾¹ç•Œæ£€æŸ¥ï¼Œé˜²æ­¢è¶Šç•Œï¼Œè¶…å‡ºäº¤æ¢é“¾å¯æ”¯æŒçš„æœ€å¤§å›¾åƒæ•°é‡</span></span><br><span class="line">    <span class="keyword">if</span> (swapChainSupport.capabilities.maxImageCount &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">        imageCount &gt; swapChainSupport.capabilities.maxImageCount) &#123;</span><br><span class="line">        imageCount = swapChainSupport.capabilities.maxImageCount;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºäº¤æ¢é“¾å¯¹è±¡</span></span><br><span class="line">    VkSwapchainCreateInfoKHR createInfo = &#123;&#125;;</span><br><span class="line">    createInfo.sType = VK_STRUCTURE_TYPE_SWAPCHAIN_CREATE_INFO_KHR;</span><br><span class="line">    createInfo.surface = surface; <span class="comment">// ç»‘å®šçª—å£Surface</span></span><br><span class="line"></span><br><span class="line">    createInfo.minImageCount = imageCount; <span class="comment">// è®¾ç½®æœ€å°å›¾åƒæ•°é‡</span></span><br><span class="line">    createInfo.imageFormat = surfaceFormat.format; <span class="comment">// è®¾ç½®å›¾åƒæ ¼å¼</span></span><br><span class="line">    createInfo.imageColorSpace = surfaceFormat.colorSpace; <span class="comment">// è®¾ç½®å›¾åƒé¢œè‰²ç©ºé—´</span></span><br><span class="line"></span><br><span class="line">    createInfo.imageExtent = extent; <span class="comment">// è®¾ç½®åˆ†è¾¨ç‡</span></span><br><span class="line">    createInfo.imageArrayLayers = <span class="number">1</span>; <span class="comment">// æŒ‡å®šæ¯ä¸ªå›¾åƒæ‰€åŒ…å«çš„å›¾å±‚æ•°é‡, é™¤éæ˜¯ç«‹ä½“3Dåº”ç”¨ç¨‹åºï¼Œå¦åˆ™å§‹ç»ˆä¸º1ã€‚ </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// imageUsage æ˜¯ VkImageUsageFlags ç±»å‹, æŒ‡å®šå°†ä½¿ç”¨äº¤æ¢é“¾ä¸­çš„å›¾åƒè¿›è¡Œå“ªç§æ“ä½œ</span></span><br><span class="line">    createInfo.imageUsage = VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT; <span class="comment">// æŒ‡å®šè¯¥å›¾åƒå¯ç”¨äºåˆ›å»ºé€‚åˆç”¨ä½œé¢œè‰²çš„VkImageViewæˆ–è§£æVkFramebufferä¸­çš„é™„ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line">    QueueFamilyIndices indices = <span class="built_in">findQueueFamilies</span>(physicalDevice);</span><br><span class="line">    <span class="type">uint32_t</span> queueFamilyIndices[] = &#123;indices.graphicsFamily.<span class="built_in">value</span>(), indices.presentFamily.<span class="built_in">value</span>()&#125;;</span><br><span class="line">    <span class="keyword">if</span> (indices.graphicsFamily != indices.presentFamily) &#123;</span><br><span class="line">        createInfo.imageSharingMode = VK_SHARING_MODE_CONCURRENT;</span><br><span class="line">        createInfo.queueFamilyIndexCount = <span class="number">2</span>;</span><br><span class="line">        createInfo.pQueueFamilyIndices = queueFamilyIndices;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        createInfo.imageSharingMode = VK_SHARING_MODE_EXCLUSIVE;</span><br><span class="line">        createInfo.queueFamilyIndexCount = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">        createInfo.pQueueFamilyIndices = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥æŒ‡å®šæŸä¸ªå˜æ¢åº”è¯¥åº”ç”¨äºäº¤æ¢é“¾ä¸­çš„å›¾åƒï¼ˆæ”¯æŒå˜æ¢åŠŸèƒ½ï¼‰ï¼Œå¦‚é¡ºæ—¶é’ˆæ—‹è½¬90åº¦æˆ–æ°´å¹³ç¿»è½¬ã€‚ è¦æŒ‡å®šæ‚¨ä¸éœ€è¦ä»»ä½•è½¬æ¢ï¼Œåªéœ€æŒ‡å®šå½“å‰è½¬æ¢ã€‚</span></span><br><span class="line">    createInfo.preTransform = swapChainSupport.capabilities.currentTransform;</span><br><span class="line">    <span class="comment">// compositeAlphaå­—æ®µæŒ‡å®šæ˜¯å¦åº”è¯¥ä½¿ç”¨alphaé€šé“ä¸çª—å£ç³»ç»Ÿä¸­çš„å…¶ä»–çª—å£è¿›è¡Œæ··åˆã€‚ ä¸€èˆ¬éƒ½æ˜¯å¿½ç•¥alphaé€šé“ï¼Œå› æ­¤è®¾ç½®ä¸ºVK_COMPOSITE_ALPHA_OPAQUE_BIT_KHRã€‚</span></span><br><span class="line">    createInfo.compositeAlpha = VK_COMPOSITE_ALPHA_OPAQUE_BIT_KHR;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®å‘ˆç°æ¨¡å¼</span></span><br><span class="line">    createInfo.presentMode = presentMode;</span><br><span class="line">    <span class="comment">// å¦‚æœå‰ªè£çš„æˆå‘˜è®¾ç½®ä¸ºVK_TRUEï¼Œé‚£ä¹ˆè¿™æ„å‘³ç€æˆ‘ä»¬ä¸å…³å¿ƒè¢«é®æŒ¡çš„åƒç´ çš„é¢œè‰²</span></span><br><span class="line">    <span class="comment">// ä¾‹å¦‚å› ä¸ºå¦ä¸€ä¸ªçª—å£ä½äºå®ƒä»¬å‰é¢ã€‚ é™¤éçœŸçš„éœ€è¦èƒ½å¤Ÿè¯»å›è¿™äº›åƒç´ å¹¶è·å¾—å¯é¢„æµ‹çš„ç»“æœï¼Œå¦åˆ™å¯ä»¥é€šè¿‡å¯ç”¨å‰ªè¾‘è·å¾—æœ€ä½³æ€§èƒ½ã€‚</span></span><br><span class="line">    createInfo.clipped = VK_TRUE;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨Vulkanæ—¶ï¼Œäº¤æ¢é“¾å¯èƒ½ä¼šåœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶å˜ä¸ºæ— æ•ˆæˆ–æœªä¼˜åŒ–ï¼Œä¾‹å¦‚å› ä¸ºçª—å£å·²è°ƒæ•´å¤§å°ã€‚</span></span><br><span class="line">    <span class="comment">// åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº¤æ¢é“¾å®é™…ä¸Šéœ€è¦ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºï¼Œå¹¶ä¸”å¿…é¡»åœ¨æ­¤å­—æ®µä¸­æŒ‡å®šå¯¹æ—§äº¤æ¢é“¾çš„å¼•ç”¨, åç»­åœ¨ç ”ç©¶ã€‚</span></span><br><span class="line">    <span class="comment">// å‡è®¾æˆ‘ä»¬åªä¼šåˆ›å»ºä¸€ä¸ªäº¤æ¢é“¾</span></span><br><span class="line">    createInfo.oldSwapchain = VK_NULL_HANDLE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateSwapchainKHR</span>(device, &amp;createInfo, <span class="literal">nullptr</span>, &amp;swapChain) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create swap chain!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-1-VkImageUsageFlags"><a href="#2-5-1-VkImageUsageFlags" class="headerlink" title="2.5.1 VkImageUsageFlags"></a>2.5.1 VkImageUsageFlags</h3><p>VkImageUsageFlagsæ˜¯ä¸€ä¸ªä½æ©ç ç±»å‹ï¼Œç”¨äºè®¾ç½®é›¶æˆ–æ›´å¤šVkImageUsageFlagBitsçš„æ©ç ã€‚<br>ç”¨äºæŒ‡å®šå›¾åƒè¿›è¡Œçš„æ“ä½œç±»å‹, æœ‰å¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkImageUsageFlagBits</span> &#123;</span><br><span class="line">    VK_IMAGE_USAGE_TRANSFER_SRC_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_IMAGE_USAGE_TRANSFER_DST_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_IMAGE_USAGE_SAMPLED_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_IMAGE_USAGE_STORAGE_BIT = <span class="number">0x00000008</span>,</span><br><span class="line">    VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT = <span class="number">0x00000010</span>,</span><br><span class="line">    VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT = <span class="number">0x00000020</span>,</span><br><span class="line">    VK_IMAGE_USAGE_TRANSIENT_ATTACHMENT_BIT = <span class="number">0x00000040</span>,</span><br><span class="line">    VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT = <span class="number">0x00000080</span>,</span><br><span class="line">    VK_IMAGE_USAGE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkImageUsageFlagBits;</span><br></pre></td></tr></table></figure>
<ul>
<li>VK_IMAGE_USAGE_TRANSFER_SRC_BIT: æŒ‡å®šå›¾åƒå¯ç”¨ä½œä¼ è¾“å‘½ä»¤çš„æºã€‚</li>
<li>VK_IMAGE_USAGE_TRANSFER_DST_BIT: æŒ‡å®šå›¾åƒå¯ç”¨ä½œä¼ è¾“å‘½ä»¤çš„ç›®æ ‡ã€‚</li>
<li>VK_IMAGE_USAGE_SAMPLED_BIT: æŒ‡å®šè¯¥å›¾åƒå¯ç”¨äºåˆ›å»ºé€‚åˆå ç”¨VK_DESCRIPTOR_TYPE_SAMPLED_IMAGEæˆ–VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLERç±»å‹çš„VkDescriptorSetæ§½çš„VkImageViewï¼Œå¹¶ç”±ç€è‰²å™¨è¿›è¡Œé‡‡æ ·ã€‚</li>
<li>VK_IMAGE_USAGE_STORAGE_BIT: æŒ‡å®šè¯¥å›¾åƒå¯ç”¨äºåˆ›å»ºé€‚åˆå ç”¨VK_DESCRIPTOR_TYPE_STORAGE_IMAGEç±»å‹çš„VkDescriptorSetæ’æ§½çš„VkImageViewã€‚</li>
<li>VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT: æŒ‡å®šè¯¥å›¾åƒå¯ç”¨äºåˆ›å»ºé€‚åˆç”¨ä½œé¢œè‰²çš„VkImageViewæˆ–è§£æVkFramebufferä¸­çš„é™„ä»¶ã€‚</li>
<li>VK_IMAGE_USAGE_DEPTH_STENCIL_ATTACHMENT_BIT: æŒ‡å®šè¯¥å›¾åƒå¯ç”¨äºåˆ›å»ºé€‚åˆç”¨ä½œVkFramebufferä¸­çš„æ·±åº¦&#x2F;æ¨¡æ¿é™„ä»¶çš„VkImageViewã€‚</li>
<li>VK_IMAGE_USAGE_TRANSIENT_ATTACHMENT_BIT: æŒ‡å®šç»‘å®šåˆ°æ­¤æ˜ åƒçš„å†…å­˜å°†ä½¿ç”¨VK_MEMORY_PROPERTY_LAZILY_ALLOCATED_BITè¿›è¡Œåˆ†é…ã€‚å¯ä»¥ä¸ºä»»ä½•å¯ç”¨äºåˆ›å»ºé€‚åˆç”¨ä½œé¢œè‰²ï¼Œåˆ†è¾¨ç‡ï¼Œæ·±åº¦&#x2F;æ¨¡æ¿æˆ–è¾“å…¥é™„ä»¶çš„VkImageViewçš„å›¾åƒè®¾ç½®æ­¤ä½ã€‚</li>
<li>VK_IMAGE_USAGE_INPUT_ATTACHMENT_BIT: æŒ‡å®šè¯¥å›¾åƒå¯ç”¨äºåˆ›å»ºé€‚åˆå ç”¨VK_DESCRIPTOR_TYPE_INPUT_ATTACHMENTç±»å‹çš„VkDescriptorSetæ§½çš„VkImageView; ä»ç€è‰²å™¨è¯»å–ä½œä¸ºè¾“å…¥é™„ä»¶; å¹¶ç”¨ä½œå¸§ç¼“å†²åŒºä¸­çš„è¾“å…¥é™„ä»¶ã€‚</li>
</ul>
<h3 id="2-5-2-å¤„ç†å°†åœ¨å¤šä¸ªé˜Ÿåˆ—ç³»åˆ—ä¸­ä½¿ç”¨çš„äº¤æ¢é“¾å›¾åƒ"><a href="#2-5-2-å¤„ç†å°†åœ¨å¤šä¸ªé˜Ÿåˆ—ç³»åˆ—ä¸­ä½¿ç”¨çš„äº¤æ¢é“¾å›¾åƒ" class="headerlink" title="2.5.2 å¤„ç†å°†åœ¨å¤šä¸ªé˜Ÿåˆ—ç³»åˆ—ä¸­ä½¿ç”¨çš„äº¤æ¢é“¾å›¾åƒ"></a>2.5.2 å¤„ç†å°†åœ¨å¤šä¸ªé˜Ÿåˆ—ç³»åˆ—ä¸­ä½¿ç”¨çš„äº¤æ¢é“¾å›¾åƒ</h3><p>å¦‚æœé˜Ÿåˆ—ç³»åˆ—ä¸åŒï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨å¹¶å‘æ¨¡å¼æ¥é¿å…å¿…é¡»æ‰§è¡Œæ‰€æœ‰æƒã€‚<br>å¹¶å‘æ¨¡å¼è¦æ±‚ä½¿ç”¨queueFamilyIndexCountå’ŒpQueueFamilyIndiceså‚æ•°é¢„å…ˆæŒ‡å®šå°†å…±äº«å“ªäº›é˜Ÿåˆ—ç³»åˆ—æ‰€æœ‰æƒã€‚<br>å¦‚æœå›¾å½¢é˜Ÿåˆ—ç³»åˆ—å’Œè¡¨ç¤ºé˜Ÿåˆ—ç³»åˆ—æ˜¯ç›¸åŒçš„ï¼ˆå¤§å¤šæ•°ç¡¬ä»¶éƒ½æ˜¯è¿™ç§æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥åšæŒç‹¬å æ¨¡å¼ï¼Œå› ä¸ºå¹¶å‘æ¨¡å¼è¦æ±‚æŒ‡å®šè‡³å°‘ä¸¤ä¸ªä¸åŒçš„é˜Ÿåˆ—ç³»åˆ—ã€‚</p>
<h2 id="2-6-æ£€ç´¢äº¤æ¢é“¾å›¾åƒ"><a href="#2-6-æ£€ç´¢äº¤æ¢é“¾å›¾åƒ" class="headerlink" title="2.6 æ£€ç´¢äº¤æ¢é“¾å›¾åƒ"></a>2.6 æ£€ç´¢äº¤æ¢é“¾å›¾åƒ</h2><p>åˆ›å»ºäº†äº¤æ¢é“¾å¯¹è±¡åï¼Œå°±å¯ä»¥æ£€ç´¢å…¶ä¸­çš„VkImagesçš„å¥æŸ„ï¼Œè¿™äº›VkImagesæ˜¯ç”¨äºåç»­æ¸²æŸ“æ“ä½œçš„ã€‚<br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªSeté›†åˆå­˜å‚¨è¿™äº›VkImages:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">std::vector&lt;VkImage&gt; swapChainImages;</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼äºSurface, è¿™äº›VkImageæ˜¯ä¸éœ€è¦æˆ‘ä»¬ä¸»åŠ¨é”€æ¯çš„ã€‚åœ¨äº¤æ¢é“¾è¢«é”€æ¯æ—¶ï¼ŒVulkanè‡ªåŠ¨å°±ä¼šé”€æ¯è¿™äº›VkImageäº†ã€‚</p>
<p>ä¸€èˆ¬åœ¨vkCreateSwapchainKHRè°ƒç”¨ä¹‹åç«‹å³æ£€ç´¢createSwapChainå‡½æ•°æœ«å°¾çš„å¥æŸ„ã€‚<br>åœ¨äº¤æ¢é“¾ä¸­åªæ˜¯æŒ‡å®šäº†æœ€å°‘æ•°é‡çš„å›¾åƒï¼ŒVulkanå…è®¸å®ç°åˆ›å»ºæ›´å¤šçš„å›¾åƒã€‚åˆ›å»ºåè®°å¾—è°ƒæ•´å®¹å™¨å¤§å°ï¼Œæœ€åå†æ¬¡è°ƒç”¨å®ƒæ¥æ£€ç´¢VkImageã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…ˆè·å–äº¤æ¢é“¾ä¸­å›¾åƒæ•°é‡</span></span><br><span class="line"><span class="built_in">vkGetSwapchainImagesKHR</span>(device, swapChain, &amp;imageCount, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="comment">// è°ƒæ•´seté›†åˆå¤§å°</span></span><br><span class="line">swapChainImages.<span class="built_in">resize</span>(imageCount);</span><br><span class="line"><span class="comment">// è·å–VkImageå¯¹è±¡</span></span><br><span class="line"><span class="built_in">vkGetSwapchainImagesKHR</span>(device, swapChain, &amp;imageCount, swapChainImages.<span class="built_in">data</span>());</span><br></pre></td></tr></table></figure>

<h2 id="2-7-å°ç»“"><a href="#2-7-å°ç»“" class="headerlink" title="2.7 å°ç»“"></a>2.7 å°ç»“</h2><p>è¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒå¤šï¼Œå°ç»“ä¸€ä¸‹ï¼š</p>
<h3 id="2-7-1-ä»€ä¹ˆæ˜¯äº¤æ¢é“¾ï¼Ÿ"><a href="#2-7-1-ä»€ä¹ˆæ˜¯äº¤æ¢é“¾ï¼Ÿ" class="headerlink" title="2.7.1 ä»€ä¹ˆæ˜¯äº¤æ¢é“¾ï¼Ÿ"></a>2.7.1 ä»€ä¹ˆæ˜¯äº¤æ¢é“¾ï¼Ÿ</h3><p>äº¤æ¢é“¾æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç­‰å¾…å‘ˆç°ç»™å±å¹•çš„å›¾åƒé˜Ÿåˆ—ã€‚åº”ç”¨ç¨‹åºå°†è·å–è¿™æ ·çš„å›¾åƒä»¥ç»˜åˆ¶å®ƒï¼Œç„¶åå°†å…¶è¿”å›åˆ°é˜Ÿåˆ—ä¸­ã€‚</p>
<h3 id="2-7-2-åˆ›å»ºäº¤æ¢é“¾çš„ä¸€èˆ¬æ­¥éª¤"><a href="#2-7-2-åˆ›å»ºäº¤æ¢é“¾çš„ä¸€èˆ¬æ­¥éª¤" class="headerlink" title="2.7.2 åˆ›å»ºäº¤æ¢é“¾çš„ä¸€èˆ¬æ­¥éª¤"></a>2.7.2 åˆ›å»ºäº¤æ¢é“¾çš„ä¸€èˆ¬æ­¥éª¤</h3><ol>
<li>ç¡®è®¤å½“å‰ç‰©ç†è®¾å¤‡(GPU)æ˜¯å¦æ”¯æŒäº¤æ¢é“¾</li>
<li>åˆ›å»ºé€»è¾‘è®¾å¤‡æ—¶ï¼Œä½¿èƒ½äº¤æ¢é“¾æ‰©å±•(ppEnabledExtensionNames)</li>
<li>è·å–å½“å‰è®¾å¤‡æ”¯æŒswap chainçš„æ›´å¤šç»†èŠ‚</li>
<li>åˆ›å»ºswap chainå¯¹è±¡<ol>
<li>ç»‘å®šçª—å£Surface</li>
<li>è®¾ç½®æœ€å°å›¾åƒæ•°é‡ minImageCount</li>
<li>é€‰æ‹©åˆé€‚çš„å›¾åƒæ ¼å¼ imageFormat </li>
<li>é€‰æ‹©åˆé€‚çš„å›¾åƒé¢œè‰²ç©ºé—´ imageColorSpace</li>
<li>é€‰æ‹©åˆé€‚çš„å›¾åƒåˆ†è¾¨ç‡ imageExtent</li>
<li>è®¾ç½®å›¾åƒå›¾å±‚ imageArrayLayers</li>
<li>è®¾ç½®å›¾åƒæ“ä½œæ–¹å¼ imageUsage</li>
<li>é€‰æ‹©å›¾åƒå‘ˆç°æ¨¡å¼ presentMode</li>
<li>æ˜¯å¦éœ€è¦è£å‰ªåŠŸèƒ½ clipped(VK_TRUE, VK_FALSE)</li>
<li>è®¾ç½®æ—§äº¤æ¢é“¾çš„å¼•ç”¨ oldSwapchain</li>
</ol>
</li>
<li>è·å–äº¤æ¢é“¾å›¾åƒ(VkImage)å¯¹è±¡é›†åˆ</li>
</ol>
<p>è™½ç„¶åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç¼–å‡ºæ¥çš„ç¨‹åºè¿˜åªæ˜¯ä¸€ä¸ª800*600çš„é»‘çª—å£ã€‚ä½†æ˜¯å·²ç»ä¸‡äº‹å…·å¤‡äº†ï¼Œä¸‹ä¸€æ­¥å°±å¯ä»¥æŠŠå›¾åƒå†…å®¹å‘ˆç°åˆ°çª—å£é‡Œäº†ã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(6)-åˆ›å»ºç®¡é“çš„å‡ ä¸ªå›ºå®šæ“ä½œ</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-6-%E5%88%9B%E5%BB%BA%E7%AE%A1%E9%81%93%E7%9A%84%E5%87%A0%E4%B8%AA%E5%9B%BA%E5%AE%9A%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>å…¶ä»–å›¾å½¢APIä¸ºå›¾å½¢ç®¡é“çš„å¤§å¤šæ•°é˜¶æ®µæä¾›äº†é»˜è®¤çŠ¶æ€ã€‚ä½†åœ¨Vulkanä¸­ï¼Œå¿…é¡»æ˜ç¡®æ‰€æœ‰å†…å®¹ï¼Œä»è§†å£å¤§å°åˆ°é¢œè‰²æ··åˆåŠŸèƒ½ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬è¯•ç€å¡«å†™é…ç½®è¿™äº›å›ºå®šåŠŸèƒ½æ“ä½œçš„æ‰€æœ‰ç»“æ„ã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><h1 id="ä¸€-Vertex-input"><a href="#ä¸€-Vertex-input" class="headerlink" title="ä¸€. Vertex input"></a>ä¸€. Vertex input</h1><p>VkPipelineVertexInputStateCreateInfoç»“æ„æè¿°å°†ä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨çš„é¡¶ç‚¹æ•°æ®çš„æ ¼å¼ã€‚<br>å®ƒä»¥ä¸¤ç§æ–¹å¼æè¿°äº†è¿™ä¸€ç‚¹ï¼š</p>
<ul>
<li>ç»‘å®š( Bindings )ï¼šæ•°æ®ä¹‹é—´çš„é—´è·ä»¥åŠæ•°æ®æ˜¯æŒ‰é¡¶ç‚¹è¿˜æ˜¯æŒ‰å®ä¾‹ï¼ˆè¯·å‚é˜…å®ä¾‹åŒ–ï¼‰</li>
<li>å±æ€§æè¿°( Attribute descriptions )ï¼šä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨çš„å±æ€§çš„ç±»å‹ï¼Œä»å“ªä¸ªç»‘å®šåŠ è½½å®ƒä»¬</li>
</ul>
<p>å› ä¸ºæˆ‘ä»¬ç›´æ¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å¯¹é¡¶ç‚¹æ•°æ®è¿›è¡Œç¡¬ç¼–ç ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å¡«å……æ­¤ç»“æ„ä»¥æŒ‡å®šç°åœ¨æ²¡æœ‰è¦åŠ è½½çš„é¡¶ç‚¹æ•°æ®ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createGraphicsPipeline</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸ºç®¡é“æŒ‡å®šç€è‰²å™¨</span></span><br><span class="line">    VkPipelineShaderStageCreateInfo shaderStages[] =  &#123;vertShaderStageInfo, fragShaderStageInfo&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºé¡¶ç‚¹ç€è‰²å™¨çš„æ•°æ®è¾“å…¥</span></span><br><span class="line">    VkPipelineVertexInputStateCreateInfo vertexInputInfo = &#123;&#125;;</span><br><span class="line">    vertexInputInfo.sType = </span><br><span class="line">            VK_STRUCTURE_TYPE_PIPELINE_VERTEX_INPUT_STATE_CREATE_INFO;</span><br><span class="line"></span><br><span class="line">    vertexInputInfo.vertexBindingDescriptionCount = <span class="number">0</span>;</span><br><span class="line">    vertexInputInfo.pVertexBindingDescriptions = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">    vertexInputInfo.vertexAttributeDescriptionCount = <span class="number">0</span>;</span><br><span class="line">    vertexInputInfo.pVertexAttributeDescriptions = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>pVertexBindingDescriptionså’ŒpVertexAttributeDescriptions æˆå‘˜æŒ‡å‘ä¸€ä¸ªç»“æ„æ•°ç»„ï¼Œæè¿°å‰é¢æåˆ°çš„åŠ è½½é¡¶ç‚¹æ•°æ®çš„ç»†èŠ‚ã€‚<br>åç»­åœ¨å­¦ä¹ é¡¶ç‚¹ç¼“å†²çš„æ—¶å€™è¯¦ç»†åˆ†æã€‚</p>
<h1 id="äºŒ-Input-assembly"><a href="#äºŒ-Input-assembly" class="headerlink" title="äºŒ. Input assembly"></a>äºŒ. Input assembly</h1><p>VkPipelineInputAssemblyStateCreateInfoç»“æ„æè¿°äº†ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å°†ä»é¡¶ç‚¹ç»˜åˆ¶ä»€ä¹ˆç±»å‹çš„å‡ ä½•, ç”±æˆå‘˜å˜é‡topology æŒ‡å®šã€‚å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å€¼ï¼š<ul>
<li>VK_PRIMITIVE_TOPOLOGY_POINT_LISTï¼šæ¥è‡ªé¡¶ç‚¹çš„ç‚¹</li>
<li>VK_PRIMITIVE_TOPOLOGY_LINE_LISTï¼šæ¥è‡ªæ¯2ä¸ªé¡¶ç‚¹çš„è¡Œè€Œä¸é‡ç”¨</li>
<li>VK_PRIMITIVE_TOPOLOGY_LINE_STRIPï¼šæ¯è¡Œçš„ç»“æŸé¡¶ç‚¹ç”¨ä½œä¸‹ä¸€è¡Œçš„èµ·å§‹é¡¶ç‚¹</li>
<li>VK_PRIMITIVE_TOPOLOGY_TRIANGLE_LISTï¼šæ¯3ä¸ªé¡¶ç‚¹çš„ä¸‰è§’å½¢ï¼Œæ— éœ€é‡å¤ä½¿ç”¨</li>
<li>VK_PRIMITIVE_TOPOLOGY_TRIANGLE_STRIPï¼šæ¯ä¸ªä¸‰è§’å½¢çš„ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªé¡¶ç‚¹ç”¨ä½œä¸‹ä¸€ä¸ªä¸‰è§’å½¢çš„å‰ä¸¤ä¸ªé¡¶ç‚¹</li>
</ul>
</li>
<li>æ˜¯å¦åº”å¯ç”¨åŸºå…ƒé‡å¯ã€‚</li>
</ol>
<p>é€šå¸¸ï¼Œé¡¶ç‚¹ç¼“å†²åŒºæŒ‰é¡ºåºä»é¡¶ç‚¹ç¼“å†²åŒºåŠ è½½ï¼Œä½†æ˜¯ä½¿ç”¨å…ƒç´ ç¼“å†²åŒºå¯ä»¥æŒ‡å®šè¦è‡ªå·±ä½¿ç”¨çš„ç´¢å¼•ï¼Œè¿™å…è®¸æ‚¨æ‰§è¡Œé‡ç”¨é¡¶ç‚¹ç­‰ä¼˜åŒ–ã€‚<br>å¦‚æœå°†primitiveRestartEnableæˆå‘˜è®¾ç½®ä¸ºVK_TRUEï¼Œåˆ™å¯ä»¥é€šè¿‡ä½¿ç”¨ç‰¹æ®Šç´¢å¼•0xFFFFæˆ–0xFFFFFFFFæ¥åˆ†è§£_STRIPæ‹“æ‰‘æ¨¡å¼ä¸­çš„è¡Œå’Œä¸‰è§’å½¢ã€‚</p>
<p>å¦‚æœæ˜¯ç»˜åˆ¶ä¸‰è§’å½¢ï¼Œåˆ›å»ºå¦‚ä¸‹çš„ VkPipelineInputAssemblyStateCreateInfoï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineInputAssemblyStateCreateInfo inputAssembly = &#123;&#125;;</span><br><span class="line">inputAssembly.sType =</span><br><span class="line">        VK_STRUCTURE_TYPE_PIPELINE_INPUT_ASSEMBLY_STATE_CREATE_INFO;</span><br><span class="line">inputAssembly.topology = VK_PRIMITIVE_TOPOLOGY_TRIANGLE_LIST;</span><br><span class="line">inputAssembly.primitiveRestartEnable = VK_FALSE;</span><br></pre></td></tr></table></figure>

<h1 id="ä¸‰-Viewports-and-scissors"><a href="#ä¸‰-Viewports-and-scissors" class="headerlink" title="ä¸‰. Viewports and scissors"></a>ä¸‰. Viewports and scissors</h1><h2 id="3-1-Viewports"><a href="#3-1-Viewports" class="headerlink" title="3.1 Viewports"></a>3.1 Viewports</h2><p>è§†çª—æè¿°äº†è¾“å‡ºå°†è¢«æ¸²æŸ“åˆ°çš„å¸§ç¼“å†²åŒºåŸŸã€‚ åŸºæœ¬æ€»æ˜¯ï¼ˆ0,0ï¼‰åˆ°ï¼ˆå®½åº¦ï¼Œé«˜åº¦ï¼‰ï¼Œä¹Ÿå°±æ˜¯çª—å£å¤§å°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkViewport viewport = &#123;&#125;;</span><br><span class="line">viewport.x = <span class="number">0.0f</span>;</span><br><span class="line">viewport.y = <span class="number">0.0f</span>;</span><br><span class="line">viewport.width = (<span class="type">float</span>) swapChainExtent.width; <span class="comment">// äº¤æ¢é“¾ï¼Œå³å¸§ç¼“å†²åŒº</span></span><br><span class="line">viewport.height = (<span class="type">float</span>) swapChainExtent.height;</span><br><span class="line">viewport.minDepth = <span class="number">0.0f</span>;</span><br><span class="line">viewport.maxDepth = <span class="number">1.0f</span>;</span><br></pre></td></tr></table></figure>
<p>äº¤æ¢é“¾åŠå…¶å›¾åƒçš„å¤§å°å¯èƒ½ä¸çª—å£çš„å®½åº¦å’Œé«˜åº¦ä¸åŒã€‚ äº¤æ¢é“¾å›¾åƒå°†åœ¨ä»¥åç”¨ä½œå¸§ç¼“å†²åŒºï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½è½»æ˜“æ”¹å˜å®ƒä»¬çš„å¤§å°ã€‚<br>minDepthå’ŒmaxDepthå€¼æŒ‡å®šç”¨äºå¸§ç¼“å†²åŒºçš„æ·±åº¦å€¼èŒƒå›´ã€‚ è¿™äº›å€¼å¿…é¡»åœ¨[0.0fï¼Œ1.0f]èŒƒå›´å†…ï¼Œä½†minDepthå¯èƒ½é«˜äºmaxDepthã€‚<br>è™½ç„¶è§†çª—å®šä¹‰äº†ä»å›¾åƒåˆ°å¸§ç¼“å†²çš„è½¬æ¢ï¼Œä½†å‰ªåˆ€çŸ©å½¢å®šä¹‰äº†å®é™…å­˜å‚¨åƒç´ çš„åŒºåŸŸã€‚<br>å‰ªåˆ€çŸ©å½¢å¤–çš„ä»»ä½•åƒç´ éƒ½å°†è¢«å…‰æ …åŒ–å™¨ä¸¢å¼ƒã€‚ å®ƒä»¬çš„åŠŸèƒ½ç±»ä¼¼äºè¿‡æ»¤å™¨è€Œä¸æ˜¯è½¬æ¢ã€‚<br>å·®å¼‚å¦‚ä¸‹æ‰€ç¤ºã€‚ è¯·æ³¨æ„ï¼Œå·¦è¾¹çš„å‰ªåˆ€çŸ©å½¢åªæ˜¯å¯¼è‡´è¯¥å›¾åƒçš„ä¼—å¤šå¯èƒ½æ€§ä¹‹ä¸€ï¼Œåªè¦å®ƒæ¯”è§†å£å¤§ï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-6-%E5%88%9B%E5%BB%BA%E7%AE%A1%E9%81%93%E7%9A%84%E5%87%A0%E4%B8%AA%E5%9B%BA%E5%AE%9A%E6%93%8D%E4%BD%9C/Vulkan_6_1.png" alt="å›¾ç‰‡"></p>
<p>ä¹Ÿå°±æ˜¯è¯´Viewportä¼šç¼©æ”¾ä»¥æ˜¾ç¤ºå®Œæ•´çš„å›¾ç‰‡ï¼Œè€Œscissorsä¼šè£å‰ª(æˆ–è€…è¯´é®æŒ¡)å›¾ç‰‡å†…å®¹ã€‚</p>
<h2 id="3-2-Scissors"><a href="#3-2-Scissors" class="headerlink" title="3.2 Scissors"></a>3.2 Scissors</h2><p>ç®€å•å®šä¹‰ä¸€ä¸ªå¯ä»¥ç»˜åˆ¶æ•´ä¸ªå¸§ç¼“å†²çš„Scissor:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkRect2D scissor = &#123;&#125;;</span><br><span class="line">scissor.offset = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">scissor.extent = swapChainExtent;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-ä½¿ç”¨æ–¹å¼"><a href="#3-3-ä½¿ç”¨æ–¹å¼" class="headerlink" title="3.3 ä½¿ç”¨æ–¹å¼"></a>3.3 ä½¿ç”¨æ–¹å¼</h2><p>ç°åœ¨ä½¿ç”¨VkPipelineViewportStateCreateInfoç»“æ„å°†æ­¤è§†å£å’Œå‰ªåˆ€çŸ©å½¢ç»„åˆæˆè§†å£çŠ¶æ€ã€‚<br>å¯ä»¥åœ¨æŸäº›å›¾å½¢å¡ä¸Šä½¿ç”¨å¤šä¸ªè§†å£å’Œå‰ªåˆ€çŸ©å½¢ï¼Œå› æ­¤å…¶æˆå‘˜éœ€è¦å¼•ç”¨å®ƒä»¬çš„æ•°ç»„ã€‚ä½¿ç”¨å¤šä¸ªéœ€è¦å¯ç”¨GPUåŠŸèƒ½ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineViewportStateCreateInfo viewportState = &#123;&#125;;</span><br><span class="line">viewportState.sType =</span><br><span class="line">        VK_STRUCTURE_TYPE_PIPELINE_VIEWPORT_STATE_CREATE_INFO;</span><br><span class="line">viewportState.viewportCount = <span class="number">1</span>;</span><br><span class="line">viewportState.pViewports = &amp;viewport;</span><br><span class="line">viewportState.scissorCount = <span class="number">1</span>;</span><br><span class="line">viewportState.pScissors = &amp;scissor;</span><br></pre></td></tr></table></figure>

<h1 id="å››-Rasterizer-å…‰æ …åŒ–"><a href="#å››-Rasterizer-å…‰æ …åŒ–" class="headerlink" title="å››. Rasterizer (å…‰æ …åŒ–)"></a>å››. Rasterizer (å…‰æ …åŒ–)</h1><p>å…‰æ …åŒ–å™¨é‡‡ç”¨ç”±é¡¶ç‚¹ç€è‰²å™¨çš„é¡¶ç‚¹æ•´å½¢çš„å‡ ä½•ä½“ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºç‰‡æ®µç€è‰²å™¨ç€è‰²çš„ç‰‡æ®µã€‚<br>å®ƒè¿˜å¯ä»¥æ‰§è¡Œæ·±åº¦æµ‹è¯•ï¼Œé¢éƒ¨å‰”é™¤å’Œå‰ªåˆ€æµ‹è¯•ï¼Œå¹¶ä¸”å¯ä»¥é…ç½®ä¸ºè¾“å‡ºå¡«å……æ•´ä¸ªå¤šè¾¹å½¢æˆ–ä»…å¡«å……è¾¹ç¼˜çš„ç‰‡æ®µï¼ˆçº¿æ¡†æ¸²æŸ“ï¼‰ã€‚<br>æ‰€æœ‰è¿™äº›éƒ½æ˜¯ä½¿ç”¨VkPipelineRasterizationStateCreateInfoç»“æ„é…ç½®çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineRasterizationStateCreateInfo rasterizer = &#123;&#125;;</span><br><span class="line">rasterizer.sType =</span><br><span class="line">    VK_STRUCTURE_TYPE_PIPELINE_RASTERIZATION_STATE_CREATE_INFO;</span><br><span class="line">rasterizer.depthClampEnable = VK_FALSE;</span><br><span class="line">rasterizer.rasterizerDiscardEnable = VK_FALSE;</span><br><span class="line">rasterizer.polygonMode = VK_POLYGON_MODE_FILL;</span><br><span class="line">rasterizer.lineWidth = <span class="number">1.0f</span>;</span><br><span class="line">rasterizer.cullMode = VK_CULL_MODE_BACK_BIT;</span><br><span class="line">rasterizer.frontFace = VK_FRONT_FACE_CLOCKWISE;</span><br><span class="line">rasterizer.depthBiasEnable = VK_FALSE;</span><br><span class="line">rasterizer.depthBiasConstantFactor = <span class="number">0.0f</span>; <span class="comment">// Optional</span></span><br><span class="line">rasterizer.depthBiasClamp = <span class="number">0.0f</span>; <span class="comment">// Optional</span></span><br><span class="line">rasterizer.depthBiasSlopeFactor = <span class="number">0.0f</span>; <span class="comment">// Optional</span></span><br></pre></td></tr></table></figure>
<ol>
<li>depthClampEnable: è®¾ç½®ä¸ºVK_TRUEï¼Œé‚£ä¹ˆè¶…å‡ºè¿‘å¹³é¢å’Œè¿œå¹³é¢çš„fragmentå°†è¢«å¤¹ä½ï¼Œè€Œä¸æ˜¯ä¸¢å¼ƒå®ƒä»¬ã€‚è¿™åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚é˜´å½±è´´å›¾ã€‚ä½¿ç”¨æ­¤åŠŸèƒ½éœ€è¦å¯ç”¨GPUåŠŸèƒ½ã€‚</li>
<li>rasterizerDiscardEnable: è®¾ç½®ä¸ºVK_TRUEï¼Œé‚£ä¹ˆå‡ ä½•å›¾å½¢æ°¸è¿œä¸ä¼šé€šè¿‡å…‰æ …åŒ–é˜¶æ®µã€‚è¿™åŸºæœ¬ä¸Šç¦æ­¢ä»»ä½•è¾“å‡ºåˆ°å¸§ç¼“å†²åŒºã€‚</li>
<li>polygonMode: å¤šè¾¹å½¢æ¨¡æ€å†³å®šäº†å¦‚ä½•ä¸ºå‡ ä½•å›¾å½¢ç”Ÿæˆfragmentã€‚æœ‰ä»¥ä¸‹å‡ ç§æ¨¡å¼:(ä½¿ç”¨FILLä»¥å¤–çš„ä»»ä½•æ¨¡å¼éƒ½éœ€è¦å¯ç”¨GPUåŠŸèƒ½)<ol>
<li>VK_POLYGON_MODE_FILL: ç”¨fragmentå¡«å……å¤šè¾¹å½¢çš„åŒºåŸŸ</li>
<li>VK_POLYGON_MODE_LINE: å¤šè¾¹å½¢è¾¹ç¼˜ä»¥ç›´çº¿çš„å½¢å¼ç»˜åˆ¶</li>
<li>VK_POLYGON_MODE_POINT: ç”¨ç‚¹ç»˜åˆ¶å¤šè¾¹å½¢é¡¶ç‚¹</li>
</ol>
</li>
<li>lineWidth: ç”¨æ¥æè¿°çº¿æ¡çš„ç²—ç»†ã€‚æ”¯æŒçš„æœ€å¤§çº¿å®½å–å†³äºç¡¬ä»¶ï¼Œä»»ä½•è¶…è¿‡1.0fçš„çº¿è·¯éƒ½éœ€è¦å¯ç”¨å®½å¸¦GPUåŠŸèƒ½ã€‚</li>
<li>cullMode: ç¡®å®šè¦ä½¿ç”¨çš„é¢æ¶ˆéšçš„ç±»å‹ã€‚å¯ä»¥ç¦ç”¨æ¶ˆéšã€æ¶ˆéšæ­£é¢ã€æ¶ˆéšèƒŒé¢æˆ–ä¸¤è€…å…¼æœ‰ã€‚</li>
<li>frontFace: æŒ‡å®šè¦è§†ä¸ºæ­£é¢çš„é¢çš„é¡¶ç‚¹é¡ºåºï¼Œå¯ä»¥æ˜¯é¡ºæ—¶é’ˆæˆ–é€†æ—¶é’ˆã€‚</li>
</ol>
<p>å…‰æ …åŒ–å™¨å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ªå¸¸é‡å€¼æˆ–æ ¹æ®fragmentçš„å¡åº¦å¯¹æ·±åº¦å€¼è¿›è¡Œåç§»æ¥æ”¹å˜æ·±åº¦å€¼ã€‚è¿™æœ‰æ—¶ç”¨äºé˜´å½±æ˜ å°„ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨æ—¶åªéœ€å°†depthBiasEnableè®¾ç½®ä¸ºVK_FALSEã€‚</p>
<h1 id="äº”-Multisampling-å¤šé‡é‡‡æ ·"><a href="#äº”-Multisampling-å¤šé‡é‡‡æ ·" class="headerlink" title="äº”. Multisampling å¤šé‡é‡‡æ ·"></a>äº”. Multisampling å¤šé‡é‡‡æ ·</h1><p>VkPipelineMultisampleStateCreateInfoç»“æ„ä½“ç”¨äºé…ç½®vulkanä¸­çš„å¤šé‡é‡‡æ ·ã€‚</p>
<p>æ˜¯é€šè¿‡å°†å…‰æ …åŒ–ä¸ºåŒä¸€åƒç´ çš„å¤šä¸ªå¤šè¾¹å½¢çš„ç‰‡æ®µç€è‰²å™¨ç»“æœç»„åˆåœ¨ä¸€èµ·å®ç°çš„ï¼Œè¿™ä¹Ÿæ˜¯æŠ—é”¯é½¿çš„æ–¹å¼ä¹‹ä¸€ã€‚ä¸»è¦æ˜¯åœ¨å›¾å½¢è¾¹ç¼˜åœ°åŒºåšå¤šé‡é‡‡æ ·ï¼Œè¿™æ˜¯æœ€æ˜æ˜¾çš„é”¯é½¿ä¼ªå½±å‘ç”Ÿçš„åœ°æ–¹ã€‚</p>
<p>å¦‚æœåªæœ‰ä¸€ä¸ªå¤šè¾¹å½¢æ˜ å°„åˆ°ä¸€ä¸ªåƒç´ ï¼Œå®ƒä¸éœ€è¦å¤šæ¬¡è¿è¡Œç‰‡æ®µç€è‰²å™¨ï¼Œå› æ­¤å®ƒæ¯”ç®€å•åœ°æ¸²æŸ“åˆ°æ›´é«˜çš„åˆ†è¾¨ç‡ç„¶åç¼©å°æ¯”ä¾‹çš„å¼€é”€å°å¾—å¤šã€‚</p>
<p>å¯ç”¨å¤šé‡é‡‡æ ·éœ€è¦å¯ç”¨GPUåŠŸèƒ½ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineMultisampleStateCreateInfo multisampling = &#123;&#125;;</span><br><span class="line">multisampling.sType = VK_STRUCTURE_TYPE_PIPELINE_MULTISAMPLE_STATE_CREATE_INFO;</span><br><span class="line">multisampling.sampleShadingEnable = VK_FALSE;</span><br><span class="line">multisampling.rasterizationSamples = VK_SAMPLE_COUNT_1_BIT;</span><br><span class="line">multisampling.minSampleShading = <span class="number">1.0f</span>; <span class="comment">// Optional</span></span><br><span class="line">multisampling.pSampleMask = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">multisampling.alphaToCoverageEnable = VK_FALSE; <span class="comment">// Optional</span></span><br><span class="line">multisampling.alphaToOneEnable = VK_FALSE;</span><br></pre></td></tr></table></figure>

<ol>
<li>sampleShadingEnable:  å¯ç”¨äºå¯ç”¨é‡‡æ ·ç€è‰²ã€‚</li>
<li>rasterizationSamples: æŒ‡å®šç”¨äºå…‰æ …åŒ–çš„æ ·æœ¬æ•°, ä¸€å…±æœ‰7ä¸ªå¯é€‰<ol>
<li>VK_SAMPLE_COUNT_1_BIT: æŒ‡å®šæ¯åƒç´ 1ä¸ªé‡‡æ ·çš„å›¾åƒã€‚</li>
<li>VK_SAMPLE_COUNT_2_BIT: æŒ‡å®šæ¯åƒç´ 2ä¸ªé‡‡æ ·çš„å›¾åƒã€‚</li>
<li>VK_SAMPLE_COUNT_4_BIT: æŒ‡å®šæ¯åƒç´ 4ä¸ªé‡‡æ ·çš„å›¾åƒã€‚</li>
<li>VK_SAMPLE_COUNT_8_BIT: æŒ‡å®šæ¯åƒç´ 8ä¸ªé‡‡æ ·çš„å›¾åƒã€‚</li>
<li>VK_SAMPLE_COUNT_16_BIT: æŒ‡å®šæ¯åƒç´ 16ä¸ªé‡‡æ ·çš„å›¾åƒã€‚</li>
<li>VK_SAMPLE_COUNT_32_BIT: æŒ‡å®šæ¯åƒç´ 32ä¸ªé‡‡æ ·çš„å›¾åƒã€‚</li>
<li>VK_SAMPLE_COUNT_64_BIT: æŒ‡å®šæ¯åƒç´ 64ä¸ªé‡‡æ ·çš„å›¾åƒã€‚</li>
</ol>
</li>
<li>minSampleShading: è‹¥sampleShadingEnableè®¾ç½®ä¸ºVK_TRUEï¼Œåˆ™æŒ‡å®šé‡‡æ ·ç€è‰²çš„æœ€å°éƒ¨åˆ†ã€‚</li>
</ol>
<p>åç»­è¯¦ç»†ç ”ç©¶ï¼Œå½“å‰å…ˆæš‚æ—¶å…³é—­è¯¥åŠŸèƒ½ã€‚</p>
<h1 id="å…­-Color-blending-é¢œè‰²æ··åˆ"><a href="#å…­-Color-blending-é¢œè‰²æ··åˆ" class="headerlink" title="å…­. Color blending é¢œè‰²æ··åˆ"></a>å…­. Color blending é¢œè‰²æ··åˆ</h1><p>ç‰‡æ®µç€è‰²å™¨è¿”å›é¢œè‰²åï¼Œéœ€è¦å°†å…¶ä¸å¸§ç¼“å†²åŒºä¸­å·²æœ‰çš„é¢œè‰²ç»„åˆã€‚è¿™ç§è½¬æ¢ç§°ä¸ºé¢œè‰²æ··åˆï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ol>
<li>å°†æ–°æ—§å€¼æ··åˆç”Ÿæˆæœ€ç»ˆé¢œè‰²</li>
<li>ä½¿ç”¨ä½è¿ç®—ç»„åˆæ–°æ—§å€¼</li>
</ol>
<p>æœ‰ä¸¤ç§ç±»å‹çš„ç»“æ„å¯ä»¥é…ç½®é¢œè‰²æ··åˆã€‚</p>
<ol>
<li>VkPipelineColorBlendAttachmentState: åŒ…å«æ¯ä¸ªé™„åŠ å¸§ç¼“å†²åŒºçš„é…ç½®ï¼Œ</li>
<li>VkPipelineColorBlendStateCreateInfo: åŒ…å«å…¨å±€é¢œè‰²æ··åˆè®¾ç½®ã€‚</li>
</ol>
<h2 id="6-1-VkPipelineColorBlendAttachmentState-ç»“æ„"><a href="#6-1-VkPipelineColorBlendAttachmentState-ç»“æ„" class="headerlink" title="6.1 VkPipelineColorBlendAttachmentState ç»“æ„"></a>6.1 VkPipelineColorBlendAttachmentState ç»“æ„</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineColorBlendAttachmentState colorBlendAttachment = &#123;&#125;;</span><br><span class="line">colorBlendAttachment.colorWriteMask = VK_COLOR_COMPONENT_R_BIT | VK_COLOR_COMPONENT_G_BIT</span><br><span class="line">                                    | VK_COLOR_COMPONENT_B_BIT | VK_COLOR_COMPONENT_A_BIT;</span><br><span class="line">colorBlendAttachment.blendEnable = VK_FALSE;</span><br><span class="line">colorBlendAttachment.srcColorBlendFactor = VK_BLEND_FACTOR_ONE;</span><br><span class="line"><span class="comment">// Optional</span></span><br><span class="line">colorBlendAttachment.dstColorBlendFactor = VK_BLEND_FACTOR_ZERO;</span><br><span class="line"><span class="comment">// Optional</span></span><br><span class="line">colorBlendAttachment.colorBlendOp = VK_BLEND_OP_ADD; <span class="comment">// Optional</span></span><br><span class="line">colorBlendAttachment.srcAlphaBlendFactor = VK_BLEND_FACTOR_ONE;</span><br><span class="line"><span class="comment">// Optional</span></span><br><span class="line">colorBlendAttachment.dstAlphaBlendFactor = VK_BLEND_FACTOR_ZERO;</span><br><span class="line"><span class="comment">// Optional</span></span><br><span class="line">colorBlendAttachment.alphaBlendOp = VK_BLEND_OP_ADD; <span class="comment">// Optional</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ¯å¸§ç¼“å†²åŒºç»“æ„å…è®¸æ‚¨é…ç½®é¢œè‰²æ··åˆçš„ç¬¬ä¸€ç§æ–¹å¼ã€‚å°†è¦æ‰§è¡Œçš„æ“ä½œä½¿ç”¨ä»¥ä¸‹ä¼ªä»£ç æ¼”ç¤ºåŸç†ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (blendEnable) &#123;</span><br><span class="line">    finalColor.rgb = (srcColorBlendFactor * newColor.rgb)</span><br><span class="line">                &lt;colorBlendOp&gt; (dstColorBlendFactor * oldColor.rgb);</span><br><span class="line">    finalColor.a = (srcAlphaBlendFactor * newColor.a)</span><br><span class="line">                &lt;alphaBlendOp&gt; (dstAlphaBlendFactor * oldColor.a);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    finalColor = newColor;</span><br><span class="line">&#125;</span><br><span class="line">finalColor = finalColor &amp; colorWriteMask;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœblendEnableè®¾ç½®ä¸ºVK_FALSEï¼Œåˆ™ç‰‡æ®µç€è‰²å™¨ä¸­çš„æ–°é¢œè‰²å°†ä¸ç»ä¿®æ”¹åœ°é€šè¿‡ã€‚å¦åˆ™ï¼Œæ‰§è¡Œè¿™ä¸¤ä¸ªæ··åˆæ“ä½œæ¥è®¡ç®—æ–°é¢œè‰²ã€‚<br>ç”Ÿæˆçš„é¢œè‰²ä¸colorWriteMaskè¿›è¡ŒANDè¿ç®—ï¼Œä»¥ç¡®å®šå®é™…é€šè¿‡å“ªäº›é€šé“ã€‚</p>
<p>ä½¿ç”¨é¢œè‰²æ··åˆæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯å®ç°alphaæ··åˆï¼Œæˆ‘ä»¬å¸Œæœ›æ–°é¢œè‰²ä¸åŸºäºä¸é€æ˜åº¦çš„æ—§é¢œè‰²æ··åˆã€‚æœ€ç»ˆé¢œè‰²çš„è®¡ç®—å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">finalColor.rgb = newAlpha * newColor + (<span class="number">1</span> - newAlpha) * oldColor;</span><br><span class="line">finalColor.a = newAlpha.a;</span><br></pre></td></tr></table></figure>

<p>è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹å‚æ•°å®ç°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®ç°alphaæ··åˆ</span></span><br><span class="line">colorBlendAttachment.blendEnable = VK_TRUE;</span><br><span class="line">colorBlendAttachment.srcColorBlendFactor = VK_BLEND_FACTOR_SRC_ALPHA;</span><br><span class="line">colorBlendAttachment.dstColorBlendFactor = VK_BLEND_FACTOR_ONE_MINUS_SRC_ALPHA;</span><br><span class="line">colorBlendAttachment.colorBlendOp = VK_BLEND_OP_ADD;</span><br><span class="line">colorBlendAttachment.srcAlphaBlendFactor = VK_BLEND_FACTOR_ONE;</span><br><span class="line">colorBlendAttachment.dstAlphaBlendFactor = VK_BLEND_FACTOR_ZERO;</span><br><span class="line">colorBlendAttachment.alphaBlendOp = VK_BLEND_OP_ADD;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥åœ¨VkBlendFactorå’ŒVkBlendOpä¸­æ‰¾åˆ°æ‰€æœ‰å¯ç”¨çš„æ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th>VkBlendFactor</th>
<th>RGB Blend Factors (Sr,Sg,Sb) or (Dr,Dg,Db)</th>
<th>Alpha Blend Factor (Sa or Da)</th>
</tr>
</thead>
<tbody><tr>
<td>VK_BLEND_FACTOR_ZERO</td>
<td>(0,0,0)</td>
<td>0</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE</td>
<td>(1,1,1)</td>
<td>1</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_SRC_COLOR</td>
<td>(Rs0,Gs0,Bs0)</td>
<td>As0</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_SRC_COLOR</td>
<td>(1-Rs0,1-Gs0,1-Bs0)</td>
<td>1-As0</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_DST_COLOR</td>
<td>(Rd,Gd,Bd)</td>
<td>Ad</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_DST_COLOR</td>
<td>(1-Rd,1-Gd,1-Bd)</td>
<td>1-Ad</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_SRC_ALPHA</td>
<td>(As0,As0,As0)</td>
<td>As0</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_SRC_ALPHA</td>
<td>(1-As0,1-As0,1-As0)</td>
<td>1-As0</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_DST_ALPHA</td>
<td>(Ad,Ad,Ad)</td>
<td>Ad</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_DST_ALPHA</td>
<td>(1-Ad,1-Ad,1-Ad)</td>
<td>1-Ad</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_CONSTANT_COLOR</td>
<td>(Rc,Gc,Bc)</td>
<td>Ac</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_CONSTANT_COLOR</td>
<td>(1-Rc,1-Gc,1-Bc)</td>
<td>1-Ac</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_CONSTANT_ALPHA</td>
<td>(Ac,Ac,Ac)</td>
<td>Ac</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_CONSTANT_ALPHA</td>
<td>(1-Ac,1-Ac,1-Ac)</td>
<td>1-Ac</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_SRC_ALPHA_SATURATE</td>
<td>(f,f,f); f &#x3D; min(As0,1-Ad)</td>
<td>1</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_SRC1_COLOR</td>
<td>(Rs1,Gs1,Bs1)</td>
<td>As1</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_SRC1_COLOR</td>
<td>(1-Rs1,1-Gs1,1-Bs1)</td>
<td>1-As1</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_SRC1_ALPHA</td>
<td>(As1,As1,As1)</td>
<td>As1</td>
</tr>
<tr>
<td>VK_BLEND_FACTOR_ONE_MINUS_SRC1_ALPHA</td>
<td>(1-As1,1-As1,1-As1)</td>
<td>1-As1</td>
</tr>
</tbody></table>
<p>å¤‡æ³¨:</p>
<ol>
<li>Rs0ã€Gs0ã€Bs0å’ŒAs0åˆ†åˆ«è¡¨ç¤ºä¸æ­£åœ¨æ··åˆçš„é¢œè‰²é™„ä»¶ç›¸å¯¹åº”çš„ç‰‡æ®µè¾“å‡ºä½ç½®çš„ç¬¬ä¸€æºé¢œè‰²Rã€Gã€Bå’ŒAåˆ†é‡ã€‚</li>
<li>Rs1ã€Gs1ã€Bs1å’ŒAs1åˆ†åˆ«è¡¨ç¤ºç¬¬äºŒæºé¢œè‰²Rã€Gã€Bå’ŒAåˆ†é‡ï¼Œç”¨äºå¯¹åº”äºè¢«æ··åˆçš„é¢œè‰²é™„ä»¶çš„ç‰‡æ®µè¾“å‡ºä½ç½®ï¼Œè¿™äº›åˆ†é‡åœ¨åŒæºæ··åˆæ¨¡å¼ä¸­ä½¿ç”¨ã€‚</li>
<li>Rdã€Gdã€Bdå’ŒAdè¡¨ç¤ºç›®çš„é¢œè‰²çš„Rã€Gã€Bå’ŒAåˆ†é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤ç‰‡æ®µ&#x2F;æ ·æœ¬çš„ç›¸åº”é¢œè‰²é™„ä»¶ä¸­å½“å‰çš„é¢œè‰²ã€‚</li>
<li>Rcã€Gcã€Bcå’ŒAcåˆ†åˆ«è¡¨ç¤ºæ··åˆå¸¸æ•°Rã€Gã€Bå’ŒAç»„åˆ†ã€‚</li>
</ol>
<p>é€‰æ‹©æºå’Œç›®æ ‡æ··åˆå› å­åï¼Œå®ƒä»¬è¿åŒæºå’Œç›®æ ‡ç»„ä»¶ä¸€èµ·ä¼ é€’ç»™æ··åˆæ“ä½œã€‚RGBå’Œalphaç»„ä»¶å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ“ä½œã€‚æŒ‡å®šæ“ä½œçš„VkBlendOpçš„å¯èƒ½å€¼ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>VkBlendOp</th>
<th>RGB Components</th>
<th>Alpha Component</th>
</tr>
</thead>
<tbody><tr>
<td>VK_BLEND_OP_ADD</td>
<td>R &#x3D; Rs0 Ã— Sr + Rd Ã— Dr<br>G &#x3D; Gs0 Ã— Sg + Gd Ã— Dg<br>B &#x3D; Bs0 Ã— Sb + Bd Ã— Db</td>
<td>A &#x3D; As0 Ã— Sa + Ad Ã— Da</td>
</tr>
<tr>
<td>VK_BLEND_OP_SUBTRACT</td>
<td>R &#x3D; Rs0 Ã— Sr - Rd Ã— Dr<br>G &#x3D; Gs0 Ã— Sg - Gd Ã— Dg<br>B &#x3D; Bs0 Ã— Sb - Bd Ã— Db</td>
<td>A &#x3D; As0 Ã— Sa - Ad Ã— Da</td>
</tr>
<tr>
<td>VK_BLEND_OP_REVERSE_SUBTRACT</td>
<td>R &#x3D; Rd Ã— Dr - Rs0 Ã— Sr<br>G &#x3D; Gd Ã— Dg - Gs0 Ã— Sg<br>B &#x3D; Bd Ã— Db - Bs0 Ã— Sb</td>
<td>A &#x3D; Ad Ã— Da - As0 Ã— Sa</td>
</tr>
<tr>
<td>VK_BLEND_OP_MIN</td>
<td>R &#x3D; min(Rs0,Rd)<br>G &#x3D; min(Gs0,Gd)<br>B &#x3D; min(Bs0,Bd)</td>
<td>A &#x3D; min(As0,Ad)</td>
</tr>
<tr>
<td>VK_BLEND_OP_MAX</td>
<td>R &#x3D; max(Rs0,Rd)<br>G &#x3D; max(Gs0,Gd)<br>B &#x3D; max(Bs0,Bd)</td>
<td>A &#x3D; max(As0,Ad)</td>
</tr>
</tbody></table>
<p>å¤‡æ³¨:</p>
<ol>
<li>Rs0ã€Gs0ã€Bs0å’ŒAs0åˆ†åˆ«è¡¨ç¤ºç¬¬ä¸€æºé¢œè‰²Rã€Gã€Bå’ŒAåˆ†é‡ã€‚</li>
<li>Rdã€Gdã€Bdå’ŒAdè¡¨ç¤ºç›®çš„é¢œè‰²çš„Rã€Gã€Bå’ŒAåˆ†é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤ç‰‡æ®µ&#x2F;æ ·æœ¬çš„ç›¸åº”é¢œè‰²é™„ä»¶ä¸­å½“å‰çš„é¢œè‰²ã€‚</li>
<li>Srã€Sgã€Sbå’ŒSaåˆ†åˆ«è¡¨ç¤ºæºæ··åˆå› å­Rã€Gã€Bå’ŒAç»„åˆ†ã€‚</li>
<li>Drã€Dgã€Dbå’ŒDaåˆ†åˆ«è¡¨ç¤ºç›®æ ‡æ··åˆå› å­Rã€Gã€Bå’ŒAåˆ†é‡ã€‚</li>
</ol>
<h2 id="6-2-VkPipelineColorBlendStateCreateInfo-å…¨å±€é¢œè‰²æ··åˆè®¾ç½®"><a href="#6-2-VkPipelineColorBlendStateCreateInfo-å…¨å±€é¢œè‰²æ··åˆè®¾ç½®" class="headerlink" title="6.2 VkPipelineColorBlendStateCreateInfo å…¨å±€é¢œè‰²æ··åˆè®¾ç½®"></a>6.2 VkPipelineColorBlendStateCreateInfo å…¨å±€é¢œè‰²æ··åˆè®¾ç½®</h2><p>VkPipelineColorBlendStateCreateInfoç»“æ„å¼•ç”¨æ‰€æœ‰å¸§ç¼“å†²åŒºçš„ç»“æ„æ•°ç»„ï¼Œå¹¶å…è®¸æ‚¨è®¾ç½®å¯ä»¥åœ¨ä¸Šè¿°è®¡ç®—ä¸­ç”¨ä½œæ··åˆå› å­çš„æ··åˆå¸¸æ•°ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineColorBlendStateCreateInfo colorBlending = &#123;&#125;;</span><br><span class="line">colorBlending.sType = VK_STRUCTURE_TYPE_PIPELINE_COLOR_BLEND_STATE_CREATE_INFO;</span><br><span class="line">colorBlending.logicOpEnable = VK_FALSE;</span><br><span class="line">colorBlending.logicOp = VK_LOGIC_OP_COPY; <span class="comment">// Optional</span></span><br><span class="line">colorBlending.attachmentCount = <span class="number">1</span>;</span><br><span class="line">colorBlending.pAttachments = &amp;colorBlendAttachment;</span><br><span class="line">colorBlending.blendConstants[<span class="number">0</span>] = <span class="number">0.0f</span>; <span class="comment">// Optional</span></span><br><span class="line">colorBlending.blendConstants[<span class="number">1</span>] = <span class="number">0.0f</span>; <span class="comment">// Optional</span></span><br><span class="line">colorBlending.blendConstants[<span class="number">2</span>] = <span class="number">0.0f</span>; <span class="comment">// Optional</span></span><br><span class="line">colorBlending.blendConstants[<span class="number">3</span>] = <span class="number">0.0f</span>; <span class="comment">// Optional</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦ä½¿ç”¨ç¬¬äºŒç§æ··åˆæ–¹æ³•ï¼ˆæŒ‰ä½ç»„åˆï¼‰ï¼Œåˆ™åº”å°†logicOpEnableè®¾ç½®ä¸ºVK_TRUEã€‚ç„¶åå¯ä»¥åœ¨logicOpå­—æ®µä¸­æŒ‡å®šä½æ“ä½œã€‚è¯·æ³¨æ„ï¼Œè¿™å°†è‡ªåŠ¨ç¦ç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œå°±åƒä¸ºæ¯ä¸ªé™„åŠ çš„å¸§ç¼“å†²åŒºå°†blendEnableè®¾ç½®ä¸ºVK_FALSEä¸€æ ·ï¼colorWriteMaskä¹Ÿå°†ç”¨äºæ­¤æ¨¡å¼ï¼Œä»¥ç¡®å®šå¸§ç¼“å†²åŒºä¸­çš„å“ªäº›é€šé“å°†å®é™…å—åˆ°å½±å“ã€‚ä¹Ÿå¯ä»¥ç¦ç”¨è¿™ä¸¤ç§æ¨¡å¼ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œç‰‡æ®µé¢œè‰²å°†è¢«ä¸ä¿®æ”¹åœ°å†™å…¥å¸§ç¼“å†²åŒºã€‚</p>
<h1 id="ä¸ƒ-Dynamic-state-å¯åŠ¨æ€ä¿®æ”¹çŠ¶æ€"><a href="#ä¸ƒ-Dynamic-state-å¯åŠ¨æ€ä¿®æ”¹çŠ¶æ€" class="headerlink" title="ä¸ƒ. Dynamic state å¯åŠ¨æ€ä¿®æ”¹çŠ¶æ€"></a>ä¸ƒ. Dynamic state å¯åŠ¨æ€ä¿®æ”¹çŠ¶æ€</h1><p>ä¸€å°éƒ¨åˆ†çŠ¶æ€æ˜¯å¯ä»¥ä¸éœ€è¦é‡æ–°åˆ›å»ºç®¡é“ï¼Œç›´æ¥ä¿®æ”¹çš„ï¼›æ¯”å¦‚viewportçš„å¤§å°ï¼Œçº¿å®½å’Œé¢œè‰²æ··åˆå¸¸æ•°ç­‰ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ VkPipelineDynamicStateCreateInfo æ¥æ›´æ”¹è¿™äº›åŠ¨æ€å‚æ•°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkDynamicState dynamicStates[] = &#123;</span><br><span class="line">    VK_DYNAMIC_STATE_VIEWPORT,</span><br><span class="line">    VK_DYNAMIC_STATE_LINE_WIDTH</span><br><span class="line">&#125;;</span><br><span class="line">VkPipelineDynamicStateCreateInfo dynamicState = &#123;&#125;;</span><br><span class="line">dynamicState.sType = VK_STRUCTURE_TYPE_PIPELINE_DYNAMIC_STATE_CREATE_INFO;</span><br><span class="line">dynamicState.dynamicStateCount = <span class="number">2</span>;</span><br><span class="line">dynamicState.pDynamicStates = dynamicStates;</span><br></pre></td></tr></table></figure>
<p>è¿™å°†å¯¼è‡´å¿½ç•¥è¿™äº›å€¼çš„é…ç½®ï¼Œå¹¶è¦æ±‚åœ¨ç»˜å›¾æ—¶æŒ‡å®šç›¸åº”é…ç½®ã€‚</p>
<h1 id="å…«-Pipeline-layout-ç®¡é“å¸ƒç½®å›¾"><a href="#å…«-Pipeline-layout-ç®¡é“å¸ƒç½®å›¾" class="headerlink" title="å…«. Pipeline layout ç®¡é“å¸ƒç½®å›¾"></a>å…«. Pipeline layout ç®¡é“å¸ƒç½®å›¾</h1><p>å¯ä»¥åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨ç»Ÿä¸€çš„å€¼ï¼Œç±»ä¼¼äºå¯ä»¥åœ¨ç»˜åˆ¶æ—¶æ›´æ”¹çš„åŠ¨æ€çŠ¶æ€å˜é‡ï¼Œä»¥æ›´æ”¹ç€è‰²å™¨çš„è¡Œä¸ºï¼Œè€Œæ— éœ€é‡æ–°åˆ›å»ºå®ƒä»¬ã€‚</p>
<p>é€šå¸¸ç”¨äºå°†å˜æ¢çŸ©é˜µä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨ï¼Œæˆ–åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­åˆ›å»ºçº¹ç†é‡‡æ ·å™¨ã€‚</p>
<p>åœ¨åˆ›å»ºç®¡é“æœŸé—´ï¼Œéœ€è¦é€šè¿‡åˆ›å»ºVkPipelineLayoutå¯¹è±¡æ¥æŒ‡å®šè¿™äº›ç»Ÿä¸€å€¼ã€‚åˆ›å»ºä¸€ä¸ªç±»æˆå‘˜æ¥ä¿å­˜è¿™ä¸ªå¯¹è±¡ï¼Œç¨åä¼šä»å…¶ä»–å‡½æ•°ä¸­å¼•ç”¨å®ƒï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineLayout pipelineLayout;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createGraphicsPipeline</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">    VkPipelineLayoutCreateInfo pipelineLayoutInfo = &#123;&#125;;</span><br><span class="line">    pipelineLayoutInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_LAYOUT_CREATE_INFO;</span><br><span class="line">    pipelineLayoutInfo.setLayoutCount = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    pipelineLayoutInfo.pSetLayouts = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">    pipelineLayoutInfo.pushConstantRangeCount = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line">    pipelineLayoutInfo.pPushConstantRanges = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreatePipelineLayout</span>(device, &amp;pipelineLayoutInfo, <span class="literal">nullptr</span>,</span><br><span class="line">            &amp;pipelineLayout) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create pipeline layout!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¥ç»“æ„è¿˜æŒ‡å®šäº†pushå¸¸é‡ï¼Œè¿™æ˜¯å°†åŠ¨æ€å€¼ä¼ é€’ç»™ç€è‰²å™¨çš„å¦ä¸€ç§æ–¹å¼ï¼Œæˆ‘ä»¬å°†åœ¨ä»¥åçš„ç« èŠ‚ä¸­è®¨è®ºã€‚</p>
<p>ç®¡é“å¸ƒå±€å°†åœ¨æ•´ä¸ªç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…è¢«å¼•ç”¨ï¼Œå› æ­¤åœ¨ç»“æŸæ—¶åº”é”€æ¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vkDestroyPipelineLayout</span>(device, pipelineLayout, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ä¹-å°ç»“"><a href="#ä¹-å°ç»“" class="headerlink" title="ä¹. å°ç»“"></a>ä¹. å°ç»“</h1><p>æ‰€æœ‰çš„å›ºå®šå‡½æ•°çŠ¶æ€éƒ½æ˜¯è¿™æ ·ï¼è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å·¥ä½œï¼Œä»¥è®¾ç½®æ‰€æœ‰è¿™äº›ä»å¤´å¼€å§‹ï¼Œä½†å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨å‡ ä¹å®Œå…¨äº†è§£ä¸€åˆ‡æ­£åœ¨è¿›è¡Œçš„å›¾å½¢ç®¡é“ï¼<br>è¿™å‡å°‘äº†è¿è¡Œåˆ°æ„å¤–è¡Œä¸ºçš„æœºä¼šï¼Œå› ä¸ºæŸäº›ç»„ä»¶çš„é»˜è®¤çŠ¶æ€ä¸æ˜¯æ‚¨æ‰€æœŸæœ›çš„ã€‚ä¸è¿‡ï¼Œåœ¨æˆ‘ä»¬æœ€ç»ˆåˆ›å»ºå›¾å½¢ç®¡é“ä¹‹å‰ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯¹è±¡éœ€è¦åˆ›å»ºï¼Œé‚£å°±æ˜¯æ¸²æŸ“è¿‡ç¨‹ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹åˆ°ç›®å‰ä½ä¸ºæ­¢ï¼Œåˆ›å»ºå›¾å½¢ç®¡é“åº”è¯¥åšçš„æ“ä½œ:</p>
<ol>
<li>Vertex Input æè¿°å°†ä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨çš„é¡¶ç‚¹æ•°æ®çš„æ ¼å¼</li>
<li>Input assembly æè¿°é¡¶ç‚¹ç»˜åˆ¶å‡ ä½•ç±»å‹</li>
<li>Viewports and scissors æè¿°å°†è¢«æ¸²æŸ“åˆ°çš„å¸§ç¼“å†²åŒºåŸŸ</li>
<li>Rasterizer å…‰æ …åŒ–é…ç½®</li>
<li>Multisampling é…ç½®å¤šé‡é‡‡æ ·</li>
<li>Color blending é…ç½®é¢œè‰²æ··åˆ</li>
<li>Pipeline layout åˆ›å»ºç®¡é“å¸ƒç½®å›¾</li>
</ol>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(5)-å›¾åƒè§†å›¾åŠPipelineç®€è¿°</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-5-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%8F%8APipeline%E7%AE%80%E8%BF%B0/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>æœ¬æ–‡ä¸»è¦ä»‹ç»VkImageViewä»¥åŠç€è‰²å™¨çš„åˆ›å»ºï¼Œå¹¶ä¸”æˆ‘ä»¬å°†å­¦ä¹ åˆ°å¦‚ä½•ç¼–å†™ä¸€ä¸ªæ¸å˜é¢œè‰²çš„ä¸‰è§’å½¢ç€è‰²å™¨ã€‚</p>
<span id="more"></span>

<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><ol>
<li>[SPIR-V] <a href="https://www.khronos.org/spir/">https://www.khronos.org/spir/</a></li>
<li>[SPIR-V doc] <a href="https://www.khronos.org/registry/spir-v/specs/unified1/SPIRV.html">https://www.khronos.org/registry/spir-v/specs/unified1/SPIRV.html</a></li>
<li>[GLSLå¼€å‘æ‰‹å†Œ] <a href="https://github.com/wshxbqq/GLSL-Card">https://github.com/wshxbqq/GLSL-Card</a></li>
</ol>
<h1 id="ä¸€-Image-views"><a href="#ä¸€-Image-views" class="headerlink" title="ä¸€. Image views"></a>ä¸€. Image views</h1><p>åœ¨Render pipelineä¸­ä½¿ç”¨VkImage, åŒ…æ‹¬åœ¨äº¤æ¢é“¾ä¸­ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªVkImageViewçš„å¯¹è±¡ã€‚<br>VkImageViewå®é™…ä¸Šå°±æ˜¯å›¾åƒçš„è§†å›¾ã€‚å®ƒæè¿°äº†å¦‚ä½•è®¿é—®å›¾åƒä»¥åŠè¦è®¿é—®çš„å›¾åƒéƒ¨åˆ†ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå®ƒåº”è¢«è§†ä¸º2Dçº¹ç†æ·±åº¦çº¹ç†è€Œæ²¡æœ‰ä»»ä½•mipmappingçº§åˆ«ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬è¯•è¯•ä¸ºäº¤æ¢é“¾ä¸­çš„æ¯ä¸ªå›¾åƒåˆ›å»ºä¸€ä¸ªåŸºæœ¬VkImageViewã€‚<br>åˆ›å»ºVkImageViewçš„æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªç»“æ„ä½“ï¼šVkImageViewCreateInfo, æ¥æŒ‡æ˜ç»†èŠ‚.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkImageViewCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType            sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                pNext;</span><br><span class="line">    VkImageViewCreateFlags     flags;</span><br><span class="line">    VkImage                    image;</span><br><span class="line">    VkImageViewType            viewType;</span><br><span class="line">    VkFormat                   format;</span><br><span class="line">    VkComponentMapping         components;</span><br><span class="line">    VkImageSubresourceRange    subresourceRange;</span><br><span class="line">&#125; VkImageViewCreateInfo;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>VkImage: ç»‘å®šå¯¹åº”å›¾åƒ</li>
<li>VkImageViewType: å›¾åƒè§†å›¾ç±»å‹<ul>
<li>ä¸€ç»´çº¹ç†: VK_IMAGE_VIEW_TYPE_1Dã€VK_IMAGE_VIEW_TYPE_1D_ARRAY</li>
<li>äºŒç»´çº¹ç†: VK_IMAGE_VIEW_TYPE_2Dã€VK_IMAGE_VIEW_TYPE_2D_ARRAY</li>
<li>ä¸‰ç»´çº¹ç†: VK_IMAGE_VIEW_TYPE_3D</li>
<li>ç«‹æ–¹ä½“è´´å›¾: VK_IMAGE_VIEW_TYPE_CUBEã€VK_IMAGE_VIEW_TYPE_CUBE_ARRAY</li>
</ul>
</li>
<li>VkFormat: å›¾åƒæ ¼å¼</li>
<li>VkComponentMapping: å›¾åƒé¢œè‰²é€šé“ï¼Œå³RGBå’ŒAlphaé€šé“</li>
<li>VkImageSubresourceRange:æè¿°äº†å›¾åƒçš„ç›®çš„ä»¥åŠåº”è¯¥è®¿é—®å›¾åƒçš„å“ªä¸ªéƒ¨åˆ†</li>
</ul>
<p>ç‰¹åˆ«çš„ï¼Œå¦‚æœæ˜¯3Dåº”ç”¨ç¨‹åº, é‚£åº”è¯¥åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å¤šä¸ªlayerçš„äº¤æ¢é“¾ã€‚è¿™æ ·å¯ä»¥é€šè¿‡è®¿é—®ä¸åŒçš„å›¾å±‚ä¸ºæ¯ä¸ªå›¾åƒåˆ›å»ºå¤šä¸ªå›¾åƒè§†å›¾ï¼Œä»¥è¡¨ç¤ºå·¦å³è§†å›¾ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createImageViews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®é›†åˆå¤§å°</span></span><br><span class="line">    swapChainImageViews.<span class="built_in">resize</span>(swapChainImages.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; swapChainImageViews.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        VkImageViewCreateInfo createInfo = &#123;&#125;;</span><br><span class="line">        createInfo.sType = VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO;</span><br><span class="line">        createInfo.image = swapChainImages[i]; <span class="comment">// ç»‘å®š VkImage</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// viewTypeå’Œformatå­—æ®µæŒ‡å®šåº”å¦‚ä½•è§£é‡Šå›¾åƒæ•°æ®</span></span><br><span class="line">        <span class="comment">// viewTypeå‚æ•°æŒ‡å®šå›¾åƒä¸ºä¸€ç»´çº¹ç†ï¼ŒäºŒç»´çº¹ç†ï¼Œä¸‰ç»´çº¹ç†æˆ–ç«‹æ–¹ä½“è´´å›¾</span></span><br><span class="line">        createInfo.viewType = VK_IMAGE_VIEW_TYPE_2D;</span><br><span class="line">        <span class="comment">// å›¾åƒæ ¼å¼</span></span><br><span class="line">        createInfo.format = swapChainImageFormat;</span><br><span class="line">        <span class="comment">// å›¾åƒé¢œè‰²é€šé“ï¼Œå³RGBå’ŒAlphaé€šé“ã€‚æ¯”å¦‚å°†æ‰€æœ‰é€šé“æ˜ å°„åˆ°çº¢è‰²é€šé“ä»¥è·å¾—å•è‰²çº¹ç†ï¼Œæˆ–è€…å°†å¸¸é‡å€¼0å’Œ1æ˜ å°„åˆ°é€šé“ã€‚è¿™é‡Œé€‰æ‹©é»˜è®¤æ˜ å°„:</span></span><br><span class="line">        createInfo.components.r = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line">        createInfo.components.g = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line">        createInfo.components.b = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line">        createInfo.components.a = VK_COMPONENT_SWIZZLE_IDENTITY;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// subresourceRangeå­—æ®µæè¿°äº†å›¾åƒçš„ç›®çš„æ˜¯ä»€ä¹ˆä»¥åŠåº”è¯¥è®¿é—®å›¾åƒçš„å“ªä¸ªéƒ¨åˆ†ã€‚</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œå›¾åƒå°†ç”¨ä½œé¢œè‰²ç›®æ ‡ï¼Œæ²¡æœ‰ä»»ä½•mipmappingçº§åˆ«æˆ–å¤šä¸ªå±‚ã€‚</span></span><br><span class="line">        createInfo.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</span><br><span class="line">        createInfo.subresourceRange.baseMipLevel = <span class="number">0</span>;</span><br><span class="line">        createInfo.subresourceRange.levelCount = <span class="number">1</span>;</span><br><span class="line">        createInfo.subresourceRange.baseArrayLayer = <span class="number">0</span>;</span><br><span class="line">        createInfo.subresourceRange.layerCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼Œé€šè¿‡vkCreateXXXåˆ›å»ºçš„å¯¹è±¡ï¼Œéƒ½éœ€è¦æˆ‘ä»¬ä¸»åŠ¨å»é‡Šæ”¾</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">vkCreateImageView</span>(device, &amp;createInfo, <span class="literal">nullptr</span>, &amp;swapChainImageViews[i]) != VK_SUCCESS) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create image views!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾äº¤æ¢é“¾å¯¹åº”çš„å›¾åƒè§†å›¾</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> imageView : swapChainImageViews) &#123;</span><br><span class="line">        <span class="built_in">vkDestroyImageView</span>(device, imageView, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†å›¾åƒè§†å›¾è¶³ä»¥å¼€å§‹å°†å›¾åƒç”¨ä½œçº¹ç†ï¼Œä½†è¿˜ä¸èƒ½ç›´æ¥ç”¨ä½œæ¸²æŸ“ç›®æ ‡ã€‚éœ€è¦ä¸€ä¸ªé—´æ¥æ­¥éª¤ï¼Œç§°ä¸ºå¸§ç¼“å†²ï¼Œä½†é¦–å…ˆæˆ‘ä»¬å¿…é¡»è®¾ç½®å›¾å½¢ç®¡é“ã€‚</p>
<h1 id="äºŒ-å›¾å½¢ç®¡é“-Pipeline-ç®€ä»‹"><a href="#äºŒ-å›¾å½¢ç®¡é“-Pipeline-ç®€ä»‹" class="headerlink" title="äºŒ. å›¾å½¢ç®¡é“ Pipeline ç®€ä»‹"></a>äºŒ. å›¾å½¢ç®¡é“ Pipeline ç®€ä»‹</h1><p>æ‰€è°“å›¾å½¢ç®¡é“å°±æ˜¯ä¸€ç³»åˆ—æ“ä½œï¼Œå®ƒä»¬å°†ç½‘æ ¼çš„é¡¶ç‚¹å’Œçº¹ç†ä¸€ç›´å¸¦åˆ°æ¸²æŸ“ç›®æ ‡ä¸­çš„åƒç´ ã€‚ç®€åŒ–æ¦‚è¿°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ol>
<li>è¾“å…¥æ±‡ç¼–ç¨‹åº(input assembler): ä»æŒ‡å®šçš„ç¼“å†²åŒºæ”¶é›†åŸå§‹é¡¶ç‚¹æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•ç¼“å†²åŒºé‡å¤æŸäº›å…ƒç´ ï¼Œè€Œä¸å¿…å¤åˆ¶é¡¶ç‚¹æ•°æ®æœ¬èº«ã€‚</li>
<li>é¡¶ç‚¹ç€è‰²å™¨(vertex shader): é’ˆå¯¹æ¯ä¸ªé¡¶ç‚¹è¿è¡Œï¼Œå¹¶ä¸”é€šå¸¸åº”ç”¨å˜æ¢ä»¥å°†é¡¶ç‚¹ä½ç½®ä»æ¨¡å‹ç©ºé—´è½¬æ¢åˆ°å±å¹•ç©ºé—´ã€‚å®ƒè¿˜æ²¿ç€ç®¡é“ä¼ é€’æ¯é¡¶ç‚¹æ•°æ®ã€‚</li>
<li>æ›²é¢ç»†åˆ†ç€è‰²å™¨(tessellation shaders): æ ¹æ®ç‰¹å®šè§„åˆ™ç»†åˆ†å‡ ä½•ä½“ä»¥æé«˜ç½‘æ ¼è´¨é‡ã€‚é€šå¸¸ç”¨äºä½¿ç –å¢™å’Œæ¥¼æ¢¯ç­‰è¡¨é¢åœ¨é™„è¿‘æ—¶çœ‹èµ·æ¥ä¸é‚£ä¹ˆå¹³å¦ã€‚</li>
<li>å‡ ä½•ç€è‰²å™¨(geometry shader): åœ¨æ¯ä¸ªåŸºå…ƒ(ä¸‰è§’å½¢ï¼Œç›´çº¿ï¼Œç‚¹)ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥ä¸¢å¼ƒå®ƒæˆ–è¾“å‡ºæ¯”åŸæ¥æ›´å¤šçš„åŸºå…ƒã€‚ç±»ä¼¼äºæ›²é¢ç»†åˆ†ç€è‰²å™¨ï¼Œä½†æ›´çµæ´»ã€‚ä½†æ²¡æœ‰å¾—åˆ°å¤ªå¤šåº”ç”¨ï¼Œå› ä¸ºå¤§å¤šæ•°æ˜¾å¡çš„æ€§èƒ½éƒ½ä¸æ˜¯å¾ˆå¥½ã€‚</li>
<li>å…‰æ …åŒ–é˜¶æ®µ(rasterization stage): å°†åŸºå…ƒç¦»æ•£åŒ–ä¸ºç‰‡æ®µã€‚è¿™äº›æ˜¯å®ƒä»¬å¡«å……åœ¨å¸§ç¼“å†²åŒºä¸Šçš„åƒç´ å…ƒç´ ã€‚åœ¨å±å¹•ä¹‹å¤–çš„ç‰‡æ®µéƒ½å°†è¢«ä¸¢å¼ƒï¼Œé¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„å±æ€§å°†åœ¨ç‰‡æ®µä¹‹é—´è¿›è¡Œæ’å€¼ã€‚ç”±äºæ·±åº¦æµ‹è¯•ï¼Œé€šå¸¸åœ¨è¿™é‡Œä¹Ÿä¸¢å¼ƒå…¶ä»–åŸå§‹ç‰‡æ®µåé¢çš„ç‰‡æ®µã€‚</li>
<li>ç‰‡æ®µç€è‰²å™¨(fragment shader): ä¸ºå­˜æ´»çš„æ¯ä¸ªç‰‡æ®µè°ƒç”¨ç‰‡æ®µç€è‰²å™¨ï¼Œå¹¶ç¡®å®šç‰‡æ®µå†™å…¥å“ªäº›å¸§ç¼“å†²åŒºä»¥åŠä½¿ç”¨å“ªäº›é¢œè‰²å’Œæ·±åº¦å€¼ã€‚å®ƒå¯ä»¥ä½¿ç”¨æ¥è‡ªé¡¶ç‚¹ç€è‰²å™¨çš„æ’å€¼æ•°æ®æ¥å®Œæˆæ­¤æ“ä½œï¼Œå…¶ä¸­å¯ä»¥åŒ…æ‹¬çº¹ç†åæ ‡å’Œæ³•çº¿ç…§æ˜ç­‰å†…å®¹ã€‚</li>
<li>é¢œè‰²æ··åˆé˜¶æ®µ(color blending stage): åº”ç”¨æ“ä½œæ¥æ··åˆæ˜ å°„åˆ°å¸§ç¼“å†²åŒºä¸­çš„ç›¸åŒåƒç´ çš„ä¸åŒç‰‡æ®µã€‚ ç¢ç‰‡å¯ä»¥ç®€å•åœ°ç›¸äº’è¦†ç›–ï¼ŒåŠ èµ·æ¥æˆ–æ ¹æ®é€æ˜åº¦è¿›è¡Œæ··åˆã€‚<ol>
<li>ç»¿è‰²çš„é˜¶æ®µè¢«ç§°ä¸ºå›ºå®šåŠŸèƒ½é˜¶æ®µã€‚è¿™äº›é˜¶æ®µå…è®¸ä½¿ç”¨å‚æ•°è°ƒæ•´å…¶æ“ä½œï¼Œä½†å®ƒä»¬çš„å·¥ä½œæ–¹å¼æ˜¯é¢„å®šä¹‰çš„ã€‚</li>
<li>æ©™è‰²çš„é˜¶æ®µæ˜¯å¯ç¼–ç¨‹çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥å°†ä»£ç ä¸Šä¼ åˆ°å›¾å½¢å¡ï¼Œä»¥å®Œå…¨åº”ç”¨æƒ³è¦çš„æ“ä½œã€‚ </li>
<li>ä¾‹å¦‚ï¼Œå®ç°ä»çº¹ç†å’Œå…‰ç…§åˆ°å…‰çº¿è·Ÿè¸ªå™¨çš„ä»»ä½•å†…å®¹ã€‚è¿™äº›ç¨‹åºåŒæ—¶åœ¨è®¸å¤šGPUå†…æ ¸ä¸Šè¿è¡Œï¼Œä»¥å¹¶è¡Œå¤„ç†è®¸å¤šå¯¹è±¡ï¼Œå¦‚é¡¶ç‚¹å’Œç‰‡æ®µã€‚ï¼Œå¯ä»¥ä½¿ç”¨ç‰‡æ®µç€è‰²å™¨</li>
</ol>
</li>
</ol>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-5-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%8F%8APipeline%E7%AE%80%E8%BF%B0/Vulkan_5_1.png" alt="å›¾ç‰‡"></p>
<p>åœ¨OpenGLå’ŒDirect3Dä¸­ï¼Œå¯ä»¥ä½¿ç”¨glBlendFuncå’ŒOMSetBlendStateç­‰è°ƒç”¨éšæ„æ›´æ”¹ä»»ä½•ç®¡é“è®¾ç½®ã€‚<br>ä½†Vulkanä¸­çš„å›¾å½¢ç®¡é“å‡ ä¹å®Œå…¨ä¸å¯å˜ï¼Œå› æ­¤å¦‚æœè¦æ›´æ”¹ç€è‰²å™¨ï¼Œç»‘å®šä¸åŒçš„å¸§ç¼“å†²åŒºæˆ–æ›´æ”¹æ··åˆå‡½æ•°ï¼Œåˆ™å¿…é¡»ä»å¤´å¼€å§‹é‡æ–°åˆ›å»ºç®¡é“ã€‚<br>ç¼ºç‚¹æ˜¯æ‚¨å¿…é¡»åˆ›å»ºè®¸å¤šç®¡é“ï¼Œè¿™äº›ç®¡é“ä»£è¡¨æ‚¨è¦åœ¨æ¸²æŸ“æ“ä½œä¸­ä½¿ç”¨çš„æ‰€æœ‰çŠ¶æ€ç»„åˆã€‚ä½†æ˜¯ï¼Œå› ä¸ºæ‚¨å°†åœ¨ç®¡é“ä¸­æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯äº‹å…ˆçŸ¥é“çš„ï¼Œæ‰€ä»¥é©±åŠ¨ç¨‹åºå¯ä»¥æ›´å¥½åœ°ä¼˜åŒ–å®ƒã€‚</p>
<p>æ ¹æ®æ‚¨çš„ç›®çš„ï¼ŒæŸäº›å¯ç¼–ç¨‹é˜¶æ®µæ˜¯å¯é€‰çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åªæ˜¯ç»˜åˆ¶ç®€å•å‡ ä½•ä½“ï¼Œåˆ™å¯ä»¥ç¦ç”¨æ›²é¢ç»†åˆ†å’Œå‡ ä½•ä½“é˜¶æ®µã€‚<br>å¦‚æœæ‚¨åªå¯¹æ·±åº¦å€¼æ„Ÿå…´è¶£ï¼Œåˆ™å¯ä»¥ç¦ç”¨ç‰‡æ®µç€è‰²å™¨é˜¶æ®µï¼Œè¿™å¯¹é˜´å½±è´´å›¾ç”Ÿæˆå¾ˆæœ‰ç”¨ã€‚</p>
<p>è®°ä½<strong>åˆ›å»ºç®¡é“éœ€è¦åœ¨åˆ›å»ºVkImageViewä¹‹å</strong>ã€‚</p>
<p>å…·ä½“çš„åˆ›å»ºéœ€è¦ä¾èµ–ä¸Šè¿°å„ä¸ªç€è‰²å™¨ï¼Œæˆ‘ä»¬å…ˆç†Ÿæ‚‰ä¸€ä¸‹è¿™äº›ç€è‰²å™¨ã€‚</p>
<h1 id="ä¸‰-ç€è‰²å™¨-Shader-modules"><a href="#ä¸‰-ç€è‰²å™¨-Shader-modules" class="headerlink" title="ä¸‰. ç€è‰²å™¨(Shader modules)"></a>ä¸‰. ç€è‰²å™¨(Shader modules)</h1><p>Vulkanä¸­çš„ç€è‰²å™¨ä»£ç å¿…é¡»ä»¥å­—èŠ‚ç æ ¼å¼æŒ‡å®šï¼Œè€Œä¸æ˜¯åƒGLSLå’ŒHLSLè¿™æ ·çš„äººç±»å¯è¯»è¯­æ³•ã€‚</p>
<ul>
<li>GLSLæ˜¯ä¸€ç§å…·æœ‰Cé£æ ¼è¯­æ³•çš„ç€è‰²è¯­è¨€ã€‚å†™åœ¨å…¶ä¸­çš„ç¨‹åºå…·æœ‰ä¸ºæ¯ä¸ªå¯¹è±¡è°ƒç”¨çš„ä¸»å‡½æ•°ã€‚</li>
<li>GLSLä½¿ç”¨å…¨å±€å˜é‡æ¥å¤„ç†è¾“å…¥å’Œè¾“å‡ºï¼Œè€Œä¸æ˜¯ä½¿ç”¨è¾“å…¥å‚æ•°å’Œè¿”å›å€¼ä½œä¸ºè¾“å‡ºã€‚è¯¥è¯­è¨€åŒ…æ‹¬è®¸å¤šæœ‰åŠ©äºå›¾å½¢ç¼–ç¨‹çš„åŠŸèƒ½ï¼Œå¦‚å†…ç½®å‘é‡å’ŒçŸ©é˜µåŸºå…ƒã€‚åŒ…æ‹¬äº¤å‰ç§¯ï¼ŒçŸ©é˜µå‘é‡ç§¯å’Œå‘é‡å‘¨å›´åå°„ç­‰æ“ä½œçš„å‡½æ•°ã€‚</li>
</ul>
<p>è€ŒVulkanä¸­çš„è¿™ç§å­—èŠ‚ç æ ¼å¼ç§°ä¸º<strong>SPIR-V</strong>ï¼Œæ—¨åœ¨ä¸Vulkanå’ŒOpenCLï¼ˆä¸¤ç§Khronos APIï¼‰ä¸€èµ·ä½¿ç”¨ã€‚<br>SPIR-Væ˜¯ä¸€ç§ç”¨äºå›¾å½¢ç€è‰²å™¨å’Œè®¡ç®—å†…æ ¸çš„ç®€å•äºŒè¿›åˆ¶ä¸­é—´è¯­è¨€ã€‚ æ›´å¤šä¿¡æ¯å¯ä»¥å‚è€ƒ <a href="https://www.khronos.org/registry/spir-v/specs/unified1/SPIRV.html">https://www.khronos.org/registry/spir-v/specs/unified1/SPIRV.html</a></p>
<p>ä½¿ç”¨å­—èŠ‚ç æ ¼å¼çš„ä¼˜ç‚¹æ˜¯æ¯”GPUä¾›åº”å•†ç¼–å†™çš„å°†ç€è‰²å™¨ä»£ç è½¬æ¢ä¸ºæœ¬æœºä»£ç çš„ç¼–è¯‘å™¨è¦ç®€å•çš„å¾—å¤šã€‚<br>è¿‡å»å·²ç»è¡¨æ˜ï¼Œä½¿ç”¨åƒGLSLè¿™æ ·çš„äººç±»å¯è¯»è¯­æ³•ï¼Œä¸€äº›GPUä¾›åº”å•†å¯¹æ ‡å‡†çš„è§£é‡Šç›¸å½“çµæ´»ã€‚<br>å¦‚æœç¢°å·§ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªä¾›åº”å•†ç¼–å†™çš„ä¸æ ‡å‡†GPUç€è‰²å™¨ï¼Œé‚£ä¹ˆç”±äºè¯­æ³•é”™è¯¯ï¼Œå¯èƒ½å…¶ä»–ä¾›åº”å•†çš„é©±åŠ¨ç¨‹åºä¼šæ‹’ç»æˆ‘ä»¬çš„ä»£ç ï¼Œæˆ–è€…æ›´ç³Ÿç³•çš„ï¼Œç”±äºç¼–è¯‘å™¨é”™è¯¯ï¼Œç€è‰²å™¨è¿è¡Œæ–¹å¼ä¸åŒã€‚è€Œä½¿ç”¨ç®€å•çš„å­—èŠ‚ç æ ¼å¼ï¼Œå¦‚SPIR-Vï¼Œåˆ™å¯ä»¥é¿å…æ­¤ç±»é—®é¢˜ã€‚</p>
<p>ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç¼–å†™è¿™ä¸ªå­—èŠ‚ç ã€‚ Khronoså‘å¸ƒäº†è‡ªå·±ç‹¬ç«‹äºä¾›åº”å•†çš„ç¼–è¯‘å™¨ï¼Œå°†GLSLç¼–è¯‘ä¸ºSPIR-Vã€‚<br>æ­¤ç¼–è¯‘å™¨æ—¨åœ¨éªŒè¯ç€è‰²å™¨ä»£ç æ˜¯å¦å®Œå…¨ç¬¦åˆæ ‡å‡†ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªå¯ä¸ç¨‹åºä¸€èµ·æä¾›çš„SPIR-VäºŒè¿›åˆ¶æ–‡ä»¶ã€‚<br>æˆ‘ä»¬è¿˜å¯ä»¥å°†æ­¤ç¼–è¯‘å™¨ä½œä¸ºåº“åŒ…å«åœ¨è¿è¡Œæ—¶ç”ŸæˆSPIR-Vã€‚<br>è¿™ä¸ªç¼–è¯‘å™¨å·²ç»åŒ…å«åœ¨LunarG SDKä¸­ä½œä¸ºglslangValidator.exeï¼Œæ— éœ€é¢å¤–ä¸‹è½½ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨GLSLè¯­è¨€(è¯¦ç»†å‚è€ƒ: <a href="https://github.com/wshxbqq/GLSL-Card)%E7%BC%96%E5%86%99%E7%9D%80%E8%89%B2%E5%99%A8%E3%80%82">https://github.com/wshxbqq/GLSL-Card)ç¼–å†™ç€è‰²å™¨ã€‚</a></p>
<h2 id="3-1-é¡¶ç‚¹ç€è‰²å™¨-Vertex-Shader"><a href="#3-1-é¡¶ç‚¹ç€è‰²å™¨-Vertex-Shader" class="headerlink" title="3.1 é¡¶ç‚¹ç€è‰²å™¨ Vertex Shader"></a>3.1 é¡¶ç‚¹ç€è‰²å™¨ Vertex Shader</h2><p>çŸ¢é‡ç±»å‹ç§°ä¸ºvecï¼Œå…¶æ•°å­—è¡¨ç¤ºå…ƒç´ çš„æ•°é‡ã€‚ ä¾‹å¦‚ï¼Œ3Dä½ç½®å°†å­˜å‚¨åœ¨vec3ä¸­ã€‚<br>å¯ä»¥é€šè¿‡.xç­‰æˆå‘˜è®¿é—®å•ä¸ªç»„ä»¶ï¼Œä½†ä¹Ÿå¯ä»¥åŒæ—¶ä»å¤šä¸ªç»„ä»¶åˆ›å»ºæ–°çš„å‘é‡ã€‚ ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼vec3ï¼ˆ1.0,2.0,3.0ï¼‰.xyå°†å¯¼è‡´vec2ã€‚<br>å‘é‡çš„æ„é€ å‡½æ•°ä¹Ÿå¯ä»¥é‡‡ç”¨å‘é‡å¯¹è±¡å’Œæ ‡é‡å€¼çš„ç»„åˆã€‚ ä¾‹å¦‚ï¼Œvec3å¯ä»¥ç”¨vec3ï¼ˆvec2ï¼ˆ1.0,2.0ï¼‰ï¼Œ3.0ï¼‰æ„å»ºã€‚</p>
<p>é¡¶ç‚¹ç€è‰²å™¨å¤„ç†æ¯ä¸ªä¼ å…¥çš„é¡¶ç‚¹ã€‚ å®ƒå°†å…¶å±æ€§ï¼ˆå¦‚ä¸–ç•Œä½ç½®ï¼Œé¢œè‰²ï¼Œæ³•çº¿å’Œçº¹ç†åæ ‡ï¼‰ä½œä¸ºè¾“å…¥ã€‚<br>è¾“å‡ºæ˜¯å‰ªè¾‘åæ ‡ä¸­çš„æœ€ç»ˆä½ç½®ä»¥åŠéœ€è¦ä¼ é€’åˆ°ç‰‡æ®µç€è‰²å™¨çš„å±æ€§ï¼Œå¦‚é¢œè‰²å’Œçº¹ç†åæ ‡ã€‚<br>ç„¶åï¼Œå…‰æ …åŒ–å™¨å°†è¿™äº›å€¼æ’å…¥ç‰‡æ®µä¸Šä»¥äº§ç”Ÿå¹³æ»‘çš„æ¢¯åº¦ã€‚<br>å‰ªè¾‘åæ ‡æ˜¯æ¥è‡ªé¡¶ç‚¹ç€è‰²å™¨çš„å››ç»´çŸ¢é‡ï¼Œå…¶éšåé€šè¿‡å°†æ•´ä¸ªçŸ¢é‡é™¤ä»¥å…¶æœ€åä¸€ä¸ªåˆ†é‡è€Œå˜ä¸ºæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ã€‚ è¿™äº›æ ‡å‡†åŒ–çš„è®¾å¤‡åæ ‡æ˜¯é½æ¬¡åæ ‡ï¼Œå®ƒå°†å¸§ç¼“å†²åŒºæ˜ å°„åˆ°[-1,1]ä¹˜[-1,1]åæ ‡ç³»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-5-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%8F%8APipeline%E7%AE%80%E8%BF%B0/Vulkan_5_2.png" alt="å›¾ç‰‡"></p>
<p>æ³¨æ„xyè½´çš„æ–¹å‘ï¼Œç±»ä¼¼Androidä¸­çš„åæ ‡è½´ï¼Œè€Œä¸æ˜¯OpenGLä¸­çš„åæ ‡è½´æ–¹å‘ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨ä»¥åœ¨å±å¹•ä¸Šå‘ˆç°ä¸€ä¸ªä¸‰è§’å½¢,å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-5-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%8F%8APipeline%E7%AE%80%E8%BF%B0/Vulkan_5_3.png" alt="å›¾ç‰‡"></p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å‡ºå½’ä¸€åŒ–è®¾å¤‡åæ ‡ï¼Œæ–¹æ³•æ˜¯å°†å®ƒä»¬ä½œä¸ºé¡¶ç‚¹ç€è‰²å™¨çš„å‰ªè¾‘åæ ‡è¾“å‡ºï¼Œæœ€åä¸€ä¸ªç»„ä»¶è®¾ç½®ä¸º1.<br>è¿™æ ·ï¼Œå°†å‰ªè¾‘åæ ‡è½¬æ¢ä¸ºè§„èŒƒåŒ–è®¾å¤‡åæ ‡çš„åˆ’åˆ†ä¸ä¼šæ”¹å˜ä»»ä½•ä¸œè¥¿ã€‚<br>é€šå¸¸è¿™äº›åæ ‡å°†å­˜å‚¨åœ¨é¡¶ç‚¹ç¼“å†²åŒºä¸­ï¼Œä½†åœ¨Vulkanä¸­åˆ›å»ºé¡¶ç‚¹ç¼“å†²åŒºå¹¶ç”¨æ•°æ®å¡«å……å®ƒå¹¶ä¸ç®€å•ã€‚<br>å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­åŒ…å«åæ ‡ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> positions[<span class="number">3</span>] = <span class="type">vec2</span>[](</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">0.0</span>, <span class="number">-0.5</span>),</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">0.5</span>, <span class="number">0.5</span>),</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">-0.5</span>, <span class="number">0.5</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(positions[gl_VertexIndex], <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªé¡¶ç‚¹çš„ç”Ÿæˆéƒ½éœ€è¦è°ƒç”¨mainå‡½æ•°ã€‚<br>å†…ç½®çš„<strong>gl_VertexIndex</strong>å˜é‡åŒ…å«å½“å‰é¡¶ç‚¹çš„ç´¢å¼•ï¼Œä¸€èˆ¬æ˜¯é¡¶ç‚¹ç¼“å†²åŒºçš„ç´¢å¼•ã€‚åœ¨è¿™é‡Œï¼Œå®ƒæ˜¯é¡¶ç‚¹æ•°æ®çš„ç¡¬ç¼–ç æ•°ç»„çš„ç´¢å¼•ã€‚<br>ä»ç€è‰²å™¨ä¸­çš„å¸¸é‡æ•°ç»„è®¿é—®æ¯ä¸ªé¡¶ç‚¹çš„ä½ç½®ï¼Œå¹¶ä¸è™šæ‹Ÿzå’Œwç»„ä»¶ç»„åˆä»¥åœ¨å‰ªè¾‘åæ ‡ä¸­ç”Ÿæˆä½ç½®ï¼Œå†…ç½®å˜é‡gl_Positionç”¨ä½œè¾“å‡ºã€‚</p>
<h2 id="3-2-ç‰‡æ®µç€è‰²å™¨-Fragment-Shader"><a href="#3-2-ç‰‡æ®µç€è‰²å™¨-Fragment-Shader" class="headerlink" title="3.2 ç‰‡æ®µç€è‰²å™¨ Fragment Shader"></a>3.2 ç‰‡æ®µç€è‰²å™¨ Fragment Shader</h2><p>ç”±é¡¶ç‚¹ç€è‰²å™¨çš„ä½ç½®å½¢æˆçš„ä¸‰è§’å½¢ç”¨ç‰‡æ®µå¡«å……å±å¹•ä¸Šçš„åŒºåŸŸã€‚<br>åœ¨è¿™äº›ç‰‡æ®µä¸Šè°ƒç”¨ç‰‡æ®µç€è‰²å™¨ä»¥ç”Ÿæˆå¸§ç¼“å†²åŒºï¼ˆæˆ–å¸§ç¼“å†²åŒºï¼‰çš„é¢œè‰²å’Œæ·±åº¦ã€‚<br>ä¸ºæ•´ä¸ªä¸‰è§’å½¢è¾“å‡ºçº¢è‰²çš„ç®€å•ç‰‡æ®µç€è‰²å™¨å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"><span class="meta">#extension GL_ARB_separate_shader_objects : enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸§ç¼“å†²åŒºçš„ç´¢å¼•ä¸º0</span></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec4</span> outColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    outColor = <span class="type">vec4</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>GLSLä¸­çš„é¢œè‰²æ˜¯4åˆ†é‡çŸ¢é‡ï¼Œå…¶ä¸­Rï¼ŒGï¼ŒBå’ŒÎ±é€šé“åœ¨[0,1]èŒƒå›´å†…ã€‚<br>ä¸é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„gl_Positionä¸åŒï¼Œæ²¡æœ‰å†…ç½®å˜é‡æ¥è¾“å‡ºå½“å‰ç‰‡æ®µçš„é¢œè‰²ã€‚ æ‰€ä»¥å¿…é¡»ä¸ºæ¯ä¸ªå¸§ç¼“å†²åŒºæŒ‡å®šè‡ªå·±çš„è¾“å‡ºå˜é‡ï¼Œå…¶ä¸­layoutï¼ˆlocation &#x3D; 0ï¼‰ä¿®é¥°ç¬¦æŒ‡å®šå¸§ç¼“å†²åŒºçš„ç´¢å¼•ã€‚<br>çº¢è‰²å°†å†™å…¥æ­¤outColorå˜é‡ï¼Œè¯¥å˜é‡é“¾æ¥åˆ°ç´¢å¼•0å¤„çš„ç¬¬ä¸€ä¸ªï¼ˆä¹Ÿæ˜¯å”¯ä¸€çš„ï¼‰å¸§ç¼“å†²åŒºã€‚</p>
<h2 id="3-3-ä¸ºæ¯ä¸ªé¡¶ç‚¹ç€è‰²"><a href="#3-3-ä¸ºæ¯ä¸ªé¡¶ç‚¹ç€è‰²" class="headerlink" title="3.3 ä¸ºæ¯ä¸ªé¡¶ç‚¹ç€è‰²"></a>3.3 ä¸ºæ¯ä¸ªé¡¶ç‚¹ç€è‰²</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°æ¸å˜é¢œè‰²çš„ä¸‰è§’å½¢ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-5-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%8F%8APipeline%E7%AE%80%E8%BF%B0/Vulkan_5_4.png" alt="å›¾ç‰‡"></p>
<p>è¿™å°±éœ€è¦æˆ‘ä»¬ä¸ºä¸‰ä¸ªé¡¶ç‚¹ä¸­çš„æ¯ä¸€ä¸ªæŒ‡å®šä¸åŒçš„é¢œè‰²ã€‚ é¡¶ç‚¹ç€è‰²å™¨ç°åœ¨åº”è¯¥åŒ…å«ä¸€ä¸ªé¢œè‰²çš„æ•°ç»„ï¼Œå°±åƒå®ƒå¯¹ä½ç½®ä¸€æ ·.</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="type">vec3</span> colors[<span class="number">3</span>] = <span class="type">vec3</span>[](</span><br><span class="line">    <span class="comment">// vec3(r,g,b)</span></span><br><span class="line">    <span class="type">vec3</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">    <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>),</span><br><span class="line">    <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸€ä¸ªvec3å¯¹åº”ä¸€ä¸ªé¡¶ç‚¹ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦å°†è¿™äº›é¡¶ç‚¹é¢œè‰²ä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨ï¼Œè¿™æ ·å°±å¯ä»¥å°†å®ƒä»¬çš„æ’å€¼è¾“å‡ºåˆ°å¸§ç¼“å†²åŒºã€‚<br>å°†é¢œè‰²è¾“å‡ºæ·»åŠ åˆ°é¡¶ç‚¹ç€è‰²å™¨å¹¶åœ¨mainå‡½æ•°ä¸­å†™å…¥ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"></span><br><span class="line"><span class="type">vec2</span> positions[<span class="number">3</span>] = <span class="type">vec2</span>[](</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">0.0</span>, <span class="number">-0.5</span>),</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">0.5</span>, <span class="number">0.5</span>),</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">-0.5</span>, <span class="number">0.5</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(positions[gl_VertexIndex], <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    fragColor = colors[gl_VertexIndex];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­æ·»åŠ åŒ¹é…çš„è¾“å…¥ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"><span class="meta">#extension GL_ARB_separate_shader_objects : enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸§ç¼“å†²åŒºçš„ç´¢å¼•ä¸º0</span></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    outColor = <span class="type">vec4</span>(fragColor, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥å˜é‡ä¸ä¸€å®šå¿…é¡»ä½¿ç”¨ç›¸åŒçš„åç§°ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨locationæŒ‡ä»¤æŒ‡å®šçš„ç´¢å¼•è®²å®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·ã€‚<br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒfragColorçš„å€¼å°†è‡ªåŠ¨æ’å…¥ä¸‰ä¸ªé¡¶ç‚¹ä¹‹é—´çš„ç‰‡æ®µï¼Œä»è€Œäº§ç”Ÿå¹³æ»‘çš„æ¸å˜ã€‚</p>
<h2 id="3-4-ç¼–è¯‘ç€è‰²å™¨"><a href="#3-4-ç¼–è¯‘ç€è‰²å™¨" class="headerlink" title="3.4 ç¼–è¯‘ç€è‰²å™¨"></a>3.4 ç¼–è¯‘ç€è‰²å™¨</h2><p>é¦–å…ˆåœ¨æˆ‘ä»¬çš„å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª shaders çš„ç›®å½•ï¼Œç”¨äºä¿å­˜æˆ‘ä»¬çš„ç€è‰²å™¨ã€‚<br>é¦–å…ˆæ˜¯ shader.vert æ–‡ä»¶ï¼š</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"><span class="meta">#extension GL_ARB_separate_shader_objects : enable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºä¸ºfragColor</span></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‰è§’å½¢é¡¶ç‚¹åæ ‡</span></span><br><span class="line"><span class="type">vec2</span> positions[<span class="number">3</span>] = <span class="type">vec2</span>[](</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">0.0</span>, <span class="number">-0.5</span>),</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">0.5</span>, <span class="number">0.5</span>),</span><br><span class="line">    <span class="type">vec2</span>(<span class="number">-0.5</span>, <span class="number">0.5</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸å˜é¢œè‰²</span></span><br><span class="line"><span class="type">vec3</span> colors[<span class="number">3</span>] = <span class="type">vec3</span>[](</span><br><span class="line">    <span class="type">vec3</span>(<span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>),</span><br><span class="line">    <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>),</span><br><span class="line">    <span class="type">vec3</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    <span class="built_in">gl_Position</span> = <span class="type">vec4</span>(positions[gl_VertexIndex], <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br><span class="line">    fragColor = colors[gl_VertexIndex];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ shader.frag æ–‡ä»¶:</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#version 450</span></span><br><span class="line"><span class="meta">#extension GL_ARB_separate_shader_objects : enable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">in</span> <span class="type">vec3</span> fragColor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">layout</span>(<span class="keyword">location</span> = <span class="number">0</span>) <span class="keyword">out</span> <span class="type">vec4</span> outColor;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">    outColor = <span class="type">vec4</span>(fragColor, <span class="number">1.0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-1-Linuxå¹³å°ä¸‹ç¼–è¯‘æ–¹å¼"><a href="#3-4-1-Linuxå¹³å°ä¸‹ç¼–è¯‘æ–¹å¼" class="headerlink" title="3.4.1 Linuxå¹³å°ä¸‹ç¼–è¯‘æ–¹å¼"></a>3.4.1 Linuxå¹³å°ä¸‹ç¼–è¯‘æ–¹å¼</h3><p>ä½¿ç”¨ vulkan SDKä¸­çš„glslangValidatoræ¥ç¼–è¯‘shaderæ–‡ä»¶:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/home/user/VulkanSDK/x.x.x.x/x86_64/bin/glslangValidator -V shader.vert</span></span><br><span class="line"><span class="comment">#/home/user/VulkanSDK/x.x.x.x/x86_64/bin/glslangValidator -V shader.frag</span></span><br><span class="line">/home/jh/Program/vulkan/1.1.106.0/x86_64/bin/glslangValidator -V shader.vert</span><br><span class="line">/home/jh/Program/vulkan/1.1.106.0/x86_64/bin/glslangValidator -V shader.frag</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¸Šé¢çš„è„šæœ¬åï¼Œä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆå¯¹åº”çš„: frag.spvå’Œvert.spvæ–‡ä»¶<br><img src="/images/Vulkan%E5%85%A5%E9%97%A8-5-%E5%9B%BE%E5%83%8F%E8%A7%86%E5%9B%BE%E5%8F%8APipeline%E7%AE%80%E8%BF%B0/Vulkan_5_5.png" alt="Vulkan_5_5.png"></p>
<h3 id="3-4-2-Windowså¹³å°ç¼–è¯‘æ–¹å¼"><a href="#3-4-2-Windowså¹³å°ç¼–è¯‘æ–¹å¼" class="headerlink" title="3.4.2 Windowså¹³å°ç¼–è¯‘æ–¹å¼"></a>3.4.2 Windowså¹³å°ç¼–è¯‘æ–¹å¼</h3><p>ç±»ä¼¼ï¼Œä¸èµ˜è¿°</p>
<p>å¦å¤–Vulkan SDKåŒ…å«libshadercåº“ï¼Œç”¨äºä»ç¨‹åºä¸­å°†GLSLä»£ç ç¼–è¯‘ä¸ºSPIR-Vã€‚</p>
<h2 id="3-5-åŠ è½½ç€è‰²å™¨"><a href="#3-5-åŠ è½½ç€è‰²å™¨" class="headerlink" title="3.5 åŠ è½½ç€è‰²å™¨"></a>3.5 åŠ è½½ç€è‰²å™¨</h2><p>åŠ è½½ç€è‰²å™¨å°±æ˜¯è¯»å–æˆ‘ä»¬ç¼–è¯‘å¥½çš„shaderæ–‡ä»¶:frag.spvå’Œvert.spv.<br>c++ä¸­è¯»å–æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> std::vector&lt;<span class="type">char</span>&gt; <span class="title">readFile</span><span class="params">(<span class="type">const</span> std::string&amp; filename)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ate: ä»æ–‡ä»¶æœ«å°¾å¼€å§‹é˜…è¯»</span></span><br><span class="line">    <span class="comment">// binary: äºŒè¿›åˆ¶æµå½¢å¼</span></span><br><span class="line">    <span class="function">std::ifstream <span class="title">file</span><span class="params">(filename, std::ios::ate | std::ios::binary)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!file.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to open file!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> fileSize = (<span class="type">size_t</span>) file.<span class="built_in">tellg</span>();</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">char</span>&gt; <span class="title">buffer</span><span class="params">(fileSize)</span></span>;</span><br><span class="line"></span><br><span class="line">    file.<span class="built_in">seekg</span>(<span class="number">0</span>);</span><br><span class="line">    file.<span class="built_in">read</span>(buffer.<span class="built_in">data</span>(), fileSize);</span><br><span class="line"></span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    <span class="keyword">return</span> buffer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯”å¦‚è¯»å– vert.spv:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> vertShaderCode = <span class="built_in">readFile</span>(<span class="string">&quot;shaders/vert.spv&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>è¯»å–æˆåŠŸåï¼Œè®°å¾—checkä¸€ä¸‹æ–‡ä»¶å¤§å°æ˜¯å¦åŒ¹é…ã€‚</p>
<h2 id="3-6-åˆ›å»ºç€è‰²å™¨æ¨¡å—-shader-modules-VkShaderModule"><a href="#3-6-åˆ›å»ºç€è‰²å™¨æ¨¡å—-shader-modules-VkShaderModule" class="headerlink" title="3.6 åˆ›å»ºç€è‰²å™¨æ¨¡å—(shader modules - VkShaderModule)"></a>3.6 åˆ›å»ºç€è‰²å™¨æ¨¡å—(shader modules - VkShaderModule)</h2><p>åœ¨Vulkanä¸­ä½¿ç”¨VkShaderModuleå­˜å‚¨ç€è‰²å™¨. ä½¿ç”¨ç»“æ„ä½“ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkShaderModuleCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType              sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                  pNext;</span><br><span class="line">    VkShaderModuleCreateFlags    flags;</span><br><span class="line">    <span class="type">size_t</span>                       codeSize;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span>*              pCode;</span><br><span class="line">&#125; VkShaderModuleCreateInfo;</span><br></pre></td></tr></table></figure>
<p>å°è£…æˆcreateShaderModuleæ–¹æ³•,æ–¹ä¾¿åç»­è°ƒç”¨.<br>å…¶å®VkShaderModuleåªæ˜¯ä¸€ä¸ªå¯¹ç€è‰²å™¨æ–‡ä»¶çš„å°è£…è€Œå·²ã€‚ä½¿ç”¨æ–¹æ³•ï¼švkCreateShaderModule</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkShaderModule <span class="title">createShaderModule</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">char</span>&gt;&amp; code)</span> </span>&#123;</span><br><span class="line">    VkShaderModuleCreateInfo createInfo = &#123;&#125;;</span><br><span class="line">    createInfo.sType = VK_STRUCTURE_TYPE_SHADER_MODULE_CREATE_INFO;</span><br><span class="line">    createInfo.codeSize = code.<span class="built_in">size</span>();</span><br><span class="line">    createInfo.pCode = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">const</span> <span class="type">uint32_t</span>*&gt;(code.<span class="built_in">data</span>());</span><br><span class="line"></span><br><span class="line">    VkShaderModule shaderModule;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// vkResult device, const  *pCreateInfo, const VkAllocationCallbacks *pAllocator, VkShaderModule *pShaderModule)</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateShaderModule</span>(device, &amp;createInfo, <span class="literal">nullptr</span>, &amp;shaderModule) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create shader module!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> shaderModule;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-7-ç€è‰²å™¨é˜¶æ®µåˆ›å»º-shader-stage"><a href="#3-7-ç€è‰²å™¨é˜¶æ®µåˆ›å»º-shader-stage" class="headerlink" title="3.7 ç€è‰²å™¨é˜¶æ®µåˆ›å»º(shader stage)"></a>3.7 ç€è‰²å™¨é˜¶æ®µåˆ›å»º(shader stage)</h2><p>åªæ˜¯æœ‰ VkShaderModuleï¼Œè¿˜ä¸å¤Ÿã€‚è¦ä½¿ç”¨ç€è‰²å™¨ï¼Œè¿˜éœ€è¦åœ¨åˆ›å»ºç®¡é“(Pipeline)æ—¶ï¼Œä½¿ç”¨VkPipelineShaderStageCreateInfoç»“æ„è®²å…¶åˆ†é…åˆ°ç‰¹å®šçš„ç®¡é“é˜¶æ®µã€‚<br>æ¯”å¦‚åœ¨ç®¡é“ä¸­å¡«å……é¡¶ç‚¹ç€è‰²å™¨: vert.spv</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipelineShaderStageCreateInfo vertShaderStageInfo = &#123;&#125;;</span><br><span class="line">vertShaderStageInfo.sType = VK_STRUCTURE_TYPE_PIPELINE_SHADER_STAGE_CREATE_INFO;</span><br><span class="line">vertShaderStageInfo.stage = VK_SHADER_STAGE_VERTEX_BIT; <span class="comment">// æŒ‡æ˜å½“å‰æ˜¯é¡¶ç‚¹é˜¶æ®µ (3.7.1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šåŒ…å«ä»£ç çš„ç€è‰²å™¨æ¨¡å—</span></span><br><span class="line">vertShaderStageInfo.<span class="keyword">module</span> = vertShaderModule;</span><br><span class="line"><span class="comment">// æŒ‡å®šè¦è°ƒç”¨çš„ç€è‰²å™¨æ¨¡å—å‡½æ•°ï¼ˆç§°ä¸ºå…¥å£ç‚¹ï¼‰</span></span><br><span class="line">vertShaderStageInfo.pName = <span class="string">&quot;main&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ªï¼ˆå¯é€‰çš„ï¼‰æˆå‘˜pSpecializationInfoï¼Œè¿™é‡Œä¸ä¼šåœ¨è¿™é‡Œä½¿ç”¨ã€‚å®ƒå…è®¸æ‚¨æŒ‡å®šç€è‰²å™¨å¸¸é‡çš„å€¼ã€‚<br>å½“ä½¿ç”¨å•ä¸ªç€è‰²å™¨æ¨¡å—ï¼Œé€šè¿‡ä¸ºå…¶ä¸­ä½¿ç”¨çš„å¸¸é‡æŒ‡å®šä¸åŒçš„å€¼ï¼Œå°±å¯ä»¥åœ¨åˆ›å»ºç®¡é“æ—¶é…ç½®å…¶è¡Œä¸ºã€‚<br>è¿™æ¯”åœ¨æ¸²æŸ“æ—¶ä½¿ç”¨å˜é‡é…ç½®ç€è‰²å™¨æ›´æœ‰æ•ˆï¼Œå› ä¸ºç¼–è¯‘å™¨å¯ä»¥æ‰§è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚æ¶ˆé™¤ä¾èµ–äºè¿™äº›å€¼çš„ifè¯­å¥ã€‚<br>é»˜è®¤ä¸ºnullptrï¼Œstructåˆå§‹åŒ–ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚</p>
<h3 id="3-7-1-Shader-Stage"><a href="#3-7-1-Shader-Stage" class="headerlink" title="3.7.1 Shader Stage"></a>3.7.1 Shader Stage</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkShaderStageFlagBits</span> &#123;</span><br><span class="line">    VK_SHADER_STAGE_VERTEX_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_SHADER_STAGE_GEOMETRY_BIT = <span class="number">0x00000008</span>,</span><br><span class="line">    VK_SHADER_STAGE_FRAGMENT_BIT = <span class="number">0x00000010</span>,</span><br><span class="line">    VK_SHADER_STAGE_COMPUTE_BIT = <span class="number">0x00000020</span>,</span><br><span class="line">    VK_SHADER_STAGE_ALL_GRAPHICS = <span class="number">0x0000001F</span>,</span><br><span class="line">    VK_SHADER_STAGE_ALL = <span class="number">0x7FFFFFFF</span>,</span><br><span class="line">    VK_SHADER_STAGE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkShaderStageFlagBits;</span><br></pre></td></tr></table></figure>
<ul>
<li>VK_SHADER_STAGE_VERTEX_BIT: é¡¶ç‚¹é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_TESSELLATION_CONTROL_BIT: æ›²é¢ç»†åˆ†æ§åˆ¶é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_TESSELLATION_EVALUATION_BIT: æ›²é¢ç»†åˆ†è¯„ä¼°é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_GEOMETRY_BIT: å‡ ä½•é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_FRAGMENT_BIT: ç‰‡æ®µé˜¶æ®µ</li>
<li>VK_SHADER_STAGE_COMPUTE_BIT: è®¡ç®—é˜¶æ®µ</li>
<li>VK_SHADER_STAGE_ALL_GRAPHICS: ç”¨ä½œé€Ÿè®°çš„ä½ç»„åˆï¼Œç”¨äºæŒ‡å®šä¸Šé¢å®šä¹‰çš„æ‰€æœ‰å›¾å½¢é˜¶æ®µï¼ˆä¸åŒ…æ‹¬è®¡ç®—é˜¶æ®µï¼‰ã€‚</li>
<li>VK_SHADER_STAGE_FLAG_BITS_MAX_ENUM: ç”¨ä½œé€Ÿè®°çš„ä½ç»„åˆï¼Œç”¨äºæŒ‡å®šè®¾å¤‡æ”¯æŒçš„æ‰€æœ‰ç€è‰²å™¨é˜¶æ®µï¼ŒåŒ…æ‹¬æ‰©å±•å¼•å…¥çš„æ‰€æœ‰å…¶ä»–é˜¶æ®µã€‚</li>
</ul>
<h3 id="3-7-2-ä¸ºç€è‰²å™¨æŒ‡å®šç®¡é“"><a href="#3-7-2-ä¸ºç€è‰²å™¨æŒ‡å®šç®¡é“" class="headerlink" title="3.7.2 ä¸ºç€è‰²å™¨æŒ‡å®šç®¡é“"></a>3.7.2 ä¸ºç€è‰²å™¨æŒ‡å®šç®¡é“</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createGraphicsPipeline</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> vertShaderCode = <span class="built_in">readFile</span>(<span class="string">&quot;shaders/vert.spv&quot;</span>);</span><br><span class="line">    <span class="keyword">auto</span> fragShaderCode = <span class="built_in">readFile</span>(<span class="string">&quot;shaders/frag.spv&quot;</span>);</span><br><span class="line"></span><br><span class="line">    VkShaderModule vertShaderModule = <span class="built_in">createShaderModule</span>(vertShaderCode);</span><br><span class="line">    VkShaderModule fragShaderModule = <span class="built_in">createShaderModule</span>(fragShaderCode);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œä¸ºç®¡é“æŒ‡å®šç€è‰²å™¨</span></span><br><span class="line">    VkPipelineShaderStageCreateInfo shaderStages[] =  &#123;vertShaderStageInfo, fragShaderStageInfo&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å¾—é”€æ¯shader</span></span><br><span class="line">    <span class="built_in">vkDestroyShaderModule</span>(device, vertShaderModule, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkDestroyShaderModule</span>(device, fragShaderModule, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å›¾å½¢ç®¡é“ å…¶ä»–éƒ¨åˆ†è®¾ç½®åœ¨ä¸‹ä¸ªæ–‡ç« ä¸­è®¨è®ºã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(7)-æ¸²æŸ“è¿‡ç¨‹åŠåˆ›å»ºå›¾å½¢ç®¡é“</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-7-%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B%E5%8F%8A%E5%88%9B%E5%BB%BA%E5%9B%BE%E5%BD%A2%E7%AE%A1%E9%81%93/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>Render passes, å³æ¸²æŸ“è¿‡ç¨‹ã€‚åœ¨å®Œæˆåˆ›å»ºç®¡é“ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰Vulkanæ¸²æŸ“æ—¶å°†ä½¿ç”¨çš„å¸§ç¼“å†²åŒºé™„ä»¶ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦æŒ‡å®šå°†æœ‰å¤šå°‘é¢œè‰²å’Œæ·±åº¦ç¼“å†²åŒºï¼Œä¸ºæ¯ä¸ªç¼“å†²åŒºä½¿ç”¨å¤šå°‘ä¸ªæ ·æœ¬ï¼Œä»¥åŠåœ¨æ•´ä¸ªæ¸²æŸ“æ“ä½œä¸­åº”å¦‚ä½•å¤„ç†å®ƒä»¬çš„å†…å®¹ã€‚</p>
<p>æ‰€æœ‰è¿™äº›ä¿¡æ¯éƒ½åŒ…è£…åœ¨ä¸€ä¸ªrender passå¯¹è±¡ä¸­ï¼Œä¸ºå…¶åˆ›å»ºä¸€ä¸ªæ–°çš„createRenderPasså‡½æ•°ã€‚åœ¨createGraphicsPipelineä¹‹å‰ä»initVulkanè°ƒç”¨æ­¤å‡½æ•°ã€‚</p>
<span id="more"></span>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">createInstance</span>();</span><br><span class="line">    <span class="built_in">setupDebugCallback</span>();</span><br><span class="line">    <span class="built_in">createSurface</span>();</span><br><span class="line">    <span class="built_in">pickPhysicalDevice</span>();</span><br><span class="line">    <span class="built_in">createLogicalDevice</span>();</span><br><span class="line">    <span class="built_in">createSwapChain</span>();</span><br><span class="line">    <span class="built_in">createImageViews</span>();</span><br><span class="line">    <span class="built_in">createRenderPass</span>();</span><br><span class="line">    <span class="built_in">createGraphicsPipeline</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createRenderPass</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Vulkanå›¾å½¢ç®¡çº¿å’Œè®¡ç®—ç®¡çº¿çš„åŒºåˆ«ä¹‹ä¸€æ˜¯ï¼Œä½ ä½¿ç”¨å›¾å½¢ç®¡çº¿æ¥æ¸²æŸ“å‡ºåƒç´ ï¼Œç»„æˆå›¾åƒä»¥ä¾›å¤„ç†æˆ–æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚åœ¨å¤æ‚çš„å›¾å½¢åº”ç”¨ç¨‹åºä¸­ï¼Œå›¾ç‰‡ç»è¿‡å¾ˆå¤šéæ„å»ºï¼Œæ¯ä¸€ééƒ½ç”Ÿæˆåœºæ™¯çš„ä¸€éƒ¨åˆ†ï¼Œåº”ç”¨å…¨å¸§æ•ˆæœå¦‚åæœŸå¤„ç†ã€åˆæˆã€æ¸²æŸ“ç”¨æˆ·ç•Œé¢å…ƒç´ ç­‰ç­‰ã€‚è¿™æ ·çš„ä¸€éå¯ä»¥ä½¿ç”¨Vulkan ä¸­ renderpass å¯¹è±¡è¡¨ç¤ºã€‚</p>
<p>ä¸€ä¸ªå•ä¸€çš„çš„renderpasså¯¹è±¡å°è£…äº†å¤šä¸ªpassæˆ–è€…ä¸€ç³»åˆ—æœ€ç»ˆå›¾åƒçš„å‡ ä¸ªæ¸²æŸ“é˜¶æ®µï¼Œrenderpasså¯¹è±¡åŒ…å«è¾“å‡ºå›¾åƒæ‰€éœ€çš„ä¿¡æ¯ã€‚</p>
<p>æ‰€æœ‰çš„ç»˜åˆ¶å¿…é¡»è¢«åŒ…å«åœ¨ä¸€ä¸ªrenderpassä¸­ã€‚ç”šè‡³ï¼Œå›¾å½¢ç®¡çº¿éœ€è¦çŸ¥é“ä»–ä»¬æŠŠæ¸²æŸ“ç»“æœå‘å¾€å“ªå„¿ï¼Œå› æ­¤ï¼Œæœ‰å¿…è¦åœ¨åˆ›å»ºå›¾å½¢ç®¡çº¿ä¹‹å‰åˆ›å»ºä¸€ä¸ªrenderpasså¯¹è±¡ï¼Œå‘ŠçŸ¥æ­£åœ¨ç”Ÿæˆå›¾åƒçš„ç®¡çº¿æœ‰å…³å›¾åƒçš„ä¿¡æ¯ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><h1 id="ä¸€-Attachment-description-é™„ä»¶è¯´æ˜"><a href="#ä¸€-Attachment-description-é™„ä»¶è¯´æ˜" class="headerlink" title="ä¸€. Attachment description é™„ä»¶è¯´æ˜"></a>ä¸€. Attachment description é™„ä»¶è¯´æ˜</h1><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»…æœ‰ä¸€ä¸ªé¢œè‰²ç¼“å†²åŒºé™„ä»¶ï¼Œç”±äº¤æ¢é“¾ä¸­çš„ä¸€ä¸ªå›¾åƒè¡¨ç¤ºã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createRenderPass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkAttachmentDescription colorAttachment = &#123;&#125;;</span><br><span class="line">    colorAttachment.format = swapChainImageFormat;</span><br><span class="line">    colorAttachment.samples = VK_SAMPLE_COUNT_1_BIT;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¢œè‰²é™„ä»¶çš„æ ¼å¼åº”è¯¥ä¸äº¤æ¢é“¾å›¾åƒçš„æ ¼å¼åŒ¹é…ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜æ²¡æœ‰å¯¹å¤šé‡é‡‡æ ·åšä»»ä½•äº‹æƒ…ï¼Œæ‰€ä»¥åªè¦ä½¿ç”¨1ä¸ªæ ·æœ¬ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">colorAttachment.loadOp = VK_ATTACHMENT_LOAD_OP_CLEAR;</span><br><span class="line">colorAttachment.storeOp = VK_ATTACHMENT_STORE_OP_STORE;</span><br><span class="line"></span><br><span class="line">colorAttachment.stencilLoadOp = VK_ATTACHMENT_LOAD_OP_DONT_CARE;</span><br><span class="line">colorAttachment.stencilStoreOp = VK_ATTACHMENT_STORE_OP_DONT_CARE;</span><br></pre></td></tr></table></figure>
<p>loadOpå’ŒstoreOpå†³å®šåœ¨å‘ˆç°ä¹‹å‰å’Œå‘ˆç°ä¹‹åå¦‚ä½•å¤„ç†é™„ä»¶ä¸­çš„æ•°æ®ã€‚loadOpå’ŒstoreOpåº”ç”¨äºé¢œè‰²å’Œæ·±åº¦æ•°æ®ï¼Œä»¥åŠstencilLoadOp&#x2F;<br>stencilStoreOpåº”ç”¨äºæ¨¡å…·æ•°æ®ã€‚è¿™é‡Œä¸ä¼šå¯¹æ¨¡æ¿ç¼“å†²åŒºæ‰§è¡Œä»»ä½•æ“ä½œï¼Œå› æ­¤åŠ è½½å’Œå­˜å‚¨çš„ç»“æœæ˜¯æ— å…³çš„ã€‚</p>
<h2 id="1-1-loadOp"><a href="#1-1-loadOp" class="headerlink" title="1.1 loadOp"></a>1.1 loadOp</h2><ol>
<li>VK_ATTACHMENT_LOAD_OP_LOAD: æŒ‡å®šå°†ä¿ç•™æ¸²æŸ“åŒºåŸŸä¸­å›¾åƒçš„å…ˆå‰å†…å®¹ã€‚å¯¹äºæ·±åº¦&#x2F;æ¨¡å…·æ ¼å¼çš„é™„ä»¶ï¼Œè¿™å°†ä½¿ç”¨è®¿é—®ç±»å‹VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READä½ã€‚å¯¹äºé¢œè‰²æ ¼å¼çš„é™„ä»¶ï¼Œè¿™å°†ä½¿ç”¨è®¿é—®ç±»å‹VK_ACCESS_COLOR_ATTACHMENT_READä½ã€‚</li>
<li>VK_ATTACHMENT_LOAD_OP_CLEAR: æŒ‡å®šå°†æ¸²æŸ“åŒºåŸŸä¸­çš„å†…å®¹æ¸…é™¤ä¸ºç»Ÿä¸€å€¼ï¼Œè¯¥å€¼åœ¨æ¸²æŸ“è¿‡ç¨‹å®ä¾‹å¼€å§‹æ—¶æŒ‡å®šã€‚å¯¹äºæ·±åº¦&#x2F;æ¨¡æ¿æ ¼å¼çš„é™„ä»¶ï¼Œè¿™å°†ä½¿ç”¨è®¿é—®ç±»å‹VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITEä½ã€‚å¯¹äºé¢œè‰²æ ¼å¼çš„é™„ä»¶ï¼Œè¿™å°†ä½¿ç”¨è®¿é—®ç±»å‹VK_ACCESS_COLOR_ATTACHMENT_WRITEä½ã€‚</li>
<li>VK_ATTACHMENT_LOAD_OP_DONT_CARE: æŒ‡å®šä¸éœ€è¦ä¿ç•™åŒºåŸŸä¸­çš„å‰ä¸€ä¸ªå†…å®¹ï¼›é™„ä»¶çš„å†…å®¹å°†åœ¨æ¸²æŸ“åŒºåŸŸå†…æœªå®šä¹‰ã€‚å¯¹äºæ·±åº¦&#x2F;æ¨¡æ¿æ ¼å¼çš„é™„ä»¶ï¼Œè¿™å°†ä½¿ç”¨è®¿é—®ç±»å‹VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITEä½ã€‚å¯¹äºé¢œè‰²æ ¼å¼çš„é™„ä»¶ï¼Œè¿™å°†ä½¿ç”¨è®¿é—®ç±»å‹VK_ACCESS_COLOR_ATTACHMENT_WRITEä½ã€‚</li>
</ol>
<h2 id="1-2-storeOp"><a href="#1-2-storeOp" class="headerlink" title="1.2 storeOp"></a>1.2 storeOp</h2><ol>
<li>VK_ATTACHMENT_STORE_OP_STORE: æŒ‡å®šåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­å’Œæ¸²æŸ“åŒºåŸŸå†…ç”Ÿæˆçš„å†…å®¹å†™å…¥å†…å­˜ï¼Œä»¥åå¯ä»¥è¯»å–</li>
<li>VK_ATTACHMENT_STORE_OP_DONT_CARE: æŒ‡å®šæ¸²æŸ“åä¸éœ€è¦æ¸²æŸ“åŒºåŸŸå†…çš„å†…å®¹ï¼Œè¿™äº›å†…å®¹å¯èƒ½ä¼šè¢«ä¸¢å¼ƒï¼›é™„ä»¶çš„å†…å®¹å°†åœ¨æ¸²æŸ“åŒºåŸŸå†…æœªå®šä¹‰ã€‚</li>
</ol>
<h2 id="1-3-å†…å­˜ä¸­åƒç´ çš„å¸ƒå±€"><a href="#1-3-å†…å­˜ä¸­åƒç´ çš„å¸ƒå±€" class="headerlink" title="1.3 å†…å­˜ä¸­åƒç´ çš„å¸ƒå±€"></a>1.3 å†…å­˜ä¸­åƒç´ çš„å¸ƒå±€</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">colorAttachment.initialLayout = VK_IMAGE_LAYOUT_UNDEFINED;</span><br><span class="line">colorAttachment.finalLayout = VK_IMAGE_LAYOUT_PRESENT_SRC_KHR;</span><br></pre></td></tr></table></figure>
<p>Vulkanä¸­çš„çº¹ç†å’Œå¸§ç¼“å†²åŒºç”±å…·æœ‰ç‰¹å®šåƒç´ æ ¼å¼çš„VkImageå¯¹è±¡è¡¨ç¤ºï¼Œä½†æ˜¯ï¼Œå†…å­˜ä¸­åƒç´ çš„å¸ƒå±€å¯èƒ½ä¼šæ ¹æ®æ‚¨å°è¯•å¯¹å›¾åƒæ‰§è¡Œçš„æ“ä½œè€Œæ”¹å˜ã€‚</p>
<p>initialLayoutæŒ‡å®šåœ¨æ¸²æŸ“è¿‡ç¨‹å¼€å§‹ä¹‹å‰å›¾åƒå°†å…·æœ‰çš„å¸ƒå±€ã€‚finalLayoutæœ€ç»ˆå¸ƒå±€æŒ‡å®šæ¸²æŸ“è¿‡ç¨‹å®Œæˆæ—¶è‡ªåŠ¨è½¬æ¢åˆ°çš„å¸ƒå±€ã€‚</p>
<p>å¯¹initialLayoutä½¿ç”¨VK_IMAGE_LAYOUT_UNDEFINEDæ„å‘³ç€æˆ‘ä»¬ä¸å…³å¿ƒå›¾åƒåœ¨ä»¥å‰çš„å¸ƒå±€ä¸­æ˜¯ä»€ä¹ˆã€‚è¿™ä¸ªç‰¹æ®Šå€¼çš„è­¦å‘Šæ˜¯å›¾åƒçš„å†…å®¹ä¸èƒ½ä¿è¯è¢«ä¿å­˜ï¼Œä½†è¿™å¹¶ä¸é‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬æ— è®ºå¦‚ä½•éƒ½è¦æ¸…é™¤å®ƒã€‚<strong>æˆ‘ä»¬å¸Œæœ›å›¾åƒåœ¨æ¸²æŸ“åå¯ä»¥ä½¿ç”¨äº¤æ¢é“¾è¿›è¡Œæ˜¾ç¤ºï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨VK_IMAGE_LAYOUT_PRESENT_SRC_KHRä½œä¸ºfinalLayoutã€‚</strong></p>
<p>ä¸€äº›æœ€å¸¸è§çš„å¸ƒå±€æœ‰ï¼š</p>
<ol>
<li>VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL: ç”¨ä½œé¢œè‰²é™„ä»¶çš„å›¾åƒ</li>
<li>VK_IMAGE_LAYOUT_PRESENT_SRC_KHR: äº¤æ¢é“¾ä¸­è¦æ˜¾ç¤ºçš„å›¾åƒ</li>
<li>VK_IMAGE_LAYOUT_TRANSFER_DST_OPTIMAL: è¦ç”¨ä½œå†…å­˜å¤åˆ¶æ“ä½œç›®æ ‡çš„å›¾åƒ</li>
</ol>
<p>æˆ‘ä»¬å°†åœ¨â€œçº¹ç†â€ä¸€ç« ä¸­æ›´æ·±å…¥åœ°è®¨è®ºè¿™ä¸ªä¸»é¢˜ï¼Œä½†ç°åœ¨éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œå›¾åƒéœ€è¦è½¬æ¢åˆ°é€‚åˆå…¶ä¸‹ä¸€æ­¥å°†è¦æ¶‰åŠçš„æ“ä½œçš„ç‰¹å®šå¸ƒå±€ã€‚</p>
<h1 id="äºŒ-Subpasses-and-attachment-references-å­è¿‡ç¨‹å’Œé™„ä»¶å¼•ç”¨"><a href="#äºŒ-Subpasses-and-attachment-references-å­è¿‡ç¨‹å’Œé™„ä»¶å¼•ç”¨" class="headerlink" title="äºŒ. Subpasses and attachment references å­è¿‡ç¨‹å’Œé™„ä»¶å¼•ç”¨"></a>äºŒ. Subpasses and attachment references å­è¿‡ç¨‹å’Œé™„ä»¶å¼•ç”¨</h1><p>å•ä¸ªæ¸²æŸ“è¿‡ç¨‹å¯ä»¥ç”±å¤šä¸ªå­è¿‡ç¨‹ç»„æˆã€‚å­è¿‡ç¨‹æ˜¯ä¾èµ–äºå…ˆå‰è¿‡ç¨‹ä¸­å¸§ç¼“å†²åŒºçš„å†…å®¹çš„åç»­å‘ˆç°æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ä¸€ç³»åˆ—ç›¸ç»§åº”ç”¨çš„åå¤„ç†æ•ˆæœã€‚å¦‚æœå°†è¿™äº›æ¸²æŸ“æ“ä½œåˆ†ç»„åˆ°ä¸€ä¸ªæ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œåˆ™Vulkanèƒ½å¤Ÿå¯¹æ“ä½œé‡æ–°æ’åºï¼Œå¹¶èŠ‚çœå†…å­˜å¸¦å®½ä»¥è·å¾—å¯èƒ½æ›´å¥½çš„æ€§èƒ½ã€‚</p>
<p>è¿™é‡Œå¯¹äºä¸€ä¸ªä¸‰è§’å½¢ï¼Œä½¿ç”¨ä¸€ä¸ªå­è¿‡ç¨‹ã€‚</p>
<p>æ¯ä¸ªå­è¿‡ç¨‹å¼•ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªé™„ä»¶ï¼Œè¿™äº›é™„ä»¶æ˜¯æˆ‘ä»¬ä½¿ç”¨å‰é¢éƒ¨åˆ†ä¸­çš„ç»“æ„æè¿°çš„ã€‚è¿™äº›å¼•ç”¨æœ¬èº«å°±æ˜¯VKatAttchmentReferenceç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkAttachmentReference colorAttachmentRef = &#123;&#125;;</span><br><span class="line">colorAttachmentRef.attachment = <span class="number">0</span>;</span><br><span class="line">colorAttachmentRef.layout = VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL;</span><br></pre></td></tr></table></figure>

<ol>
<li>attachmentå‚æ•°é€šè¿‡é™„ä»¶æè¿°æ•°ç»„ä¸­çš„ç´¢å¼•æŒ‡å®šè¦å¼•ç”¨çš„é™„ä»¶ã€‚æˆ‘ä»¬çš„æ•°ç»„ç”±ä¸€ä¸ªVkAttachmentDescriptionç»„æˆï¼Œæ‰€ä»¥å®ƒçš„ç´¢å¼•æ˜¯0ã€‚</li>
<li>layoutæŒ‡å®šåœ¨ä½¿ç”¨æ­¤å¼•ç”¨çš„å­è¿‡ç¨‹æœŸé—´å¸Œæœ›é™„ä»¶å…·æœ‰çš„å¸ƒå±€ã€‚å½“å­è¿›ç¨‹å¯åŠ¨æ—¶ï¼ŒVulkanå°†è‡ªåŠ¨å°†é™„ä»¶è½¬æ¢åˆ°æ­¤å¸ƒå±€ã€‚ä½¿ç”¨é™„ä»¶ä½œä¸ºä¸€ä¸ªé¢œè‰²ç¼“å†²åŒºï¼ŒVK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL LAYOUTä¼šç»™æˆ‘ä»¬å¸¦æ¥æœ€å¥½çš„æ€§èƒ½ï¼Œé¡¾åæ€ä¹‰ã€‚</li>
</ol>
<p>å­è¿‡ç¨‹ä½¿ç”¨VkSubpassDescriptionç»“æ„è¿›è¡Œæè¿°ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkSubpassDescription subpass = &#123;&#125;;</span><br><span class="line">subpass.pipelineBindPoint = VK_PIPELINE_BIND_POINT_GRAPHICS;</span><br><span class="line">subpass.colorAttachmentCount = <span class="number">1</span>;</span><br><span class="line">subpass.pColorAttachments = &amp;colorAttachmentRef; <span class="comment">// æŒ‡å®šå¯¹é¢œè‰²é™„ä»¶çš„å¼•ç”¨</span></span><br></pre></td></tr></table></figure>
<p>Vulkanå°†æ¥ä¹Ÿå¯èƒ½æ”¯æŒè®¡ç®—å­è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ˜ç¡®è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå›¾å½¢å­è¿‡ç¨‹ã€‚<br>æ­¤æ•°ç»„ä¸­é™„ä»¶çš„ç´¢å¼•ç›´æ¥ä»å…·æœ‰layoutï¼ˆlocation&#x3D;0ï¼‰out vec4 outColoræŒ‡ä»¤çš„ç‰‡æ®µç€è‰²å™¨å¼•ç”¨ï¼</p>
<p>å­è¿‡ç¨‹å¯ä»¥å¼•ç”¨ä»¥ä¸‹ç±»å‹çš„é™„ä»¶ï¼š</p>
<ol>
<li>pColorAttachments: é¢œè‰²é™„ä»¶</li>
<li>pInputAttachments: ä»ç€è‰²å™¨è¯»å–çš„é™„ä»¶</li>
<li>pResolveAttachments: ç”¨äºå¤šé‡é‡‡æ ·é¢œè‰²é™„ä»¶çš„é™„ä»¶</li>
<li>pDepthStencilAttachment: æ·±åº¦å’Œæ¨¡æ¿æ•°æ®é™„ä»¶</li>
<li>pPreserveAttachments: æ­¤å­è¿‡ç¨‹æœªä½¿ç”¨ä½†å¿…é¡»ä¿ç•™æ•°æ®çš„é™„ä»¶</li>
</ol>
<h1 id="ä¸‰-Render-pass-æ¸²æŸ“è¿‡ç¨‹"><a href="#ä¸‰-Render-pass-æ¸²æŸ“è¿‡ç¨‹" class="headerlink" title="ä¸‰. Render pass æ¸²æŸ“è¿‡ç¨‹"></a>ä¸‰. Render pass æ¸²æŸ“è¿‡ç¨‹</h1><p>ä¸Šé¢å·²ç»æè¿°äº†é™„ä»¶å’Œå¼•ç”¨å®ƒçš„åŸºæœ¬å­è¿‡ç¨‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºæ¸²æŸ“è¿‡ç¨‹æœ¬èº«äº†ã€‚</p>
<p>æ¸²æŸ“è¿‡ç¨‹è¡¨ç¤ºé™„ä»¶ã€å­è¿‡ç¨‹å’Œå­è¿‡ç¨‹ä¹‹é—´çš„ä¾èµ–å…³ç³»çš„é›†åˆï¼Œå¹¶æè¿°å¦‚ä½•åœ¨å­è¿‡ç¨‹ä¸­ä½¿ç”¨é™„ä»¶ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»æˆå‘˜å˜é‡ï¼Œå°†VkRenderPasså¯¹è±¡ä¿æŒåœ¨pipelineLayoutå˜é‡çš„æ­£ä¸Šæ–¹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkRenderPass renderPass;</span><br><span class="line">VkPipelineLayout pipelineLayout;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥é€šè¿‡ä½¿ç”¨é™„ä»¶å’Œå­è¿‡ç¨‹æ•°ç»„å¡«å……VkRenderPassCreateInfoç»“æ„æ¥åˆ›å»ºæ¸²æŸ“è¿‡ç¨‹å¯¹è±¡ã€‚VkAttachmentReferenceå¯¹è±¡ä½¿ç”¨æ­¤æ•°ç»„çš„ç´¢å¼•å¼•ç”¨é™„ä»¶ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ¸²æŸ“è¿‡ç¨‹</span></span><br><span class="line">VkRenderPassCreateInfo renderPassInfo = &#123;&#125;;</span><br><span class="line">renderPassInfo.sType = VK_STRUCTURE_TYPE_RENDER_PASS_CREATE_INFO;</span><br><span class="line">renderPassInfo.attachmentCount = <span class="number">1</span>;</span><br><span class="line">renderPassInfo.pAttachments = &amp;colorAttachment;</span><br><span class="line">renderPassInfo.subpassCount = <span class="number">1</span>;</span><br><span class="line">renderPassInfo.pSubpasses = &amp;subpass;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">vkCreateRenderPass</span>(device, &amp;renderPassInfo, <span class="literal">nullptr</span>, &amp;renderPass) != VK_SUCCESS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create render pass!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ç®¡é“å¸ƒå±€ä¸€æ ·ï¼Œæ¸²æŸ“è¿‡ç¨‹å°†åœ¨æ•´ä¸ªç¨‹åºä¸­è¢«å¼•ç”¨ï¼Œå› æ­¤åªåº”åœ¨ç»“æŸæ—¶è¿›è¡Œæ¸…ç†ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vkDestroyPipelineLayout</span>(device, pipelineLayout, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkDestroyRenderPass</span>(device, renderPass, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›®å‰æˆ‘ä»¬ä»¥åŠåšäº†å¾ˆå¤šå·¥ä½œäº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åˆ›å»ºå›¾å½¢ç®¡é“å¯¹è±¡äº†ï¼</p>
<h1 id="å››-åˆ›å»º-pipeline"><a href="#å››-åˆ›å»º-pipeline" class="headerlink" title="å››. åˆ›å»º pipeline"></a>å››. åˆ›å»º pipeline</h1><p>å¿«é€Ÿå›é¡¾ç°åœ¨æ‹¥æœ‰çš„å¯¹è±¡ç±»å‹ï¼š</p>
<ol>
<li>shader stages: å®šä¹‰å›¾å½¢ç®¡é“å¯ç¼–ç¨‹é˜¶æ®µåŠŸèƒ½çš„ç€è‰²å™¨æ¨¡å—</li>
<li>Fixed-function state: å®šä¹‰ç®¡é“å›ºå®šå‡½æ•°é˜¶æ®µçš„æ‰€æœ‰ç»“æ„ï¼Œå¦‚è¾“å…¥ç¨‹åºé›†ã€å…‰æ …åŒ–å™¨ã€è§†å£å’Œé¢œè‰²æ··åˆ</li>
<li>Pipeline layout: å¯åœ¨ç»˜åˆ¶æ—¶æ›´æ–°çš„ç€è‰²å™¨å¼•ç”¨çš„ç»Ÿä¸€å€¼å’Œæ¨é€å€¼</li>
<li>Render pass: ç®¡é“é˜¶æ®µå¼•ç”¨çš„é™„ä»¶åŠå…¶ç”¨æ³•</li>
</ol>
<p>æ‰€æœ‰è¿™äº›ç»„åˆéƒ½å……åˆ†å®šä¹‰äº†å›¾å½¢ç®¡é“çš„åŠŸèƒ½ï¼Œå› æ­¤ç°åœ¨å¯ä»¥å¼€å§‹åœ¨createGraphicsPipelineå‡½æ•°æœ«å°¾å¡«å……VkGraphicsPipelineCreateInfoç»“æ„ã€‚<br>ä½†æ˜¯æ˜¯åœ¨è°ƒç”¨vkDestroyShaderModuleä¹‹å‰ï¼Œå› ä¸ºåœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨ä»ç„¶éœ€è¦ä½¿ç”¨è¿™äº›ç€è‰²å™¨ï¼</p>
<p>VkGraphicsPipelineCreateInfoç»“æ„åŒ…æ‹¬ä¸€ä¸ªshader-reate-infoç»“æ„æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æ‰€éœ€çš„æ´»åŠ¨ç€è‰²å™¨é˜¶æ®µã€å®šä¹‰æ‰€æœ‰ç›¸å…³å›ºå®šå‡½æ•°é˜¶æ®µçš„åˆ›å»ºä¿¡æ¯ä»¥åŠç®¡é“å¸ƒå±€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkGraphicsPipelineCreateInfo pipelineInfo = &#123;&#125;;</span><br><span class="line">pipelineInfo.sType = VK_STRUCTURE_TYPE_GRAPHICS_PIPELINE_CREATE_INFO;</span><br><span class="line">pipelineInfo.stageCount = <span class="number">2</span>;</span><br><span class="line">pipelineInfo.pStages = shaderStages;</span><br><span class="line"><span class="comment">// é¦–å…ˆå¼•ç”¨VkPipelineShaderStageCreateInfoç»“æ„çš„æ•°ç»„ã€‚</span></span><br><span class="line">pipelineInfo.pVertexInputState = &amp;vertexInputInfo;</span><br><span class="line">pipelineInfo.pInputAssemblyState = &amp;inputAssembly;</span><br><span class="line">pipelineInfo.pViewportState = &amp;viewportState;</span><br><span class="line">pipelineInfo.pRasterizationState = &amp;rasterizer;</span><br><span class="line">pipelineInfo.pMultisampleState = &amp;multisampling;</span><br><span class="line">pipelineInfo.pDepthStencilState = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">pipelineInfo.pColorBlendState = &amp;colorBlending;</span><br><span class="line">pipelineInfo.pDynamicState = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line"><span class="comment">// ç„¶åå¼•ç”¨æ‰€æœ‰æè¿°å›ºå®šå‡½æ•°é˜¶æ®µçš„ç»“æ„ã€‚</span></span><br><span class="line">pipelineInfo.layout = pipelineLayout;</span><br><span class="line"><span class="comment">// ä¹‹åæ˜¯ç®¡é“å¸ƒå±€ï¼Œå®ƒæ˜¯ä¸€ä¸ªVulkanå¥æŸ„è€Œä¸æ˜¯ç»“æ„æŒ‡é’ˆã€‚</span></span><br><span class="line">pipelineInfo.renderPass = renderPass;</span><br><span class="line">pipelineInfo.subpass = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬æœ‰äº†æ¸²æŸ“è¿‡ç¨‹çš„å¼•ç”¨ä»¥åŠä½¿ç”¨è¿™ä¸ªå›¾å½¢ç®¡é“çš„å­è¿‡ç¨‹çš„ç´¢å¼•ã€‚ä¹Ÿå¯ä»¥å°†å…¶ä»–æ¸²æŸ“è¿‡ç¨‹ç”¨äºæ­¤ç®¡é“è€Œä¸æ˜¯æ­¤ç‰¹å®šå®ä¾‹ï¼Œä½†å®ƒä»¬å¿…é¡»ä¸renderPasså…¼å®¹ã€‚ä¸‹é¢æè¿°äº†å…¼å®¹æ€§çš„è¦æ±‚ï¼Œä½†è¿™é‡Œä¸ä½¿ç”¨è¯¥ç‰¹æ€§ã€‚</p>
<p>å®é™…ä¸Šè¿˜æœ‰ä¸¤ä¸ªå‚æ•°ï¼šbasePipelineHandleå’ŒbasePipelineIndexã€‚</p>
<p>Vulkanå…è®¸é€šè¿‡ä»ç°æœ‰ç®¡é“æ´¾ç”Ÿæ¥åˆ›å»ºæ–°çš„å›¾å½¢ç®¡é“ã€‚ç®¡é“è¡ç”Ÿå“çš„æƒ³æ³•æ˜¯ï¼Œå½“ç®¡é“å…·æœ‰ä¸ç°æœ‰ç®¡é“å…·æœ‰è®¸å¤šç›¸åŒåŠŸèƒ½æ—¶ï¼Œè®¾ç½®ç®¡é“æˆæœ¬æ›´ä½ï¼Œå¹¶ä¸”å¯ä»¥æ›´å¿«åœ°åœ¨åŒä¸€çˆ¶ç®¡é“ä¹‹é—´åˆ‡æ¢ã€‚<br>å¯ä»¥æŒ‡å®šç°æœ‰ç®¡é“çš„å¥æŸ„ï¼ˆå¸¦æœ‰basePipelineHandleï¼‰ï¼Œä¹Ÿå¯ä»¥å¼•ç”¨å¦ä¸€ä¸ªå°†ç”±basePipelineIndexçš„ç´¢å¼•åˆ›å»ºçš„ç®¡é“ã€‚</p>
<p>ç°åœ¨åªæœ‰ä¸€ä¸ªç®¡é“ï¼Œæ‰€ä»¥åªéœ€è¦æŒ‡å®šä¸€ä¸ªnullå¥æŸ„å’Œä¸€ä¸ªæ— æ•ˆçš„ç´¢å¼•ã€‚åªæœ‰åœ¨VkGraphicsPipelineCreateInfoçš„flagså­—æ®µä¸­æŒ‡å®šVK_PIPELINE_CREATE_UBITæ ‡å¿—æ—¶ï¼Œæ‰ä½¿ç”¨è¿™äº›å€¼ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">pipelineInfo.basePipelineHandle = VK_NULL_HANDLE; <span class="comment">// Optional</span></span><br><span class="line">pipelineInfo.basePipelineIndex = <span class="number">-1</span>; <span class="comment">// Optional</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡åˆ›å»ºä¸€ä¸ªç±»æˆå‘˜æ¥ä¿å­˜VkPipelineå¯¹è±¡ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPipeline graphicsPipeline;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå›¾å½¢ç®¡é“</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">vkCreateGraphicsPipelines</span>(device, VK_NULL_HANDLE, <span class="number">1</span>,</span><br><span class="line">        &amp;pipelineInfo, <span class="literal">nullptr</span>, &amp;graphicsPipeline) != VK_SUCCESS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create graphics pipeline!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vkCreateGraphicsPipelineså®é™…ä¸Šæ¯”Vulkanä¸­å¸¸ç”¨çš„å¯¹è±¡åˆ›å»ºå‡½æ•°æœ‰æ›´å¤šçš„å‚æ•°ã€‚<br>å®ƒçš„è®¾è®¡æ˜¯æ”¯æŒåœ¨ä¸€æ¬¡è°ƒç”¨ä¸­è·å–å¤šä¸ªVkGraphicsPipelineCreateInfoå¯¹è±¡å¹¶åˆ›å»ºå¤šä¸ªVkPipelineå¯¹è±¡ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°ï¼ˆæˆ‘ä»¬ä¸ºå…¶ä¼ é€’äº†VK_NULL_HANDLEå‚æ•°ï¼‰å¼•ç”¨äº†ä¸€ä¸ªå¯é€‰çš„VkPipelineCacheå¯¹è±¡ã€‚ç®¡é“ç¼“å­˜å¯ç”¨äºåœ¨å¯¹vkCreateGraphicsPipelinesçš„å¤šä¸ªè°ƒç”¨ä¸­å­˜å‚¨å’Œé‡ç”¨ä¸ç®¡é“åˆ›å»ºç›¸å…³çš„æ•°æ®ï¼Œå¦‚æœç¼“å­˜å­˜å‚¨åˆ°æ–‡ä»¶ä¸­ï¼Œç”šè‡³å¯ä»¥è·¨ç¨‹åºæ‰§è¡Œã€‚è¿™ä½¿å¾—ä»¥åå¯ä»¥å¤§å¤§åŠ å¿«ç®¡é“çš„åˆ›å»ºé€Ÿåº¦ã€‚æˆ‘ä»¬å°†åœ¨ç®¡é“ç¼“å­˜ä¸­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æ‰€æœ‰å¸¸è§çš„ç»˜å›¾æ“ä½œéƒ½éœ€è¦å›¾å½¢ç®¡é“ï¼Œå› æ­¤ä¹Ÿåªèƒ½åœ¨ç¨‹åºç»“æŸæ—¶é”€æ¯ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vkDestroyPipeline</span>(device, graphicsPipeline, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkDestroyPipelineLayout</span>(device, pipelineLayout, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨è¿è¡Œç¨‹åºæ¥ç¡®è®¤æ‰€æœ‰è¿™äº›è‰°è‹¦çš„å·¥ä½œå·²ç»æˆåŠŸåœ°åˆ›å»ºäº†ç®¡é“ï¼æˆ‘ä»¬å·²ç»éå¸¸æ¥è¿‘çœ‹åˆ°å±å¹•ä¸Šå¼¹å‡ºä¸€äº›ä¸œè¥¿(å®é™…ç°åœ¨è¿˜æ²¡æœ‰çœ‹åˆ°ä»»ä½•ä¸œè¥¿ï¼Œé»‘ä¹ä¹ä¸€ç‰‡)ã€‚</p>
<p>æ¥ä¸‹æ¥å°†ä»äº¤æ¢é“¾å›¾åƒè®¾ç½®å®é™…çš„å¸§ç¼“å†²åŒºï¼Œå¹¶å‡†å¤‡ç»˜å›¾å‘½ä»¤ã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(8)-å¸§ç¼“å†²åŒºå’ŒæŒ‡ä»¤ç¼“å†²åŒº</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-8-%E5%B8%A7%E7%BC%93%E5%86%B2%E5%8C%BA%E5%92%8C%E6%8C%87%E4%BB%A4%E7%BC%93%E5%86%B2%E5%8C%BA/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>Framebuffers, å¸§ç¼“å†²åŒºã€‚ä¹‹å‰æˆ‘ä»¬åœ¨å­¦ä¹ â€™Swap Chain-äº¤æ¢é“¾â€™æ—¶æåˆ°Vulkanæ²¡æœ‰â€œé»˜è®¤å¸§ç¼“å†²åŒºâ€çš„æ¦‚å¿µï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åä¸º â€œswap chainâ€ å³äº¤æ¢é“¾ï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“çš„ç¼“å†²åŒºï¼Œå¿…é¡»åœ¨Vulkanä¸­æ˜ç¡®åˆ›å»ºã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®äº†æ¸²æŸ“è¿‡ç¨‹ï¼Œä»¥æœŸæœ›ä½¿ç”¨ä¸äº¤æ¢é“¾å›¾åƒç›¸åŒæ ¼å¼çš„å•ä¸ªå¸§ç¼“å†²åŒºï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•å¸§ç¼“å†²åŒºã€‚</p>
<p>é€šè¿‡å°†æ¸²æŸ“è¿‡ç¨‹åˆ›å»ºæœŸé—´æŒ‡å®šçš„é™„ä»¶åŒ…è£…åˆ°VkFramebufferå¯¹è±¡ä¸­æ¥ç»‘å®šé™„ä»¶ã€‚</p>
<p>å¸§ç¼“å†²åŒºå¯¹è±¡å¼•ç”¨è¡¨ç¤ºé™„ä»¶çš„æ‰€æœ‰VkImageViewå¯¹è±¡ã€‚åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œè¿™å°†åªæ˜¯ä¸€ä¸ªå•ä¸€çš„ï¼šé¢œè‰²é™„ä»¶ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨äºé™„ä»¶çš„å›¾åƒå–å†³äºåœ¨æ£€ç´¢ç”¨äºè¡¨ç¤ºçš„å›¾åƒæ—¶äº¤æ¢é“¾è¿”å›çš„å›¾åƒã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¸ºäº¤æ¢é“¾ä¸­çš„æ‰€æœ‰å›¾åƒåˆ›å»ºä¸€ä¸ªå¸§ç¼“å†²åŒºï¼Œå¹¶ä½¿ç”¨ä¸ç»˜åˆ¶æ—¶æ£€ç´¢åˆ°çš„å›¾åƒç›¸å¯¹åº”çš„å¸§ç¼“å†²åŒºã€‚</p>
<span id="more"></span>

<h1 id="ä¸€-VkFramebuffer-åˆ›å»ºå¸§ç¼“å†²åŒº"><a href="#ä¸€-VkFramebuffer-åˆ›å»ºå¸§ç¼“å†²åŒº" class="headerlink" title="ä¸€. VkFramebuffer åˆ›å»ºå¸§ç¼“å†²åŒº"></a>ä¸€. VkFramebuffer åˆ›å»ºå¸§ç¼“å†²åŒº</h1><p>å¸§ç¼“å†²åŒºç”±VkFramebufferå¥æŸ„è¡¨ç¤ºï¼š VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkFramebuffer)</p>
<p>é€šè¿‡è°ƒç”¨vkCreateFramebufferæ¥åˆ›å»ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateFramebuffer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkFramebufferCreateInfo*              pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkFramebuffer*                              pFramebuffer)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: åˆ›å»ºå¸§ç¼“å†²åŒºçš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfo: æŒ‡å‘VkFramebufferCreateInfoç»“æ„ï¼Œè¯¥ç»“æ„æè¿°æœ‰å…³å¸§ç¼“å†²åŒºåˆ›å»ºçš„é™„åŠ ä¿¡æ¯ã€‚</li>
<li>pAllocator: æ§åˆ¶ä¸»æœºå†…å­˜åˆ†é…</li>
<li>pFramebuffer: æŒ‡å‘è¿”å›ç»“æœå¸§ç¼“å†²åŒºå¯¹è±¡çš„VkFramebufferå¥æŸ„ã€‚</li>
</ol>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªVkFramebufferçš„é›†åˆæ¥ä¿å­˜æ‰€æœ‰å¸§ç¼“å†²:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">std::vector&lt;VkFramebuffer&gt; swapChainFramebuffers;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸€ä¸ªæ–°å‡½æ•°createFramebuffersä¸­ä¸ºè¯¥æ•°ç»„åˆ›å»ºå¯¹è±¡ï¼Œè¯¥å‡½æ•°åœ¨åˆ›å»ºå›¾å½¢ç®¡é“ä¹‹åç«‹å³ä»initVulkanè°ƒç”¨ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">createInstance</span>();</span><br><span class="line">    <span class="built_in">setupDebugCallback</span>();</span><br><span class="line">    <span class="built_in">createSurface</span>();</span><br><span class="line">    <span class="built_in">pickPhysicalDevice</span>();</span><br><span class="line">    <span class="built_in">createLogicalDevice</span>();</span><br><span class="line">    <span class="built_in">createSwapChain</span>();</span><br><span class="line">    <span class="built_in">createImageViews</span>();</span><br><span class="line">    <span class="built_in">createRenderPass</span>();</span><br><span class="line">    <span class="built_in">createGraphicsPipeline</span>();</span><br><span class="line">    <span class="built_in">createFramebuffers</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨createFramebuffersæœ€å¼€å§‹ï¼Œè°ƒæ•´å¸§ç¼“å†²åŒºå®¹å™¨çš„å¤§å°ä»¥å®¹çº³æ‰€æœ‰äº¤æ¢é“¾å›¾åƒè§†å›¾, ç„¶åéå†å›¾åƒè§†å›¾å¹¶ä»å®ƒä»¬åˆ›å»ºå¸§ç¼“å†²åŒºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createFramebuffers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    swapChainFramebuffers.<span class="built_in">resize</span>(swapChainImageViews.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; swapChainImageViews.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        VkImageView attachments[] = &#123;</span><br><span class="line">        swapChainImageViews[i]</span><br><span class="line">    &#125;;</span><br><span class="line">    VkFramebufferCreateInfo framebufferInfo = &#123;&#125;;</span><br><span class="line">    framebufferInfo.sType = VK_STRUCTURE_TYPE_FRAMEBUFFER_CREATE_INFO;</span><br><span class="line">    framebufferInfo.renderPass = renderPass;</span><br><span class="line">    framebufferInfo.attachmentCount = <span class="number">1</span>;</span><br><span class="line">    framebufferInfo.pAttachments = attachments;</span><br><span class="line">    framebufferInfo.width = swapChainExtent.width;</span><br><span class="line">    framebufferInfo.height = swapChainExtent.height;</span><br><span class="line">    framebufferInfo.layers = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateFramebuffer</span>(device, &amp;framebufferInfo, <span class="literal">nullptr</span>,</span><br><span class="line">            &amp;swapChainFramebuffers[i]) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create framebuffer!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šï¼Œå¸§ç¼“å†²åŒºçš„åˆ›å»ºéå¸¸ç®€å•:</p>
<ol>
<li>é¦–å…ˆéœ€è¦æŒ‡å®šå¸§ç¼“å†²åŒºéœ€è¦ä¸å“ªä¸ªrenderPasså…¼å®¹ã€‚åªèƒ½å¯¹ä¸ä¹‹å…¼å®¹çš„æ¸²æŸ“è¿‡ç¨‹ä½¿ç”¨å¸§ç¼“å†²åŒºï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä½¿ç”¨ç›¸åŒæ•°é‡å’Œç±»å‹çš„é™„ä»¶ã€‚</li>
<li>attachmentCountå’ŒpAttachmentså‚æ•°æŒ‡å®šåº”ç»‘å®šåˆ°æ¸²æŸ“è¿‡ç¨‹pAttachmentæ•°ç»„ä¸­ç›¸åº”é™„ä»¶æè¿°çš„VkImageViewå¯¹è±¡ã€‚</li>
<li>å®½åº¦å’Œé«˜åº¦å‚æ•°æ˜¯äº¤æ¢é“¾ä¸­è·å–çš„å®½é«˜</li>
<li>layersæ˜¯æŒ‡å›¾åƒæ•°ç»„ä¸­çš„å±‚æ•°ã€‚æˆ‘ä»¬çš„äº¤æ¢é“¾å›¾åƒæ˜¯å•ä¸ªå›¾åƒï¼Œå› æ­¤å±‚çš„æ•°é‡æ˜¯1ã€‚</li>
</ol>
<p>æˆ‘ä»¬åº”è¯¥å…ˆåˆ é™¤å¸§ç¼“å†²åŒºï¼Œç„¶åå†åˆ é™¤å®ƒä»¬æ‰€åŸºäºçš„å›¾åƒè§†å›¾å’Œæ¸²æŸ“è¿‡ç¨‹ï¼Œä½†å¿…é¡»åœ¨å®Œæˆæ¸²æŸ“ä¹‹åï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> framebuffer : swapChainFramebuffers) &#123;</span><br><span class="line">        <span class="built_in">vkDestroyFramebuffer</span>(device, framebuffer, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å·²ç»åˆ°è¾¾äº†ä¸€ä¸ªé‡Œç¨‹ç¢‘â€“æ‹¥æœ‰äº†æ¸²æŸ“æ‰€éœ€çš„æ‰€æœ‰å¯¹è±¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç¼–å†™ç¬¬ä¸€ä¸ªå®é™…çš„ç»˜å›¾æŒ‡ä»¤ã€‚</p>
<h1 id="äºŒ-Command-buffers-æŒ‡ä»¤ç¼“å†²åŒº"><a href="#äºŒ-Command-buffers-æŒ‡ä»¤ç¼“å†²åŒº" class="headerlink" title="äºŒ. Command buffers æŒ‡ä»¤ç¼“å†²åŒº"></a>äºŒ. Command buffers æŒ‡ä»¤ç¼“å†²åŒº</h1><p>Vulkanä¸­çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚ç»˜å›¾æ“ä½œå’Œå†…å­˜ä¼ è¾“ï¼Œä¸æ˜¯ç›´æ¥ä½¿ç”¨å‡½æ•°è°ƒç”¨æ¥æ‰§è¡Œçš„ã€‚å¿…é¡»åœ¨æŒ‡ä»¤ç¼“å†²åŒºå¯¹è±¡ä¸­è®°å½•æƒ³è¦æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæ‰€æœ‰è®¾ç½®ç»˜å›¾æŒ‡ä»¤çš„å·¥ä½œéƒ½å¯ä»¥æå‰åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å®Œæˆã€‚ä¹‹åï¼Œåªéœ€å‘Šè¯‰Vulkanåœ¨ä¸»å¾ªç¯ä¸­æ‰§è¡ŒæŒ‡ä»¤ã€‚</p>
<p>æŒ‡ä»¤ç¼“å†²åŒºæ˜¯ç”¨æ¥è®°å½•æŒ‡ä»¤çš„å¯¹è±¡ï¼Œè¿™äº›æŒ‡ä»¤å¯ä»¥éšåæäº¤åˆ°è®¾å¤‡é˜Ÿåˆ—ä¸­æ‰§è¡Œã€‚æŒ‡ä»¤ç¼“å†²åŒºæœ‰ä¸¤çº§:ä¸€çº§æŒ‡ä»¤ç¼“å†²åŒºï¼Œå®ƒå¯ä»¥æ‰§è¡ŒäºŒçº§æŒ‡ä»¤ç¼“å†²åŒºï¼Œå¹¶æäº¤ç»™é˜Ÿåˆ—;äºŒçº§æŒ‡ä»¤ç¼“å†²åŒºï¼Œå®ƒå¯ä»¥ç”±ä¸€çº§æŒ‡ä»¤ç¼“å†²åŒºæ‰§è¡Œï¼Œä½†ä¸ç›´æ¥æäº¤ç»™é˜Ÿåˆ—ã€‚</p>
<h2 id="2-1-Command-pools-æŒ‡ä»¤æ± "><a href="#2-1-Command-pools-æŒ‡ä»¤æ± " class="headerlink" title="2.1 Command pools æŒ‡ä»¤æ± "></a>2.1 Command pools æŒ‡ä»¤æ± </h2><p>åœ¨åˆ›å»ºæŒ‡ä»¤ç¼“å†²åŒºä¹‹å‰å¿…é¡»å…ˆåˆ›å»ºæŒ‡ä»¤æ± ã€‚æŒ‡ä»¤æ± ç®¡ç†ç”¨äºå­˜å‚¨ç¼“å†²åŒºçš„å†…å­˜ï¼Œå¹¶ä»å®ƒä»¬ä¸­åˆ†é…æŒ‡ä»¤ç¼“å†²åŒºã€‚</p>
<p>æŒ‡ä»¤æ± é€šè¿‡å…è®¸ä¸åŒçš„çº¿ç¨‹ä½¿ç”¨ä¸åŒçš„åˆ†é…å™¨æ¥æé«˜å¤šçº¿ç¨‹æ€§èƒ½ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡ä½¿ç”¨éƒ½è¿›è¡Œå†…éƒ¨åŒæ­¥ã€‚</p>
<p>ç”±VkCommandPoolå¯¹è±¡è¡¨ç¤ºï¼š VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkCommandPool)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkCommandPool commandPool;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºæŒ‡ä»¤æ± å‡½æ•°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateCommandPool</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkCommandPoolCreateInfo*              pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandPool*                              pCommandPool)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: åˆ›å»ºæŒ‡ä»¤æ± çš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfo: ä¸€ä¸ªæŒ‡å‘VkCommandPoolCreateInfoç»“æ„å®ä¾‹çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æŒ‡å®šæŒ‡ä»¤æ± å¯¹è±¡çš„çŠ¶æ€ã€‚</li>
<li>pAllocator: æ§åˆ¶å†…å­˜åˆ†é…</li>
<li>pCommandPool: æŒ‡å‘ä¸€ä¸ªVkCommandPoolå¥æŸ„ï¼Œåˆ›å»ºçš„æ± è¿”å›è¯¥å¥æŸ„ã€‚</li>
</ol>
<h3 id="2-1-1-åˆ›å»ºæŒ‡ä»¤æ± "><a href="#2-1-1-åˆ›å»ºæŒ‡ä»¤æ± " class="headerlink" title="2.1.1 åˆ›å»ºæŒ‡ä»¤æ± "></a>2.1.1 åˆ›å»ºæŒ‡ä»¤æ± </h3><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼šcreateCommandPool, æ¥æ‰§è¡Œåˆ›å»ºæŒ‡ä»¤æ± ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// checkAvailableExtensions();</span></span><br><span class="line">    <span class="built_in">createInstance</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºDEBUGæ¶ˆæ¯å›è°ƒ</span></span><br><span class="line">    <span class="built_in">setupDebugMessenger</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºsurface</span></span><br><span class="line">    <span class="built_in">createSurface</span>();</span><br><span class="line">    <span class="comment">// é€‰æ‹©ç‰©ç†è®¾å¤‡</span></span><br><span class="line">    <span class="built_in">pickPhysicalDevice</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºé€»è¾‘è®¾å¤‡</span></span><br><span class="line">    <span class="built_in">createLogicalDevice</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºäº¤æ¢é“¾</span></span><br><span class="line">    <span class="built_in">createSwapChain</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºäº¤æ¢é“¾å›¾åƒçš„VkImageView</span></span><br><span class="line">    <span class="built_in">createImageViews</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ¸²æŸ“é€šé“</span></span><br><span class="line">    <span class="built_in">createRenderPass</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºç®¡é“</span></span><br><span class="line">    <span class="built_in">createGraphicsPipeline</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºå¸§ç¼“å†²åŒº</span></span><br><span class="line">    <span class="built_in">createFramebuffers</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»ºæŒ‡ä»¤ç¼“å†²æ± </span></span><br><span class="line">    <span class="built_in">createCommandPool</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createCommandPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QueueFamilyIndices queueFamilyIndices = <span class="built_in">findQueueFamilies</span>(physicalDevice);</span><br><span class="line">    VkCommandPoolCreateInfo poolInfo = &#123;&#125;;</span><br><span class="line">    poolInfo.sType = VK_STRUCTURE_TYPE_COMMAND_POOL_CREATE_INFO;</span><br><span class="line">    poolInfo.queueFamilyIndex = queueFamilyIndices.graphicsFamily.<span class="built_in">value</span>();</span><br><span class="line">    poolInfo.flags = <span class="number">0</span>; <span class="comment">// Optional</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateCommandPool</span>(device, &amp;poolInfo, <span class="literal">nullptr</span>, &amp;commandPool) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create command pool!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŒ‡ä»¤ç¼“å†²åŒºæ˜¯é€šè¿‡å°†å®ƒä»¬æäº¤åˆ°è®¾å¤‡é˜Ÿåˆ—(æ¯”å¦‚æˆ‘ä»¬æ£€ç´¢åˆ°çš„å›¾å½¢å’Œå±•ç¤ºé˜Ÿåˆ—)ä¸Šæ¥æ‰§è¡Œçš„ã€‚</p>
<p>æ¯ä¸ªæŒ‡ä»¤æ± åªèƒ½åˆ†é…æäº¤åˆ°å•ä¸€ç±»å‹é˜Ÿåˆ—ä¸Šçš„æŒ‡ä»¤ç¼“å†²åŒºã€‚æˆ‘ä»¬å°†è®°å½•ç»˜å›¾çš„æŒ‡ä»¤ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬é€‰æ‹©å›¾å½¢é˜Ÿåˆ—å®¶æ—çš„åŸå› ã€‚</p>
<h3 id="2-1-2-VkCommandPoolCreateInfo"><a href="#2-1-2-VkCommandPoolCreateInfo" class="headerlink" title="2.1.2 VkCommandPoolCreateInfo"></a>2.1.2 VkCommandPoolCreateInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkCommandPoolCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType             sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                 pNext;</span><br><span class="line">    VkCommandPoolCreateFlags    flags;</span><br><span class="line">    <span class="type">uint32_t</span>                    queueFamilyIndex;</span><br><span class="line">&#125; VkCommandPoolCreateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: æ­¤ç»“æ„çš„ç±»å‹ï¼ŒVK_STRUCTURE_TYPE_COMMAND_POOL_CREATE_INFO</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆã€‚</li>
<li>flags: æ˜¯VkCommandPoolCreateFlagBitsçš„ä½æ©ç , æŒ‡ç¤ºæŒ‡ä»¤æ± å’Œä»ä¸­åˆ†é…çš„æŒ‡ä»¤ç¼“å†²åŒºçš„ä½¿ç”¨è¡Œä¸ºã€‚</li>
<li>queueFamilyIndex: æŒ‡å®šé˜Ÿåˆ—æ—ã€‚ä»è¿™ä¸ªæŒ‡ä»¤æ± åˆ†é…çš„æ‰€æœ‰æŒ‡ä»¤ç¼“å†²åŒºå¿…é¡»åœ¨æ¥è‡ªç›¸åŒé˜Ÿåˆ—æ—çš„é˜Ÿåˆ—ä¸Šæäº¤ã€‚</li>
</ol>
<h3 id="2-1-3-VkCommandPoolCreateFlags"><a href="#2-1-3-VkCommandPoolCreateFlags" class="headerlink" title="2.1.3 VkCommandPoolCreateFlags"></a>2.1.3 VkCommandPoolCreateFlags</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkCommandPoolCreateFlagBits</span> &#123;</span><br><span class="line">    VK_COMMAND_POOL_CREATE_TRANSIENT_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_COMMAND_POOL_CREATE_PROTECTED_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_COMMAND_POOL_CREATE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkCommandPoolCreateFlagBits;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_COMMAND_POOL_CREATE_TRANSIENT_BIT:æŒ‡å®šä»æ± ä¸­åˆ†é…çš„æŒ‡ä»¤ç¼“å†²åŒºå°†æ˜¯çŸ­æš‚çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å°†åœ¨ç›¸å¯¹è¾ƒçŸ­çš„æ—¶é—´å†…è¢«é‡ç½®æˆ–é‡Šæ”¾ã€‚è¿™ä¸ªæ ‡å¿—å¯ä»¥è¢«å®ç°ç”¨æ¥æ§åˆ¶æ± å†…çš„å†…å­˜åˆ†é…è¡Œä¸ºã€‚</li>
<li>VK_COMMAND_POOL_CREATE_RESET_COMMAND_BUFFER_BIT:å…è®¸ä»æ± ä¸­åˆ†é…çš„ä»»ä½•æŒ‡ä»¤ç¼“å†²åŒºè¢«å•ç‹¬é‡ç½®åˆ°åˆå§‹çŠ¶æ€;æˆ–è€…é€šè¿‡è°ƒç”¨vkResetCommandBufferï¼Œæˆ–è€…åœ¨è°ƒç”¨vkBeginCommandBufferæ—¶é€šè¿‡éšå¼é‡ç½®ã€‚å¦‚æœåœ¨æ± ä¸­æ²¡æœ‰è®¾ç½®è¿™ä¸ªæ ‡å¿—ï¼Œé‚£ä¹ˆvkResetCommandBufferç»å¯¹ä¸èƒ½è¢«ä»æ± ä¸­åˆ†é…çš„ä»»ä½•æŒ‡ä»¤ç¼“å†²åŒºè°ƒç”¨ã€‚</li>
<li>VK_COMMAND_POOL_CREATE_PROTECTED_BIT:æŒ‡å®šä»æ± ä¸­åˆ†é…çš„æŒ‡ä»¤ç¼“å†²åŒºä¸ºå—ä¿æŠ¤çš„æŒ‡ä»¤ç¼“å†²åŒºã€‚å¦‚æœæœªå¯ç”¨å—ä¿æŠ¤çš„å†…å­˜ç‰¹æ€§ï¼Œåˆ™ä¸èƒ½è®¾ç½®VK_COMMAND_POOL_CREATE_PROTECTED_BITæ ‡å¿—ä½ã€‚</li>
</ol>
<p>é‰´äºæˆ‘ä»¬å°†åªåœ¨ç¨‹åºå¼€å§‹æ—¶è®°å½•æŒ‡ä»¤ç¼“å†²åŒºï¼Œç„¶ååœ¨ä¸»å¾ªç¯ä¸­å¤šæ¬¡æ‰§è¡Œå®ƒä»¬ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šä½¿ç”¨è¿™è¿™äº›æ ‡å¿—ã€‚</p>
<h3 id="2-1-4-vkDestroyCommandPool"><a href="#2-1-4-vkDestroyCommandPool" class="headerlink" title="2.1.4 vkDestroyCommandPool"></a>2.1.4 vkDestroyCommandPool</h3><p>ä½¿ç”¨vkCreateCommandPoolåŠŸèƒ½å®ŒæˆæŒ‡ä»¤æ± çš„åˆ›å»ºï¼ŒæŒ‡ä»¤å°†åœ¨æ•´ä¸ªç¨‹åºä¸­ä½¿ç”¨æ¥ç»˜åˆ¶å±å¹•ä¸Šçš„ä¸œè¥¿ï¼Œæ‰€ä»¥æ± åº”è¯¥åªåœ¨ç»“æŸæ—¶é”€æ¯:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾æŒ‡ä»¤æ± </span></span><br><span class="line">    <span class="built_in">vkDestroyCommandPool</span>(device, commandPool, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-Command-buffer-allocation-æŒ‡ä»¤ç¼“å†²åŒºåˆ†é…"><a href="#2-2-Command-buffer-allocation-æŒ‡ä»¤ç¼“å†²åŒºåˆ†é…" class="headerlink" title="2.2 Command buffer allocation æŒ‡ä»¤ç¼“å†²åŒºåˆ†é…"></a>2.2 Command buffer allocation æŒ‡ä»¤ç¼“å†²åŒºåˆ†é…</h2><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹åˆ†é…æŒ‡ä»¤ç¼“å†²åŒºå¹¶åœ¨å…¶ä¸­è®°å½•ç»˜å›¾æŒ‡ä»¤ã€‚å› ä¸ºå…¶ä¸­ä¸€ä¸ªç»˜å›¾æŒ‡ä»¤æ¶‰åŠåˆ°ç»‘å®šæ­£ç¡®çš„VkFramebufferï¼Œæ‰€ä»¥æˆ‘ä»¬å®é™…ä¸Šå¿…é¡»å†æ¬¡ä¸ºäº¤æ¢é“¾ä¸­çš„æ¯ä¸ªå›¾åƒè®°å½•ä¸€ä¸ªæŒ‡ä»¤ç¼“å†²åŒºã€‚</p>
<p>ä¸ºæ­¤ï¼Œåˆ›å»ºä¸€ä¸ªVkCommandBufferå¯¹è±¡åˆ—è¡¨ä½œä¸ºç±»æˆå‘˜ã€‚å½“å®ƒä»¬çš„æŒ‡ä»¤æ± è¢«é”€æ¯æ—¶ï¼ŒæŒ‡ä»¤ç¼“å†²åŒºå°†è¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ˜¾å¼çš„æ¸…ç†ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">std::vector&lt;VkCommandBuffer&gt; commandBuffers;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å¼€å§‹ä½¿ç”¨createCommandBufferså‡½æ•°ï¼Œä¸ºæ¯ä¸ªäº¤æ¢é“¾å›¾åƒ(VkImageView)åˆ†é…å’Œè®°å½•æŒ‡ä»¤ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createCommandBuffers</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createCommandBuffers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    commandBuffers.<span class="built_in">resize</span>(swapChainFramebuffers.<span class="built_in">size</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-1-vkAllocateCommandBuffers"><a href="#2-2-1-vkAllocateCommandBuffers" class="headerlink" title="2.2.1 vkAllocateCommandBuffers"></a>2.2.1 vkAllocateCommandBuffers</h3><p>æŒ‡ä»¤ç¼“å†²åŒºæ˜¯é€šè¿‡vkAllocateCommandBufferså‡½æ•°åˆ†é…çš„ï¼Œè¯¥å‡½æ•°ä»¥VkCommandBufferAllocateInfoç»“æ„ä½“ä½œä¸ºå‚æ•°ï¼ŒæŒ‡å®šæŒ‡ä»¤æ± å’Œè¦åˆ†é…çš„ç¼“å†²åŒºæ•°é‡:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkAllocateCommandBuffers</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkCommandBufferAllocateInfo*          pAllocateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer*                            pCommandBuffers)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: æŒ‡ä»¤æ± æ‰€å±çš„é€»è¾‘è®¾å¤‡ã€‚</li>
<li>pAllocateInfo: æŒ‡å‘VkCommandBufferAllocateInfoç»“æ„å®ä¾‹çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„æè¿°äº†åˆ†é…çš„å‚æ•°ã€‚</li>
<li>pCommandBuffers: æŒ‡å‘VkCommandBufferå¥æŸ„æ•°ç»„çš„æŒ‡é’ˆï¼Œåœ¨è¯¥æ•°ç»„ä¸­è¿”å›ç”Ÿæˆçš„æŒ‡ä»¤ç¼“å†²åŒºå¯¹è±¡ã€‚æ•°ç»„å¿…é¡»è‡³å°‘ä¸ºpAllocateInfoçš„commandBufferCountæˆå‘˜æŒ‡å®šçš„é•¿åº¦commandBufferCountã€‚æ¯ä¸ªåˆ†é…çš„æŒ‡ä»¤ç¼“å†²åŒºéƒ½ä»åˆå§‹çŠ¶æ€å¼€å§‹ã€‚(å°±æ˜¯commandBuffersé›†çš„é¦–ä¸ªå…ƒç´ çš„åœ°å€)</li>
</ol>
<h3 id="2-2-2-VkCommandBufferAllocateInfo"><a href="#2-2-2-VkCommandBufferAllocateInfo" class="headerlink" title="2.2.2 VkCommandBufferAllocateInfo"></a>2.2.2 VkCommandBufferAllocateInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkCommandBufferAllocateInfo</span> &#123;</span><br><span class="line">    VkStructureType         sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*             pNext;</span><br><span class="line">    VkCommandPool           commandPool;</span><br><span class="line">    VkCommandBufferLevel    level;</span><br><span class="line">    <span class="type">uint32_t</span>                commandBufferCount;</span><br><span class="line">&#125; VkCommandBufferAllocateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: ç»“æ„ä½“ç±»å‹</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>commandPool: åˆ†é…æ­¤æŒ‡ä»¤ç¼“å†²åŒºçš„æŒ‡ä»¤æ± </li>
<li>level: VkCommandBufferLevelå€¼ï¼ŒæŒ‡å®šæŒ‡ä»¤ç¼“å†²åŒºçº§åˆ«</li>
<li>commandBufferCount: ä»æ± ä¸­åˆ†é…çš„æŒ‡ä»¤ç¼“å†²åŒºçš„æ•°é‡</li>
</ol>
<p>VkCommandBufferLevel, æŒ‡å®šæŒ‡ä»¤ç¼“å†²åŒºçº§åˆ«:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkCommandBufferLevel</span> &#123;</span><br><span class="line">    VK_COMMAND_BUFFER_LEVEL_PRIMARY = <span class="number">0</span>,</span><br><span class="line">    VK_COMMAND_BUFFER_LEVEL_SECONDARY = <span class="number">1</span>,</span><br><span class="line">    VK_COMMAND_BUFFER_LEVEL_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkCommandBufferLevel;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_COMMAND_BUFFER_LEVEL_PRIMARY:æŒ‡å®šä¸»æŒ‡ä»¤ç¼“å†²åŒºï¼Œå¯ä»¥æäº¤åˆ°é˜Ÿåˆ—æ‰§è¡Œï¼Œä½†ä¸èƒ½ä»å…¶ä»–æŒ‡ä»¤ç¼“å†²åŒºè°ƒç”¨ã€‚</li>
<li>VK_COMMAND_BUFFER_LEVEL_SECONDARY:æŒ‡å®šæ¬¡è¦æŒ‡ä»¤ç¼“å†²åŒºï¼Œä¸èƒ½ç›´æ¥æäº¤ï¼Œä½†å¯ä»¥ä»ä¸»æŒ‡ä»¤ç¼“å†²åŒºè°ƒç”¨ã€‚</li>
</ol>
<h3 id="2-2-3-createCommandBuffers"><a href="#2-2-3-createCommandBuffers" class="headerlink" title="2.2.3 createCommandBuffers"></a>2.2.3 createCommandBuffers</h3><p>æ¥ä¸‹æ¥å°±æ˜¯å®ŒæˆæŒ‡ä»¤ç¼“å†²åŒºé›†çš„åˆ›å»ºï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createCommandBuffers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    commandBuffers.<span class="built_in">resize</span>(swapChainFramebuffers.<span class="built_in">size</span>());</span><br><span class="line"></span><br><span class="line">    VkCommandBufferAllocateInfo allocInfo = &#123;&#125;;</span><br><span class="line">    allocInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_ALLOCATE_INFO;</span><br><span class="line">    allocInfo.commandPool = commandPool;</span><br><span class="line">    allocInfo.level = VK_COMMAND_BUFFER_LEVEL_PRIMARY;</span><br><span class="line">    allocInfo.commandBufferCount = (<span class="type">uint32_t</span>) commandBuffers.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkAllocateCommandBuffers</span>(device, &amp;allocInfo, commandBuffers.<span class="built_in">data</span>()) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to allocate command buffers!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œä¸ä½¿ç”¨è¾…åŠ©æŒ‡ä»¤ç¼“å†²åŒºåŠŸèƒ½ï¼Œä½†æ˜¯å¯ä»¥æƒ³è±¡ï¼Œé‡ç”¨æ¥è‡ªä¸»è¦æŒ‡ä»¤ç¼“å†²åŒºçš„å¸¸ç”¨æ“ä½œæ˜¯å¾ˆæœ‰å¸®åŠ©çš„</p>
<h2 id="2-3-å¯åŠ¨æŒ‡ä»¤ç¼“å†²åŒºè®°å½•"><a href="#2-3-å¯åŠ¨æŒ‡ä»¤ç¼“å†²åŒºè®°å½•" class="headerlink" title="2.3 å¯åŠ¨æŒ‡ä»¤ç¼“å†²åŒºè®°å½•"></a>2.3 å¯åŠ¨æŒ‡ä»¤ç¼“å†²åŒºè®°å½•</h2><p>è®°å½•çš„æŒ‡ä»¤åŒ…æ‹¬å°†ç®¡é“å’Œæè¿°ç¬¦é›†ç»‘å®šåˆ°æŒ‡ä»¤ç¼“å†²åŒºçš„æŒ‡ä»¤ã€ä¿®æ”¹åŠ¨æ€çŠ¶æ€çš„æŒ‡ä»¤ã€ç»˜åˆ¶æŒ‡ä»¤(ç”¨äºå›¾å½¢æ¸²æŸ“)ã€è°ƒåº¦æŒ‡ä»¤(ç”¨äºè®¡ç®—)ã€æ‰§è¡Œæ¬¡è¦æŒ‡ä»¤ç¼“å†²åŒºçš„æŒ‡ä»¤(ä»…ç”¨äºä¸»è¦æŒ‡ä»¤ç¼“å†²åŒº)ã€å¤åˆ¶ç¼“å†²åŒºå’Œå›¾åƒçš„æŒ‡ä»¤ï¼Œä»¥åŠå…¶ä»–æŒ‡ä»¤ã€‚</p>
<p>ä¸ºä»€ä¹ˆéœ€è¦è®°å½•æŒ‡ä»¤ï¼Ÿ å…ˆçœ‹ä¸€ä¸‹æŒ‡ä»¤ç¼“å†²åŒºçš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<h3 id="2-3-1-æŒ‡ä»¤ç¼“å†²åŒºçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#2-3-1-æŒ‡ä»¤ç¼“å†²åŒºçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.3.1 æŒ‡ä»¤ç¼“å†²åŒºçš„ç”Ÿå‘½å‘¨æœŸ"></a>2.3.1 æŒ‡ä»¤ç¼“å†²åŒºçš„ç”Ÿå‘½å‘¨æœŸ</h3><p>æ¯ä¸ªæŒ‡ä»¤ç¼“å†²åŒºæ€»æ˜¯å¤„äºä»¥ä¸‹çŠ¶æ€ä¹‹ä¸€:</p>
<ol>
<li>Initial(åˆå§‹çŠ¶æ€): å½“ä¸€ä¸ªæŒ‡ä»¤ç¼“å†²åŒºè¢«åˆ†é…æ—¶ï¼Œå®ƒå¤„äºåˆå§‹çŠ¶æ€ã€‚ä¸€äº›æŒ‡ä»¤èƒ½å¤Ÿå°†ä¸€ä¸ªæŒ‡ä»¤ç¼“å†²åŒºæˆ–ä¸€ç»„æŒ‡ä»¤ç¼“å†²åŒºä»ä»»ä½•å¯æ‰§è¡ŒçŠ¶æ€ã€è®°å½•çŠ¶æ€æˆ–æ— æ•ˆçŠ¶æ€é‡ç½®å›è¯¥çŠ¶æ€ã€‚å¤„äºåˆå§‹çŠ¶æ€çš„æŒ‡ä»¤ç¼“å†²åŒºåªèƒ½ç§»åŠ¨åˆ°è®°å½•çŠ¶æ€æˆ–é‡Šæ”¾ã€‚</li>
<li>Recording(è®°å½•çŠ¶æ€): vkBeginCommandBufferæ”¹å˜æŒ‡ä»¤ç¼“å†²åŒºçš„çŠ¶æ€ä»åˆå§‹çŠ¶æ€åˆ°è®°å½•çŠ¶æ€ã€‚ä¸€æ—¦æŒ‡ä»¤ç¼“å†²åŒºå¤„äºè®°å½•çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨vkCmd*æŒ‡ä»¤è®°å½•åˆ°æŒ‡ä»¤ç¼“å†²åŒºã€‚</li>
<li>Executable(å¯æ‰§è¡ŒçŠ¶æ€): vkEndCommandBufferç»“æŸæŒ‡ä»¤ç¼“å†²åŒºçš„è®°å½•ï¼Œå¹¶å°†å…¶ä»è®°å½•çŠ¶æ€ç§»åŠ¨åˆ°å¯æ‰§è¡ŒçŠ¶æ€ã€‚å¯æ‰§è¡ŒæŒ‡ä»¤ç¼“å†²åŒºå¯ä»¥æäº¤ã€é‡ç½®æˆ–è®°å½•åˆ°å¦ä¸€ä¸ªæŒ‡ä»¤ç¼“å†²åŒºã€‚</li>
<li>Pending(æŒ‚èµ·çŠ¶æ€): æŒ‡ä»¤ç¼“å†²åŒºçš„é˜Ÿåˆ—æäº¤å°†æŒ‡ä»¤ç¼“å†²åŒºçš„çŠ¶æ€ä»å¯æ‰§è¡ŒçŠ¶æ€æ›´æ”¹ä¸ºæŒ‚èµ·çŠ¶æ€ã€‚åœ¨æŒ‚èµ·çŠ¶æ€ä¸‹ï¼Œåº”ç”¨ç¨‹åºä¸èƒ½è¯•å›¾ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹æŒ‡ä»¤ç¼“å†²åŒº-å› ä¸ºè®¾å¤‡å¯èƒ½æ­£åœ¨å¤„ç†è®°å½•åˆ°å®ƒçš„æŒ‡ä»¤ã€‚ä¸€æ—¦æŒ‡ä»¤ç¼“å†²åŒºçš„æ‰§è¡Œå®Œæˆï¼ŒæŒ‡ä»¤ç¼“å†²åŒºå°†è¿”å›åˆ°å¯æ‰§è¡ŒçŠ¶æ€ï¼Œæˆ–è€…è¿”å›æ— æ•ˆçŠ¶æ€(å¦‚æœå®ƒæ˜¯é€šè¿‡VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BITè®°å½•çš„)ã€‚åº”è¯¥ä½¿ç”¨ä¸€ä¸ªåŒæ­¥æŒ‡ä»¤æ¥æ£€æµ‹ä½•æ—¶å‘ç”Ÿè¿™ç§æƒ…å†µã€‚</li>
<li>Invalid(æ— æ•ˆçŠ¶æ€):æŸäº›æ“ä½œï¼Œå¦‚ä¿®æ”¹æˆ–åˆ é™¤è®°å½•åˆ°æŒ‡ä»¤ç¼“å†²åŒºçš„æŒ‡ä»¤ä¸­ä½¿ç”¨çš„èµ„æºï¼Œå°†æŠŠè¯¥æŒ‡ä»¤ç¼“å†²åŒºçš„çŠ¶æ€è½¬æ¢ä¸ºæ— æ•ˆçŠ¶æ€ã€‚å¤„äºæ— æ•ˆçŠ¶æ€çš„æŒ‡ä»¤ç¼“å†²åŒºåªèƒ½è¢«é‡ç½®æˆ–é‡Šæ”¾ã€‚</li>
</ol>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-8-%E5%B8%A7%E7%BC%93%E5%86%B2%E5%8C%BA%E5%92%8C%E6%8C%87%E4%BB%A4%E7%BC%93%E5%86%B2%E5%8C%BA/Vulkan_8_1.png" alt="ç”Ÿå‘½å‘¨æœŸ"></p>
<p>æ‰€ä»¥è®°å½•çŠ¶æ€å¯ä»¥ç†è§£ä¸ºè®°å½•ç»˜åˆ¶æ“ä½œï¼Œç„¶åè®°å½•å®Œæ¯•å°±è½¬ä¸ºå¯æ‰§è¡ŒçŠ¶æ€ï¼Œç­‰å¾…è¢«æ‰§è¡Œã€‚</p>
<h3 id="2-3-2-è®°å½•æŒ‡ä»¤ç¼“å†²åŒº"><a href="#2-3-2-è®°å½•æŒ‡ä»¤ç¼“å†²åŒº" class="headerlink" title="2.3.2 è®°å½•æŒ‡ä»¤ç¼“å†²åŒº"></a>2.3.2 è®°å½•æŒ‡ä»¤ç¼“å†²åŒº</h3><p>é€šè¿‡è°ƒç”¨vkBeginCommandBufferå¼€å§‹è®°å½•æŒ‡ä»¤ç¼“å†²åŒºï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªå°çš„VkCommandBufferBeginInfoç»“æ„ä½œä¸ºå‚æ•°ï¼ŒæŒ‡å®šå…³äºè¿™ä¸ªç‰¹å®šæŒ‡ä»¤ç¼“å†²åŒºä½¿ç”¨çš„ä¸€äº›ç»†èŠ‚ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkBeginCommandBuffer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkCommandBufferBeginInfo*             pBeginInfo)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBuffer: å¾…æ”¾å…¥è®°å½•çŠ¶æ€çš„æŒ‡ä»¤ç¼“å†²åŒºçš„å¥æŸ„ã€‚</li>
<li>pBeginInfo: VkCommandBufferBeginInfoç»“æ„çš„ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒå®šä¹‰äº†å…³äºæŒ‡ä»¤ç¼“å†²åŒºå¦‚ä½•å¼€å§‹è®°å½•çš„é™„åŠ ä¿¡æ¯ã€‚</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkCommandBufferBeginInfo</span> &#123;</span><br><span class="line">    VkStructureType                          sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                              pNext;</span><br><span class="line">    VkCommandBufferUsageFlags                flags;</span><br><span class="line">    <span class="type">const</span> VkCommandBufferInheritanceInfo*    pInheritanceInfo;</span><br><span class="line">&#125; VkCommandBufferBeginInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: ç»“æ„ä½“ç±»å‹</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>flags: æ˜¯VkCommandBufferUsageFlagBitsçš„ä½æ©ç ï¼ŒæŒ‡å®šå‘½ä»¤ç¼“å†²åŒºçš„ä½¿ç”¨è¡Œä¸ºã€‚</li>
<li>pInheritanceInfo: æ˜¯ä¸€ä¸ªæŒ‡å‘VkCommandBufferInheritanceInfoç»“æ„çš„æŒ‡é’ˆï¼Œå¦‚æœcommandBufferæ˜¯ä¸€ä¸ªæ¬¡è¦å‘½ä»¤ç¼“å†²åŒºï¼Œå°±ä¼šä½¿ç”¨è¿™ä¸ªç»“æ„ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªä¸»å‘½ä»¤ç¼“å†²åŒºï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°†è¢«å¿½ç•¥ã€‚</li>
</ol>
<p>åœ¨VkCommandBufferBeginInfo::flagsä¸­è®¾ç½®ä½æ¥æŒ‡å®šå‘½ä»¤ç¼“å†²åŒºçš„ä½¿ç”¨è¡Œä¸º:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> <span class="title class_">VkCommandBufferUsageFlagBits</span> &#123;</span><br><span class="line">    VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT = <span class="number">0x00000001</span>,</span><br><span class="line">    VK_COMMAND_BUFFER_USAGE_RENDER_PASS_CONTINUE_BIT = <span class="number">0x00000002</span>,</span><br><span class="line">    VK_COMMAND_BUFFER_USAGE_SIMULTANEOUS_USE_BIT = <span class="number">0x00000004</span>,</span><br><span class="line">    VK_COMMAND_BUFFER_USAGE_FLAG_BITS_MAX_ENUM = <span class="number">0x7FFFFFFF</span></span><br><span class="line">&#125; VkCommandBufferUsageFlagBits;</span><br></pre></td></tr></table></figure>
<ol>
<li>VK_COMMAND_BUFFER_USAGE_ONE_TIME_SUBMIT_BIT:æŒ‡å®šå‘½ä»¤ç¼“å†²åŒºçš„æ¯ä¸ªè®°å½•å°†åªæäº¤ä¸€æ¬¡ï¼Œå‘½ä»¤ç¼“å†²åŒºå°†è¢«é‡ç½®å¹¶åœ¨æ¯æ¬¡æäº¤ä¹‹é—´å†æ¬¡è®°å½•ã€‚</li>
<li>VK_COMMAND_BUFFER_USAGE_RENDER_PASS_CONTINUE_BIT:æŒ‡å®šæ¬¡è¦å‘½ä»¤ç¼“å†²åŒºè¢«è®¤ä¸ºå®Œå…¨ä½äºæ¸²æŸ“é€šé“å†…ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªä¸»å‘½ä»¤ç¼“å†²åŒºï¼Œé‚£ä¹ˆè¿™ä¸ªä½ä¼šè¢«å¿½ç•¥ã€‚</li>
<li>VK_COMMAND_BUFFER_USAGE_SIMULTANEOUS_USE_BIT:æŒ‡å®šå½“å‘½ä»¤ç¼“å†²åŒºå¤„äºæŒ‚èµ·çŠ¶æ€æ—¶ï¼Œå¯ä»¥é‡æ–°æäº¤ç»™é˜Ÿåˆ—ï¼Œå¹¶è®°å½•åˆ°å¤šä¸ªä¸»è¦å‘½ä»¤ç¼“å†²åŒºä¸­ã€‚</li>
</ol>
<p>å¼€å§‹æŒ‡ä»¤ç¼“å†²åŒºè®°å½•:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; commandBuffers.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">    VkCommandBufferBeginInfo beginInfo = &#123;&#125;;</span><br><span class="line">    beginInfo.sType = VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO;</span><br><span class="line">    <span class="comment">// æ ‡è®°è¯¥æŒ‡ä»¤ç¼“å†²åŒºå¯é‡å¤è¿½åŠ æŒ‡ä»¤</span></span><br><span class="line">    beginInfo.flags = VK_COMMAND_BUFFER_USAGE_SIMULTANEOUS_USE_BIT;</span><br><span class="line">    beginInfo.pInheritanceInfo = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkBeginCommandBuffer</span>(commandBuffers[i], &amp;beginInfo) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to begin recording command buffer!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä½¿ç”¨VK_COMMAND_BUFFER_USAGE_SIMULTANEOUS_USE_BITæ ‡å¿—æ˜¯å› ä¸ºæˆ‘ä»¬å¯èƒ½å·²ç»åœ¨ä¸ºä¸‹ä¸€å¸§è°ƒåº¦ç»˜å›¾å‘½ä»¤ï¼Œè€Œæœ€åä¸€å¸§è¿˜æ²¡æœ‰å®Œæˆã€‚pInheritanceInfoå‚æ•°ä»…ä¸è¾…åŠ©å‘½ä»¤ç¼“å†²åŒºç›¸å…³ã€‚å®ƒæŒ‡å®šä»è°ƒç”¨çš„ä¸»å‘½ä»¤ç¼“å†²åŒºç»§æ‰¿å“ªä¸ªçŠ¶æ€ã€‚</p>
<p>å¦‚æœå‘½ä»¤ç¼“å†²åŒºå·²ç»è¢«è®°å½•è¿‡ä¸€æ¬¡ï¼Œé‚£ä¹ˆè°ƒç”¨vkBeginCommandBufferå°†éšå¼é‡ç½®å®ƒã€‚ä»¥åä¸å¯èƒ½å‘ç¼“å†²åŒºè¿½åŠ å‘½ä»¤ã€‚</p>
<h2 id="2-4-å¯åŠ¨æ¸²æŸ“é€šé“"><a href="#2-4-å¯åŠ¨æ¸²æŸ“é€šé“" class="headerlink" title="2.4 å¯åŠ¨æ¸²æŸ“é€šé“"></a>2.4 å¯åŠ¨æ¸²æŸ“é€šé“</h2><p>é€šè¿‡vkCmdBeginRenderPasså¼€å§‹ç»˜åˆ¶ã€‚æ¸²æŸ“é€šé“æ˜¯ä½¿ç”¨VkRenderPassBeginInfoç»“æ„ä¸­çš„ä¸€äº›å‚æ•°æ¥é…ç½®çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdBeginRenderPass</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkRenderPassBeginInfo*                pRenderPassBegin,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkSubpassContents                           contents)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBuffer: æŒ‡ä»¤ç¼“å†²åŒº</li>
<li>VkRenderPassBeginInfo: æ˜¯ä¸€ä¸ªæŒ‡å‘VkRenderPassBeginInfoç»“æ„çš„æŒ‡é’ˆï¼Œæä¾›çš„æ¸²æŸ“é€šé“çš„è¯¦ç»†ä¿¡æ¯</li>
<li>contents: æ˜¯ä¸€ä¸ªVkSubpassContentså€¼ï¼Œæ§åˆ¶æ¸²æŸ“é€šé“å†…çš„ç»˜å›¾å‘½ä»¤å°†å¦‚ä½•æä¾›,å¯ä»¥æœ‰ä¸¤ä¸ªå€¼:<ol>
<li>VK_SUBPASS_CONTENTS_INLINE:render passå‘½ä»¤å°†è¢«åµŒå…¥åˆ°ä¸»å‘½ä»¤ç¼“å†²åŒºä¸­ï¼Œè€Œä¸ä¼šæ‰§è¡Œæ¬¡è¦å‘½ä»¤ç¼“å†²åŒºã€‚</li>
<li>VK_SUBPASS_CONTENTS_SECONDARY_COMMAND_BUFFERS:render passå‘½ä»¤å°†ä»æ¬¡è¦å‘½ä»¤ç¼“å†²åŒºæ‰§è¡Œã€‚</li>
</ol>
</li>
</ol>
<p>åœ¨å¼€å§‹æ¸²æŸ“é€šé“å®ä¾‹ä¹‹åï¼Œå‘½ä»¤ç¼“å†²åŒºå‡†å¤‡å¥½è®°å½•è¯¥æ¸²æŸ“é€šé“çš„ç¬¬ä¸€ä¸ªå­é€šé“çš„å‘½ä»¤ã€‚</p>
<h3 id="2-4-1-VkRenderPassBeginInfo"><a href="#2-4-1-VkRenderPassBeginInfo" class="headerlink" title="2.4.1 VkRenderPassBeginInfo"></a>2.4.1 VkRenderPassBeginInfo</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkRenderPassBeginInfo</span> &#123;</span><br><span class="line">    VkStructureType        sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*            pNext;</span><br><span class="line">    VkRenderPass           renderPass;</span><br><span class="line">    VkFramebuffer          framebuffer;</span><br><span class="line">    VkRect2D               renderArea;</span><br><span class="line">    <span class="type">uint32_t</span>               clearValueCount;</span><br><span class="line">    <span class="type">const</span> VkClearValue*    pClearValues;</span><br><span class="line">&#125; VkRenderPassBeginInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: ç»“æ„ä½“ç±»å‹</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>renderPass: æ¸²æŸ“é€šé“</li>
<li>framebuffer: æŒ‡ä»¤ç¼“å†²åŒº</li>
<li>renderArea: æ¸²æŸ“é€šé“å®ä¾‹å½±å“çš„æ¸²æŸ“åŒºåŸŸ</li>
<li>clearValueCount: pClearValuesä¸­çš„å…ƒç´ æ•°é‡</li>
<li>pClearValues: æ˜¯ä¸€ä¸ªVkClearValueç»“æ„çš„æ•°ç»„ï¼Œå®ƒåŒ…å«æ¯ä¸ªé™„ä»¶çš„æ¸…é™¤å€¼ï¼Œå¦‚æœé™„ä»¶ä½¿ç”¨çš„loadOpå€¼æ˜¯VK_ATTACHMENT_LOAD_OP_CLEARï¼Œæˆ–è€…é™„ä»¶å…·æœ‰æ·±åº¦&#x2F;æ¨¡æ¿æ ¼å¼å¹¶ä½¿ç”¨çš„stencilLoadOpå€¼æ˜¯VK_ATTACHMENT_LOAD_OP_CLEARã€‚æ•°ç»„æŒ‰é™„ä»¶å·ç´¢å¼•ã€‚åªä½¿ç”¨ä¸å·²æ¸…é™¤é™„ä»¶å¯¹åº”çš„å…ƒç´ ã€‚pClearValuesçš„å…¶ä»–å…ƒç´ å°†è¢«å¿½ç•¥ã€‚</li>
</ol>
<p>renderAreaæ¸²æŸ“åŒºåŸŸæ˜¯å—æ¸²æŸ“é€šé“å®ä¾‹å½±å“çš„æ¸²æŸ“åŒºåŸŸã€‚é™„ä»¶åŠ è½½ã€å­˜å‚¨å’Œå¤šæ ·æœ¬è§£ææ“ä½œçš„å½±å“ä»…é™äºxå’Œyåæ ‡è½åœ¨æ‰€æœ‰é™„ä»¶æ¸²æŸ“åŒºåŸŸå†…çš„åƒç´ ã€‚æ¸²æŸ“åŒºåŸŸæ‰©å±•åˆ°framebufferçš„æ‰€æœ‰å±‚ã€‚åº”ç”¨ç¨‹åºå¿…é¡»ç¡®ä¿(å¿…è¦æ—¶ä½¿ç”¨scissor)æ‰€æœ‰çš„æ¸²æŸ“éƒ½åŒ…å«åœ¨æ¸²æŸ“åŒºåŸŸå†…ã€‚æ¸²æŸ“åŒºåŸŸå¿…é¡»åŒ…å«åœ¨framebufferå°ºå¯¸å†…ã€‚</p>
<h3 id="2-4-2-start-a-Render-Pass"><a href="#2-4-2-start-a-Render-Pass" class="headerlink" title="2.4.2 start a Render Pass"></a>2.4.2 start a Render Pass</h3><p>åº”ç”¨ç¨‹åºä¸€æ¬¡è®°å½•ä¸€ä¸ªrender passå®ä¾‹çš„å‘½ä»¤ï¼Œæ–¹æ³•æ˜¯å¼€å§‹ä¸€ä¸ªrender passå®ä¾‹ï¼Œéå†å­é€šé“(subpass)æ¥è®°å½•è¯¥å­é€šé“çš„å‘½ä»¤ï¼Œç„¶åç»“æŸrender passå®ä¾‹ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkRenderPassBeginInfo renderPassInfo = &#123;&#125;;</span><br><span class="line">renderPassInfo.sType = VK_STRUCTURE_TYPE_RENDER_PASS_BEGIN_INFO;</span><br><span class="line"><span class="comment">// æ¸²æŸ“é€šé“æœ¬èº«å’Œè¦ç»‘å®šçš„é™„ä»¶</span></span><br><span class="line">renderPassInfo.renderPass = renderPass;</span><br><span class="line"><span class="comment">// æ¯ä¸ªäº¤æ¢é“¾å›¾åƒåˆ›å»ºäº†ä¸€ä¸ªframebufferï¼Œå°†å…¶æŒ‡å®šä¸ºé¢œè‰²é™„ä»¶ã€‚</span></span><br><span class="line">renderPassInfo.framebuffer = swapChainFramebuffers[i];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸²æŸ“åŒºåŸŸå®šä¹‰ç€è‰²å™¨åŠ è½½å’Œå­˜å‚¨çš„ä½ç½®ã€‚è¯¥åŒºåŸŸä¹‹å¤–çš„åƒç´ å°†å…·æœ‰æœªå®šä¹‰çš„å€¼ã€‚å®ƒåº”è¯¥ä¸é™„ä»¶çš„å¤§å°ç›¸åŒ¹é…ï¼Œä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚</span></span><br><span class="line">renderPassInfo.renderArea.offset = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">renderPassInfo.renderArea.extent = swapChainExtent;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ç”¨äºVK_ATTACHMENT_LOAD_OP_CLEARçš„æ¸…é™¤å€¼ï¼Œæˆ‘ä»¬å°†å…¶ç”¨ä½œé¢œè‰²é™„ä»¶çš„åŠ è½½æ“ä½œã€‚å°†é€æ˜é¢œè‰²å®šä¹‰ä¸º100%ä¸é€æ˜åº¦çš„é»‘è‰²ã€‚</span></span><br><span class="line">VkClearValue clearColor = &#123;<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">1.0f</span>&#125;;</span><br><span class="line">renderPassInfo.clearValueCount = <span class="number">1</span>;</span><br><span class="line">renderPassInfo.pClearValues = &amp;clearColor;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-åŸºæœ¬ç»˜åˆ¶æŒ‡ä»¤"><a href="#2-4-3-åŸºæœ¬ç»˜åˆ¶æŒ‡ä»¤" class="headerlink" title="2.4.3 åŸºæœ¬ç»˜åˆ¶æŒ‡ä»¤"></a>2.4.3 åŸºæœ¬ç»˜åˆ¶æŒ‡ä»¤</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¸²æŸ“é€šé“ç°åœ¨å¯ä»¥å¼€å§‹äº†ã€‚æ‰€æœ‰è®°å½•å‘½ä»¤çš„å‡½æ•°éƒ½å¯ä»¥é€šè¿‡å®ƒä»¬çš„vkCmdå‰ç¼€æ¥è¯†åˆ«ã€‚å®ƒä»¬éƒ½è¿”å›voidï¼Œæ‰€ä»¥åœ¨å®Œæˆè®°å½•ä¹‹å‰ä¸ä¼šæœ‰é”™è¯¯å¤„ç†ã€‚</span></span><br><span class="line"><span class="built_in">vkCmdBeginRenderPass</span>(commandBuffers[i], &amp;renderPassInfo, VK_SUBPASS_CONTENTS_INLINE);</span><br><span class="line"><span class="built_in">vkCmdBindPipeline</span>(commandBuffers[i], VK_PIPELINE_BIND_POINT_GRAPHICS, graphicsPipeline);</span><br><span class="line"><span class="built_in">vkCmdDraw</span>(commandBuffers[i], <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">vkCmdEndRenderPass</span>(commandBuffers[i]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">vkEndCommandBuffer</span>(commandBuffers[i]) != VK_SUCCESS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to record command buffer!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-4-3-1-vkCmdBindPipeline"><a href="#2-4-3-1-vkCmdBindPipeline" class="headerlink" title="2.4.3.1 vkCmdBindPipeline"></a>2.4.3.1 vkCmdBindPipeline</h4><p>ç®¡é“è¢«åˆ›å»ºåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†å…¶ç»‘å®šåˆ°æŒ‡ä»¤ç¼“å†²åŒº:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdBindPipeline</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkPipelineBindPoint                         pipelineBindPoint,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkPipeline                                  pipeline)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBuffer: æ˜¯å³å°†ç»‘å®šåˆ°ç®¡é“çš„å‘½ä»¤ç¼“å†²åŒº</li>
<li>pipelineBindPoint:æ˜¯ä¸€ä¸ªVkPipelineBindPointå€¼ï¼ŒæŒ‡å®šç®¡é“å¯¹è±¡æ˜¯å›¾å½¢ç®¡é“è¿˜æ˜¯è®¡ç®—ç®¡é“ã€‚<ol>
<li>VK_PIPELINE_BIND_POINT_COMPUTE: ç®¡é“æ§åˆ¶vkCmdDispatchå’ŒvkCmdDispatchIndirectçš„è¡Œä¸ºã€‚</li>
<li>VK_PIPELINE_BIND_POINT_GRAPHICS: ç®¡é“æ§åˆ¶æ‰€æœ‰ç»˜åˆ¶å‘½ä»¤çš„è¡Œä¸ºã€‚å…¶ä»–å‘½ä»¤ä¸å—ç®¡é“çŠ¶æ€çš„å½±å“ã€‚</li>
</ol>
</li>
<li>pipeline: å³å°†ç»‘å®šçš„ç®¡é“</li>
</ol>
<p>ä¸€æ—¦ç»‘å®šï¼Œç®¡é“ç»‘å®šå°†å½±å“å‘½ä»¤ç¼“å†²åŒºä¸­çš„åç»­å›¾å½¢æˆ–è®¡ç®—å‘½ä»¤ï¼Œç›´åˆ°å¦ä¸€ä¸ªç®¡é“ç»‘å®šåˆ°ç»‘å®šç‚¹ã€‚</p>
<h4 id="2-4-3-2-vkCmdDraw"><a href="#2-4-3-2-vkCmdDraw" class="headerlink" title="2.4.3.2 vkCmdDraw"></a>2.4.3.2 vkCmdDraw</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdDraw</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    vertexCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    instanceCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstVertex,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    firstInstance)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>commandBuffer: ç»˜åˆ¶æŒ‡ä»¤è®°å½•åˆ°çš„æŒ‡ä»¤ç¼“å†²åŒº</li>
<li>vertexCount: è¦ç»˜åˆ¶çš„é¡¶ç‚¹æ•°</li>
<li>instanceCount: è¦ç»˜åˆ¶çš„å®ä¾‹æ•°</li>
<li>firstVertex: è¦ç»˜åˆ¶çš„ç¬¬ä¸€ä¸ªé¡¶ç‚¹çš„ç´¢å¼•</li>
<li>firstInstance: è¦ç»˜åˆ¶çš„ç¬¬ä¸€ä¸ªå®ä¾‹çš„ç´¢å¼•</li>
</ol>
<p>å½“æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œå°†ä½¿ç”¨å½“å‰åŸºå…ƒæ‹“æ‰‘å’ŒvertexCountè¿ç»­é¡¶ç‚¹ç´¢å¼•(ç¬¬ä¸€ä¸ªvertexIndexå€¼ç­‰äºfirstVertex)ç»„è£…åŸºå…ƒã€‚è¿™äº›åŸè¯­æ˜¯ç”¨ä»firstInstanceå¼€å§‹çš„instanceIndexç»˜åˆ¶çš„instanceCountæ—¶é—´ï¼Œå¹¶æŒ‰é¡ºåºå¢åŠ æ¯ä¸ªå®ä¾‹ã€‚ç»„è£…çš„åŸè¯­æ‰§è¡Œç»‘å®šçš„å›¾å½¢ç®¡é“ã€‚</p>
<h4 id="2-4-3-3-vkCmdEndRenderPass"><a href="#2-4-3-3-vkCmdEndRenderPass" class="headerlink" title="2.4.3.3 vkCmdEndRenderPass"></a>2.4.3.3 vkCmdEndRenderPass</h4><p>åœ¨è®°å½•äº†æœ€åä¸€ä¸ªå­è¿‡ç¨‹çš„æŒ‡ä»¤ä¹‹åï¼Œç»“æŸæ¸²æŸ“é€šé“å®ä¾‹è°ƒç”¨:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">vkCmdEndRenderPass</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer)</span></span>;</span><br></pre></td></tr></table></figure>
<p>ç»“æŸæ¸²æŸ“é€šé“å®ä¾‹åœ¨æœ€ç»ˆå­é€šé“ä¸Šæ‰§è¡Œä¸€åˆ‡å¤šæ ·æœ¬è§£ææ“ä½œã€‚</p>
<h4 id="2-4-3-4-vkEndCommandBuffer"><a href="#2-4-3-4-vkEndCommandBuffer" class="headerlink" title="2.4.3.4 vkEndCommandBuffer"></a>2.4.3.4 vkEndCommandBuffer</h4><p>ä¸€æ—¦å¼€å§‹è®°å½•ï¼Œåº”ç”¨ç¨‹åºå°†è®°å½•æŒ‡ä»¤åºåˆ—(vkCmd*)ï¼Œä»¥åœ¨æŒ‡ä»¤ç¼“å†²åŒºã€ç»˜åˆ¶ã€è°ƒåº¦å’Œå…¶ä»–æŒ‡ä»¤ä¸­è®¾ç½®çŠ¶æ€ã€‚è°ƒç”¨å®ŒæˆvkEndCommandBufferå‘½ä»¤ç¼“å†²åŒºçš„è®°å½•:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkEndCommandBuffer</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkCommandBuffer                             commandBuffer)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨è®°å½•è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼ŒvkEndCommandBufferå°†è¿”å›ä¸€ä¸ªä¸æˆåŠŸçš„è¿”å›ç æ¥é€šçŸ¥åº”ç”¨ç¨‹åºã€‚</p>
<p>å¦‚æœåº”ç”¨ç¨‹åºå¸Œæœ›è¿›ä¸€æ­¥ä½¿ç”¨æŒ‡ä»¤ç¼“å†²åŒºï¼Œåˆ™å¿…é¡»é‡ç½®æŒ‡ä»¤ç¼“å†²åŒºã€‚æŒ‡ä»¤ç¼“å†²åŒºå¿…é¡»å¤„äºè®°å½•çŠ¶æ€ï¼Œå¹¶è¢«ç§»åŠ¨åˆ°å¯æ‰§è¡ŒçŠ¶æ€ã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulkanå…¥é—¨(9)-æ¸²æŸ“å’Œæ˜¾ç¤º</title>
    <url>/2022/02/27/Vulkan%E5%85%A5%E9%97%A8-9-%E6%B8%B2%E6%9F%93%E5%92%8C%E6%98%BE%E7%A4%BA/</url>
    <content><![CDATA[<h1 id="ç®€è¿°"><a href="#ç®€è¿°" class="headerlink" title="ç®€è¿°"></a>ç®€è¿°</h1><p>åœ¨è¿™ä¸€ç« é‡Œï¼Œæ‰€æœ‰çš„äº‹æƒ…éƒ½è¦é›†ä¸­èµ·æ¥ã€‚æˆ‘ä»¬å°†ç¼–å†™drawFrameå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨ä¸»å¾ªç¯ä¸­è¢«è°ƒç”¨ï¼Œä»¥å°†ä¸‰è§’å½¢ç½®äºå±å¹•ä¸Šã€‚åˆ›å»ºå‡½æ•°å¹¶ä»mainLoopè°ƒç”¨å®ƒ.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">mainLoop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window)) &#123;</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">        <span class="built_in">drawFrame</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="ä¸€-åŒæ­¥"><a href="#ä¸€-åŒæ­¥" class="headerlink" title="ä¸€. åŒæ­¥"></a>ä¸€. åŒæ­¥</h1><p>drawFrameå‡½æ•°å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<ol>
<li>ä»äº¤æ¢é“¾è·å–ä¸€ä¸ªæ˜ åƒ</li>
<li>åœ¨framebufferä¸­ä»¥è¯¥å›¾åƒä½œä¸ºé™„ä»¶æ‰§è¡Œå‘½ä»¤ç¼“å†²</li>
<li>å°†å›¾åƒè¿”å›åˆ°äº¤æ¢é“¾ä»¥ä¾¿æ˜¾ç¤º</li>
</ol>
<p>è¿™äº›äº‹ä»¶éƒ½æ˜¯ä½¿ç”¨å•ä¸ªå‡½æ•°è°ƒç”¨è®¾ç½®çš„ï¼Œä½†å®ƒä»¬æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚å‡½æ•°è°ƒç”¨å°†åœ¨æ“ä½œå®é™…å®Œæˆä¹‹å‰è¿”å›ï¼Œå¹¶ä¸”æ‰§è¡Œçš„é¡ºåºä¹Ÿæœªå®šä¹‰ã€‚å› ä¸ºæ¯ä¸ªæ“ä½œéƒ½ä¾èµ–äºå‰ä¸€ä¸ªå®Œæˆï¼Œæ‰€ä»¥éœ€è¦åŒæ­¥æœºåˆ¶ã€‚</p>
<p>æœ‰ä¸¤ç§åŒæ­¥äº¤æ¢é“¾äº‹ä»¶çš„æ–¹æ³•:æ …æ å’Œä¿¡å·é‡ã€‚</p>
<p>å®ƒä»¬éƒ½æ˜¯å¯ä»¥ç”¨äºåè°ƒæ“ä½œçš„å¯¹è±¡ï¼Œæ–¹æ³•æ˜¯è®©ä¸€ä¸ªæ“ä½œä¿¡å·å’Œå¦ä¸€ä¸ªæ“ä½œç­‰å¾…æ …æ æˆ–ä¿¡å·é‡ä»æ— ä¿¡å·çŠ¶æ€å˜ä¸ºæœ‰ä¿¡å·çŠ¶æ€ã€‚</p>
<p>ä¸åŒçš„æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡vkWaitForFencesæ¥è®¿é—®fencesçš„çŠ¶æ€ï¼Œè€Œä¿¡å·é‡å´ä¸èƒ½ã€‚</p>
<p>fenceä¸»è¦ç”¨äºé€šè¿‡å‘ˆç°æ“ä½œåŒæ­¥åº”ç”¨ç¨‹åºæœ¬èº«ï¼Œè€Œä¿¡å·é‡ç”¨äºåœ¨å‘½ä»¤é˜Ÿåˆ—å†…æˆ–è·¨å‘½ä»¤é˜Ÿåˆ—åŒæ­¥æ“ä½œã€‚æˆ‘ä»¬æƒ³è¦åŒæ­¥drawå‘½ä»¤å’Œè¡¨ç¤ºçš„é˜Ÿåˆ—æ“ä½œï¼Œè¿™ä½¿å¾—ä¿¡å·é‡æœ€é€‚åˆã€‚</p>
<h2 id="1-1-ä¿¡å·é‡åŒæ­¥"><a href="#1-1-ä¿¡å·é‡åŒæ­¥" class="headerlink" title="1.1 ä¿¡å·é‡åŒæ­¥"></a>1.1 ä¿¡å·é‡åŒæ­¥</h2><p>ä¿¡å·é‡æ˜¯ä¸€ç§åŒæ­¥åŸè¯­ï¼Œå¯ä»¥ç”¨æ¥åœ¨æäº¤ç»™é˜Ÿåˆ—çš„æ‰¹ä¹‹é—´æ’å…¥ä¾èµ–å…³ç³»ã€‚ä¿¡å·é‡æœ‰ä¸¤ç§çŠ¶æ€â€”â€”æœ‰ä¿¡å·çš„å’Œæ— ä¿¡å·çš„ã€‚ä¸€ä¸ªä¿¡å·é‡çš„çŠ¶æ€å¯ä»¥åœ¨ä¸€æ‰¹å‘½ä»¤æ‰§è¡Œå®Œæˆåå‘å‡ºä¿¡å·ã€‚æ‰¹å¤„ç†å¯ä»¥åœ¨å¼€å§‹æ‰§è¡Œå‰ç­‰å¾…ä¿¡å·é‡å˜æˆæœ‰ä¿¡å·çš„ï¼Œä¹Ÿå¯ä»¥åœ¨æ‰¹å¤„ç†å¼€å§‹æ‰§è¡Œå‰ç­‰å¾…ä¿¡å·é‡å˜æˆæ— ä¿¡å·çš„ã€‚</p>
<p>ä¸Vulkanä¸­çš„å¤§å¤šæ•°å¯¹è±¡ä¸€æ ·ï¼Œä¿¡å·é‡æ˜¯å†…éƒ¨æ•°æ®çš„æ¥å£ï¼Œé€šå¸¸å¯¹åº”ç”¨ç¨‹åºæ˜¯ä¸é€æ˜çš„ã€‚è¿™ä¸ªå†…éƒ¨æ•°æ®è¢«ç§°ä¸ºä¿¡å·é‡çš„æœ‰æ•ˆè´Ÿè½½ã€‚ä½†æ˜¯ï¼Œä¸ºäº†èƒ½å¤Ÿä¸å½“å‰è®¾å¤‡ä¹‹å¤–çš„ä»£ç†è¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»èƒ½å¤Ÿå°†æœ‰æ•ˆè´Ÿè½½å¯¼å‡ºä¸ºä¸€ç§æ™®éç†è§£çš„æ ¼å¼ï¼Œç„¶åå†ä»è¯¥æ ¼å¼å¯¼å…¥ã€‚ä¿¡å·é‡çš„å†…éƒ¨æ•°æ®å¯ä»¥åŒ…æ‹¬å¯¹ä»»ä½•èµ„æºçš„å¼•ç”¨ï¼Œä»¥åŠä¸åœ¨è¯¥ä¿¡å·é‡å¯¹è±¡ä¸Šæ‰§è¡Œçš„ä¿¡å·æˆ–éä¿¡å·æ“ä½œç›¸å…³çš„å¾…å®šå·¥ä½œã€‚</p>
<p>ä¸‹é¢æä¾›äº†å‘ä¿¡å·é‡å¯¼å…¥å’Œå¯¼å‡ºå†…éƒ¨æ•°æ®çš„æœºåˆ¶ã€‚è¿™äº›æœºåˆ¶é—´æ¥åœ°ä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿè·¨è¿›ç¨‹å’ŒAPIè¾¹ç•Œåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªä¿¡å·é‡å’Œå…¶ä»–åŒæ­¥åŸè¯­ä¹‹é—´å…±äº«ä¿¡å·é‡çŠ¶æ€ã€‚</p>
<p>ä¿¡å·é‡ç”±VkSemaphoreå¥æŸ„è¡¨ç¤º:VK_DEFINE_NON_DISPATCHABLE_HANDLE(VkSemaphore)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkCreateSemaphore</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkSemaphoreCreateInfo*                pCreateInfo,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkAllocationCallbacks*                pAllocator,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkSemaphore*                                pSemaphore)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: åˆ›å»ºä¿¡å·é‡çš„é€»è¾‘è®¾å¤‡</li>
<li>pCreateInfo: æŒ‡å‘VkSemaphoreCreateInfoç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„ä½“åŒ…å«äº†å¦‚ä½•åˆ›å»ºä¿¡å·é‡çš„ä¿¡æ¯</li>
<li>pAllocator: æ§åˆ¶å†…å­˜åˆ†é…</li>
<li>pSemaphore: æŒ‡å‘è¿”å›ç»“æœä¿¡å·é‡å¯¹è±¡çš„å¥æŸ„ã€‚</li>
</ol>
<p>åˆ›å»ºæ—¶ï¼Œä¿¡å·é‡å¤„äºæ— ä¿¡å·çŠ¶æ€ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkSemaphoreCreateInfo</span> &#123;</span><br><span class="line">    VkStructureType           sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*               pNext;</span><br><span class="line">    VkSemaphoreCreateFlags    flags;</span><br><span class="line">&#125; VkSemaphoreCreateInfo;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: æ­¤ç»“æ„çš„ç±»å‹ï¼ŒVK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>flags: å½“å‰APIä¸‹æ— å¯ç”¨flag, æœªæ¥ç‰ˆæœ¬çš„Vulkan APIæˆ–æ‰©å±•å¯èƒ½ä¼šåƒå¯¹å…¶ä»–ç»“æ„ä¸€æ ·ä¸ºflagå’ŒpNextå‚æ•°æ·»åŠ åŠŸèƒ½</li>
</ol>
<h3 id="1-2-åˆ›å»ºä¿¡å·é‡-vkCreateSemaphore"><a href="#1-2-åˆ›å»ºä¿¡å·é‡-vkCreateSemaphore" class="headerlink" title="1.2 åˆ›å»ºä¿¡å·é‡ vkCreateSemaphore"></a>1.2 åˆ›å»ºä¿¡å·é‡ vkCreateSemaphore</h3><p>éœ€è¦ä¸€ä¸ªä¿¡å·é‡æ¥è¡¨ç¤ºå›¾åƒå·²ç»è·å¾—å¹¶å‡†å¤‡å¥½å‘ˆç°ï¼Œè¿˜éœ€è¦å¦ä¸€ä¸ªä¿¡å·é‡æ¥è¡¨ç¤ºæ¸²æŸ“å·²ç»å®Œæˆå¹¶å¯ä»¥è¿›è¡Œå‘ˆç°ã€‚åˆ›å»ºä¸¤ä¸ªç±»æˆå‘˜æ¥å­˜å‚¨è¿™äº›ä¿¡å·é‡å¯¹è±¡:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkSemaphore imageAvailableSemaphore;</span><br><span class="line">VkSemaphore renderFinishedSemaphore;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¿¡å·é‡éœ€è¦å¡«å†™VkSemaphoreCreateInfoï¼Œä½†æ˜¯åœ¨å½“å‰ç‰ˆæœ¬çš„APIä¸­ï¼Œé™¤äº†sTypeä¹‹å¤–å®é™…ä¸Šæ²¡æœ‰ä»»ä½•å¿…éœ€çš„å­—æ®µ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">initVulkan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">createSemaphores</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createSemaphores</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    VkSemaphoreCreateInfo semaphoreInfo = &#123;&#125;;</span><br><span class="line">    semaphoreInfo.sType = VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkCreateSemaphore</span>(device, &amp;semaphoreInfo, <span class="literal">nullptr</span>, &amp;imageAvailableSemaphore) != VK_SUCCESS</span><br><span class="line">            || <span class="built_in">vkCreateSemaphore</span>(device, &amp;semaphoreInfo, <span class="literal">nullptr</span>, &amp;renderFinishedSemaphore) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create semaphores!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒç†ï¼Œä¿¡å·é‡åº”è¯¥åœ¨ç¨‹åºç»“æŸæ—¶æ¸…é™¤ï¼Œå½“æ‰€æœ‰çš„å‘½ä»¤éƒ½å·²ç»å®Œæˆï¼Œä¸å†éœ€è¦æ›´å¤šçš„åŒæ­¥:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vkDestroySemaphore</span>(device, renderFinishedSemaphore, <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">vkDestroySemaphore</span>(device, imageAvailableSemaphore, <span class="literal">nullptr</span>);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="äºŒ-ä»äº¤æ¢é“¾è·å–å›¾åƒ"><a href="#äºŒ-ä»äº¤æ¢é“¾è·å–å›¾åƒ" class="headerlink" title="äºŒ. ä»äº¤æ¢é“¾è·å–å›¾åƒ"></a>äºŒ. ä»äº¤æ¢é“¾è·å–å›¾åƒ</h1><p>å¦‚å‰æ‰€è¿°ï¼Œåœ¨drawFrameå‡½æ•°ä¸­éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä»äº¤æ¢é“¾ä¸­è·å–å›¾åƒã€‚å›æƒ³ä¸€ä¸‹ï¼Œäº¤æ¢é“¾æ˜¯ä¸€ä¸ªæ‰©å±•ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå…·æœ‰vk*KHRå‘½åçº¦å®šçš„å‡½æ•°:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> imageIndex;</span><br><span class="line">    <span class="built_in">vkAcquireNextImageKHR</span>(device, swapChain,</span><br><span class="line">            std::numeric_limits&lt;<span class="type">uint64_t</span>&gt;::<span class="built_in">max</span>(),</span><br><span class="line">            imageAvailableSemaphore, VK_NULL_HANDLE, &amp;imageIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å–ä¸€ä¸ªå¯ç”¨çš„å¯å‘ˆç°å›¾åƒä½¿ç”¨ï¼Œå¹¶æ£€ç´¢è¯¥å›¾åƒçš„ç´¢å¼•ï¼Œè°ƒç”¨: vkAcquireNextImageKHR:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkAcquireNextImageKHR</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkDevice                                    device,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkSwapchainKHR                              swapchain,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint64_t</span>                                    timeout,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkSemaphore                                 semaphore,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkFence                                     fence,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>*                                   pImageIndex)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>device: æä¾›é€»è¾‘è®¾å¤‡å¥æŸ„</li>
<li>swapChain: äº¤æ¢é“¾å¯¹è±¡çš„å¥æŸ„, ä»è¿™ä¸ªäº¤æ¢é“¾ä¸­è·å–å›¾åƒ</li>
<li>timeout: æŒ‡å®šå¦‚æœæ²¡æœ‰å¯ç”¨çš„æ˜ åƒï¼Œå‡½æ•°å°†ç­‰å¾…å¤šé•¿æ—¶é—´(ä»¥çº³ç§’ä¸ºå•ä½)ã€‚</li>
<li>semaphore: æ˜¯VK_NULL_HANDLEæˆ–è€…ä¸€ä¸ªä¿¡å·é‡</li>
<li>fence: VK_NULL_HANDLEæˆ–fence to signalã€‚</li>
<li>pImageIndex: ä¸€ä¸ªæŒ‡å‘uint32_tçš„æŒ‡é’ˆ, ç”¨äºè¾“å‡ºå¯ç”¨çš„äº¤æ¢é“¾æ˜ åƒçš„ç´¢å¼•, ç´¢å¼•æŒ‡çš„æ˜¯swapChainImagesæ•°ç»„ä¸­çš„VkImageã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªç´¢å¼•æ¥é€‰æ‹©æ­£ç¡®çš„å‘½ä»¤ç¼“å†²åŒºã€‚</li>
</ol>
<p>å½“æˆåŠŸæ—¶ï¼ŒvkAcquireNextImageKHRä»swapchainè·å¾—ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çš„å›¾åƒï¼Œå¹¶å°†pImageIndexè®¾ç½®ä¸ºè¯¥å›¾åƒåœ¨swapchainä¸­çš„ç´¢å¼•ã€‚è¡¨ç¤ºå¼•æ“åœ¨è·å–å›¾åƒæ—¶å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆå¯¹å›¾åƒçš„è¯»å–ï¼Œå› æ­¤åº”ç”¨ç¨‹åºå¿…é¡»ä½¿ç”¨ä¿¡å·é‡å’Œ&#x2F;æˆ–æ …æ æ¥ç¡®ä¿å›¾åƒå¸ƒå±€å’Œå†…å®¹åœ¨è¡¨ç¤ºå¼•æ“è¯»å–å®Œæˆä¹‹å‰ä¸ä¼šè¢«ä¿®æ”¹ã€‚å¦‚æœsemaphoreä¸æ˜¯VK_NULL_HANDLEï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šè®¤ä¸ºï¼Œä¸€æ—¦vkAcquireNextImageKHRè¿”å›ï¼Œsemaphoreå¼•ç”¨çš„ä¿¡å·é‡ä¿¡å·æ“ä½œå·²ç»æäº¤æ‰§è¡Œã€‚å›¾åƒè·å–çš„é¡ºåºå–å†³äºå®ç°ï¼Œå¹¶ä¸”å¯èƒ½ä¸å›¾åƒå‘ˆç°çš„é¡ºåºä¸åŒã€‚</p>
<p>å¦‚æœtimeoutä¸º0ï¼Œåˆ™vkAcquireNextImageKHRä¸ä¼šç­‰å¾…ï¼Œå¹¶ä¸”ä¼šæˆåŠŸè·å–é•œåƒï¼Œæˆ–è€…å¤±è´¥å¹¶è¿”å›VK_NOT_READYï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çš„é•œåƒã€‚å¦‚æœæŒ‡å®šçš„è¶…æ—¶æ—¶é—´åœ¨è·å–é•œåƒä¹‹å‰è¿‡æœŸï¼ŒvkAcquireNextImageKHRå°†è¿”å›VK_TIMEOUTã€‚å¦‚æœtimeoutæ˜¯UINT64_MAXï¼Œè¶…æ—¶æ—¶é—´è¢«è®¤ä¸ºæ˜¯æ— é™çš„ï¼ŒvkAcquireNextImageKHRå°†é˜»å¡ç›´åˆ°ä¸€ä¸ªå›¾åƒè¢«è·å–æˆ–ä¸€ä¸ªé”™è¯¯å‘ç”Ÿã€‚</p>
<p>å¦‚æœåº”ç”¨ç¨‹åºå½“å‰è·å–çš„(ä½†å°šæœªå‘ˆç°çš„)å›¾åƒæ•°é‡å°äºæˆ–ç­‰äºswapchainä¸­çš„å›¾åƒæ•°é‡ä¸vksurfacecabiltieskhr::minImageCountå€¼ä¹‹é—´çš„å·®å€¼ï¼Œåˆ™æœ€ç»ˆä¼šè·å¾—ä¸€ä¸ªå›¾åƒã€‚å¦‚æœå½“å‰è·å–çš„å›¾åƒæ•°é‡å¤§äºæ­¤å€¼ï¼Œåˆ™ä¸åº”è¯¥è°ƒç”¨vkAcquireNextImageKHR;å¦‚æœæ˜¯ï¼Œtimeoutä¸èƒ½æ˜¯UINT64_MAXã€‚</p>
<p>å¦‚æœä¸€ä¸ªå›¾åƒæˆåŠŸè·å¾—ï¼ŒvkAcquireNextImageKHRå¿…é¡»è¦ä¹ˆè¿”å›VK_SUCCESSï¼Œè¦ä¹ˆè¿”å›VK_SUBOPTIMAL_KHRï¼Œå¦‚æœäº¤æ¢é“¾ä¸å†å®Œå…¨åŒ¹é…è¡¨é¢å±æ€§ï¼Œä½†ä»ç„¶å¯ä»¥ç”¨äºè¡¨ç¤ºã€‚</p>
<h1 id="ä¸‰-æäº¤æŒ‡ä»¤ç¼“å†²åŒº"><a href="#ä¸‰-æäº¤æŒ‡ä»¤ç¼“å†²åŒº" class="headerlink" title="ä¸‰. æäº¤æŒ‡ä»¤ç¼“å†²åŒº"></a>ä¸‰. æäº¤æŒ‡ä»¤ç¼“å†²åŒº</h1><p>é˜Ÿåˆ—æäº¤å’ŒåŒæ­¥æ˜¯é€šè¿‡VkSubmitInfoç»“æ„ä¸­çš„å‚æ•°é…ç½®çš„ã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkSubmitInfo</span> &#123;</span><br><span class="line">    VkStructureType                sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*                    pNext;</span><br><span class="line">    <span class="type">uint32_t</span>                       waitSemaphoreCount;</span><br><span class="line">    <span class="type">const</span> VkSemaphore*             pWaitSemaphores;</span><br><span class="line">    <span class="type">const</span> VkPipelineStageFlags*    pWaitDstStageMask;</span><br><span class="line">    <span class="type">uint32_t</span>                       commandBufferCount;</span><br><span class="line">    <span class="type">const</span> VkCommandBuffer*         pCommandBuffers;</span><br><span class="line">    <span class="type">uint32_t</span>                       signalSemaphoreCount;</span><br><span class="line">    <span class="type">const</span> VkSemaphore*             pSignalSemaphores;</span><br><span class="line">&#125; VkSubmitInfo;</span><br></pre></td></tr></table></figure>

<ol>
<li>sType: æ­¤ç»“æ„çš„ç±»å‹ï¼ŒVK_STRUCTURE_TYPE_SUBMIT_INFO</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>waitSemaphoreCount: æ‰§è¡Œæ‰¹å¤„ç†çš„å‘½ä»¤ç¼“å†²åŒºä¹‹å‰éœ€è¦ç­‰å¾…çš„ä¿¡å·é‡çš„æ•°é‡</li>
<li>pWaitSemaphores: æŒ‡å‘VkSemaphoreå¥æŸ„æ•°ç»„çš„æŒ‡é’ˆï¼Œåœ¨è¿™ä¸ªæ‰¹å¤„ç†çš„å‘½ä»¤ç¼“å†²åŒºå¼€å§‹æ‰§è¡Œä¹‹å‰ï¼Œè¦ç­‰å¾…è¯¥å¥æŸ„ã€‚å¦‚æœæä¾›äº†ç­‰å¾…çš„ä¿¡å·é‡ï¼Œåˆ™å®šä¹‰ä¸€ä¸ªä¿¡å·é‡ç­‰å¾…æ“ä½œã€‚</li>
<li>pWaitDstStageMask: æŒ‡å‘æ¯ä¸ªå¯¹åº”çš„ä¿¡å·é‡ç­‰å¾…å°†å‘ç”Ÿçš„ç®¡é“é˜¶æ®µæ•°ç»„çš„æŒ‡é’ˆ</li>
<li>commandBufferCount: æ‰¹å¤„ç†ä¸­è¦æ‰§è¡Œçš„å‘½ä»¤ç¼“å†²åŒºçš„æ•°é‡</li>
<li>pCommandBuffers: æŒ‡å‘è¦åœ¨æ‰¹å¤„ç†ä¸­æ‰§è¡Œçš„VkCommandBufferå¥æŸ„æ•°ç»„çš„æŒ‡é’ˆ</li>
<li>signalSemaphoreCount: åœ¨pCommandBuffersä¸­æŒ‡å®šçš„å‘½ä»¤å®Œæˆæ‰§è¡Œåè¦å‘å‡ºä¿¡å·çš„ä¿¡å·é‡çš„æ•°é‡</li>
<li>pSignalSemaphores: æŒ‡å‘VkSemaphoreå¥æŸ„æ•°ç»„çš„æŒ‡é’ˆï¼Œå½“è¿™ä¸ªæ‰¹å¤„ç†çš„å‘½ä»¤ç¼“å†²åŒºå®Œæˆæ‰§è¡Œæ—¶ï¼ŒVkSemaphoreå¥æŸ„æ•°ç»„å°†å‘å‡ºä¿¡å·ã€‚å¦‚æœæä¾›äº†è¦å‘é€ä¿¡å·çš„ä¿¡å·é‡ï¼Œå®ƒä»¬å®šä¹‰äº†ä¸€ä¸ªä¿¡å·é‡ä¿¡å·æ“ä½œã€‚</li>
</ol>
<p>å‘½ä»¤ç¼“å†²åŒºåœ¨pCommandBuffersä¸­å‡ºç°çš„é¡ºåºç”¨äºç¡®å®šæäº¤é¡ºåºï¼Œå› æ­¤æ‰€æœ‰çš„éšå¼æ’åºéƒ½ä¿è¯éµå®ˆå®ƒã€‚é™¤äº†è¿™äº›éšå¼æ’åºä¿è¯å’Œä»»ä½•æ˜¾å¼åŒæ­¥åŸè¯­ä¹‹å¤–ï¼Œè¿™äº›å‘½ä»¤ç¼“å†²åŒºå¯èƒ½ä¼šé‡å æˆ–ä»¥å…¶ä»–æ–¹å¼ä¹±åºæ‰§è¡Œã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‰ä¸‰ä¸ªå‚æ•°æŒ‡å®šåœ¨æ‰§è¡Œå¼€å§‹ä¹‹å‰ç­‰å¾…å“ªäº›ä¿¡å·é‡ï¼Œä»¥åŠåœ¨ç®¡é“çš„å“ªä¸ªé˜¶æ®µç­‰å¾…ã€‚</span></span><br><span class="line">VkSubmitInfo submitInfo = &#123;&#125;;</span><br><span class="line">submitInfo.sType = VK_STRUCTURE_TYPE_SUBMIT_INFO;</span><br><span class="line">VkSemaphore waitSemaphores[] = &#123;imageAvailableSemaphore&#125;;</span><br><span class="line"><span class="comment">// æˆ‘ä»¬å¸Œæœ›ç­‰å¾…å‘å›¾åƒå†™å…¥é¢œè‰²ï¼Œç›´åˆ°å®ƒå¯ç”¨ä¸ºæ­¢ï¼Œå› æ­¤æˆ‘ä»¬æŒ‡å®šäº†å‘é¢œè‰²é™„ä»¶å†™å…¥çš„å›¾å½¢ç®¡é“é˜¶æ®µã€‚</span></span><br><span class="line">VkPipelineStageFlags waitStages[] = &#123;VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT&#125;;</span><br><span class="line">submitInfo.waitSemaphoreCount = <span class="number">1</span>;</span><br><span class="line">submitInfo.pWaitSemaphores = waitSemaphores;</span><br><span class="line"><span class="comment">// ç†è®ºä¸Šå·²ç»å¯ä»¥å¼€å§‹æ‰§è¡Œé¡¶ç‚¹ç€è‰²å™¨ï¼Œè€Œè¿˜æ²¡æœ‰å¯ç”¨å›¾åƒã€‚</span></span><br><span class="line"><span class="comment">// waitStagesæ•°ç»„ä¸­çš„æ¯ä¸€é¡¹éƒ½å¯¹åº”äºåœ¨pwaitsemaphresä¸­å…·æœ‰ç›¸åŒç´¢å¼•çš„ä¿¡å·é‡ã€‚</span></span><br><span class="line">submitInfo.pWaitDstStageMask = waitStages;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šå®é™…æäº¤å“ªäº›å‘½ä»¤ç¼“å†²åŒºä»¥æ‰§è¡Œ</span></span><br><span class="line">submitInfo.commandBufferCount = <span class="number">1</span>;</span><br><span class="line">submitInfo.pCommandBuffers = &amp;commandBuffers[imageIndex];</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šåœ¨å‘½ä»¤ç¼“å†²åŒºå®Œæˆæ‰§è¡Œåè¦å‘é€å“ªäº›ä¿¡å·é‡</span></span><br><span class="line">VkSemaphore signalSemaphores[] = &#123;renderFinishedSemaphore&#125;;</span><br><span class="line">submitInfo.signalSemaphoreCount = <span class="number">1</span>;</span><br><span class="line">submitInfo.pSignalSemaphores = signalSemaphores;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨vkqueuessubmitå°†å‘½ä»¤ç¼“å†²åŒºæäº¤åˆ°å›¾å½¢é˜Ÿåˆ—</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">vkQueueSubmit</span>(graphicsQueue, <span class="number">1</span>, &amp;submitInfo, VK_NULL_HANDLE) != VK_SUCCESS) &#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to submit draw command buffer!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨vkqueuessubmitå°†å‘½ä»¤ç¼“å†²åŒºæäº¤åˆ°å›¾å½¢é˜Ÿåˆ—ã€‚å½“å·¥ä½œè´Ÿè½½æ›´å¤§æ—¶ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªVkSubmitInfoç»“æ„æ•°ç»„ä½œä¸ºæ•ˆç‡å‚æ•°ã€‚<br>æœ€åä¸€ä¸ªå‚æ•°å¼•ç”¨ä¸€ä¸ªå¯é€‰çš„fenceï¼Œè¯¥fenceå°†åœ¨å‘½ä»¤ç¼“å†²åŒºå®Œæˆæ‰§è¡Œæ—¶å‘å‡ºä¿¡å·ã€‚æˆ‘ä»¬ä½¿ç”¨ä¿¡å·é‡è¿›è¡ŒåŒæ­¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¼ é€’ä¸€ä¸ªVK_NULL_HANDLEã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkQueueSubmit</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkQueue                                     queue,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">uint32_t</span>                                    submitCount,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkSubmitInfo*                         pSubmits,</span></span></span><br><span class="line"><span class="params"><span class="function">    VkFence                                     fence)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>queue: å‘½ä»¤ç¼“å†²å°†è¢«æäº¤åˆ°çš„é˜Ÿåˆ—</li>
<li>submitCount: æäº¤æ•°ç»„pSubmitsä¸­çš„å…ƒç´ æ•°é‡</li>
<li>pSubmits: æŒ‡å‘VkSubmitInfoç»“æ„æ•°ç»„çš„æŒ‡é’ˆï¼Œæ¯ä¸ªç»“æ„éƒ½æŒ‡å®šäº†ä¸€ä¸ªå‘½ä»¤ç¼“å†²åŒºæäº¤æ‰¹å¤„ç†</li>
<li>fence: å¯é€‰çš„fenceå¥æŸ„ï¼Œä¸€æ—¦æ‰€æœ‰æäº¤çš„å‘½ä»¤ç¼“å†²åŒºå®Œæˆæ‰§è¡Œï¼Œå°±ä¼šå‘å‡ºä¿¡å·ã€‚å¦‚æœfenceä¸æ˜¯VK_NULL_HANDLEï¼Œåˆ™å®šä¹‰ä¸€ä¸ªfenceä¿¡å·æ“ä½œ</li>
</ol>
<p><strong>æäº¤å¯èƒ½æ˜¯ä¸€ä¸ªé«˜å¼€é”€çš„æ“ä½œï¼Œåº”ç”¨ç¨‹åºåº”è¯¥å°½å¯èƒ½å°‘çš„è°ƒç”¨vkqueuessubmitæ¥æ‰¹é‡å¤„ç†ã€‚</strong></p>
<h1 id="å››-Subpassä¾èµ–"><a href="#å››-Subpassä¾èµ–" class="headerlink" title="å››. Subpassä¾èµ–"></a>å››. Subpassä¾èµ–</h1><p>æ¸²æŸ“é€šé“ä¸­çš„å­é€šé“ä¼šè‡ªåŠ¨å¤„ç†å›¾åƒå¸ƒå±€çš„è½¬æ¢ã€‚è¿™äº›è½¬æ¢ç”±å­ä¼ é€’ä¾èµ–é¡¹æ§åˆ¶ï¼Œå­ä¼ é€’ä¾èµ–é¡¹æŒ‡å®šå­ä¼ é€’ä¹‹é—´çš„å†…å­˜å’Œæ‰§è¡Œä¾èµ–é¡¹ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨åªæœ‰ä¸€ä¸ªSubpassï¼Œä½†æ˜¯åœ¨è¿™ä¸ªSubpassä¹‹å‰å’Œä¹‹åçš„æ“ä½œä¹Ÿè¢«ç®—ä½œéšå¼çš„â€œSubpassesâ€ã€‚</p>
<p>æœ‰ä¸¤ä¸ªå†…ç½®çš„ä¾èµ–å…³ç³»è´Ÿè´£æ¸²æŸ“é€šé“å¼€å§‹å’Œç»“æŸçš„è½¬æ¢ï¼Œä½†å‰è€…æ²¡æœ‰åœ¨æ­£ç¡®çš„æ—¶é—´å‘ç”Ÿã€‚å®ƒå‡è®¾è½¬æ¢å‘ç”Ÿåœ¨ç®¡é“çš„å¼€å§‹ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨é‚£ä¸€ç‚¹è¿˜æ²¡æœ‰è·å¾—å›¾åƒ!</p>
<p>æœ‰ä¸¤ç§æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>å°†imageAvailableSemaphoreçš„ç­‰å¾…é˜¶æ®µæ›´æ”¹ä¸ºVK_PIPELINE_STAGE_TOP_OF_PIPE_BITï¼Œä»¥ç¡®ä¿æ¸²æŸ“é€šé“ç›´åˆ°å›¾åƒå¯ç”¨æ—¶æ‰å¼€å§‹</li>
<li>è®©æ¸²æŸ“é€šé“ç­‰å¾…VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BITé˜¶æ®µã€‚</li>
</ol>
<p>åœ¨è¿™é‡Œä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼æ¥äº†è§£å­ä¼ é€’ä¾èµ–é¡¹åŠå…¶å·¥ä½œæ–¹å¼ã€‚Subpassä¾èµ–åœ¨VkSubpassDependencyç»“æ„ä¸­æŒ‡å®šã€‚</p>
<p>åœ¨createRenderPasså‡½æ•°ä¸­æ·»åŠ ä¸€ä¸ª:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkSubpassDependency dependency = &#123;&#125;;</span><br><span class="line"><span class="comment">// æŒ‡å®šä¾èµ–é¡¹</span></span><br><span class="line">dependency.srcSubpass = VK_SUBPASS_EXTERNAL;</span><br><span class="line"><span class="comment">// ä»å±å­ä¼ é€’çš„ç´¢å¼•</span></span><br><span class="line">dependency.dstSubpass = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šè¦ç­‰å¾…çš„æ“ä½œä»¥åŠè¿™äº›æ“ä½œå‘ç”Ÿçš„é˜¶æ®µ</span></span><br><span class="line"><span class="comment">// éœ€è¦ç­‰å¾…äº¤æ¢é“¾å®Œæˆå¯¹å›¾åƒçš„è¯»å–åæ‰èƒ½è®¿é—®å®ƒã€‚è¿™å¯ä»¥é€šè¿‡ç­‰å¾…é¢œè‰²é™„ä»¶è¾“å‡ºé˜¶æ®µæœ¬èº«æ¥å®Œæˆã€‚</span></span><br><span class="line">dependency.dstStageMask = VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT;</span><br><span class="line">dependency.dstAccessMask = VK_ACCESS_COLOR_ATTACHMENT_READ_BIT | VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨è¿™ä¸€é˜¶æ®µåº”è¯¥ç­‰å¾…çš„æ“ä½œæ˜¯åœ¨é¢œè‰²è¿æ¥é˜¶æ®µï¼ŒåŒ…æ‹¬é˜…è¯»å’Œä¹¦å†™é¢œè‰²è¿æ¥ã€‚</span></span><br><span class="line"><span class="comment">// è¿™äº›è®¾ç½®å°†é˜²æ­¢è½¬æ¢å‘ç”Ÿï¼Œç›´åˆ°å®ƒæ˜¯çœŸæ­£å¿…è¦çš„(å’Œå…è®¸çš„):å½“æˆ‘ä»¬æƒ³è¦å¼€å§‹å†™å…¥é¢œè‰²ã€‚</span></span><br><span class="line">renderPassInfo.dependencyCount = <span class="number">1</span>;</span><br><span class="line">renderPassInfo.pDependencies = &amp;dependency;</span><br></pre></td></tr></table></figure>
<p>ç‰¹æ®Šå€¼VK_SUBPASS_EXTERNALæŒ‡çš„æ˜¯åœ¨æ¸²æŸ“ä¼ é€’ä¹‹å‰æˆ–ä¹‹åçš„éšå¼å­ä¼ é€’ï¼Œè¿™å–å†³äºå®ƒæ˜¯åœ¨srcSubpassè¿˜æ˜¯dstSubpassä¸­æŒ‡å®šçš„ã€‚<br>ç´¢å¼•0æŒ‡å‘æˆ‘ä»¬çš„å­é€šé“ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªã€‚dstSubpasså¿…é¡»å§‹ç»ˆé«˜äºsrcSubpassï¼Œä»¥é˜²æ­¢ä¾èµ–å…³ç³»å›¾ä¸­çš„å¾ªç¯ã€‚</p>
<h1 id="äº”-æ˜¾ç¤º"><a href="#äº”-æ˜¾ç¤º" class="headerlink" title="äº”. æ˜¾ç¤º"></a>äº”. æ˜¾ç¤º</h1><p>ç»˜åˆ¶æ¡†æ¶çš„æœ€åä¸€æ­¥æ˜¯å°†ç»“æœæäº¤å›äº¤æ¢é“¾ï¼Œä½¿å…¶æœ€ç»ˆæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p>
<p><strong>åœ¨åº”ç”¨ç¨‹åºå¯ä»¥å‘ˆç°ä¸€ä¸ªå›¾åƒä¹‹å‰ï¼Œå›¾åƒçš„å¸ƒå±€å¿…é¡»è½¬æ¢ä¸ºVK_IMAGE_LAYOUT_PRESENT_SRC_KHRå¸ƒå±€ï¼Œæˆ–è€…å¯¹äºä¸€ä¸ªå…±äº«çš„å¯å‘ˆç°å›¾åƒï¼Œå¿…é¡»è½¬æ¢ä¸ºVK_IMAGE_LAYOUT_SHARED_PRESENT_KHRå¸ƒå±€ã€‚</strong></p>
<h2 id="5-1-VkPresentInfoKHR"><a href="#5-1-VkPresentInfoKHR" class="headerlink" title="5.1 VkPresentInfoKHR"></a>5.1 VkPresentInfoKHR</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">VkPresentInfoKHR</span> &#123;</span><br><span class="line">    VkStructureType          sType;</span><br><span class="line">    <span class="type">const</span> <span class="type">void</span>*              pNext;</span><br><span class="line">    <span class="type">uint32_t</span>                 waitSemaphoreCount;</span><br><span class="line">    <span class="type">const</span> VkSemaphore*       pWaitSemaphores;</span><br><span class="line">    <span class="type">uint32_t</span>                 swapchainCount;</span><br><span class="line">    <span class="type">const</span> VkSwapchainKHR*    pSwapchains;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint32_t</span>*          pImageIndices;</span><br><span class="line">    VkResult*                pResults;</span><br><span class="line">&#125; VkPresentInfoKHR;</span><br></pre></td></tr></table></figure>
<ol>
<li>sType: æ­¤ç»“æ„çš„ç±»å‹ï¼ŒVK_STRUCTURE_TYPE_PRESENT_INFO_KHR</li>
<li>pNext: ä¸ºç©ºæˆ–æŒ‡å‘ç‰¹å®šäºæ‰©å±•çš„ç»“æ„çš„æŒ‡é’ˆ</li>
<li>waitsemaphore: åœ¨å‘å‡ºå½“å‰è¯·æ±‚ä¹‹å‰ç­‰å¾…çš„ä¿¡å·é‡çš„æ•°é‡, å¯èƒ½æ˜¯é›¶ã€‚</li>
<li>pwaitsemaphres: ç©ºçš„æˆ–æŒ‡å‘å¸¦æœ‰waitsemaphoreæ¡ç›®çš„VkSemaphoreå¯¹è±¡æ•°ç»„çš„æŒ‡é’ˆï¼Œå®ƒæŒ‡å®šäº†åœ¨å‘å‡ºå½“å‰è¯·æ±‚ä¹‹å‰éœ€è¦ç­‰å¾…çš„ä¿¡å·é‡ã€‚</li>
<li>swapchainCount: æŒ‡ä»¤æä¾›ç»™äº¤æ¢é“¾çš„æ•°é‡</li>
<li>pSwapchains: æŒ‡å‘å¸¦æœ‰swapchainCountæ¡ç›®çš„VkSwapchainKHRå¯¹è±¡æ•°ç»„çš„æŒ‡é’ˆã€‚ç»™å®šçš„äº¤æ¢é“¾ä¸èƒ½åœ¨æ­¤åˆ—è¡¨ä¸­å‡ºç°å¤šæ¬¡ã€‚</li>
<li>pImageIndices: æŒ‡å‘æ¯ä¸ªswapchainçš„å¯å‘ˆç°å›¾åƒæ•°ç»„çš„ç´¢å¼•æ•°ç»„çš„æŒ‡é’ˆï¼Œå…¶ä¸­åŒ…å«swapchainCountæ¡ç›®ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½æ ‡è¯†è¦åœ¨pSwapchainsæ•°ç»„ä¸­çš„ç›¸åº”æ¡ç›®ä¸Šæ˜¾ç¤ºçš„å›¾åƒã€‚</li>
<li>results: æŒ‡å‘å¸¦æœ‰swapchainCountæ¡ç›®çš„VkResultç±»å‹å…ƒç´ æ•°ç»„çš„æŒ‡é’ˆã€‚ä¸éœ€è¦æ¯ä¸ªswapchainç»“æœçš„åº”ç”¨ç¨‹åºå¯ä»¥å¯¹ç»“æœä½¿ç”¨NULLã€‚å¦‚æœénullï¼Œåˆ™resultsä¸­çš„æ¯ä¸ªæ¡ç›®éƒ½å°†è¢«è®¾ç½®ä¸ºVkResultï¼Œä»¥è¡¨ç¤ºä¸pSwapchainsä¸­çš„ç›¸åŒç´¢å¼•ç›¸å¯¹åº”çš„äº¤æ¢é“¾ã€‚</li>
</ol>
<h2 id="5-2-æ˜¾ç¤ºè®¾ç½®"><a href="#5-2-æ˜¾ç¤ºè®¾ç½®" class="headerlink" title="5.2 æ˜¾ç¤ºè®¾ç½®"></a>5.2 æ˜¾ç¤ºè®¾ç½®</h2><p>é€šè¿‡drawFrameå‡½æ•°æœ«å°¾çš„VkPresentInfoKHRç»“æ„æ¥é…ç½®æ˜¾ç¤ºç›¸å…³è®¾ç½®:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkPresentInfoKHR presentInfo = &#123;&#125;;</span><br><span class="line">presentInfo.sType = VK_STRUCTURE_TYPE_PRESENT_INFO_KHR;</span><br><span class="line"><span class="comment">// æŒ‡å®šåœ¨è¡¨ç¤ºå‘ç”Ÿä¹‹å‰ç­‰å¾…å“ªäº›ä¿¡å·é‡ï¼Œå°±åƒVkSubmitInfoä¸€æ ·</span></span><br><span class="line">presentInfo.waitSemaphoreCount = <span class="number">1</span>;</span><br><span class="line">presentInfo.pWaitSemaphores = signalSemaphores;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šè¦å‘å…¶æ˜¾ç¤ºå›¾åƒçš„äº¤æ¢é“¾ï¼Œä»¥åŠæ¯ä¸ªäº¤æ¢é“¾çš„å›¾åƒç´¢å¼•ã€‚</span></span><br><span class="line">VkSwapchainKHR swapChains[] = &#123;swapChain&#125;;</span><br><span class="line">presentInfo.swapchainCount = <span class="number">1</span>;</span><br><span class="line">presentInfo.pSwapchains = swapChains;</span><br><span class="line">presentInfo.pImageIndices = &amp;imageIndex;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šä¸€ä¸ªVkResultå€¼æ•°ç»„ï¼Œä»¥ä¾¿åœ¨è¡¨ç¤ºæˆåŠŸæ—¶æ£€æŸ¥æ¯ä¸ªäº¤æ¢é“¾ã€‚</span></span><br><span class="line"><span class="comment">// åªä½¿ç”¨å•ä¸ªäº¤æ¢é“¾ï¼Œå°±ä¸éœ€è¦ï¼Œå› ä¸ºå¯ä»¥ç®€å•åœ°ä½¿ç”¨å½“å‰å‡½æ•°çš„è¿”å›å€¼ã€‚</span></span><br><span class="line">presentInfo.pResults = <span class="literal">nullptr</span>; <span class="comment">// Optional</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// vkQueuePresentKHRå‡½æ•°æäº¤è¯·æ±‚ï¼Œä»¥å‘äº¤æ¢é“¾è¯·æ±‚ä¸€ä¸ªå›¾åƒ</span></span><br><span class="line"><span class="built_in">vkQueuePresentKHR</span>(presentQueue, &amp;presentInfo);</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ç¼–è¯‘è¿è¡Œä¸€ä¸‹æˆ‘ä»¬çš„ç¨‹åº:</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-9-%E6%B8%B2%E6%9F%93%E5%92%8C%E6%98%BE%E7%A4%BA/Vulkan_9_1.png" alt="å›¾ç‰‡"></p>
<p>ohhhh!!!!æ•´æ•´ä¸€åƒå¤šè¡Œçš„ä»£ç ï¼Œç»ˆäºä¸æ˜¯é»‘ç³Šç³Šçš„çª—å£äº†ã€‚</p>
<p>å½“å¯ç”¨éªŒè¯å±‚æ—¶ï¼Œç¨‹åºåœ¨å…³é—­æ—¶å°±ä¼šå´©æºƒã€‚ä»debugCallbackæ‰“å°åˆ°ç»ˆç«¯çš„æ¶ˆæ¯å‘Šè¯‰æˆ‘ä»¬ä¸ºä»€ä¹ˆ:</p>
<p>è®°ä½ï¼ŒdrawFrameä¸­çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬é€€å‡ºmainLoopä¸­çš„å¾ªç¯æ—¶ï¼Œç»˜å›¾å’Œè¡¨ç¤ºæ“ä½œå¯èƒ½ä»ç„¶åœ¨è¿›è¡Œã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæ¸…ç†èµ„æºå°±å¯èƒ½å¸¦æ¥å¼‚å¸¸ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥ç­‰å¾…é€»è¾‘è®¾å¤‡å®Œæˆæ“ä½œï¼Œç„¶åé€€å‡ºmainLoopå¹¶é”€æ¯çª—å£:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">mainLoop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">glfwWindowShouldClose</span>(window)) &#123;</span><br><span class="line">        <span class="built_in">glfwPollEvents</span>();</span><br><span class="line">        <span class="built_in">drawFrame</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">vkDeviceWaitIdle</span>(device);</span><br></pre></td></tr></table></figure>

<h3 id="5-2-1-vkQueuePresentKHR"><a href="#5-2-1-vkQueuePresentKHR" class="headerlink" title="5.2.1 vkQueuePresentKHR"></a>5.2.1 vkQueuePresentKHR</h3><p>åœ¨å°†æ‰€æœ‰æ¸²æŸ“å‘½ä»¤æ’é˜Ÿå¹¶å°†å›¾åƒè½¬æ¢åˆ°æ­£ç¡®çš„å¸ƒå±€åï¼Œè¦å°†å›¾åƒæ’é˜Ÿæ˜¾ç¤ºï¼Œè°ƒç”¨:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">VkResult <span class="title">vkQueuePresentKHR</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    VkQueue                                     queue,</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">const</span> VkPresentInfoKHR*                     pPresentInfo)</span></span>;</span><br></pre></td></tr></table></figure>
<ol>
<li>queueæ˜¯ä¸€ä¸ªèƒ½å¤Ÿåœ¨ä¸å›¾åƒäº¤æ¢é“¾ç›¸åŒçš„è®¾å¤‡ä¸Šæ˜¾ç¤ºåˆ°ç›®æ ‡è¡¨é¢å¹³å°çš„é˜Ÿåˆ—ã€‚</li>
<li>pPresentInfoæ˜¯ä¸€ä¸ªæŒ‡å‘VkPresentInfoKHRç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„ä½“æŒ‡å®šäº†è¡¨ç¤ºçš„å‚æ•°ã€‚</li>
</ol>
<p>åº”ç”¨ç¨‹åºä¸éœ€è¦æŒ‰ç…§è·å–å›¾åƒçš„é¡ºåºæ¥å‘ˆç°å›¾åƒâ€”â€”åº”ç”¨ç¨‹åºå¯ä»¥ä»»æ„åœ°å‘ˆç°å½“å‰è·å–çš„ä»»ä½•å›¾åƒã€‚</p>
<h1 id="å…­-Frames-in-flight"><a href="#å…­-Frames-in-flight" class="headerlink" title="å…­. Frames in flight"></a>å…­. Frames in flight</h1><p>å¦‚æœåœ¨å¯ç”¨äº†éªŒè¯å±‚çš„æƒ…å†µä¸‹è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ç›‘è§†åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œåˆ™å¯èƒ½ä¼šæ³¨æ„åˆ°å®ƒæ­£åœ¨ç¼“æ…¢å¢é•¿ã€‚ </p>
<p>åŸå› æ˜¯åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨drawFrameå‡½æ•°å¿«é€Ÿæäº¤å·¥ä½œï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å·¥ä½œå®Œæˆã€‚å¦‚æœCPUæäº¤å·¥ä½œçš„é€Ÿåº¦å¿«äºGPUä¸èƒ½è·Ÿä¸Šçš„å·¥ä½œï¼Œé‚£ä¹ˆé˜Ÿåˆ—å°†ç¼“æ…¢åœ°å¡«æ»¡å·¥ä½œã€‚ æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæˆ‘ä»¬åŒæ—¶å¯¹å¤šä¸ªå¸§é‡ç”¨äº†imageAvailableSemaphoreå’ŒrenderFinishedSemaphoreã€‚</p>
<p>è§£å†³æ­¤é—®é¢˜çš„ç®€å•æ–¹æ³•æ˜¯æäº¤åç­‰å¾…å·¥ä½œå®Œæˆï¼Œä¾‹å¦‚ä½¿ç”¨vkQueueWaitIdleï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">vkQueuePresentKHR</span>(presentQueue, &amp;presentInfo);</span><br><span class="line">    <span class="built_in">vkQueueWaitIdle</span>(presentQueue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯èƒ½æ— æ³•ä»¥è¿™ç§æ–¹å¼æœ€ä½³åœ°ä½¿ç”¨GPUï¼Œå› ä¸ºæ•´ä¸ªå›¾å½¢æµæ°´çº¿ç°åœ¨ä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€å¸§ã€‚ å½“å‰å¸§å·²ç»ç»è¿‡çš„é˜¶æ®µæ˜¯ç©ºé—²çš„ï¼Œå¯èƒ½å·²ç»ç”¨äºä¸‹ä¸€å¸§ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ‰©å±•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œä»¥å…è®¸åœ¨è¿è¡Œå¤šä¸ªframeçš„åŒæ—¶ä»é™åˆ¶å †ç§¯çš„å·¥ä½œé‡ã€‚</p>
<p>é¦–å…ˆåœ¨ç¨‹åºé¡¶éƒ¨æ·»åŠ ä¸€ä¸ªå¸¸é‡ï¼Œè¯¥å¸¸é‡å®šä¹‰åº”åŒæ—¶å¤„ç†å¤šå°‘å¸§, ä»¥åŠæ¯ä¸ªframeåº”å…·æœ‰è‡ªå·±çš„ä¸€ç»„ä¿¡å·ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> MAX_FRAMES_IN_FLIGHT = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">std::vector&lt;VkSemaphore&gt; imageAvailableSemaphores;</span><br><span class="line">std::vector&lt;VkSemaphore&gt; renderFinishedSemaphores;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createSemaphores</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    imageAvailableSemaphores.<span class="built_in">resize</span>(MAX_FRAMES_IN_FLIGHT);</span><br><span class="line">    renderFinishedSemaphores.<span class="built_in">resize</span>(MAX_FRAMES_IN_FLIGHT);</span><br><span class="line"></span><br><span class="line">    VkSemaphoreCreateInfo semaphoreInfo = &#123;&#125;;</span><br><span class="line">    semaphoreInfo.sType = VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MAX_FRAMES_IN_FLIGHT; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">vkCreateSemaphore</span>(device, &amp;semaphoreInfo, <span class="literal">nullptr</span>, &amp;imageAvailableSemaphores[i]) != VK_SUCCESS</span><br><span class="line">                || <span class="built_in">vkCreateSemaphore</span>(device, &amp;semaphoreInfo, <span class="literal">nullptr</span>, &amp;renderFinishedSemaphores[i]) != VK_SUCCESS) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create semaphores for a frame!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MAX_FRAMES_IN_FLIGHT; i++) &#123;</span><br><span class="line">        <span class="built_in">vkDestroySemaphore</span>(device, renderFinishedSemaphores[i], <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">vkDestroySemaphore</span>(device, imageAvailableSemaphores[i], <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŒç†ï¼ŒdrawFrameä¹Ÿéœ€è¦ä¿®æ”¹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vkAcquireNextImageKHR</span>(device, swapChain, std::numeric_limits&lt;<span class="type">uint64_t</span>&gt;::<span class="built_in">max</span>(),</span><br><span class="line">            imageAvailableSemaphores[currentFrame], VK_NULL_HANDLE, &amp;imageIndex);</span><br><span class="line">    ...</span><br><span class="line">    VkSemaphore waitSemaphores[] = &#123;imageAvailableSemaphores[currentFrame]&#125;;</span><br><span class="line">    ...</span><br><span class="line">    VkSemaphore signalSemaphores[] = &#123;renderFinishedSemaphores[currentFrame]&#125;;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„currentFrameå¯ä»¥é€šè¿‡å–æ¨¡æ¥è·å–: currentFrame &#x3D; (currentFrame + 1)%MAX_FRAMES_IN_FLIGHT</p>
<p>é€šè¿‡ä½¿ç”¨æ¨¡ï¼ˆï¼…ï¼‰è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬ç¡®ä¿å¸§ç´¢å¼•åœ¨æ¯ä¸ªMAX_FRAMES_IN_FLIGHTæ’é˜Ÿçš„å¸§ä¹‹åå¾ªç¯ã€‚</p>
<h2 id="6-1-fenceæœºåˆ¶"><a href="#6-1-fenceæœºåˆ¶" class="headerlink" title="6.1 fenceæœºåˆ¶"></a>6.1 fenceæœºåˆ¶</h2><p>å°½ç®¡æˆ‘ä»¬ç°åœ¨å·²ç»è®¾ç½®äº†å¿…éœ€çš„å¯¹è±¡ä»¥æ–¹ä¾¿åŒæ—¶å¤„ç†å¤šä¸ªå¸§ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰é˜»æ­¢æäº¤è¶…è¿‡MAX_FRAMES_IN_FLIGHTä¸ªå¯¹è±¡ã€‚ ç°åœ¨åªæœ‰GPU-GPUåŒæ­¥ï¼Œæ²¡æœ‰CPU-GPUåŒæ­¥æ¥è·Ÿè¸ªå·¥ä½œçš„è¿›è¡Œæƒ…å†µã€‚ æˆ‘ä»¬å¯èƒ½æ­£åœ¨ä½¿ç”¨ç¬¬0å¸§å¯¹è±¡ï¼Œè€Œç¬¬0å¸§ä»åœ¨æ˜¾ç¤ºä¸­ï¼</p>
<p>ä¸ºäº†æ‰§è¡ŒCPU-GPUåŒæ­¥ï¼ŒVulkanæä¾›äº†ç¬¬äºŒç§ç±»å‹çš„åŒæ­¥åŸè¯­ï¼Œç§°ä¸ºfencesã€‚ åœ¨å¯ä»¥å‘ä¿¡å·å¹¶ç­‰å¾…ä¿¡å·çš„æ„ä¹‰ä¸Šï¼Œfenceä¸ä¿¡å·ç›¸ä¼¼ï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬å®é™…ä¸Šåœ¨è‡ªå·±çš„ä»£ç ä¸­ç­‰å¾…ä¿¡å·ã€‚ æˆ‘ä»¬é¦–å…ˆä¸ºæ¯ä¸ªæ¡†æ¶åˆ›å»ºä¸€ä¸ªfenceï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">std::vector&lt;VkSemaphore&gt; imageAvailableSemaphores;</span><br><span class="line">std::vector&lt;VkSemaphore&gt; renderFinishedSemaphores;</span><br><span class="line">std::vector&lt;VkFence&gt; inFlightFences;</span><br><span class="line"><span class="type">size_t</span> currentFrame = <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºfenceä¹Ÿæ˜¯åŒæ­¥æœºåˆ¶ï¼Œæ‰€ä»¥æœ€å¥½æŠŠåŒæ­¥å¯¹è±¡çš„åˆ›å»ºæ”¾åœ¨ä¸€èµ·ï¼Œå§createSemaphoresæ”¹åæˆcreateSyncObjects:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">createSyncObjects</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    imageAvailableSemaphores.<span class="built_in">resize</span>(MAX_FRAMES_IN_FLIGHT);</span><br><span class="line">    renderFinishedSemaphores.<span class="built_in">resize</span>(MAX_FRAMES_IN_FLIGHT);</span><br><span class="line">    inFlightFences.<span class="built_in">resize</span>(MAX_FRAMES_IN_FLIGHT);</span><br><span class="line"></span><br><span class="line">    VkSemaphoreCreateInfo semaphoreInfo = &#123;&#125;;</span><br><span class="line">    semaphoreInfo.sType = VK_STRUCTURE_TYPE_SEMAPHORE_CREATE_INFO;</span><br><span class="line"></span><br><span class="line">    VkFenceCreateInfo fenceInfo = &#123;&#125;;</span><br><span class="line">    fenceInfo.sType = VK_STRUCTURE_TYPE_FENCE_CREATE_INFO;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MAX_FRAMES_IN_FLIGHT; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">vkCreateSemaphore</span>(device, &amp;semaphoreInfo, <span class="literal">nullptr</span>, &amp;imageAvailableSemaphores[i]) != VK_SUCCESS</span><br><span class="line">                || <span class="built_in">vkCreateSemaphore</span>(device, &amp;semaphoreInfo, <span class="literal">nullptr</span>, &amp;renderFinishedSemaphores[i]) != VK_SUCCESS</span><br><span class="line">                || <span class="built_in">vkCreateFence</span>(device, &amp;fenceInfo, <span class="literal">nullptr</span>, &amp;inFlightFences[i]) != VK_SUCCESS) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to create synchronization objects for a frame!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿè¦è®°å¾—é”€æ¯fence.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// é‡Šæ”¾ä¿¡å·é‡å’Œfence</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; MAX_FRAMES_IN_FLIGHT; i ++) &#123;</span><br><span class="line">        <span class="built_in">vkDestroySemaphore</span>(device, renderFinishedSemaphores[i], <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="built_in">vkDestroySemaphore</span>(device, imageAvailableSemaphores[i], <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vkDestroyFence</span>(device, inFlightFences[i], <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä½¿ç”¨fenceè¿›è¡ŒåŒæ­¥ã€‚vkqueuessubmitè°ƒç”¨åŒ…å«ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºä¼ é€’ä¸€ä¸ªfenceï¼Œå½“å‘½ä»¤ç¼“å†²åŒºæ‰§è¡Œå®Œæ¯•æ—¶ï¼Œè¯¥fenceåº”è¯¥è¢«é€šçŸ¥ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¡¨ç¤ºä¸€ä¸ªå¸§å·²ç»å®Œæˆã€‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">drawFrame</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ç­‰å¾…å½“å‰å¸§fenceå®Œæˆ</span></span><br><span class="line">    <span class="built_in">vkWaitForFences</span>(device, <span class="number">1</span>, &amp;inFlightFences[currentFrame], VK_TRUE, std::numeric_limits&lt;<span class="type">uint64_t</span>&gt;::<span class="built_in">max</span>());</span><br><span class="line">    <span class="built_in">vkResetFences</span>(device, <span class="number">1</span>, &amp;inFlightFences[currentFrame]);</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// VkQueueæ˜¯Vulkanä¸­åº”ç”¨ç¨‹åºå‘GPUæäº¤å‘½ä»¤çš„å”¯ä¸€é€”å¾„</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">vkQueueSubmit</span>(graphicsQueue, <span class="number">1</span>, &amp;submitInfo, inFlightFences[currentFrame]) != VK_SUCCESS) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;failed to submit draw command buffer!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>vkWaitForFenceså‡½æ•°æ¥å—ä¸€ä¸ªfencesæ•°ç»„ï¼Œåœ¨è¿”å›ä¹‹å‰ç­‰å¾…å…¶ä¸­ä»»ä½•ä¸€ä¸ªæˆ–è€…æ‰€æœ‰çš„æ …æ è¢«é€šçŸ¥ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä¼ é€’çš„VK_TRUEè¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ç­‰å¾…æ‰€æœ‰çš„fenceï¼Œä½†åœ¨å•ä¸ªfenceçš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¾ç„¶æ— å…³ç´§è¦ã€‚å°±åƒvkAcquireNextImageKHRä¸€æ ·ï¼Œè¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯éœ€è¦ä¸€ä¸ªè¶…æ—¶ã€‚</p>
<p>ä¸ä¿¡å·é‡ä¸åŒï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡vkResetFencesè°ƒç”¨æ¥æ‰‹åŠ¨å°†æ …æ æ¢å¤åˆ°æ— ä¿¡å·çŠ¶æ€ã€‚å¦‚æœä½ ç°åœ¨è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œä½ ä¼šæ³¨æ„åˆ°ä¸€äº›å¥‡æ€ªçš„ä¸œè¥¿ã€‚åº”ç”¨ç¨‹åºä¼¼ä¹ä¸å†å‘ˆç°ä»»ä½•ä¸œè¥¿ã€‚<br>è¿™æ˜¯å› ä¸ºåœ¨ç­‰ä¸€ä¸ªè¿˜æ²¡è¢«æäº¤çš„fence! è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œfenceæ˜¯åœ¨æ— ä¿¡å·çŠ¶æ€ä¸‹åˆ›å»ºçš„ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬ä»¥å‰æ²¡æœ‰ç”¨è¿‡fenceï¼ŒvkWaitForFenceså°†ä¼šæ°¸è¿œç­‰ä¸‹å»ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜fenceçš„åˆ›å»ºï¼Œåœ¨æœ‰ä¿¡å·çš„çŠ¶æ€ä¸‹åˆå§‹åŒ–å®ƒï¼Œå°±åƒæˆ‘ä»¬å·²ç»å®Œæˆäº†åˆå§‹å¸§çš„æ¸²æŸ“ä¸€æ ·:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">VkFenceCreateInfo fenceInfo = &#123;&#125;;</span><br><span class="line">fenceInfo.sType = VK_STRUCTURE_TYPE_FENCE_CREATE_INFO;</span><br><span class="line">fenceInfo.flags = VK_FENCE_CREATE_SIGNALED_BIT; <span class="comment">// åˆå§‹åŒ–fence</span></span><br></pre></td></tr></table></figure>

<p>ç¨‹åºç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼Œå†…å­˜æ³„æ¼ä¹Ÿæ¶ˆå¤±äº†! æˆ‘ä»¬å·²ç»å®ç°äº†æ‰€æœ‰éœ€è¦çš„åŒæ­¥ï¼Œä»¥ç¡®ä¿æ’é˜Ÿçš„å·¥ä½œä¸è¶…è¿‡ä¸¤ä¸ªå¸§ã€‚è¯·æ³¨æ„ï¼Œä»£ç çš„å…¶ä»–éƒ¨åˆ†ï¼Œå¦‚æœ€ç»ˆçš„æ¸…ç†ï¼Œå¯ä»¥ä¾èµ–äºæ›´ç²—ç³™çš„åŒæ­¥ï¼Œå¦‚vkDeviceWaitIdleï¼Œåº”è¯¥æ ¹æ®æ€§èƒ½éœ€æ±‚å†³å®šä½¿ç”¨å“ªç§æ–¹æ³•ã€‚</p>
<p><img src="/images/Vulkan%E5%85%A5%E9%97%A8-9-%E6%B8%B2%E6%9F%93%E5%92%8C%E6%98%BE%E7%A4%BA/Vulkan_9_2.png" alt="å›¾ç‰‡"><br>Vulkanç®¡é“çš„æ¡†å›¾</p>
<h1 id="ä¸ƒ-æ€»ç»“"><a href="#ä¸ƒ-æ€»ç»“" class="headerlink" title="ä¸ƒ. æ€»ç»“"></a>ä¸ƒ. æ€»ç»“</h1><p>ç°åœ¨æˆ‘ä»¬å·²ç»å†™äº†ä¸€åƒå¤šè¡Œçš„ä»£ç ï¼Œæ€»ç®—æŠŠVulkançš„è¿™ä¸€å¥—ç®€å•çš„è¿‡äº†ä¸€éã€‚åœ¨ç»§ç»­åç»­å­¦ä¹ ä¹‹å‰ï¼Œæœ‰å¿…è¦å…ˆæ€»ç»“ä¸€ä¸‹ï¼Œå·©å›ºåŸºç¡€ã€‚</p>
<p>é¦–å…ˆVulkanæ˜¯ä»€ä¹ˆï¼šVulkanæ˜¯ä¸€ä¸ªä½å¼€é”€ã€è·¨å¹³å°çš„äºŒç»´ã€ä¸‰ç»´å›¾å½¢ä¸è®¡ç®—çš„åº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰ã€‚æœ¬èº«æ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„APIï¼Œæ‰€ä»¥ä¸åŒ…æ‹¬ç”¨äºåˆ›å»ºæ˜¾ç¤ºæ¸²æŸ“ç»“æœçš„çª—å£çš„å·¥å…·ã€‚æ‰€ä»¥å€ŸåŠ© GLFW ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–åº“å¦‚SDLï¼‰åˆ›å»ºçª—å£ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªVuklanåº”ç”¨ä¸€èˆ¬æµç¨‹çš„ç®€è¿°:</p>
<ol>
<li>å€ŸåŠ©GLFWåº“ï¼Œåˆ›å»ºæ˜¾ç¤ºçª—å£ã€‚</li>
<li>åˆ›å»ºVulkanå®ä¾‹VkInstance<ol>
<li>ä½¿ç”¨VkApplicationInfoå’ŒVkInstanceCreateInfoå£°æ˜ç›¸å…³é…ç½®</li>
<li>è°ƒç”¨ vkCreateInstance, åˆ›å»º vulkan å®ä¾‹</li>
</ol>
</li>
<li>å¦‚æœæ˜¯å¼€å‘è°ƒè¯•ï¼Œå¯ä»¥å¯ç”¨éªŒè¯å±‚<ol>
<li>å®ç°è°ƒè¯•å›è°ƒå‡½æ•°</li>
<li>é€šè¿‡VkDebugUtilsMessengerCreateInfoEXT.pfnUserCallbackç»‘å®šæ¶ˆæ¯å›è°ƒå‡½æ•°</li>
<li>é€šè¿‡CreateDebugUtilsMessengerEXTå‡½æ•°å®ä¾‹åŒ–DebugUtilsMessengerEXT</li>
<li>æ³¨æ„åœ¨ä¸éœ€è¦çš„æ—¶å€™æ˜¾ç¤ºé”€æ¯å›è°ƒå®ä¾‹ PFN_vkDestroyDebugUtilsMessengerEXT</li>
</ol>
</li>
<li>æ£€ç´¢åˆé€‚çš„ç‰©ç†è®¾å¤‡<ol>
<li>é€šè¿‡vkEnumeratePhysicalDevicesè·å–æœ¬æœºç‰©ç†æ˜¾å¡ï¼Œå¹¶æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚GPU<ol>
<li>é€šè¿‡vkGetPhysicalDevicePropertiesæ£€æŸ¥æ˜¾å¡çš„åŸºæœ¬åŠŸèƒ½</li>
<li>æŸ¥è¯¢vkGetPhysicalDeviceFeaturesä¸­å¯ä»¥è¢«æ”¯æŒçš„feature</li>
</ol>
</li>
<li>æŒ‘é€‰éœ€è¦çš„é˜Ÿåˆ—æ—<ol>
<li>é€šè¿‡vkGetPhysicalDeviceQueueFamilyPropertiesè·å–ç‰©ç†æ˜¾å¡æ”¯æŒçš„é˜Ÿåˆ—ï¼Œå¹¶æŒ‘é€‰éœ€è¦çš„é˜Ÿåˆ—</li>
</ol>
</li>
</ol>
</li>
<li>åˆ›å»ºé€»è¾‘è®¾å¤‡ VkDevice<ol>
<li>é¦–å…ˆå°†4.2.1ä¸­æŒ‘é€‰çš„é˜Ÿåˆ—è®°å½•åœ¨VkDeviceQueueCreateInfoä¸­ï¼ŒæŒ‡å®šè¦åˆ›å»ºçš„é˜Ÿåˆ—VkDeviceCreateInfo.pQueueCreateInfos</li>
<li>æŒ‡å®šä½¿ç”¨çš„è®¾å¤‡åŠŸèƒ½(feature)ï¼Œæ¯”å¦‚å‡ ä½•ç€è‰²å™¨ç­‰</li>
<li>é€šè¿‡vkCreateDeviceå‡½æ•°åˆ›å»ºé€»è¾‘è®¾å¤‡ï¼Œæ³¨æ„åœ¨ä¸éœ€è¦çš„æ—¶å€™æ˜¾ç¤ºé”€æ¯é€»è¾‘è®¾å¤‡(vkDestroyDevice)</li>
<li>é˜Ÿåˆ—æ˜¯ä¸é€»è¾‘è®¾å¤‡ä¸€èµ·è‡ªåŠ¨åˆ›å»ºçš„ï¼Œç›´æ¥é€šè¿‡vkGetDeviceQueueè·å–è¯¥é€»è¾‘è®¾å¤‡ä¸ŠæŒ‡å®šçš„é˜Ÿåˆ—å³å¯ï¼ˆå½“é€»è¾‘è®¾å¤‡è¢«é”€æ¯æ—¶ï¼Œä¼šéšå¼æ¸…é™¤è®¾å¤‡é˜Ÿåˆ—ï¼‰</li>
</ol>
</li>
<li>åˆ›å»ºSurface<ol>
<li>å¯ç”¨VK_KHR_surfaceæ‰©å±•ï¼Œé€šè¿‡glfwçš„glfwCreateWindowSurfaceåˆ›å»ºVkSurfaceKHR</li>
</ol>
</li>
<li>åˆ›å»ºäº¤æ¢é“¾ï¼Œå³æ¸²æŸ“ç¼“å†²åŒº, æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç­‰å¾…å‘ˆç°ç»™å±å¹•çš„å›¾åƒé˜Ÿåˆ—<ol>
<li>æ£€æŸ¥GPUæ˜¯å¦æ”¯æŒäº¤æ¢é“¾ï¼ŒVK_KHR_SWAPCHAIN_EXTENSION_NAME</li>
<li>ä½¿èƒ½è®¾å¤‡VK_KHR_swapchainæ‰©å±•</li>
<li>è·å–å…³äºswap chainæ›´å¤šæ”¯æŒç»†èŠ‚<ol>
<li>åŸºæœ¬SurfaceåŠŸèƒ½ï¼ˆäº¤æ¢é“¾ä¸­çš„æœ€å°&#x2F;æœ€å¤§å›¾åƒæ•°ï¼Œå›¾åƒçš„æœ€å°&#x2F;æœ€å¤§å®½åº¦å’Œé«˜åº¦ï¼‰</li>
<li>Surfaceçš„æ ¼å¼ï¼ˆåƒç´ æ ¼å¼ï¼Œè‰²å½©ç©ºé—´ï¼‰</li>
<li>å¯ç”¨çš„å‘ˆç°æ¨¡å¼</li>
</ol>
</li>
<li>ä¸ºäº¤æ¢é“¾é€‰æ‹©åˆé€‚çš„è®¾ç½®ï¼Œå¦‚Surfaceæ ¼å¼ï¼ˆé¢œè‰²æ·±åº¦ï¼‰ã€å‘ˆç°æ¨¡å¼ï¼ˆå°†å›¾åƒâ€œäº¤æ¢â€åˆ°å±å¹•çš„æ¡ä»¶ï¼‰ã€äº¤æ¢èŒƒå›´ï¼ˆäº¤æ¢é“¾ä¸­å›¾åƒçš„åˆ†è¾¨ç‡ï¼‰ç­‰</li>
<li>åˆ›å»ºswap chainå¯¹è±¡ VkSwapchainKHR<ol>
<li>ç»‘å®šçª—å£Surface</li>
<li>è®¾ç½®æœ€å°å›¾åƒæ•°é‡ minImageCount</li>
<li>é€‰æ‹©åˆé€‚çš„å›¾åƒæ ¼å¼ imageFormat </li>
<li>é€‰æ‹©åˆé€‚çš„å›¾åƒé¢œè‰²ç©ºé—´ imageColorSpace</li>
<li>é€‰æ‹©åˆé€‚çš„å›¾åƒåˆ†è¾¨ç‡ imageExtent</li>
<li>è®¾ç½®å›¾åƒå›¾å±‚ imageArrayLayers</li>
<li>è®¾ç½®å›¾åƒæ“ä½œæ–¹å¼ imageUsage</li>
<li>é€‰æ‹©å›¾åƒå‘ˆç°æ¨¡å¼ presentMode</li>
<li>æ˜¯å¦éœ€è¦è£å‰ªåŠŸèƒ½ clipped(VK_TRUE, VK_FALSE)</li>
<li>è®¾ç½®æ—§äº¤æ¢é“¾çš„å¼•ç”¨ oldSwapchain</li>
</ol>
</li>
<li>è·å–äº¤æ¢é“¾å›¾åƒ(VkImage)å¯¹è±¡é›†åˆ</li>
</ol>
</li>
<li>åˆ›å»ºæ¸²æŸ“è¿‡ç¨‹ï¼ŒRender Passes<ol>
<li>é€šè¿‡vkCreateRenderPassåˆ›å»ºï¼Œåœ¨ä¸éœ€è¦æ—¶é€šè¿‡vkDestroyRenderPassé”€æ¯</li>
</ol>
</li>
<li>åˆ›å»ºå›¾å½¢ç®¡é“, åœ¨Vulkanä¸­ï¼Œå¿…é¡»æ˜ç¡®æ‰€æœ‰å†…å®¹ï¼Œä»è§†å£å¤§å°åˆ°é¢œè‰²æ··åˆåŠŸèƒ½ã€‚æœ‰å¦‚ä¸‹å‡ ä¸ªå›ºå®šæ“ä½œï¼š<ol>
<li>è¾“å…¥æ±‡ç¼–ç¨‹åº(input assembler): ä»æŒ‡å®šçš„ç¼“å†²åŒºæ”¶é›†åŸå§‹é¡¶ç‚¹æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç´¢å¼•ç¼“å†²åŒºé‡å¤æŸäº›å…ƒç´ ï¼Œè€Œä¸å¿…å¤åˆ¶é¡¶ç‚¹æ•°æ®æœ¬èº«ã€‚</li>
<li>é¡¶ç‚¹ç€è‰²å™¨(vertex shader): é’ˆå¯¹æ¯ä¸ªé¡¶ç‚¹è¿è¡Œï¼Œå¹¶ä¸”é€šå¸¸åº”ç”¨å˜æ¢ä»¥å°†é¡¶ç‚¹ä½ç½®ä»æ¨¡å‹ç©ºé—´è½¬æ¢åˆ°å±å¹•ç©ºé—´ã€‚å®ƒè¿˜æ²¿ç€ç®¡é“ä¼ é€’æ¯é¡¶ç‚¹æ•°æ®ã€‚</li>
<li>æ›²é¢ç»†åˆ†ç€è‰²å™¨(tessellation shaders): æ ¹æ®ç‰¹å®šè§„åˆ™ç»†åˆ†å‡ ä½•ä½“ä»¥æé«˜ç½‘æ ¼è´¨é‡ã€‚é€šå¸¸ç”¨äºä½¿ç –å¢™å’Œæ¥¼æ¢¯ç­‰è¡¨é¢åœ¨é™„è¿‘æ—¶çœ‹èµ·æ¥ä¸é‚£ä¹ˆå¹³å¦ã€‚</li>
<li>å‡ ä½•ç€è‰²å™¨(geometry shader): åœ¨æ¯ä¸ªåŸºå…ƒ(ä¸‰è§’å½¢ï¼Œç›´çº¿ï¼Œç‚¹)ä¸Šè¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥ä¸¢å¼ƒå®ƒæˆ–è¾“å‡ºæ¯”åŸæ¥æ›´å¤šçš„åŸºå…ƒã€‚ç±»ä¼¼äºæ›²é¢ç»†åˆ†ç€è‰²å™¨ï¼Œä½†æ›´çµæ´»ã€‚ä½†æ²¡æœ‰å¾—åˆ°å¤ªå¤šåº”ç”¨ï¼Œå› ä¸ºå¤§å¤šæ•°æ˜¾å¡çš„æ€§èƒ½éƒ½ä¸æ˜¯å¾ˆå¥½ã€‚</li>
<li>å…‰æ …åŒ–é˜¶æ®µ(rasterization stage): å°†åŸºå…ƒç¦»æ•£åŒ–ä¸ºç‰‡æ®µã€‚è¿™äº›æ˜¯å®ƒä»¬å¡«å……åœ¨å¸§ç¼“å†²åŒºä¸Šçš„åƒç´ å…ƒç´ ã€‚åœ¨å±å¹•ä¹‹å¤–çš„ç‰‡æ®µéƒ½å°†è¢«ä¸¢å¼ƒï¼Œé¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„å±æ€§å°†åœ¨ç‰‡æ®µä¹‹é—´è¿›è¡Œæ’å€¼ã€‚ç”±äºæ·±åº¦æµ‹è¯•ï¼Œé€šå¸¸åœ¨è¿™é‡Œä¹Ÿä¸¢å¼ƒå…¶ä»–åŸå§‹ç‰‡æ®µåé¢çš„ç‰‡æ®µã€‚</li>
<li>ç‰‡æ®µç€è‰²å™¨(fragment shader): ä¸ºå­˜æ´»çš„æ¯ä¸ªç‰‡æ®µè°ƒç”¨ç‰‡æ®µç€è‰²å™¨ï¼Œå¹¶ç¡®å®šç‰‡æ®µå†™å…¥å“ªäº›å¸§ç¼“å†²åŒºä»¥åŠä½¿ç”¨å“ªäº›é¢œè‰²å’Œæ·±åº¦å€¼ã€‚å®ƒå¯ä»¥ä½¿ç”¨æ¥è‡ªé¡¶ç‚¹ç€è‰²å™¨çš„æ’å€¼æ•°æ®æ¥å®Œæˆæ­¤æ“ä½œï¼Œå…¶ä¸­å¯ä»¥åŒ…æ‹¬çº¹ç†åæ ‡å’Œæ³•çº¿ç…§æ˜ç­‰å†…å®¹ã€‚</li>
<li>é¢œè‰²æ··åˆé˜¶æ®µ(color blending stage): åº”ç”¨æ“ä½œæ¥æ··åˆæ˜ å°„åˆ°å¸§ç¼“å†²åŒºä¸­çš„ç›¸åŒåƒç´ çš„ä¸åŒç‰‡æ®µã€‚ fragmentå¯ä»¥ç®€å•åœ°ç›¸äº’è¦†ç›–ï¼ŒåŠ èµ·æ¥æˆ–æ ¹æ®é€æ˜åº¦è¿›è¡Œæ··åˆã€‚<ol>
<li>è¾“å…¥æ±‡ç¼–ç¨‹åºã€å…‰æ …åŒ–å’Œé¢œè‰²æ··åˆé˜¶æ®µé˜¶æ®µè¢«ç§°ä¸ºå›ºå®šåŠŸèƒ½é˜¶æ®µã€‚è¿™äº›é˜¶æ®µå…è®¸ä½¿ç”¨å‚æ•°è°ƒæ•´å…¶æ“ä½œï¼Œä½†å®ƒä»¬çš„å·¥ä½œæ–¹å¼æ˜¯é¢„å®šä¹‰çš„ã€‚</li>
<li>é¡¶ç‚¹ç€è‰²å™¨ã€æ›²é¢ç»†åˆ†ç€è‰²å™¨ã€å‡ ä½•ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨é˜¶æ®µæ˜¯å¯ç¼–ç¨‹çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥å°†ä»£ç ä¸Šä¼ åˆ°å›¾å½¢å¡ï¼Œä»¥å®Œå…¨åº”ç”¨æƒ³è¦çš„æ“ä½œã€‚ </li>
<li>ä¾‹å¦‚ï¼Œå®ç°ä»çº¹ç†å’Œå…‰ç…§åˆ°å…‰çº¿è·Ÿè¸ªå™¨çš„ä»»ä½•å†…å®¹ã€‚è¿™äº›ç¨‹åºåŒæ—¶åœ¨è®¸å¤šGPUå†…æ ¸ä¸Šè¿è¡Œï¼Œä»¥å¹¶è¡Œå¤„ç†è®¸å¤šå¯¹è±¡ï¼Œå¦‚é¡¶ç‚¹å’Œç‰‡æ®µã€‚ï¼Œå¯ä»¥ä½¿ç”¨ç‰‡æ®µç€è‰²å™¨</li>
</ol>
</li>
<li>é€šè¿‡vkCreateGraphicsPipelinesåˆ›å»ºå›¾å½¢ç®¡é“ï¼ŒæŒ‡æ˜æ¸²æŸ“è¿‡ç¨‹</li>
</ol>
</li>
<li>åˆ›å»ºå¸§ç¼“å†²åŒº<ol>
<li>è°ƒæ•´å¸§ç¼“å†²åŒºå®¹å™¨çš„å¤§å°ä»¥å®¹çº³æ‰€æœ‰äº¤æ¢é“¾å›¾åƒè§†å›¾</li>
<li>æŒ‡å®šå¸§ç¼“å†²åŒºéœ€è¦ä¸å“ªä¸ªrenderPasså…¼å®¹ã€‚åªèƒ½å¯¹ä¸ä¹‹å…¼å®¹çš„æ¸²æŸ“è¿‡ç¨‹ä½¿ç”¨å¸§ç¼“å†²åŒºï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä½¿ç”¨ç›¸åŒæ•°é‡å’Œç±»å‹çš„é™„ä»¶ã€‚</li>
<li>attachmentCountå’ŒpAttachmentså‚æ•°æŒ‡å®šåº”ç»‘å®šåˆ°æ¸²æŸ“è¿‡ç¨‹pAttachmentæ•°ç»„ä¸­ç›¸åº”é™„ä»¶æè¿°çš„VkImageViewå¯¹è±¡ã€‚</li>
<li>å¸§ç¼“å†²åŒºå®½åº¦å’Œé«˜åº¦å‚æ•°æ˜¯äº¤æ¢é“¾ä¸­è·å–çš„å®½é«˜</li>
<li>å¸§ç¼“å†²åŒºçš„layersæ˜¯æŒ‡å›¾åƒæ•°ç»„ä¸­çš„å±‚æ•°</li>
<li>åœ¨ä¸éœ€è¦æ—¶ï¼Œé€šè¿‡vkDestroyFramebufferé”€æ¯å¸§ç¼“å†²åŒº</li>
</ol>
</li>
<li>åˆ›å»ºæŒ‡ä»¤ç¼“å†²åŒºï¼ŒVulkanå¿…é¡»åœ¨æŒ‡ä»¤ç¼“å†²åŒºå¯¹è±¡ä¸­è®°å½•æƒ³è¦æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œ<ol>
<li>å…ˆåˆ›å»ºåˆ›å»ºæŒ‡ä»¤ç¼“å†²æ± ï¼ŒCommand pool</li>
<li>åˆ›å»ºæŒ‡ä»¤ç¼“å†²åŒºï¼Œå¤§å°å’Œå¸§ç¼“å†²ä¸€è‡´</li>
</ol>
</li>
<li>æ¸²æŸ“å’Œæ˜¾ç¤º<ol>
<li>ä»äº¤æ¢é“¾è·å–ä¸€ä¸ªæ˜ åƒ</li>
<li>åœ¨framebufferä¸­ä»¥è¯¥å›¾åƒä½œä¸ºé™„ä»¶æ‰§è¡Œå‘½ä»¤ç¼“å†²ï¼Œæäº¤æŒ‡ä»¤ç¼“å†²åŒº</li>
<li>å°†å›¾åƒè¿”å›åˆ°äº¤æ¢é“¾ä»¥ä¾¿æ˜¾ç¤º</li>
<li>æ¸²æŸ“æ˜¾ç¤ºçš„è¿‡ç¨‹éœ€è¦åŒæ­¥</li>
</ol>
</li>
</ol>
<p>å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬åˆåŠ æ·±äº†ä¸€éå°è±¡ï¼Œè¿™å…¶ä¸­è¯¸å¤šç»†èŠ‚æˆ‘ä»¬åç»­æŒ–æ˜ã€‚</p>
]]></content>
      <categories>
        <category>å›¾åƒå¼•æ“</category>
      </categories>
      <tags>
        <tag>Vulkan</tag>
      </tags>
  </entry>
</search>
